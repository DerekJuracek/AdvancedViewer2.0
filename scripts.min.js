// @ts-nocheck
require(["esri/WebMap","esri/views/MapView","esri/layers/FeatureLayer","esri/layers/ImageryLayer","esri/layers/MapImageLayer","esri/core/reactiveUtils","esri/Graphic","esri/geometry/geometryEngine","esri/layers/GraphicsLayer","esri/widgets/Sketch/SketchViewModel","esri/widgets/DistanceMeasurement2D","esri/widgets/AreaMeasurement2D","esri/widgets/BasemapLayerList","esri/widgets/Bookmarks","esri/widgets/Legend","esri/widgets/Print","esri/layers/support/TileInfo","esri/geometry/Extent","esri/rest/support/PrintTemplate","esri/rest/support/PrintParameters","esri/widgets/Print/PrintViewModel","esri/widgets/Print/TemplateOptions"],(function(e,t,i,a,n,r,s,l,o,d,c,u,p,m,h,g,f,b,y,v,w,x){const _=new URLSearchParams(window.location.search);let T=window.location.href,I=_.get("viewer");let L=["columbiact","columbiactnew","haddamct","northcanaanct","roxburyct","roxburyctassessor","scotlandct","warrenct","warrenctassessor","washingtonct","wiltonct","wiltoncttest","wolcottct","woodbridgect","newingtonct"].join("|"),S=new RegExp(`\\?viewer=cama\\/(${L})(\\&\\w+=\\w+)*$`);null!=I&&S.test(T)?(I+=".json",$("#whole-app").show()):"https://terrenogis.com"===window.location.href||"https://terrenogis.com/"===window.location.href?window.location.href="https://www.qds.biz/gis-service":window.location.href="./onload.html";const M={mapId:"",condoLayer:"",title:"",isCondosLayer:"",noCondoLayer:""};fetch(I).then((e=>e.json())).then((b=>{b.layers;function y(e){var t=new Date(e),i=t.getDate();return t.getMonth()+1+"/"+i+"/"+t.getFullYear()}M.mapId=b.webmapId||"6448b08504de4244973a28305b18271f",M.condoLayer=b.condoLayer,M.noCondoLayer=b.noCondoLayer,M.title=b.title,M.isCondosLayer=b.condos,M.masterTable=b.masterTable,M.zoom=b.zoom,M.parcelZoom=b.parcelZoom,M.imageUrl=b.imageUrl,M.welcomeImage=b.welcomeImage,M.pdf_Image=b.pdf_Image,M.pdf_demo=b.pdf_demographics,M.taxMap_Url=b.taxMapUrl,M.parcelMapUrl=b.parcelMapUrl,M.housingUrl=b.housingUrl,M.propertyCard=b.propertyCard,M.tax_bill=b.tax_bill,M.useVisionForTaxBillUrl=b.useVisionForTaxBillUrl,M.accessorName=b.accessorName,M.parcelTitle=b.parcelServiceTitle,M.tabTitle=b.tabTitle,M.basemapTitle=b.basemapTitle,M.parcelRenderer=b.parcelRenderer,M.useUniqueIdforParcelMap=b.useUniqueIdforParcelMap,M.helpUrl=b.helpUrl,M.includeFilter=b.includeFilter,M.customWelcomePage=b.customWelcomePage,M.customWelcomeMessage=b.customWelcomeMessage,M.showDisclaimer=b.showDisclaimer,M.customDisclaimerPage=b.customDisclaimerPage,M.customDisclaimerMessage=b.customDisclaimerMessage,M.DetailLinks=b.DetailLinks,M.DetailLinksToInclude=b.DetailLinksToInclude,M.includePermitLink=b.includePermitLink,"no"===M.showDisclaimer&&(sessionStorage.setItem("agreedToDisclaimer","yes"),$("#starterModal").modal("hide")),"yes"===M.customWelcomePage&&(document.getElementById("welcomeMessage").innerHTML=M.customWelcomeMessage),"yes"===M.customDisclaimerPage&&(document.getElementById("disclaimer-text").innerHTML=M.customDisclaimerMessage),"yes"===M.includePermitLink&&(M.permitLink=b.permitLink),document.getElementById("AccessorName").innerHTML=b.accessorName,$(".help-url").attr("href",M.helpUrl),document.getElementById("title").innerHTML=M.title,document.getElementById("print-title").innerHTML=M.title,document.getElementById("imageContainer").src=M.welcomeImage,document.getElementById("print-image").src=M.welcomeImage,document.getElementById("tab-title").innerHTML=M.tabTitle;const v="No geometry";sessionStorage.setItem("condos",M.isCondosLayer);const w=new o,_=new o,T=new e({portalItem:{id:M.mapId},layers:[w]});f.create({numLODs:30}).lods;var I=new t({container:"viewDiv",map:T,units:"imperial",zoom:`${M.zoom}`,popupEnabled:!1,ui:{components:["attribution"]}});I.when((()=>{M.homeExtent=I.extent})),"no"===M.includeFilter&&$("#filterButton").remove(),I.when((()=>{"yes"==sessionStorage.getItem("agreedToDisclaimer")||1==S?$("#starterModal").modal("hide"):$("#starterModal").modal("show"),$(document).ready((function(){$("#agreeBtn").prop("disabled",!0),$("#agreeCheck").change((function(){$(this).is(":checked")?($("#agreeBtn").prop("disabled",!1),sessionStorage.setItem("agreedToDisclaimer","yes")):$("#agreeBtn").prop("disabled",!0)}))}))})),I.when((()=>{document.getElementById("urlButton").addEventListener("click",(function(e){let t=urlInput.value;t.length>0&&function(){let e=new i({url:`${t}`});e.load().then((()=>{T.add(e),$("#urlMessage").html('<strong><p style="color:green;">Successfully uploaded REST Service.</p></strong>'),T.layers.on("change",(function(e){console.log(e," layer was added/removed from the map.")}));var t=$("#layerList");Se(e,t),urlInput.value=""})).catch((e=>{$("#urlMessage").html('<strong><p style="color:red;">Error uploading REST Service.</p></strong>'),console.error("Error loading the FeatureLayer:",e)}))}()}))})),I.when((()=>{document.getElementById("urlButtonImagery").addEventListener("click",(function(e){let t=urlInputImagery.value;t.length>0&&function(){let e=new a({url:`${t}`});e.load().then((()=>{T.add(e),$("#urlMessageImagery").html('<strong><p style="color:green;">Successfully uploaded REST Service.</p></strong>'),T.layers.on("change",(function(e){console.log(e," layer was added/removed from the map.")}));var t=$("#layerList");Se(e,t),urlInput.value=""})).catch((e=>{$("#urlMessageImagery").html('<strong><p style="color:red;">Error uploading REST Service.</p></strong>'),console.error("Error loading the FeatureLayer:",e)}))}()}))})),I.when((()=>{document.getElementById("urlButtonMapService").addEventListener("click",(function(e){let t=urlInputMapService.value;t.length>0&&function(){let e=new n({url:`${t}`});e.load().then((()=>{T.add(e),$("#urlMessageMapService").html('<strong><p style="color:green;">Successfully uploaded REST Service.</p></strong>'),T.layers.on("change",(function(e){console.log(e," layer was added/removed from the map.")}));var t=$("#layerList");Se(e,t),urlInput.value=""})).catch((e=>{$("#urlMessageMapService").html('<strong><p style="color:red;">Error uploading REST Service.</p></strong>'),console.error("Error loading the FeatureLayer:",e)}))}()}))})),I.when((()=>{const e=T.layers.items.filter((e=>!("group"===e.type&&e.title&&"hidden group"===e.title.toLowerCase()||e.title&&e.title===`${M.parcelTitle}`)));new h({view:I,container:$("#LegendDiv")[0],layerInfos:e.map((e=>({layer:e})))})})),I.when((()=>{new m({view:I,container:$("#BookmarksDiv")[0],dragEnabled:!0})}));new x({title:"Print Map at Scale 1:1200",layout:"a4-portrait",scale:1200,scaleEnabled:!0,dpi:96,legendEnabled:!0,northArrowEnabled:!0}),new x({title:"Print Map at Scale 1:2400",layout:"a4-portrait",scale:2400,scaleEnabled:!0,dpi:96,legendEnabled:!0,northArrowEnabled:!0});I.when((()=>{new g({view:I,container:$("#PrintDiv")[0],templateOptions:{title:"Print Map at Scale 1:1200",layout:"a4-portrait",scale:1200,scaleEnabled:!0,dpi:96,legendEnabled:!0,northArrowEnabled:!0},allowedLayouts:["letter-ansi-a-landscape","letter-ansi-a-portrait","tabloid-ansi-b-landscape","tabloid-ansi-b-portrait","a3-landscape","a3-portrait","a4-landscape","a4-portrait"]})})),I.when((()=>{let e;new p({view:I,container:$("#BasemapDiv")[0],dragEnabled:!0}).visibleElements={statusIndicators:!0,baseLayers:!0,referenceLayers:!1,referenceLayersTitle:!1,errors:!0,heading:!1};let t={type:"simple",symbol:{type:"simple-fill",color:[255,255,255,0],outline:{width:1,color:`${M.parcelRenderer}`}}},i={type:"simple",symbol:{type:"simple-fill",color:[255,255,255,0],outline:{width:1,color:"#897044"}}};I.map.allLayers.forEach((t=>{"Parcel Boundaries"===t.title&&(e=t.renderer)}));const a=["Aerial-Ortho 2023","Aerial-Ortho 2019","Aerial-Ortho 2016","Aerial-Ortho 2012"];I.map.allLayers.some((e=>a.includes(e.title)&&e.visible))&&I.map.allLayers.forEach((e=>{"Parcel Boundaries"===e.title&&(e.renderer=t)})),e="yes"===sessionStorage.getItem("condos")?Te.renderer:_e.renderer;const n={};I.map.basemap.baseLayers.forEach((e=>{n[e.id]=e.visible})),r.watch((()=>I.map.basemap.baseLayers.map((e=>e.visible))),(()=>{console.log("Visibility changed:",I.map.basemap.baseLayers.map((e=>({title:e.title,visible:e.visible})))),function(e,a){let n=e.find((e=>e.visible&&!a[e.id]));if(n)console.log(`Newly visible layer: ${n.title}`),e.forEach((e=>{e!==n&&(e.visible=!1)})),n.title!==`${M.basemapTitle}`&&"Washington Basemap"!==n.title?"yes"===sessionStorage.getItem("condos")?Te.renderer=t:_e.renderer=t:I.map.allLayers.forEach((e=>{"Parcel Boundaries"===e.title&&(e.renderer=i)}));else{0===e.filter((e=>e.visible)).length&&e.forEach((e=>{e.visible=a[e.id]}))}e.forEach((e=>{a[e.id]=e.visible})),console.log("Updated visibility tracker:",e.map((e=>({title:e.title,wasVisible:a[e.id]}))))}(I.map.basemap.baseLayers,n)}))})),T.add(_);let L,S,B,E,C,D,A,P,k,F,N,O,R,U,q,V,z=!1,G=!1,K=!1,j=!1,H=[],Z=[],W=!1,Q="feet",J=!1,Y=!1,X=!1,ee={isChanged:!1,item:""},te=!1,ie=document.getElementById("buffer-value");const ae=document.getElementById("clear-btn1"),ne=document.getElementById("clear-btn2");let re,se,le,oe,de,ce,ue,pe,me,he,ge,$e=I.extent,fe=I.scale,be=I.zoom;r.watch((()=>[I.zoom,I.extent,I.scale]),(([e,t,i],[a])=>{if(e){if(e!==be&&(be=e),!_e.visible&&!Te.visible&&Number(e)>M.parcelZoom){if("no"===sessionStorage.getItem("condos")?_e.visible=!0:Te.visible=!0,U&&(U?.remove(),U=null),q&&(q?.remove(),q=null),"click"==re||"details"==re||"none yet"==re)return void $("#select-button").removeClass("btn-warning");q=I.on("click",Qe),$("#lasso").removeClass("btn-warning"),$("#select-button").addClass("btn-warning"),Y=!0}}else a&&($e=t,fe=i,be=e);return""}));let ye=document.getElementById("topbar");I.ui.add(ye,"bottom-right");let ve=null;function we(e){switch(e){case"distance":if(ve=new c({view:I,unit:"feet"}),ve.viewModel.start(),U||q||(re="none yet"),U)try{re="details",U?.remove(),U=null}catch(e){console.error("Failed to remove DetailsHandle",e)}if(q)try{re="click",q.remove()}catch(e){console.error("Failed to remove DetailsHandle",e)}ve&&ve.viewModel&&ve.viewModel.watch("state",(function(e){"measured"===e&&("click"==re?q=I.on("click",Qe):"details"==re&&(U=I.on("click",We)))})),I.ui.add(ve,"bottom-right"),xe(document.getElementById("distanceButton"));break;case"area":if(ve=new u({view:I,unit:"square-us-feet"}),ve.viewModel.start(),U||q||(re="none yet"),U)try{re="details",U?.remove(),U=null}catch(e){console.error("Failed to remove DetailsHandle",e)}if(q)try{re="click",q?.remove(),q=null}catch(e){console.error("Failed to remove DetailsHandle",e)}ve&&ve.viewModel&&ve.viewModel.watch("state",(function(e){"measured"===e&&("click"==re?q=I.on("click",Qe):"details"==re&&(U=I.on("click",We)))})),I.ui.add(ve,"bottom-right"),xe(document.getElementById("areaButton"));break;case null:ve&&(I.ui.remove(ve),ve.destroy(),ve=null)}}function xe(e){I.focus();let t=Array.from(document.getElementsByClassName("active"));for(let e=0;e<t.length;e++)t[e].classList.remove("active","btn-warning");e&&(e.classList.add("active","btn-warning"),e.classList.remove("bg-info"))}document.getElementById("distanceButton").addEventListener("click",(function(){we(null),this.classList.contains("active")?xe(null):we("distance")})),document.getElementById("areaButton").addEventListener("click",(function(){we(null),this.classList.contains("active")?xe(null):we("area")}));let _e=new i({url:`${M.noCondoLayer}`,visible:!1,popupEnabled:!0,title:"Parcel Boundaries",id:"noCondoLayer"}),Te=new i({url:`${M.condoLayer}`,visible:!1,popupEnabled:!0,title:"Parcel Boundaries",id:"condoLayer"});const Ie=new i({url:`${M.masterTable}`}),Le=new i({url:`${M.masterTable}`});function Se(e,t){let i;if(i="yes"===sessionStorage.getItem("condos")?"noCondoLayer":"condoLayer","graphics"!==e.type&&"Tax Map Annotation"!=e.title&&"Road Centerline"!=e.title&&null!=e.title&&""!=e.title&&e.id!=i){var a;a=e.visible?"check-square":"square";var n=$(`\n          <calcite-list-item scale="m" label="${e.title}" value="${e.id}" style="border: white 0.5px solid;">\n          <calcite-action class="toggle-slider" id="action-${e.id}-dropdown" slot="actions-end" icon="sliders-horizontal" text="${e.title}"></calcite-action>\n            <calcite-action class="layer-vis" id="action-${e.id}" slot="actions-end" icon="${a}" text="${e.title}"></calcite-action>\n            <div id="opacityDiv-${e.id}" class="esri-slider esri-widget esri-slider--horizontal opacity-div " touch-action="none" style="display: none; height: 45px; align-items: center; padding-bottom: 10px; padding-left: 10px;">\n              <label style="margin-right: 10px; padding-top: 20px; font-weight: 500;font-size: 12px;">Layer Opacity (%)</label>\n              <calcite-slider class="slider-opacity" id="${e.id}" style="width: 50%;" value="100" label-handles max-label="100" max-value="100" min-label="0"></calcite-slider>\n              </calcite-slider>\n            </div>\n          </calcite-list-item>\n      `);t.append(n)}}function Me(e,t){e.forEach((function(e){if("group"===e.type){if(e.title&&"hidden group"===e.title.toLowerCase())return;var i=e.title||"Industry",a=$(`\n              <calcite-accordion scale="m">\n                <calcite-accordion-item heading="${i}">\n                </calcite-accordion-item>\n              </calcite-accordion>`);Me(e.layers.items,a.find("calcite-accordion-item")),t.append(a)}else Se(e,t)}))}function Be(e){ce=e}function Ee(e){const t=$(e);"CALCITE-COMBOBOX"===t[0].tagName?(t[0].open=!1,t[0].disabled=!0,t[0].placeholder="Loading..."):"CALCITE-INPUT-TEXT"===t[0].tagName?(t[0].loading=!0,t[0].disabled=!0,t[0].placeholder="Loading..."):"CALCITE-DATE-PICKER"===t[0].tagName&&(t[0].disabled=!0)}function Ce(e,t){const i=$(e);"CALCITE-COMBOBOX"===i[0].tagName?(i[0].disabled=!1,i[0].placeholder=`${t}`):"CALCITE-INPUT-TEXT"===i[0].tagName?(i[0].disabled=!1,i[0].loading=!1,i[0].placeholder=`${t}`):"CALCITE-DATE-PICKER"===i[0].tagName&&(i[0].disabled=!1)}T.add(_e),T.add(Te),he=[{layer:Te,field:"Appraised_Total",filterSelector:"#app-val-min",filterSelector2:"#app-val-max"},{layer:Te,field:"Assessed_Total",filterSelector:"#assess-val-min",filterSelector2:"#assess-val-max"},{layer:Te,field:"Total_Acres",filterSelector:"#acres-val-min",filterSelector2:"#acres-val-max"},{layer:Te,field:"Sale_Date",filterSelector:"#sold_calendar_lowest",filterSelector2:"#sold_calendar_highest"},{layer:Te,field:"Sale_Price",filterSelector:"#saleP-val-min",filterSelector2:"#saleP-val-max"}],me=[{layer:Te,field:"Street_Name",filterSelector:"#streetFilter",alias:"Street_Name",message:"Select a Street Name"},{layer:Te,field:"Owner",filterSelector:"#ownerFilter",message:"Select a Owner"},{layer:Te,field:"Parcel_Type",filterSelector:"#propertyFilter",alias:"Parcel_Type",message:"Select a Property Type"},{layer:Te,field:"Building_Type",filterSelector:"#buildingFilter",message:"Select a Building Type"},{layer:Te,field:"Building_Use_Code",filterSelector:"#buildingUseFilter",message:"Select a Building Use Type"},{layer:Te,field:"Design_Type",filterSelector:"#designTypeFilter",message:"Select a Design Type"},{layer:Te,field:"Zoning",filterSelector:"#zoningFilter",message:"Select a Zone"},{layer:Te,field:"Neighborhood",filterSelector:"#neighborhoodFilter",message:"Select a Neighborhood"}],ge=[{layer:Te,field:"Appraised_Total",filterSelector:"#streetFilter",minInput:"app-val-min",maxInput:"app-val-max",minValField:"appraisedValueMin",maxValueField:"appraisedValueMax",index:0},{layer:Te,field:"Assessed_Total",filterSelector:"#ownerFilter",minInput:"assess-val-min",maxInput:"assess-val-max",minValField:"assessedValueMin",maxValueField:"assessedValueMax",index:1},{layer:Te,field:"Total_Acres",filterSelector:"#propertyFilter",minInput:"acres-val-min",maxInput:"acres-val-max",minValField:"acresValueMin",maxValueField:"acresValueMax",index:2},{layer:Te,field:"Sale_Date",filterSelector:"#buildingFilter",minInput:"sold_calendar_lowest",maxInput:"sold_calendar_highest",minValField:"soldOnMin",maxValueField:"soldOnMax",index:3},{layer:Te,field:"Sale_Price",filterSelector:"#buildingUseFilter",minInput:"saleP-val-min",maxInput:"saleP-val-max",minValField:"soldPMin",maxValueField:"soldPMax",index:4}],I.when((function(){let e;e="yes"===sessionStorage.getItem("condos")?"condoLayer":"noCondoLayer";var t=T.layers.find((t=>t.id===e));r.watch((()=>t.visible),(()=>{let e=t.visible;!function(e,t){let i=$(`calcite-list-item[value="${e}"] calcite-action`);if(t){if(i.hasClass("layer-vis"))return;i.attr("icon","check-square")}else{if(i.hasClass("layer-vis"))return;i.attr("icon","square")}}(t.id,e)}))})),$(document).ready((function(){$("body").on("click",".toggle-slider",(function(){$(this).closest("calcite-list-item").find(".opacity-div").toggle()}))})),$("#layerList").on("click",".layer-vis",(function(e){e.preventDefault(),function(e,t){let i=T.findLayerById(e);i&&(i.visible=!i.visible,"group"===i.type&&i.layers.forEach((e=>{e.visible=i.visible})),t.attr("icon",i.visible?"check-square":"square"))}($(this).closest("calcite-list-item").attr("value"),$(this))})),I.when((function(){var e=$("#layerList");Me(T.layers.items,e),$(".slider-opacity").on("calciteSliderChange",(function(e){const t=e.target.id;let i=T.findLayerById(t);var a=e.target.value/100;i.opacity=a}))}));let De,Ae,Pe,ke={appraisedValueMin:null,appraisedValueMax:null,assessedValueMin:null,assessedValueMax:null,acresValueMin:null,acresValueMax:null,soldOnMin:null,soldOnMax:null,soldPMin:null,soldPMax:null};function Fe(e,t,i){function a(){const a=me.findIndex((t=>t.field==e));me.splice(a,1),me.forEach((a=>{!function(e,t,i,a,n,r,s){Ee(i),$(i).empty();let l=Ie.createQuery();if(Array.isArray(a)&&a.length>0&&!r){let e=a.map((e=>`${t} = '${e}'`));l.where=e.join(" OR ")}else l.where=a&&r?`${t} >= '${a}' AND ${t} <= '${r}'`:`${t} = '${a}'`;l.returnDistinctValues=!0,l.returnGeometry=!1,l.outFields=[n],n&&(l.orderByFields=[`${n} ASC`]);Ie.queryFeatures(l).then((function(e){var t=e.features,a=$(i);a.empty(),t.forEach((function(e){var t=e.attributes[n];if(t&&t.trim()){var i=$(`<calcite-combobox-item value="${t}" text-label="${t}"></calcite-combobox-item>`);a.append(i)}})),Ce(i,s)}))}(a.layer,e,a.filterSelector,t,a.field,i,a.message)}))}clearTimeout(De),De=setTimeout((()=>{a()}),600)}async function Ne(e,t,i,a,n,r){try{let e=Ie.createQuery();if(Array.isArray(a)&&a.length>0&&!r){let i=a.map((e=>`${t} = '${e}'`));e.where=i.join(" OR ")}else e.where=a&&r?`${t} BETWEEN '${a}' AND '${r}'`:`${t} = '${a}'`;e.returnDistinctValues=!0,e.returnGeometry=!1,e.outFields=[n],n&&(e.orderByFields=[`${n} ASC`]);let i=(await Ie.queryFeatures(e)).features.map((e=>e.attributes[n])),s=Math.max(...i),l=Math.min(...i);switch(n){case"Sale_Date":let e=new Date(l),t=new Date(s),i=e.getFullYear(),a=("0"+(e.getMonth()+1)).slice(-2),n=("0"+e.getDate()).slice(-2),r=t.getFullYear(),o=("0"+(t.getMonth()+1)).slice(-2),d=("0"+t.getDate()).slice(-2),c=`${i}-${a}-${n}`,u=`${r}-${o}-${d}`;ke.soldOnMin=c,ke.soldOnMax=u;break;case"Appraised_Total":ke.appraisedValueMin=l,ke.appraisedValueMax=s;break;case"Assessed_Total":ke.assessedValueMin=l,ke.assessedValueMax=s;break;case"Sale_Price":ke.soldPMin=l,ke.soldPMax=s;break;case"Total_Acres":ke.acresValueMin=l,ke.acresValueMax=s;break;default:console.log("Sorry, no field found.")}clearTimeout(Ae),Ae=setTimeout((()=>{!function(e){const t=ge.findIndex((t=>t.field==e));ge.splice(t,1),ge.forEach((e=>{const t=document.getElementById(e.minInput),i=document.getElementById(e.maxInput);let a=ke[e.minValField];const n=ke[e.maxValueField];let r,s;a===n&&(a=0),"Appraised_Total"===e.field||"Assessed_Total"===e.field||"Sale_Price"===e.field?(r="$"+(void 0!==a?a.toLocaleString():""),s="$"+(void 0!==n?n.toLocaleString():""),t.value=r,i.value=s):"Sale_Date"===e.field?(t.value=void 0!==a?a:"",i.value=void 0!==n?n:""):"Total_Acres"===e.field&&(r=void 0!==a?a.toLocaleString():"",s=void 0!==n?n.toLocaleString():"",t.value=r,i.value=s)}))}(t)}),600)}catch(e){console.error("Error querying features:",e)}}function Oe(e,t,i){const a=he.findIndex((t=>t.field==e));he.splice(a,1),async function(e,t,i,a){for(const n of e)await Ne(n.layer,t,n.filterSelector,i,n.field,a)}(he,e,t,i)}function Re(e,t,i,a){Ee(i),$(i).empty();let n=Ie.createQuery();n.where=`1=1 AND ${t} IS NOT NULL`,n.returnDistinctValues=!0,n.returnGeometry=!1,t&&(n.orderByFields=[`${t} ASC`]),n.outFields=[t],n.maxRecordCountFactor=5,Ie.queryFeatures(n).then((function(e){var a=e.features,n=(e.features.length,$(i));a.forEach((function(e){var i=e.attributes[t];if(i&&i.trim()){var a=$(`<calcite-combobox-item value="${i}" text-label="${i}"></calcite-combobox-item>`);n.append(a)}}))})),Ce(i,a)}function Ue(){var e=document.querySelector(".esri-widget--button.esri-print__refresh-button.esri-icon-refresh");e&&e.click()}function qe(e,t){const i=function(e,t){let i,a=t.split("?")[0],n=[],r=-1!==t.indexOf("?")?t.split("?")[1]:"";if(""!==r){n=r.split("&");for(let t=n.length-1;t>=0;t-=1)i=n[t].split("=")[0],i===e&&n.splice(t,1);a=a+"?"+n.join("&")}return a}("uniqueid",window.location.href);if(window.history.pushState({path:i},"",i),"no"===sessionStorage.getItem("condos")?_e.visible=!0:Te.visible=!0,U)try{U?.remove(),U=null}catch(e){console.error("Failed to remove DetailsHandle",e)}if(q)try{q?.remove(),q=null}catch(e){console.error("Failed to remove DetailsHandle",e)}re="",Be(!!Y),$("#select-button").removeClass("btn-warning"),$("#select-button").addClass("btn-warning"),q=I.on("click",Qe),Y=!0,J=!1,$("#searchInput ul").remove(),$("#searchInput").val="",$("#select-button").prop("disabled",!1);document.getElementById("searchInput").value="",B="",searchTerm="",Z=[],secondList=[],de="",S=!1,j=!1,K=!1,z=!1,$(".spinner-container").hide(),$("#distanceButton").removeClass("active"),$("#areaButton").removeClass("active"),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#dropdown").toggleClass("expanded"),$("#dropdown").hide(),$("#results-div").css("left","0px"),$("#sidebar2").css("left","-350px"),$("#sidebar2").removeClass("collapsed"),$("#right-arrow-2").show(),$("#left-arrow-2").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#backButton").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportSearch").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#featureWid").hide(),$("#exportButtons").hide(),$("#layerListDiv").hide(),$("#detailBox").hide(),$("#filterDiv").hide(),$("#dropdown").show(),$("#WelcomeBox").show(),G=!1,$("#select-button").attr("title","Add to Selection Enabled"),$(".center-container").show(),document.getElementById("suggestions").innerHTML="",$("#distanceButton").removeClass("btn-warning"),$("#distanceButton").addClass("bg-info"),$("#areaButton").removeClass("btn-warning"),$("#distanceButton").addClass("bg-info"),$("#featureWid").empty(),I.ui.remove(ve),ve&&(ve.destroy(),ve=null),I.graphics.removeAll(),N=[]}function Ve(e){P.sort(((t,i)=>"owner"===e?t.owner.toLowerCase().localeCompare(i.owner.toLowerCase()):"location"===e?t.location.toLowerCase().localeCompare(i.location.toLowerCase()):"Street_Name"===e?t.Street_name.toLowerCase().localeCompare(i.Street_name.toLowerCase()):void 0)),function(){let e,t;const i=document.getElementById("featureWid");i.innerHTML="";const a=document.createElement("ul");a.classList.add("row","list-group"),P.forEach((function(i){let n=i.objectid,r=i.location,s=void 0===i.uniqueId?i.GIS_LINK:i.uniqueId,l=i.GIS_LINK,o=i.coOwner,d=i.owner,c=i.MBL,u=i.geometry,p=i.Parcel_Type;"yes"===M.useUniqueIdforParcelMap?(t=s,e=s):(t=l,e=l);let m=i.Image_Path,h=void 0===i.AcctNum?"":i.AcctNum;const g=`${M.imageUrl}${m}`;a.classList.add("row"),a.classList.add("list-group");const $=document.createElement("li"),f=document.createElement("li"),b=document.createElement("tr");b.classList.add("col-12","list-group-item");let y,w,x=`<div class="extra-links">\n            <a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=https://publicweb-gis.s3.amazonaws.com/PDFs/${M.parcelMapUrl}/Quick_Maps/QM_${e}.pdf><span style="font-family:Tahoma;font-size:12px;"><strong>PDF Map</strong></a>\n            <a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.propertyCard}${s}><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></a>`;"yes"===M.useVisionForTaxBillUrl?x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.tax_bill}&amp;uniqueId=${h}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`:x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.tax_bill}&amp;uniqueId=${s}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`,"yes"===M.includePermitLink&&(x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.permitLink}?uniqueid=${s} ><span style="font-family:Tahoma;font-size:12px;"><strong>Permits</strong></a>`),x+="</div>",b.innerHTML=x,f.innerHTML=`<img class="img-search image" object-id="${n}" src="${g}" alt="Image of ${s}" >`,$.classList.add("list-group-item","col-9"),$.classList.add("search-list"),f.setAttribute("object-id",n),f.setAttribute("data-id",l),f.classList.add("image-div","col-3"),w="yes"===sessionStorage.getItem(v),!o&&u||u?y=` <div class="listText">UID: ${s}  &nbsp;<br>MBL: ${c} <br> ${d} ${o} <br> ${r} <br> Property Type: ${p}</div>\n            <div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justZoom" title="Zoom to Parcel"><calcite-icon icon="magnifying-glass-plus" scale="s"/>Zoom</button><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`:(y=` <div class="listText noGeometry">UID: ${s}  &nbsp;<br>MBL: ${c} <br> ${d} ${o} <br> ${r} <br> Property Type: ${p} \n             </div><div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`,$.classList.add("no-zoomto")),$.innerHTML+=y,$.setAttribute("object-id",n),$.setAttribute("data-id",l),a.appendChild(f),a.appendChild($),a.appendChild(b)})),k=P.length,a.addEventListener("click",(function(e){if(e.target.closest(".justZoom")||e.target.closest(".justZoomBtn"))return;q&&(q?.remove(),q=null),U&&(U?.remove(),U=null),$("#select-button").attr("title","Select Enabled");let t=e.target.closest("li");if(!t)return;let i=t.getAttribute("data-id"),a=t.getAttribute("object-id");nt(a,N,i),$("#details-spinner").show(),$("#WelcomeBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportButtons").hide(),$("#exportSearch").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$(".center-container").hide(),it(a,i)})),i.appendChild(a)}()}function ze(e,t,i,a,n,r){$("status-loader").show(),$("#featureWid").empty();let s=new Set,l=new Set;P=Z.filter((e=>!!e.geometry&&(s.add(e.uniqueId),!0))),Z.forEach((e=>{!s.has(e.uniqueId)&&(l.add(e.uniqueId),P.push(e))})),P.sort(((e,t)=>{const i=e.owner?e.owner.toLowerCase():"",a=t.owner?t.owner.toLowerCase():"";return i.localeCompare(a)})),z||function(e){return Z.filter((t=>t.objectid===e)).length}(a)>1&&function(e,t,i){"yes"==sessionStorage.getItem("condos")&&(P=P.filter((t=>t.objectid!=e)),Z=Z.filter((t=>t.objectid!=e)),$(`li[object-id="${e}"]`).remove()),"no"==sessionStorage.getItem("condos")&&(Z=Z.filter((e=>e.GIS_LINK!=i)),P=P.filter((e=>e.GIS_LINK!=i)),$(`li[data-id="${i}"]`).remove())}(a,0,r);const o=document.getElementById("featureWid"),d=document.createElement("ul");let c,u;P.forEach((function(e){let t=e.objectid,i=e.location,a=void 0===e.uniqueId?e.GIS_LINK:e.uniqueId,n=e.GIS_LINK,r=e.coOwner,s=e.owner,l=e.MBL,o=e.geometry,p=e.Parcel_Type;"yes"===M.useUniqueIdforParcelMap?(c=a,u=a):(c=n,u=n);let m=e.Image_Path,h=void 0===e.AcctNum?"":e.AcctNum;const g=`${M.imageUrl}${m}`;d.classList.add("row"),d.classList.add("list-group");const $=document.createElement("li"),f=document.createElement("li"),b=document.createElement("tr");b.classList.add("col-12","list-group-item");let y,w,x=`<div class="extra-links">\n            <a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=https://publicweb-gis.s3.amazonaws.com/PDFs/${M.parcelMapUrl}/Quick_Maps/QM_${u}.pdf><span style="font-family:Tahoma;font-size:12px;"><strong>PDF Map</strong></a>\n            <a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.propertyCard}${a}><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></a>`;"yes"===M.useVisionForTaxBillUrl?x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.tax_bill}&amp;uniqueId=${h}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`:x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.tax_bill}&amp;uniqueId=${a}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`,"yes"===M.includePermitLink&&(x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.permitLink}?uniqueid=${a} ><span style="font-family:Tahoma;font-size:12px;"><strong>Permits</strong></a>`),x+="</div>",b.innerHTML=x,f.innerHTML=`<img class="img-search image" object-id="${t}" src="${g}" alt="Image of ${a}" >`,$.classList.add("list-group-item","col-9"),$.classList.add("search-list"),f.setAttribute("object-id",t),f.setAttribute("data-id",n),f.classList.add("image-div","col-3"),w="yes"===sessionStorage.getItem(v),!r&&o||o?y=` <div class="listText">UID: ${a}  &nbsp;<br>MBL: ${l} <br> ${s} ${r} <br> ${i} <br> Property Type: ${p}</div>\n            <div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justZoom" title="Zoom to Parcel"><calcite-icon icon="magnifying-glass-plus" scale="s"/>Zoom</button><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`:(y=` <div class="listText noGeometry">UID: ${a}  &nbsp;<br>MBL: ${l} <br> ${s} ${r} <br> ${i} <br> Property Type: ${p} \n             </div><div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`,$.classList.add("no-zoomto")),$.innerHTML+=y,$.setAttribute("object-id",t),$.setAttribute("data-id",n),d.appendChild(f),d.appendChild($),d.appendChild(b)})),k=P.length,$("#total-results").show(),$("#ResultDiv").show(),$("#total-results").html(k+" results returned"),$("#backButton").hide(),$("#detailsButton").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#featureWid").show(),$("#detail-content").empty(),$("#dropdown").toggleClass("expanded"),$("status-loader").hide(),$("#dropdown").show(),$("#sidebar2").css("left","0px"),$("#sidebar2").addClass("collapsed"),$("#results-div").css("left","350px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide(),$("#WelcomeBox").hide(),$("#csvExportResults").hide(),$("#exportSearch").show(),$("#results-div").css("height","300px"),$("#exportButtons").show(),$("#exportResults").hide(),$("#csvExportSearch").show(),$(".spinner-container").hide(),$(`li[object-id="${a}"]`).remove(),z=!1,d.addEventListener("click",(function(e){let i=!0;if(e.target.closest(".justZoom")||e.target.closest(".justZoomBtn")||e.target.closest(".pdf-links"))return;q&&(q?.remove(),q=null),U&&(U?.remove(),U=null),$("#select-button").attr("title","Select Enabled");let a=e.target.closest("li");if(!a)return;let n=a.getAttribute("data-id"),r=a.getAttribute("object-id");nt(r,t,n),$("#details-spinner").show(),$("#WelcomeBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportButtons").hide(),$("#exportSearch").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$(".center-container").hide(),$("#abutters-attributes").prop("disabled",!1),$("#abutters-zoom").prop("disabled",!1),e.target.closest(".no-zoomto")&&(console.log("dont zoom"),i=!1),it(r,n,i)})),o.appendChild(d),j=!1}function Ge(e,t,i,a){let n,r,s;function l(e){e.forEach((function(e){if(""!==e.attributes.Owner){let t=e.attributes.OBJECTID,i=e.attributes.Location,a=e.attributes.Uniqueid,n=e.attributes.GIS_LINK,r=e.attributes.Co_Owner,s=e.attributes.Owner,l=e.attributes.MBL,o=e.geometry,d=e.attributes.Mailing_Address_1,c=e.attributes.Mailing_Address_2,u=e.attributes.Mailing_City,p=e.attributes.Mail_State,m=e.attributes.Mailing_Zip,h=e.attributes.Total_Acres,g=e.attributes.Parcel_Primary_Use,$=e.attributes.Building_Use_Code,f=e.attributes.Parcel_Type,b=e.attributes.Design_Type,v=e.attributes.Zoning,w=e.attributes.Neighborhood,x=e.attributes.Land_Type_Rate,_=e.attributes.Functional_Obs,T=e.attributes.External_Obs,I=y(e.attributes.Sale_Date),L=e.attributes.Sale_Price,S=e.attributes.Vol_Page,M=e.attributes.Assessed_Total,B=e.attributes.Appraised_Total,E=e.attributes.Influence_Factor,C=e.attributes.Influence_Type,D=e.attributes.Land_Type,A=e.attributes.Prior_Assessment_Year,P=e.attributes.Prior_Assessed_Total,k=e.attributes.Prior_Appraised_Total,F=e.attributes.Map,N=e.attributes.Lat,O=e.attributes.Lon,R=e.attributes.Image_Path,U=e.attributes.AcctNum,q=e.attributes.Match_Status;Z.push(new He(t,i,a,n,r,s,l,o,d,c,u,p,m,h,g,$,f,b,v,w,x,_,T,I,L,S,M,B,E,C,D,A,P,k,F,N,O,R,U,q))}}))}if(i&&null!=i){n=e[0].attributes.OBJECTID,r=e[0].attributes.Location,s=e[0].attributes.GIS_LINK;const i=Z.filter((e=>e.objectid===n)).length,a=Z.filter((e=>e.GIS_LINK===s)).length;i>=1||0==i&&a>=1?(l(e),ze(0,t,0,n,0,s)):(l(e),ze())}else e?e.length>1?(J||(e=e.filter((e=>"CONDOMAIN"!=e.attributes.ACCOUNT_TYPE))),l(e)):l(e):ze(0,t,0,n);i||ze(0,t,0,n,0,s)}function Ke(e,t,i,a){let n,r;Pe=a?e:e.features,_.removeAll();let l,o,d=[];var c={type:"simple-fill",color:[127,42,145,.4],outline:{color:[127,42,145,.8],width:2}};if(i){l=e.features[0].attributes.OBJECTID,o=Pe[0].attributes.GIS_LINK;const i=new s({geometry:Pe[0].geometry,symbol:c,id:l});if(d.push(i),r=Z.filter((e=>e.GIS_LINK===o)).length,n=I.graphics.some((e=>e.id===l)),n){const e=I.graphics.findIndex((e=>e.id===l));I.graphics.removeAt(e);const t=N.findIndex((e=>e.id===l));1===N.length?N.splice(0,1):N.splice(t,1),0===N.length&&(U||(U=I.on("click",We)),q&&(q?.remove(),q=null),q=I.on("click",Qe))}else t.addMany(d)}else if(a){Pe.filter((e=>e.geometry)).forEach((e=>{const t=e.attributes.OBJECTID,i=new s({geometry:e.geometry,symbol:c,id:t});d.push(i)})),d.length>=1&&t.addMany(d),I.goTo({target:N,zoom:18})}else{let e;if(te=!0,Pe.map((function(t){if(l=t.attributes.OBJECTID,!t.geometry||a)return null;e=new s({geometry:t.geometry,symbol:c,id:l}),d.push(e)})).filter((e=>null!==e)),1==d.length){t.addMany(d);const e=Pe[0].geometry.extent,i=(e.center,2),a=e.expand(i);I.goTo({target:d,extent:a})}else if(t.addMany(d),d.length>0){const e=d.map((e=>e.geometry.extent)),t=3,i=e.reduce(((e,t)=>e.union(t)),e[0]).expand(t);I.goTo({target:i}).catch((e=>{console.error("Error zooming to extent:",e)}))}else console.warn("No graphics available to calculate extent.")}if(N||(N=d),i&&!n){let e=d[0].id;N=[...N,d[0]],V=e}te&&(N=d),n=!1,te=!1}Re(0,"Street_Name","#streetFilter","Select a Street Name"),Re(0,"Owner","#ownerFilter","Select a Owner"),Re(0,"Parcel_Type","#propertyFilter","Select a Property Type"),Re(0,"Building_Type","#buildingFilter","Select a Building Type"),Re(0,"Building_Use_Code","#buildingUseFilter","Select a Building Use"),Re(0,"Design_Type","#designTypeFilter","Select a Design Type"),Re(0,"Zoning","#zoningFilter","Select a Zone"),Re(0,"Neighborhood","#neighborhoodFilter","Select a Neighborhood"),document.getElementById("Print-selector").addEventListener("click",(function(){!function(){const e=300,t=8.8,i=t*e,a=7.7*e;I.takeScreenshot({width:i,height:a}).then((function(e){const i=window.open("","_blank"),a=document.getElementById("scale-value").innerHTML,n=(new Date).toLocaleString();i.document.write(`\n            <!DOCTYPE html>\n            <html lang="en">\n            <head>\n                <meta charset="UTF-8">\n                <meta name="viewport" content="width=device-width, initial-scale=1.0">\n                <title>Print Map</title>\n                <link rel="stylesheet" href="https://js.arcgis.com/4.27/esri/themes/light/main.css">\n                <style>\n                    body {\n                        display: flex;\n                        flex-direction: column;\n                        align-items: center;\n                        justify-content: center;\n                        margin: 0;\n                        padding: 0;\n                    }\n                    .print-title {\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        text-align: center;\n                        font-size: 24px;\n                        margin: 20px 0;\n                    }\n                    .print-scale {\n                        display: flex;\n                        align-items: center;\n                        justify-content: space-around;\n                        text-align: center;\n                        font-size: 14px;\n                        width: 100%;\n                        margin-left: 20px;\n                        margin-right: 20px;\n                    }\n                    .print-title img {\n                        margin-right: 20px;\n                    }\n                    .scale-bar-container {\n                        transform: scale(1.5);\n                        margin-right: 50px;\n                    }\n                    .print-scale-bar {\n                        width: 300px;\n                        height: 30px;\n                    }\n                    .info-writing-container {\n                        display: flex;\n                        justify-content: center;\n                        align-items: flex-start;\n                        width: 80%;\n                        margin: 20px auto;\n                    }\n                    .info-text {\n                        width: 20%;\n                        text-align: left;\n                        margin-right: 20px;\n                    }\n                    .writing-lines {\n                        width: 80%;\n                        text-align: center;\n                    }\n                    .writing-lines div {\n                        border-bottom: 1px solid black;\n                        margin: 10px 0;\n                        height: 20px;\n                    }\n                    @media print {\n                        body * {\n                            visibility: visible;\n                        }\n                    }\n                </style>\n            </head>\n            <body>\n                <div class="print-title" id="print-title">\n                    <img id="town-logo" src="${M.welcomeImage}" alt="Town Logo">\n                    <h1 id="title-text">${M.title}</h1>\n                </div>\n                <div class="print-map">\n                    <img id="print-map-image" src="${e.dataUrl}" alt="Map Image" style="width: ${t}in; height: auto; border: 3px solid #A9A9A9; margin: 0 0.75in;">\n                </div>\n                <div class="print-scale">\n                    <div class="print-date" style="font-size: 12px;">Date Printed: ${n}</div>\n                    <div id="to-scale" class="scale-bar-container"></div>\n                    <div id="print-scale-bar" class="scale-bar-container">${a}</div>\n                </div>\n                <div style="text-align: center; font-size: 12px; padding-left: 30px; padding-right: 30px;">\n                    <p>Disclaimer: This map is intended for reference and general informational purposes\n                    only and is not a legally recorded map or survey. While reasonable effort has been\n                    made to ensure the accuracy, correctness, and timeliness of materials presented,\n                    the map vendor and the municipality disclaim any and all liability and responsibility for\n                    any errors, omissions, or inaccuracies in the data provided, including without limitation\n                    any liability for direct, indirect, incidental, consequential, special, exemplary,\n                    punitive, or any other type of damages. Users are hereby notified that the primary\n                    information source should be consulted for verification of the data contained herein.\n                    Continued use of this map acknowledges acceptance of these terms.</p>\n                </div>\n                <script>\n                    window.onload = function() {\n                        window.print();\n                    };\n                <\/script>\n            </body>\n            </html>\n          `),i.document.close()}))}()})),I.watch("zoom",(function(e,t){e!==t&&Ue()})),I.watch("center",(function(e,t){e!==t&&Ue()})),$(document).ready((function(){$(document).on("click",".justRemove",(function(e){e.stopPropagation(),e.preventDefault();let t=e.target.closest("li"),i=t.getAttribute("data-id"),a=t.getAttribute("object-id"),n=e,r=!0,s=[],l=!1,o=t.querySelector(".listText");if(o){let e=o.classList;s=Array.from(e),l=s.includes("noGeometry")}if("no"===sessionStorage.getItem("condos")){let e=Te.createQuery();e.where=l?`GIS_LINK = '${i}'`:`OBJECTID = '${a}'`,e.returnGeometry=!0,e.outFields=["*"],_e.queryFeatures(e).then((function(e){totalResults=e.features,Ge(totalResults,"",n),Ke(e,I.graphics,r)}))}else{let e=Te.createQuery();e.where=`OBJECTID = ${a}`,e.returnGeometry=!0,e.outFields=["*"],Te.queryFeatures(e).then((function(e){totalResults=e.features,Ge(totalResults,"",n),Ke(e,I.graphics,r)}))}}))})),$(document).ready((function(){$(document).on("click",".justZoom",(function(e){e.stopPropagation(),e.preventDefault();let t=e.target.closest("li"),i=(t.getAttribute("data-id"),t.getAttribute("object-id"));if("no"===sessionStorage.getItem("condos")){let e=`OBJECTID = ${i}`,t=_e.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],_e.queryFeatures(t).then((e=>{let t=e.features[0].geometry;const i=t.extent;i.center,i.expand(3);I.goTo({target:t})}))}else{let e=`OBJECTID = ${i}`,t=Te.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],Te.queryFeatures(t).then((e=>{let t=e.features[0].geometry;const i=t.extent;i.center,i.expand(3);I.goTo({target:t})}))}}))})),document.getElementById("sortByOwner").addEventListener("click",(function(){Ve("owner")})),document.getElementById("sortByLocation").addEventListener("click",(function(){Ve("location")}));let je=new d({view:I,layer:_,defaultCreateOptions:{mode:"freehand"},polygonSymbol:{type:"simple-fill",style:"cross",color:"rgb(145, 199, 61)",outline:{width:3,style:"solid",color:"rgba(127, 42, 145, 1)"}},defaultUpdateOptions:{tool:"reshape",toggleToolOnClick:!1}});$("#lasso").on("click",(function(e){J=!J,Y=!1,$("#select-button").removeClass("btn-warning"),$("#select-button").prop("disabled",!1),J&&!Y?(je.create("polygon"),$("#select-button").removeClass("btn-warning"),$("#lasso").addClass("btn-warning")):(je.cancel(),$("#lasso").removeClass("btn-warning"),$("#lasso").addClass("btn-info"),$("#select-button").removeClass("btn-warning"),$("#select-button").addClass("btn-info")),qe(),_.removeAll(),"no"===sessionStorage.getItem("condos")?_e.visible=!0:Te.visible=!0})),je.on("create",(function(e){"complete"===e.state&&(_.remove(e.graphic),_.add(e.graphic),function(e){let t=!0;j=!0;let i=[];"no"==sessionStorage.getItem("condos")?function(){let a=_e.createQuery();a.geometry=e,a.distance=1,a.units="feet",a.spatialRelationship="intersects",a.returnGeometry=!0,a.outFields=["*"],_e.queryFeatures(a).then((function(a){a.features.forEach((e=>{i.push(e.attributes.GIS_LINK)})),Ye(i,t),e=!1}))}():function(){let a=Te.createQuery();a.geometry=e,a.distance=1,a.units="feet",a.spatialRelationship="intersects",a.returnGeometry=!0,a.outFields=["*"],Te.queryFeatures(a).then((function(a){a.features.forEach((e=>{i.push(e.attributes.GIS_LINK)})),Ye(i,t),e=!1}))}()}(e.graphic.geometry),U&&(U?.remove(),U=null),q&&(q?.remove(),q=null),$("#lasso").removeClass("btn-warning"),$("#lasso").addClass("btn-info"))})),$("#select-button").on("click",(function(e){if(je.cancel(),Y=!!ce||!Y,Y||qe(),J=!1,Y&&!J?($("#lasso").removeClass("btn-warning"),$("#select-button").addClass("btn-warning")):$("#select-button").removeClass("btn-warning"),"no"===sessionStorage.getItem("condos")?_e.visible=!0:Te.visible=!0,Y&&!J){if(q)try{q?.remove(),q=null}catch(e){console.error("Failed to remove clickHandle",e)}if(U)try{U?.remove(),U=null}catch(e){console.error("Failed to remove DetailsHandle",e)}q=I.on("click",Qe)}else if(Y&&J)U&&(U?.remove(),U=null),q&&(q?.remove(),q=null),q=I.on("click",Qe);else{if(q)try{q?.remove(),q=null}catch(e){console.error("Failed to remove clickHandle",e)}if(U)try{U?.remove(),U=null}catch(e){console.error("Failed to remove DetailsHandle",e)}}})),$("#home").on("click",(function(e){I.goTo(M.homeExtent)}));class He{constructor(e,t,i,a,n,r,s,l,o,d,c,u,p,m,h,g,$,f,b,y,v,w,x,_,T,I,L,S,M,B,E,C,D,A,P,k,F,N,O,R){this.objectid=e,this.location=t,this.uniqueId=i,this.GIS_LINK=a,this.coOwner=n,this.owner=r,this.MBL=s,this.geometry=l,this.mailingAddress=o,this.mailingAddress2=d,this.Mailing_City=c,this.Mail_State=u,this.Mailing_Zip=p,this.Total_Acres=m,this.Parcel_Primary_Use=h,this.Building_Use_Code=g,this.Parcel_Type=$,this.Design_Type=f,this.Zoning=b,this.Neighborhood=y,this.Land_Type_Rate=v,this.Functional_Obs=w,this.External_Obs=x,this.Sale_Date=_,this.Sale_Price=T,this.Vol_Page=I,this.Assessed_Total=L,this.Appraised_Total=S,this.Influence_Factor=M,this.Influence_Type=B,this.Land_Type=E,this.Prior_Assessment_Year=C,this.Prior_Assessed_Total=D,this.Prior_Appraised_Total=A,this.Map=P,this.LAT=k,this.LON=F,this.Image_Path=N,this.AcctNum=O,this.Match_Status=R}}function Ze(){$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$(".center-container").hide(),$("#layerListDiv").hide(),$("#details-spinner").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").html('<h5 style="color: red;">Issue selecting Parcel. Please make another selection.</h5>'),$("#abutters-attributes").prop("disabled",!0),$("#abutters-zoom").prop("disabled",!0),$("#selected-feature").empty(),$("#exportSearch").hide(),$("#exportButtons").hide()}function We(e){if(q&&(q?.remove(),q=null),$("#details-spinner").show(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportSearch").hide(),$("#exportButtons").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$("#abutters-attributes").prop("disabled",!1),$("#abutters-zoom").prop("disabled",!1),"no"===sessionStorage.getItem("condos")){let t=_e.createQuery();t.geometry=e.mapPoint,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"],_e.queryFeatures(t).then((function(e){if(totalResults=e.features,totalResults.length>0){at(e.features[0].attributes.OBJECTID,e.features[0].geometry,e.features[0]),tt(totalResults)}else Ze()}))}else{let t=Te.createQuery();t.geometry=e.mapPoint,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"],Te.queryFeatures(t).then((function(e){if(totalResults=e.features,totalResults.length>0){at(e.features[0].attributes.OBJECTID,e.features[0].geometry,e.features[0]),tt(totalResults)}else Ze()}))}}function Qe(e){if(se="click",z=!1,X=!0,U&&(U?.remove(),U=null),"no"===sessionStorage.getItem("condos")){let t=_e.createQuery();t.geometry=e.mapPoint,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"],_e.queryFeatures(t).then((function(t){t.features&&(totalResults=t.features,Ge(totalResults,"",e),Ke(t,I.graphics,X))}))}else{let t=Te.createQuery();t.geometry=e.mapPoint,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"],Te.queryFeatures(t).then((function(t){t.features&&(totalResults=t.features,Ge(totalResults,"",e),Ke(t,I.graphics,X))}))}}function Je(e){var t;t="search"===e?document.querySelectorAll(".export-search-list"):document.querySelectorAll(".abutters-group-list");const i=[];document.querySelectorAll(".search-list").forEach((function(e,t){i[t]=e.innerHTML}));var a="<ul class='label-list'>";t.forEach((function(e){a+="<li>"+e.innerHTML.trim()+"</li>"})),a+="</ul>";var n=window.open("","print","left=0,top=0,width=800,height=600,toolbar=0,status=0");n.document.write("<!DOCTYPE html><html><head>"),n.document.write("<title>Print Labels</title>"),n.document.write("<style>body { margin: 0; padding: 0; font-size: 10pt; }.label-list { list-style-type: none; margin: 0; padding: 0; display: flex; align-items: center; text-align: center; flex-wrap: wrap; justify-content: space-between; }.label-list li { box-sizing: border-box; width: 2.225in; height: 1in; margin-bottom: 0.0in; padding: 0.1in; display: flex; align-items: center; justify-content: center; font-size: 8pt; }@media print {  body { margin: 0.0in 0.1875in; }  .label-list { padding: 0; }  .label-list li { margin-right: 0in; margin-bottom: 0; }  @page { margin-top: 0.5in; margin-bottom: 0.5in; margin-left: 0.25in; margin-right: 0.25in }}</style>"),n.document.write("</head><body>"),n.document.write(a),n.document.write("</body></html>"),n.document.close(),setTimeout((()=>{n.print(),n.close(),document.querySelectorAll(".search-list").forEach((function(e,t){i[t]&&(e.innerHTML=i[t])}))}),250)}function Ye(e,t){if(e.length>0){let i=[];e.forEach((e=>{i.includes(e)||i.push(e)}));const a=i.map((e=>`'${e}'`)).join(" OR GIS_LINK = "),n=`GIS_LINK = ${a}`;let r=Ie.createQuery();r.where=n,r.returnGeometry=!1,r.returnHiddenFields=!0,r.outFields=["*"],Ie.queryFeatures(r).then((e=>{t?st("","",r):function(e){const t=document.getElementById("parcel-feature");t.innerHTML="";const i=e.features;totalResults=i.length,lastResults=totalResults,A=i,P=i,le=i,i.forEach((function(e){let i=e.attributes.GIS_LINK,a=e.attributes.OBJECTID,n=e.attributes.Owner,r=e.attributes.Co_Owner,s=e.attributes.Mailing_Address_1,l=e.attributes.Mailing_Address_2,o=e.attributes.Mailing_City,d=e.attributes.Mail_State,c=e.attributes.Mailing_Zip;const u=document.createElement("ul");u.classList.add("row"),u.classList.add("list-group"),u.classList.add("abutters-list");const p=document.createElement("li");p.classList.add("abutters-group-item","col-12");let m="";m=` ${n} ${r} <br> ${s} ${l} <br> ${o}, ${d} ${c}`,p.innerHTML+=m,p.setAttribute("data-id",i),p.setAttribute("object-id",a),u.appendChild(p),t.appendChild(u),$("#abutters-spinner").hide(),$("#abutters-title").html(`Abutting Parcels (${totalResults})`)})),$("#results-div").css("height","300px"),$("#exportResults").show(),$("#csvExportResults").show()}(e)}))}else console.log("No buffer results to query.")}function Xe(e){F="BufferGraphicId";const t=I.graphics.items.findIndex((e=>e.id===F));t>-1&&I.graphics.removeAt(t);let i=new s({geometry:e,symbol:{type:"simple-fill",color:[51,51,204,.1],style:"forward-diagonal",outline:{color:"rgba(127, 42, 145, 0.8)",width:4}},id:F});I.graphics.add(i),I.goTo({target:i})}function et(e){$("#abutters-spinner").show(),0===e&&(e=-10);let t,i=e,a=Q;t=(sessionStorage.getItem("condos"),l.buffer(C,i,a)),Xe(t),function(e){const t={spatialRelationship:"intersects",geometry:e,outFields:["*"],returnGeometry:!0,units:Q};let i=[];"no"===sessionStorage.getItem("condos")?_e.queryFeatures(t).then((e=>{e.features.forEach((e=>{i.push(e.attributes.GIS_LINK)})),Ye(i)})):Te.queryFeatures(t).then((e=>{e.features.forEach((e=>{i.push(e.attributes.GIS_LINK)})),Ye(i)}))}(t)}function tt(e){function t(e){return void 0===e?"":new Intl.NumberFormat("en-US").format(e)}$("#select-button").prop("disabled",!0),$("#select-button").removeClass("btn-warning"),se="detailClick",$("#detail-content").empty(),$("#selected-feature").empty(),$(".center-container").hide(),$("#layerListDiv").hide();let i,a,n=e[0].attributes,r=void 0===n.Location?"":n.Location,s=void 0===n.Uniqueid?"":n.Uniqueid,l=void 0===n.GIS_LINK?"":n.GIS_LINK,o=void 0===n.Co_Owner?"":n.Co_Owner,d=void 0===n.Owner?"":n.Owner,c=void 0===n.MBL?"":n.MBL,u=void 0===n.Mailing_Address_1?"":n.Mailing_Address_1,p=void 0===n.Mailing_City?"":n.Mailing_City+", ",m=void 0===n.Mail_State?"":n.Mail_State,h=void 0===n.Mailing_Zip?"":n.Mailing_Zip,g=void 0===n.Total_Acres?"":n.Total_Acres,f=void 0===n.Parcel_Primary_Use?"":n.Parcel_Primary_Use,b=void 0===n.Building_Use_Code?"":n.Building_Use_Code,v=n.Sale_Date,w=void 0===n.Sale_Date?"":y(v),x=void 0===n.Sale_Price?"":t(n.Assessed_Total),_=void 0===n.Vol_Page?"":n.Vol_Page,T=void 0===n.Prior_Appraised_Total?"":t(n.Prior_Appraised_Total),I=void 0===n.Prior_Assessed_Total?"":t(n.Prior_Assessed_Total),S=void 0===n.Prior_Assessment_Year?"":n.Prior_Assessment_Year,B=void 0===n.Map?"":$.trim(n.Map),E=void 0===n.OBJECTID?"":n.OBJECTID,C=void 0===n.Lat?"":n.Lat,D=void 0===n.Lon?"":n.Lon,A=void 0===n.AcctNum?"":n.AcctNum;"yes"===M.useUniqueIdforParcelMap?(oe=s,i=s):(oe=l,i=l),a="yes"===M.useVisionForTaxBillUrl?A:s,de=E,L=l;const P=n.Image_Path,k=document.getElementById("detail-content"),F=document.createElement("div");F.innerHTML="",F.classList.add("details");let N=M.DetailLinksToInclude,O=M.DetailLinks,R=[];O.forEach((e=>{let t=e;if(N.includes(e)){let e={[t]:{show:"show"}};R.push(e)}else{let e={[t]:{show:"none"}};R.push(e)}}));let U=`\n        <p>\n        <span style="font-family:Tahoma;font-size:14px;"><strong>${r}</strong></span> <br>\n        </p>\n  \n        <div>\n        <img class="image" src=${M.imageUrl}${P} alt="Building Photo" width="250" height="125">\n        </div>\n        <p>\n        <span style="font-family:Tahoma;font-size:12px;"><strong>${d} ${o}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;"><strong>${u}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;"><strong>${p} ${m} ${h}</strong></span><br>\n    </p>\n    <div id="accordion">\n      <div class="card" id="links" style="display:${R[0].links.show}">\n        <div class="card-header" id="headingOne">\n            <h5 class="mb-0">\n            <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">\n                Property Links\n            </button>\n          </h5>\n      </div>\n  \n      \n      <div id="collapseOne" class="collapse show" aria-labelledby="OneFour" data-parent="#accordion">\n             <div class="card-body" style="text-align: left;">\n      `;"yes"===M.includePermitLink&&(U+=`<a class='mx-auto' href=${M.permitLink}?uniqueid=${a} target="_blank"><span style="font-family:Tahoma;font-size:12px;"><strong>Permits</strong></a><br>`),U+=`\n        <table style="width: 100%; font-family: Tahoma; font-size: 12px; border-collapse: collapse; text-align: left;">\n  <tr>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="${M.tax_bill}&uniqueId=${a}">\n        <strong>Tax Bills</strong>\n      </a>\n    </td>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="${M.propertyCard}${s}">\n        <strong>Property Card</strong>\n      </a>\n    </td>\n  </tr>\n  <tr>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="https://publicweb-gis.s3.amazonaws.com/PDFs/${M.parcelMapUrl}/Quick_Maps/QM_${i}.pdf">\n        <strong>Parcel Map</strong>\n      </a>\n    </td>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="${M.taxMap_Url}${B}.pdf">\n        <strong>Tax Map</strong>\n      </a>\n    </td>\n  </tr>\n  <tr>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="https://www.google.com/maps/@${C},${D},17z/@${C},${D},17z/data=!5m1!1e2">\n        <strong>Google Maps</strong>\n      </a>\n    </td>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="https://www.bing.com/maps?cp=${C}~${D}&lvl=17.0">\n        <strong>Bing Maps</strong>\n      </a>\n    </td>\n  </tr>\n  <tr><td colspan="2"> &nbsp </td></tr>\n  <tr>\n    <td colspan="2">\n      <a target="_blank" rel="noopener noreferrer" href="${M.pdf_demo}">\n        <strong>Demographics Profile</strong>\n      </a>\n    </td>\n  </tr>\n  <tr>\n    <td colspan="2">\n      <a target="_blank" rel="noopener noreferrer" href="${M.housingUrl}">\n        <strong>Housing Profile</strong>\n      </a>\n    </td>\n  </tr>\n</table>\n\n            </div>\n          </div>\n        </div>\n          <div class="card " id="ids" style="display:${R[1].ids.show}">\n              <div class="card-header" id="headingTwo">\n              <h5 class="mb-0">\n                  <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">\n                  Property Ids & Uses\n                  </button>\n              </h5>\n              </div>\n              <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">\n                  <div class="card-body">\n                    <p>\n                    <span style="font-family:Tahoma;font-size:12px;">Unique ID: <strong>${s}</strong></span> <br>\n                    <span style="font-family:Tahoma;font-size:12px;">MBL: <strong>${c}</strong></span> <br>\n                    <span style="font-family:Tahoma;font-size:12px;">Total Acres: <strong>${g}</strong></span> <br>\n                    <span style="font-family:Tahoma;font-size:12px;">Primary Use: <strong>${f}</strong></span> <br>\n                    <span style="font-family:Tahoma;font-size:12px;">Primary Bldg Use: <strong>${b}</strong></span><br>\n                    </p>\n                  </div>\n              </div>\n          </div>\n      <div class="card" id="sales" style="display:${R[3].sales.show}" >\n      <div class="card-header" id="headingThree">\n        <h5 class="mb-0">\n          <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">\n            Latest Sale / Transfer\n          </button>\n        </h5>\n      </div>\n      <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">\n        <div class="card-body">\n          <p>\n          <span style="font-family:Tahoma;font-size:12px;">Sold on: <strong>${w}</strong></span> <br>\n          <span style="font-family:Tahoma;font-size:12px;">Sale Price: <strong>$${x}</strong></span> <br>\n          <span style="font-family:Tahoma;font-size:12px;">Volume/Page: <strong>${_}</strong></span><br>\n          </p>\n        </div>\n      </div>\n    </div>\n    <div class="card" id="vals" style="display:${R[2].vals.show}">\n      <div class="card-header" id="headingFour">\n          <h5 class="mb-0">\n            <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">\n              Valuations\n            </button>\n          </h5>\n        </div>\n        <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordion">\n          <div class="card-body">\n              <p>\n              <span style="font-family:Tahoma;font-size:12px;"><strong>Valuations:</strong></span><br>\n              <span style="font-family:Tahoma;font-size:12px;">GL Year: <strong>${S}</strong></span> <br>\n              <span style="font-family:Tahoma;font-size:12px;">Assessment: <strong>$${I}</strong></span> <br>\n              <span style="font-family:Tahoma;font-size:12px;">Appraised: <strong>$${T}</strong></span> <br>\n              <span style="font-family:Tahoma;font-size:12px;"></span>\n              </p>\n          </div>\n      </div>\n    </div>\n  </div>\n      `,F.innerHTML=U,$("#details-spinner").hide(),k.appendChild(F)}function it(e,t,i){function a(e){return void 0===e?"":new Intl.NumberFormat("en-US").format(e)}var n;i?$("#abutters-zoom").prop("disabled",!1):$("#abutters-zoom").prop("disabled",!0),$("#select-button").prop("disabled",!0),$("#select-button").removeClass("btn-warning"),q&&(q?.remove(),q=null),se="detailClick",$("#exportResults").hide(),$("#csvExportResults").hide(),H=[e,t],(n=Z.find((function(i){return i.objectid===parseInt(e)&&i.GIS_LINK===t})))||(n=Z.find((function(e){return e.GIS_LINK===t||e.uniqueId===t})));let r,s,l=void 0===n.location?"":n.location,o=void 0===n.uniqueId?"":n.uniqueId,d=void 0===n.GIS_LINK?"":n.GIS_LINK,c=void 0===n.coOwner?"":n.coOwner,u=void 0===n.owner?"":n.owner,p=void 0===n.MBL?"":n.MBL,m=void 0===n.mailingAddress?"":n.mailingAddress,h=void 0===n.Mailing_City?"":n.Mailing_City+", ",g=void 0===n.Mail_State?"":n.Mail_State,f=void 0===n.Mailing_Zip?"":n.Mailing_Zip,b=void 0===n.Total_Acres?"":n.Total_Acres,y=void 0===n.Parcel_Primary_Use?"":n.Parcel_Primary_Use,v=void 0===n.Building_Use_Code?"":n.Building_Use_Code,w=void 0===n.Sale_Date?"":n.Sale_Date,x=void 0===n.Sale_Price?"":a(n.Sale_Price),_=void 0===n.Vol_Page?"":n.Vol_Page,T=void 0===n.Prior_Appraised_Total?"":a(n.Prior_Appraised_Total),I=void 0===n.Prior_Assessed_Total?"":a(n.Prior_Assessed_Total),B=void 0===n.Prior_Assessment_Year?"":n.Prior_Assessment_Year,E=(void 0===n.geometry||n.geometry,void 0===n.Map?"":$.trim(n.Map)),C=void 0===n.objectid?"":n.objectid,D=void 0===n.LAT?"":n.LAT,A=void 0===n.LON?"":n.LON,P=void 0===n.AcctNum?"":n.AcctNum,k=void 0===n.Image_Path?"":n.Image_Path;"yes"===M.useUniqueIdforParcelMap?(oe=o,r=o):(oe=d,r=d),s="yes"===M.useVisionForTaxBillUrl?P:o,de=C,L=d;const F=document.getElementById("detail-content"),N=document.createElement("div");N.innerHTML="",N.classList.add("details");let O=M.DetailLinksToInclude,R=M.DetailLinks,U=[];R.forEach((e=>{let t=e;if(O.includes(e)){let e={[t]:{show:"show"}};U.push(e)}else{let e={[t]:{show:"none"}};U.push(e)}}));let V=`\n      <p>\n      <span style="font-family:Tahoma;font-size:14px;"><strong>${l}</strong></span> <br>\n      </p>\n\n      <div>\n      <img class="image" src=${M.imageUrl}${k} alt="Building Photo" width="250" height="125">\n      </div>\n      <p>\n      <span style="font-family:Tahoma;font-size:12px;"><strong>${u} ${c}</strong></span> <br>\n      <span style="font-family:Tahoma;font-size:12px;"><strong>${m}</strong></span> <br>\n      <span style="font-family:Tahoma;font-size:12px;"><strong>${h} ${g} ${f}</strong></span><br>\n  </p>\n  <div id="accordion">\n    <div class="card" id="links" style="display:${U[0].links.show}">\n      <div class="card-header" id="headingOne">\n          <h5 class="mb-0">\n          <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">\n              Property Links\n          </button>\n        </h5>\n    </div>\n\n    \n    <div id="collapseOne" class="collapse show" aria-labelledby="OneFour" data-parent="#accordion">\n           <div class="card-body" style="text-align: left;">\n      `;"yes"===M.includePermitLink&&(V+=`<a class='mx-auto' href=${M.permitLink}?uniqueid=${o} target="_blank"><span style="font-family:Tahoma;font-size:12px;"><strong>Permits</strong></a><br>`),V+=`\n        <table style="width: 100%; font-family: Tahoma; font-size: 12px; border-collapse: collapse; text-align: left;">\n  <tr>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="${M.tax_bill}&uniqueId=${s}">\n        <strong>Tax Bills</strong>\n      </a>\n    </td>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="${M.propertyCard}${o}">\n        <strong>Property Card</strong>\n      </a>\n    </td>\n  </tr>\n  <tr>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="https://publicweb-gis.s3.amazonaws.com/PDFs/${M.parcelMapUrl}/Quick_Maps/QM_${r}.pdf">\n        <strong>Parcel Map</strong>\n      </a>\n    </td>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="${M.taxMap_Url}${E}.pdf">\n        <strong>Tax Map</strong>\n      </a>\n    </td>\n  </tr>\n  <tr>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="https://www.google.com/maps/@${D},${A},17z/@${D},${A},17z/data=!5m1!1e2">\n        <strong>Google Maps</strong>\n      </a>\n    </td>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="https://www.bing.com/maps?cp=${D}~${A}&lvl=17.0">\n        <strong>Bing Maps</strong>\n      </a>\n    </td>\n  </tr>\n  <tr><td colspan="2"> &nbsp </td></tr>\n  <tr>\n    <td colspan="2">\n      <a target="_blank" rel="noopener noreferrer" href="${M.pdf_demo}">\n        <strong>Demographics Profile</strong>\n      </a>\n    </td>\n  </tr>\n  <tr>\n    <td colspan="2">\n      <a target="_blank" rel="noopener noreferrer" href="${M.housingUrl}">\n        <strong>Housing Profile</strong>\n      </a>\n    </td>\n  </tr>\n</table>\n\n          </div>\n        </div>\n      </div>\n        <div class="card " id="ids" style="display:${U[1].ids.show}">\n            <div class="card-header" id="headingTwo">\n            <h5 class="mb-0">\n                <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">\n                Property Ids & Uses\n                </button>\n            </h5>\n            </div>\n            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">\n                <div class="card-body">\n                  <p>\n                  <span style="font-family:Tahoma;font-size:12px;">Unique ID: <strong>${o}</strong></span> <br>\n                  <span style="font-family:Tahoma;font-size:12px;">MBL: <strong>${p}</strong></span> <br>\n                  <span style="font-family:Tahoma;font-size:12px;">Total Acres: <strong>${b}</strong></span> <br>\n                  <span style="font-family:Tahoma;font-size:12px;">Primary Use: <strong>${y}</strong></span> <br>\n                  <span style="font-family:Tahoma;font-size:12px;">Primary Bldg Use: <strong>${v}</strong></span><br>\n                  </p>\n                </div>\n            </div>\n        </div>\n    <div class="card" id="sales" style="display:${U[3].sales.show}" >\n    <div class="card-header" id="headingThree">\n      <h5 class="mb-0">\n        <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">\n          Latest Sale / Transfer\n        </button>\n      </h5>\n    </div>\n    <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">\n      <div class="card-body">\n        <p>\n        <span style="font-family:Tahoma;font-size:12px;">Sold on: <strong>${w}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;">Sale Price: <strong>$${x}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;">Volume/Page: <strong>${_}</strong></span><br>\n        </p>\n      </div>\n    </div>\n  </div>\n  <div class="card" id="vals" style="display:${U[2].vals.show}">\n    <div class="card-header" id="headingFour">\n        <h5 class="mb-0">\n          <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">\n            Valuations\n          </button>\n        </h5>\n      </div>\n      <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordion">\n        <div class="card-body">\n            <p>\n            <span style="font-family:Tahoma;font-size:12px;"><strong>Valuations:</strong></span><br>\n            <span style="font-family:Tahoma;font-size:12px;">GL Year: <strong>${B}</strong></span> <br>\n            <span style="font-family:Tahoma;font-size:12px;">Assessment: <strong>$${I}</strong></span> <br>\n            <span style="font-family:Tahoma;font-size:12px;">Appraised: <strong>$${T}</strong></span> <br>\n            <span style="font-family:Tahoma;font-size:12px;"></span>\n            </p>\n        </div>\n    </div>\n  </div>\n</div>\n    `,N.innerHTML=V,$("#details-spinner").hide(),F.appendChild(N),S&&$(".abutters-zoom").trigger("click"),S=!1}function at(e,t,i){ee={isChanged:!0,item:i};I.graphics.removeAll(N);D=t,C=t;const a=new s({geometry:D,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:3}},id:"uniqueBufferGraphicId"}),n=D.extent.expand(2);I.graphics.addMany([a]),I.goTo({target:a,extent:n})}function nt(e,t,i){ee={isChanged:!1,item:""},R=[];let a="uniqueBufferGraphicId";I.graphics.removeAll(N);const n=I.graphics.items.findIndex((e=>e.id===a));if(n>-1&&I.graphics.removeAt(n),R=Z.filter((e=>e.GIS_LINK==i)),"no"==sessionStorage.getItem("condos")&&R.length==Z.length&&R.length>1)if(O){W=!1,D=O[0].geometry,C=O[0].geometry;const e={type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},t=2,i=D.extent.expand(t),n=new s({geometry:D,symbol:e,id:a});I.graphics.addMany([n]),I.goTo({target:n,extent:i}).catch((function(e){"AbortError"!=e.name&&console.error(e)}))}else{let e=`GIS_LINK = '${i}'`,t=_e.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],_e.queryFeatures(t).then((e=>{let t=e.features[0].geometry;D=t,C=t;const i=D.extent.expand(2);I.goTo({target:t,extent:i}).catch((function(e){"AbortError"!=e.name&&console.error(e)}));const n=new s({geometry:C,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:a});I.graphics.addMany([n])}))}else{W=!0;let t=Z.filter((t=>t.objectid==e));if(t)if(null!=t[0].geometry&&""!=t[0].geometry){C=t[0].geometry;const e=2,i=C.extent.expand(e);I.goTo({target:C,extent:i}).catch((function(e){"AbortError"!=e.name&&console.error(e)}));const n=new s({geometry:C,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:a});I.graphics.addMany([n])}else{let e;W=!1,e=t.filter((e=>{e.GIS_LINK}))?`GIS_LINK = '${i}'`:`GIS_LINK = '${t[0].GIS_LINK}'`;let n=_e.createQuery();n.where=e,n.returnGeometry=!0,n.returnHiddenFields=!0,n.outFields=["*"],_e.queryFeatures(n).then((e=>{let t=e.features[0].geometry;C=t,D=t;const i=D.extent.expand(2);I.goTo({target:t,extent:i}).catch((function(e){"AbortError"!=e.name&&console.error(e)}));const n=new s({geometry:C,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:a});I.graphics.addMany([n])}))}}q&&(q?.remove(),q=null),U&&(U?.remove(),U=null),U=I.on("click",We)}I.when((function(){document.getElementById("zoom-in").onclick=function(){I.zoom+=1},document.getElementById("zoom-out").onclick=function(){I.zoom-=1}})),ae.addEventListener("click",(function(){qe()})),ne.addEventListener("click",(function(){qe()})),document.getElementById("searchInput").addEventListener("input",(function(e){B=e.target.value.toUpperCase().replace(/&amp;/g,"&")})),$(document).ready((function(){$("#backButton").on("click",(function(){if(N&&N.length>=1||!0===G||Z.length>0)if($("#WelcomeBox").hide(),$("#select-button").prop("disabled",!1),$("#detailBox").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#featureWid").show(),$("#total-results").show(),$("#ResultDiv").show(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#detail-content").empty(),$("#backButton").hide(),$("#detailsButton").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").show(),$("#exportButtons").show(),$("#exportSearch").show(),$("#results-div").css("height","300px"),$(".center-container").show(),I.graphics.removeAll(),I.graphics.addMany(N),N.length>1){const e=N.map((e=>e.geometry.extent)),t=3,i=e.reduce(((e,t)=>e.union(t)),e[0]).expand(t);I.goTo({target:i}).catch((e=>{console.error("Error zooming to extent:",e)}))}else{const e=2,t=N[0].geometry.extent.expand(e);I.goTo({target:N,extent:t})}else $("#total-results").hide(),$("#ResultDiv").hide(),$("#abut-mail").hide(),$("#backButton").hide(),$("#details-btns").hide(),$("#detailBox").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#dropdown").show(),$(".center-container").show(),$("#WelcomeBox").show();J||Y?!J&&Y||!Y&&J?(q&&q.remove(),U&&(U?.remove(),U=null),$("#select-button").addClass("btn-warning"),q=I.on("click",Qe)):J&&!Y?(q&&(q?.remove(),q=null),U&&(U?.remove(),U=null),q=I.on("click",Qe),$("#select-button").addClass("btn-warning")):(q&&(q?.remove(),q=null),U&&(U?.remove(),U=null),$("#select-button").addClass("btn-warning"),q=I.on("click",Qe)):(U&&(U?.remove(),U=null),q&&(q?.remove(),q=null),q&&Y&&(q?.remove(),q=null),$("#select-button").removeClass("btn-warning"),U=I.on("click",We))}))})),$(document).ready((function(){$("#detailsButton").on("click",(function(){$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detail-content").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportSearch").hide(),$("#exportButtons").hide(),$("#abutters-title").html("Abutting Parcels (0)"),$("#backButton-div").css("padding-top","0px"),$("#results-div").css("height","300px"),U&&(U?.remove(),U=null),U=I.on("click",We);const e=I.graphics.items.findIndex((e=>e.id===F));e>-1&&I.graphics.removeAt(e)}))})),$(document).ready((function(){$("#abutters").on("click",(function(e){U&&(U?.remove(),U=null),q&&(q?.remove(),q=null),$("#results-div").css("height","300px"),$("#exportButtons").show(),$("#exportResults").show(),$("#exportSearch").hide(),$("#csvExportResults").show(),$("#csvExportSearch").hide(),$("#WelcomeBox").hide(),$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#abutters-content").show(),$("#selected-feature").empty(),$("#backButton").show(),$("#detailsButton").show(),$("#parcel-feature").empty(),$("#backButton-div").css("padding-top","78px"),$("#abutters-title").html("Abutting Parcels (0)"),rt(e),ie.value=100,function(e){$("#abutters-spinner").show();let t,i=e,a=Q;t="no"==sessionStorage.getItem("condos")?l.buffer(D,i,a):l.buffer(C,i,a);Xe(t),function(e){let t=[];const i=document.getElementById("parcel-feature");i.innerHTML="";const a={spatialRelationship:"intersects",geometry:e,outFields:["*"],returnGeometry:!0,units:Q};A=[],"no"===sessionStorage.getItem("condos")?_e.queryFeatures(a).then((e=>{t=[...e.features];const a=new Set;t.filter((e=>!a.has(e.attributes.OBJECTID)&&(a.add(e.attributes.OBJECTID),!0)));let n=t.filter((e=>a.has(e.attributes.OBJECTID)));totalResults=t.length;let r=t,s=r.filter(((e,t)=>r.indexOf(e)===t));lastResults=s,A=t,le=n,n.forEach((function(e){let t=e.attributes.GIS_LINK,a=e.attributes.OBJECTID,n=e.attributes.Owner,r=e.attributes.Co_Owner,s=e.attributes.Mailing_Address_1,l=e.attributes.Mailing_Address_2,o=e.attributes.Mailing_City,d=e.attributes.Mail_State,c=e.attributes.Mailing_Zip;const u=document.createElement("ul");u.classList.add("row"),u.classList.add("list-group"),u.classList.add("abutters-list");const p=document.createElement("li");p.classList.add("abutters-group-item","col-12");let m="";m=` ${n} ${r} <br> ${s} ${l} <br> ${o}, ${d} ${c}`,p.innerHTML+=m,p.setAttribute("data-id",t),p.setAttribute("object-id",a),u.appendChild(p),i.appendChild(u),$("#abutters-spinner").hide(),$("#abutters-title").html(`Abutting Parcels (${totalResults})`)}))})):Te.queryFeatures(a).then((e=>{t=[...e.features];const a=new Set;t.filter((e=>!a.has(e.attributes.OBJECTID)&&(a.add(e.attributes.OBJECTID),!0)));let n=t.filter((e=>a.has(e.attributes.OBJECTID)));totalResults=t.length;let r=t,s=r.filter(((e,t)=>r.indexOf(e)===t));lastResults=s,A=t,le=n,n.forEach((function(e){let t=e.attributes.GIS_LINK,a=e.attributes.OBJECTID,n=e.attributes.Owner,r=e.attributes.Co_Owner,s=e.attributes.Mailing_Address_1,l=e.attributes.Mailing_Address_2,o=e.attributes.Mailing_City,d=e.attributes.Mail_State,c=e.attributes.Mailing_Zip;const u=document.createElement("ul");u.classList.add("row"),u.classList.add("list-group"),u.classList.add("abutters-list");const p=document.createElement("li");p.classList.add("abutters-group-item","col-12");let m="";m=` ${n} ${r} <br> ${s} ${l} <br> ${o}, ${d} ${c}`,p.innerHTML+=m,p.setAttribute("data-id",t),p.setAttribute("object-id",a),u.appendChild(p),i.appendChild(u),$("#abutters-spinner").hide(),$("#abutters-title").html(`Abutting Parcels (${totalResults})`)}))}));$("#results-div").css("height","300px"),$("#exportResults").show(),$("#csvExportResults").show()}(t)}("100")}))})),$(document).ready((function(){$("#abutters-attributes").on("click",(function(e){U&&(U?.remove(),U=null),q&&(q?.remove(),q=null),$("#results-div").css("height","300px"),$("#exportButtons").show(),$("#exportResults").show(),$("#exportButtons").show(),$("#exportSearch").hide(),$("#csvExportResults").show(),$("#csvExportSearch").hide(),$("#WelcomeBox").hide(),$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#abutters-content").show(),$("#selected-feature").empty(),$("#backButton").show(),$("#detailsButton").show(),$("#parcel-feature").empty(),$("#backButton-div").css("padding-top","78px"),$("#abutters-title").html("Abutting Parcels (0)"),rt(e),ie.value=100,et("100")}))})),$(document).ready((function(){$("#filterButton").on("click",(function(){$("#WelcomeBox").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#exportSearch").hide(),$("#csvExportSearch").hide(),$("#abutters-content").hide(),$("#layerListDiv").hide(),$("#selected-feature").empty(),$("#backButton").hide(),$("#detailsButton").hide(),$("#dropdown").show(),$("#filterDiv").show(),$("#dropdown").toggleClass("expanded"),$("#sidebar2").css("left","0px"),$("#sidebar2").addClass("collapsed"),$("#results-div").css("left","350px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide(),$("#results-div").css("height","300px"),$("#parcel-feature").empty(),$("#backButton").show(),$("#backButton-div").css("padding-top","0px"),$("#abutters-title").html("Abutting Parcels (0)"),$(".center-container").show()}))})),$(document).ready((function(){$("#layerListBtn").on("click",(function(){$("#WelcomeBox").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#exportSearch").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportButtons").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#backButton").hide(),$("#detailsButton").hide(),$("#dropdown").show(),$("#filterDiv").hide(),$("#backButton").show(),$("#dropdown").toggleClass("expanded"),$("#sidebar2").css("left","0px"),$("#sidebar2").addClass("collapsed"),$("#results-div").css("left","350px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide(),$("#results-div").css("height","300px"),$("#layerListDiv").show(),$("#parcel-feature").empty(),$("#backButton-div").css("padding-top","0px"),$("#abutters-title").html("Abutting Parcels (0)"),$(".center-container").show()}))})),$("#layerListDiv").hide(),$(document).ready((function(){$("#exportSearch").on("click",(function(e){e.stopPropagation();const t=document.createElement("div");t.style.visibility="hidden",document.body.appendChild(t);const i=document.createElement("ul");P.forEach((function(e){let t=e.objectid,a=e.owner,n=e.coOwner,r=e.mailingAddress,s=(e.mailingAddress2,e.Mailing_City),l=e.Mail_State,o=e.Mailing_Zip,d=(e.location,e.MBL);const c=document.createElement("li");let u;c.classList.add("export-search-list"),u=` ${a} ${n} <br> MBL: ${d} <br> ${r} <br> ${s}, ${l} ${o}`,c.innerHTML+=u,c.setAttribute("object-id",t),i.appendChild(c)})),t.appendChild(i),Je("search"),document.body.removeChild(t)}))})),$(document).ready((function(){$("#csvExportResults").on("click",(function(e){e.stopPropagation();let t=["Owner","Co-Owner","Mailing Address","Mailing Address 2","Mailing City","Mailing State","Mailing Zip","MBL","Location"].join(",")+"\n";le.forEach((function(e){let i=e.attributes.Owner||"",a=e.attributes.Co_Owner||"",n=e.attributes.Mailing_Address_1||"",r=e.attributes.Mailing_Address_2||"",s=e.attributes.Mailing_City||"",l=e.attributes.Mail_State||"",o=e.attributes.Mailing_Zip?`\t${e.attributes.Mailing_Zip.toString().padStart(5,"0")}`:"",d=e.attributes.Location||"",c=e.attributes.MBL||"";t+=`"${i}","${a}","${n}","${r}","${s}","${l}","${o}","${c}","${d}"\n`}));const i=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");if(void 0!==a.download){const e=URL.createObjectURL(i);a.setAttribute("href",e),a.setAttribute("download","export.csv"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}))})),$(document).ready((function(){$("#csvExportSearch").on("click",(function(e){e.stopPropagation();let t=["Owner","Co-Owner","Mailing Address","Mailing Address 2","Mailing City","Mailing State","Mailing Zip","MBL","Location"].join(",")+"\n";P.forEach((function(e){let i=e.owner||"",a=e.coOwner||"",n=e.mailingAddress||"",r=e.mailingAddress2||"",s=e.Mailing_City||"",l=e.Mail_State||"",o=e.Mailing_Zip?`\t${e.Mailing_Zip.toString().padStart(5,"0")}`:"",d=e.location||"",c=e.MBL||"";t+=`"${i}","${a}","${n}","${r}","${s}","${l}","${o}","${c}","${d}"\n`}));const i=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");if(void 0!==a.download){const e=URL.createObjectURL(i);a.setAttribute("href",e),a.setAttribute("download","export.csv"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}}))})),$(document).ready((function(){$("#exportResults").on("click",(function(e){e.stopPropagation();const t=document.createElement("div");t.style.visibility="hidden",document.body.appendChild(t);const i=document.createElement("ul");P.forEach((function(e){let t=e.attributes.OBJECTID,a=e.attributes.Owner,n=e.attributes.Co_Owner,r=e.attributes.Mailing_Address_1,s=(e.attributes.Mailing_Address_2,e.attributes.Mailing_City),l=e.attributes.Mail_State,o=e.attributes.Mailing_Zip,d=(e.location,e.attributes.MBL);const c=document.createElement("li");let u;c.classList.add("abutters-group-list"),u=` ${a} ${n} <br> MBL: ${d} <br> ${r} <br> ${s}, ${l} ${o}`,c.innerHTML+=u,c.setAttribute("object-id",t),i.appendChild(c)})),t.appendChild(i),Je("details"),document.body.removeChild(t)}))})),$(document).ready((function(){let e;function t(){clearTimeout(e),e=setTimeout((()=>{et(currentVal)}),200)}$("#buffer-value").on("change",(function(e){e.stopPropagation(),currentVal=ie.value=parseInt(ie.value),$("#parcel-feature").empty(),t()})),$("#increase").on("click",(function(e){e.stopPropagation(),currentVal=ie.value=parseInt(ie.value)+1,$("#parcel-feature").empty(),t()})),$("#decrease").on("click",(function(e){e.stopPropagation(),currentVal=ie.value=parseInt(ie.value)-1,$("#parcel-feature").empty(),t()})),$("#submit").on("click",(function(e){e.stopPropagation(),e.preventDefault(),currentVal=ie.value=parseInt(ie.value),$("#parcel-feature").empty(),t()})),$("#buffer-value").on("keypress",(function(e){13==e.which&&(currentVal=ie.value=parseInt(ie.value),e.preventDefault(),t())})),$(".units").on("click",(function(e){"feet"==e.target.value?(Q="feet",$("#unitSelector").html(Q)):(Q="meters",$("#unitSelector").html(Q))}))})),$(document).ready((function(){$(document).on("click",".abutters-zoom",(function(e){if(e.stopPropagation(),e.preventDefault(),"no"===sessionStorage.getItem("condos"))if(K){if(K){let e=`GIS_LINK = '${L}'`,t=_e.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],_e.queryFeatures(t).then((e=>{const t=e.features[0].geometry.extent,i=t.center;t.expand(3);I.goTo({target:i,zoom:14})}))}}else{let e=`OBJECTID = ${de}`,t=_e.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],_e.queryFeatures(t).then((e=>{const t=e.features[0].geometry.extent,i=t.center;t.expand(3);I.goTo({target:i})}))}else{let e=`OBJECTID = ${de}`,t=Te.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],Te.queryFeatures(t).then((e=>{let i,a,n,r;e.features>0?Te.queryFeatures(t).then((e=>{let t=Te.createQuery();t.where=`GIS_LINK = ${L}`,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"]})).then((e=>{i=e,a=i.features[0].geometry,n=a.extent,r=n.center})):(i=e,a=i.features[0].geometry,n=a.extent,r=n.center);n.expand(3);I.goTo({target:r})}))}}))}));const rt=function(e,t){$("#abutters-title").html("Abutters");let i,a,n,r,s,l,o,d,c,u,p,m=H;if(ee.isChanged)i=ee.item.attributes.Mailing_Address_1,a=ee.item.attributes.Uniqueid,n=ee.item.attributes.GIS_LINK,r=ee.item.attributes.Owner,p=ee.item.attributes.MBL,s=ee.item.attributes.Co_Owner,o=ee.item.attributes.Mailing_Address_1,d=ee.item.attributes.Mailing_Address_2,c=ee.item.attributes.Mailing_City,l=ee.item.attributes.Mailing_Zip,u=ee.item.attributes.Mail_State;else{var h=Z.find((function(e){return e.uniqueId===m[1]&&e.objectid===Number(m[0])||e.GIS_LINK===m[1]&&e.objectid===Number(m[0])}));i=void 0===h.mailingAddress?"":h.mailingAddress,a=void 0===h.uniqueId?"":h.uniqueId,n=void 0===h.GIS_LINK?"":h.GIS_LINK,r=void 0===h.owner?"":h.owner,s=void 0===h.coOwner?"":h.coOwner,o=void 0===h.mailingAddress?"":h.mailingAddress,d=void 0===h.mailingAddress2?"":h.mailingAddress2,c=void 0===h.Mailing_City?"":h.Mailing_City,u=void 0===h.Mail_State?"":h.Mail_State,l=void 0===h.Mailing_Zip?"":h.Mailing_Zip,p=void 0===h.MBL?"":h.MBL}const g=document.getElementById("selected-feature"),f=document.createElement("ul");f.classList.add("row"),f.classList.add("list-group");const b=document.createElement("li");let y;b.classList.add("abutters-group-item","col-12"),y=` ${r} ${s} <br> ${o} ${d} <br> ${c}, ${u} ${l}`,b.innerHTML+=y,b.setAttribute("data-id",n),$("#abutters-spinner").hide(),f.appendChild(b),g.appendChild(f)},st=(e,t,i)=>{let a;Z=[],document.getElementById("suggestions").innerHTML="",E&&(B=e.replace(/&amp;/g,"&"));let n=B;if(!(n?.length<3)||t||n||i){let e,r;$("#dropdown").toggleClass("expanded"),$("#details-btns").hide(),$("#abut-mail").hide(),$("#result-btns").hide(),$("#backButton").hide(),$("#detailsButton").hide(),$("#featureWid").empty(),$("#exportSearch").hide(),$("#csvExportResults").hide(),$("#exportButtons").hide(),e=`\n          Street_Name LIKE '%${n}%' OR \n          MBL LIKE '%${n}%' OR \n          Location LIKE '%${n}%' OR \n          Co_Owner LIKE '%${n}%' OR \n          Uniqueid LIKE '%${n}%' OR \n          Owner LIKE '%${n}%' OR \n          GIS_LINK LIKE '%${n}%'\n      `,t?r=t:j?(r=i,J=!0):S?r=t:(r=Ie.createQuery(),r.where=e,r.returnGeometry=!1,r.returnHiddenFields=!0,r.outFields=["*"]),Ie.queryFeatures(r).then((e=>{if(e.features.length>0){let n;a=e.features,"MISMATCH"===e.features[0].attributes.Match_Status&&"Condominium"===e.features[0].attributes.Parcel_Type&&0==J&&(z=!0),a.forEach((function(e){if(""!==e.attributes.Owner){let t=e.attributes.OBJECTID,i=e.attributes.Location,a=e.attributes.Uniqueid,n=e.attributes.GIS_LINK,r=e.attributes.Co_Owner,s=e.attributes.Owner,l=e.attributes.MBL,o=e.geometry,d=e.attributes.Mailing_Address_1,c=e.attributes.Mailing_Address_2,u=e.attributes.Mailing_City,p=e.attributes.Mail_State,m=e.attributes.Mailing_Zip,h=e.attributes.Total_Acres,g=e.attributes.Parcel_Primary_Use,$=e.attributes.Building_Use_Code,f=e.attributes.Parcel_Type,b=e.attributes.Design_Type,v=e.attributes.Zoning,w=e.attributes.Neighborhood,x=e.attributes.Land_Type_Rate,_=e.attributes.Functional_Obs,T=e.attributes.External_Obs,I=y(e.attributes.Sale_Date),L=e.attributes.Sale_Price,S=e.attributes.Vol_Page,M=e.attributes.Assessed_Total,B=e.attributes.Appraised_Total,E=e.attributes.Influence_Factor,C=e.attributes.Influence_Type,D=e.attributes.Land_Type,A=e.attributes.Prior_Assessment_Year,P=e.attributes.Prior_Assessed_Total,k=e.attributes.Prior_Appraised_Total,F=e.attributes.Map,N=e.attributes.Lat,O=e.attributes.Lon,R=e.attributes.Image_Path,U=e.attributes.AcctNum,q=e.attributes.Match_Status;Z.push(new He(t,i,a,n,r,s,l,o,d,c,u,p,m,h,g,$,f,b,v,w,x,_,T,I,L,S,M,B,E,C,D,A,P,k,F,N,O,R,U,q))}})),"no"===sessionStorage.getItem("condos")?(n=_e.createQuery(),n.where=r.where,n.returnDistinctValues=!1,n.returnGeometry=!0,n.outFields=["*"]):(n=Te.createQuery(),n.where=r.where,n.returnDistinctValues=!1,n.returnGeometry=!0,n.outFields=["*"]);let s=null;j?n.where=i.where:S&&(n.where=t.where,s=!0),function(e,t,i){"no"===sessionStorage.getItem("condos")?_e.visible=!0:Te.visible=!0,$(".spinner-container").show();const a=!0;let n,r,s,l;n=`\n          Street_Name LIKE '%${e}%' OR \n          MBL LIKE '%${e}%' OR \n          Location LIKE '%${e}%' OR \n          Co_Owner LIKE '%${e}%' OR \n          Uniqueid LIKE '%${e}%' OR \n          Owner LIKE '%${e}%' OR \n          GIS_LINK LIKE '%${e}%'\n      `,i?r=i:(j||S)&&(r=i,a=!0),"no"===sessionStorage.getItem("condos")?_e.queryFeatures(r).then((function(a){if(l=a.features,a.features.length>=0)if(l=a.features,O=a.features,z){let i="",a="";const n=Le.createQuery();n.where=r.where,n.returnGeometry=!1,n.outFields=["*"],Le.queryFeatures(n).then((function(e){i=e.features;const t=e.features[0].attributes.GIS_LINK;let a=_e.createQuery();return a.where=`GIS_LINK = '${t}'`,a.returnGeometry=!0,a.returnHiddenFields=!0,a.outFields=["*"],_e.queryFeatures(a)})).then((function(n){l=n.features,a=n.features,O=n.features,Ke(n,I.graphics,""),Ge(n.features),t&&lt(i,a,e)})).catch((function(e){console.error("Error querying features: ",e)}))}else O=a.features,Ke(a,I.graphics,""),Ge(a.features),t&&lt(l,e),z=!1;else if(1===a.features.length&&Z.length>2){const i=Le.createQuery();i.where=n,i.returnGeometry=!1,i.outFields=["*"],Le.queryFeatures(i).then((function(i){Ke(i.features),Ge(),t&&lt(l,e)}))}else{const e=Le.createQuery();e.where=i.where,e.returnGeometry=!1,e.outFields=["*"],0==a.features.length&&Le.queryFeatures(e).then((function(e){l=e.features,s=e.features[0].attributes.GIS_LINK;let i=e.features[0].attributes.Uniqueid;O=e.features,Ke(e,I.graphics),Ge(e.features),t&&(K=!0,lt(l,i))}))}})):Te.queryFeatures(r).then((function(e){l=e.features;const i=e.features[0].attributes.Uniqueid;e.features&&(Ke(e,I.graphics,""),Ge(e.features),t&&lt(l,i))})),q&&(q?.remove(),q=null),U&&(U?.remove(),U=null),j?($("#select-button").addClass("btn-warning"),q=I.on("click",Qe)):(U=I.on("click",We),$("#select-button").removeClass("btn-warning")),J=!1,Y=!1}(B,s,n)}})).catch((e=>{console.error("Error querying for details:",e)}))}else qe()};function lt(e,t,i){let a=e,n=t;changeAbuttersZoom=!0,a.length<=0&&(qe(),alert("Search resulted in an error, please try again."));let r=a[0].attributes.Uniqueid,s=a[0].attributes.OBJECTID,l=n[0].attributes.OBJECTID;$("#details-spinner").show(),$("#WelcomeBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportButtons").hide(),$("#exportSearch").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$(".center-container").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),document.getElementById("total-results").style.display="none",it(s,r),nt(l,0,r),$("#total-results").hide(),$("#ResultDiv").hide(),G=!0,z=!1,S=!1,urlSearch=!1}const ot=function(){const e={},t=window.location.search.substring(1).split("&");for(let i=0;i<t.length;i++){const a=t[i].split("=");a[0]&&a[1]&&(e[decodeURIComponent(a[0])]=decodeURIComponent(a[1].replace(/\+/g," ")))}return e}().uniqueid;let dt,ct=`Uniqueid = '${ot}'`;if(ot){S=!0;I.when((function(){query=Ie.createQuery(),query.where=ct,query.returnGeometry=!1,query.returnHiddenFields=!0,query.outFields=["*"],query=Ie.createQuery(),query.where=ct,query.returnGeometry=!1,query.returnHiddenFields=!0,query.outFields=["*"],Le.queryFeatures(query).then((e=>{let t=e.features[0].attributes,i=(t.Uniqueid,t.Building_Type);"MISMATCH"===t.Match_Status&&"Condominium"===i&&(z=!0),st(null,query)}))})).catch((function(e){console.error("Error occurred while the view was loading: ",e)}))}document.getElementById("searchInput").addEventListener("input",(function(e){Z=[],$("#sidebar2").css("left","-350px"),$("#sidebar2").removeClass("collapsed"),$("#results-div").css("left","0px"),$("#dropdown").toggleClass("expanded"),$("#dropdown").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide();var t=e.target.value.toUpperCase();Z=[],secondList=[],N=[],$("#select-button").removeClass("btn-warning"),$("#searchInput ul").remove(),$("#suggestions").hide(),$("#featureWid").empty(),$("#featureWid").hide(),$("#ResultDiv").hide(),$("#dropdown").removeClass("expanded"),$("#dropdown").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#right-arrow-2").show(),$("#left-arrow-2").hide(),$("#abutters-content").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#backButton").hide(),$("#detailBox").hide(),$("#exportSearch").hide(),$("#csvExportSearch").hide(),$("#csvExportResults").hide(),$("#exportButtons").hide(),U&&(U?.remove(),U=null),q&&(q?.remove(),q=null),$("#dropdown").show(),$("#WelcomeBox").show(),$(".center-container").show(),document.getElementById("suggestions").innerHTML="",$("#featureWid").empty(),I.graphics.removeAll();let i=`\n            Street_Name LIKE '%${t}%' OR \n            MBL LIKE '%${t}%' OR \n            Location LIKE '%${t}%' OR \n            Co_Owner LIKE '%${t}%' OR \n            Uniqueid LIKE '%${t}%' OR \n            Owner LIKE '%${t}%' OR\n            GIS_LINK LIKE '%${t}%'\n        `,a=Le.createQuery();a.where=i,a.returnGeometry=!1,a.outFields=["Street_Name","MBL","Location","Co_Owner","Uniqueid","Owner","GIS_LINK"];let n=new Set;Le.queryFeatures(a).then((e=>{let i=document.getElementById("suggestions");i.innerHTML="",e.features.forEach((e=>{["Street_Name","MBL","Location","Co_Owner","Uniqueid","Owner","GIS_LINK"].forEach((a=>{let r=e.attributes[a];if(r&&r.includes(t)&&!n.has(r)){let e=document.createElement("div");e.className="list-group-item",e.innerText=`${r}`,i.appendChild(e),n.add(r),i.style.display="block",e.addEventListener("click",(function(e){E=!0,st(e.target.innerHTML),E=!1}))}}))}))}))})),document.querySelector(".form-inline").addEventListener("submit",(function(e){"no"===sessionStorage.getItem("condos")?_e.visible=!0:Te.visible=!0,Z=[],I.graphics.removeAll(),N=[],e.preventDefault(),$("#featureWid").empty(),$("#selected-feature").empty(),U&&(U?.remove(),U=null),q&&(q?.remove(),q=null)})),document.addEventListener("click",(function(e){"searchInput"!==e.target.id&&(document.getElementById("suggestions").style.display="none")})),document.getElementById("searchButton").addEventListener("click",(function(){$("#sidebar2").css("left","-350px"),$("#sidebar2").removeClass("collapsed"),$("#results-div").css("left","0px"),$("#exportResults").hide(),$("#csvExportResults").hide(),clearTimeout(dt),dt=setTimeout((()=>{"no"===sessionStorage.getItem("condos")?_e.visible=!0:Te.visible=!0,$("#lasso").removeClass("btn-warning"),$("#select-button").removeClass("btn-warning"),$("dropdown").empty(),$("#featureWid").empty(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#total-results").show(),$("#ResultDiv").hide(),$("#backButton").hide(),$("#detailsButton").hide(),$("#detailBox").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#abutters-title").html("Abutting Parcels (0)"),N=[],I.graphics.removeAll(),U&&(U?.remove(),U=null),q&&(q?.remove(),q=null),st()}),300)})),$(document).ready((function(){pe={streetName:null,owner:null,appraisedValueMin:null,appraisedValueMax:null,assessedValueMin:null,assessedValueMax:null,zoningType:null,neighborhoodType:null,propertyType:null,buildingType:null,buildingUseType:null,designType:null,acresValueMin:null,acresValueMax:null,soldOnMin:null,soldOnMax:null,soldPMin:null,soldPMax:null},$("#streetFilter").on("calciteComboboxChange",(function(e){let t;if(pe.streetName=e.target.value,""!==pe.streetName&&void 0!==pe.streetName&&null!==pe.streetName)Fe("Street_Name",e.target.value),Oe("Street_Name",e.target.value);else{clearTimeout(t),t=setTimeout((()=>{i()}),600)}})),$("#ownerFilter").on("calciteComboboxChange",(function(e){if(pe.owner=e.target.value,""!==pe.owner&&void 0!==pe.owner&&null!==pe.owner)Fe("Owner",e.target.value),Oe("Owner",e.target.value);else{let e;clearTimeout(e),e=setTimeout((()=>{i()}),600)}})),$("#app-val-min, #app-val-max").on("input",(function(){var e=$("#app-val-min").val(),t=$("#app-val-max").val();e=e.replace(/^\$/,"").replace(/,/g,""),t=t.replace(/^\$/,"").replace(/,/g,"");var i=parseInt(e,10),a=parseInt(t,10);if(!isNaN(i)&&!isNaN(a)){var n=i.toLocaleString(),r=a.toLocaleString();$("#app-val-min").val("$"+n),$("#app-val-max").val("$"+r),pe.appraisedValueMin=i,pe.appraisedValueMax=a}!isNaN(i)&&!isNaN(a)&&i<=a&&e.length>=6&&t.length>=6&&(pe.appraisedValueMin=i,pe.appraisedValueMax=a,Fe("Appraised_Total",i,a),Oe("Appraised_Total",i,a))})),$("#assess-val-min, #assess-val-max").on("input",(function(){var e=$("#assess-val-min").val(),t=$("#assess-val-max").val();e=e.replace(/^\$/,"").replace(/,/g,""),t=t.replace(/^\$/,"").replace(/,/g,"");var i=parseInt(e,10),a=parseInt(t,10);if(!isNaN(i)&&!isNaN(a)){var n=i.toLocaleString(),r=a.toLocaleString();$("#assess-val-min").val("$"+n),$("#assess-val-max").val("$"+r),pe.assessedValueMin=i,pe.assessedValueMax=a}!isNaN(i)&&!isNaN(a)&&i<=a&&e.length>=6&&t.length>=6?(pe.assessedValueMin=i,pe.assessedValueMax=a,Fe("Assessed_Total",i,a),Oe("Assessed_Total",i,a)):console.log("Invalid input values: ",i,a)})),$("#propertyFilter").on("calciteComboboxChange",(function(e){if(pe.propertyType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Fe("Parcel_Type",e.target.value),Oe("Parcel_Type",e.target.value);else{!function(){let e;clearTimeout(e),e=setTimeout((()=>{i()}),600)}()}})),$("#zoningFilter").on("calciteComboboxChange",(function(e){if(pe.zoningType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Fe("Zoning",e.target.value),Oe("Zoning",e.target.value);else{let e;clearTimeout(e),e=setTimeout((()=>{i()}),600)}})),$("#neighborhoodFilter").on("calciteComboboxChange",(function(e){if(pe.neighborhoodType=e.target.value,""!==e.target.value||void 0!==e.target.value||null!==e.target.value)Fe("Neighborhood",e.target.value),Oe("Neighborhood",e.target.value);else{let e;clearTimeout(e),e=setTimeout((()=>{i()}),600)}})),$("#buildingFilter").on("calciteComboboxChange",(function(e){if(pe.buildingType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Fe("Building_Type",e.target.value),Oe("Building_Type",e.target.value);else{let e;clearTimeout(e),e=setTimeout((()=>{i()}),600)}})),$("#buildingUseFilter").on("calciteComboboxChange",(function(e){if(pe.buildingUseType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Fe("Building_Use_Code",e.target.value),Oe("Building_Use_Code",e.target.value);else{let e;clearTimeout(e),e=setTimeout((()=>{i()}),600)}})),$("#designTypeFilter").on("calciteComboboxChange",(function(e){if(pe.designType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Fe("Design_Type",e.target.value),Oe("Design_Type",e.target.value);else{let e;clearTimeout(e),e=setTimeout((()=>{i()}),600)}})),$("#acres-val-min, #acres-val-max").on("input",(function(){var e=parseFloat($("#acres-val-min").val()),t=parseFloat($("#acres-val-max").val()),i=$("#acres-val-min").val().trim(),a=$("#acres-val-max").val().trim();!isNaN(e)&&!isNaN(t)&&e<=t&&i.length>=0&&a.length>=0?(pe.acresValueMin=e,pe.acresValueMax=t,Fe("Total_Acres",e,t),Oe("Total_Acres",e,t)):console.log("Invalid input values: ",e,t)})),$("#sold_calendar_lowest").on("calciteDatePickerChange",(function(){var e=$("#sold_calendar_lowest").val(),t=$("#sold_calendar_highest").val();pe.soldOnMin=e,pe.soldOnMax=t,Fe("Sale_Date",e,t),Oe("Sale_Date",e,t)})),$("#sold_calendar_highest").on("calciteDatePickerChange",(function(){var e=new Date($("#sold_calendar_lowest").val()),t=new Date($("#sold_calendar_highest").val());e.setDate(e.getDate()+1),t.setDate(t.getDate()+1);var i=e.toISOString().split("T")[0],a=t.toISOString().split("T")[0];pe.soldOnMin=i,pe.soldOnMax=a,Fe("Sale_Date",i,a),Oe("Sale_Date",i,a)}));let e,t=null;function i(){const e=["#designTypeFilter","#buildingUseFilter","#buildingFilter","#neighborhoodFilter","#zoningFilter","#propertyFilter","#ownerFilter","#streetFilter"].map((e=>$(e).val())).every((function(e){return 0===e.length}));return t!==e&&(e&&n(),t=e),e}async function a(){let e=[],t=["Appraised_Total","Assessed_Total","Total_Acres","Sale_Date","Sale_Price"];for(let i of t){let t=Ie.createQuery();t.outStatistics=[{statisticType:"max",onStatisticField:i,outStatisticFieldName:"maxValue"},{statisticType:"min",onStatisticField:i,outStatisticFieldName:"minValue"}];try{let a,n=await Ie.queryFeatures(t);if("Sale_Date"===i){let e=new Date(n.features[0].attributes.maxValue),t=new Date(n.features[0].attributes.minValue);a={[i]:{min:t,max:e}}}else{let e=n.features[0].attributes.maxValue,t=n.features[0].attributes.minValue;a={[i]:{min:t,max:e}}}e.push(a)}catch(e){console.error("Error querying features:",e)}}var i;i=e,[{fieldName:"Appraised_Total",minInput:"#app-val-min",maxInput:"#app-val-max",index:0},{fieldName:"Assessed_Total",minInput:"#assess-val-min",maxInput:"#assess-val-max",index:1},{fieldName:"Total_Acres",minInput:"#acres-val-min",maxInput:"#acres-val-max",index:2},{fieldName:"Sale_Date",minInput:"#sold_calendar_lowest",maxInput:"#sold_calendar_highest",index:3},{fieldName:"Sale_Price",minInput:"#saleP-val-min",maxInput:"#saleP-val-max",index:4}].forEach((function(e){if("Sale_Date"==e.fieldName){const n=$(e.minInput),r=$(e.maxInput);Ee(e.minInput),Ee(e.maxInput),n.empty(),r.empty();var t=i[e.index][e.fieldName].min,a=i[e.index][e.fieldName].max;let s=new Date(t),l=new Date(a),o=`${s.getFullYear()}-${("0"+(s.getMonth()+1)).slice(-2)}-${("0"+s.getDate()).slice(-2)}`,d=`${l.getFullYear()}-${("0"+(l.getMonth()+1)).slice(-2)}-${("0"+l.getDate()).slice(-2)}`;n.val(o),r.val(d),Ce(e.minInput,o),Ce(e.maxInput,d)}else{Ee(e.minInput),Ee(e.maxInput);const t=$(e.minInput),a=$(e.maxInput),n=t.value=i[e.index][e.fieldName].min,r=a.value=i[e.index][e.fieldName].max;let s,l;"Total_Acres"!==e.fieldName?(s="$"+n.toLocaleString(),l="$"+r.toLocaleString()):(s=n.toLocaleString(),l=r.toLocaleString()),t.val(s),a.val(l),Ce(e.minInput,s),Ce(e.maxInput,l)}}))}function n(){clearTimeout(e),e=setTimeout((()=>{!function(){ue=!0,t=null,$("#lasso").removeClass("btn-warning"),$("#searchInput ul").remove(),$("#searchInput").val="",document.getElementById("searchInput").value="",B="",searchTerm="",Z=[],secondList=[],he=[{layer:Te,field:"Appraised_Total",filterSelector:"#app-val-min",filterSelector2:"#app-val-max"},{layer:Te,field:"Assessed_Total",filterSelector:"#assess-val-min",filterSelector2:"#assess-val-max"},{layer:Te,field:"Total_Acres",filterSelector:"#acres-val-min",filterSelector2:"#acres-val-max"},{layer:Te,field:"Sale_Date",filterSelector:"#sold_calendar_lowest",filterSelector2:"#sold_calendar_highest"},{layer:Te,field:"Sale_Price",filterSelector:"#saleP-val-min",filterSelector2:"#saleP-val-max"}],me=[{layer:Te,field:"Street_Name",filterSelector:"#streetFilter",alias:"Street_Name",message:"Select a Street Name"},{layer:Te,field:"Owner",filterSelector:"#ownerFilter",message:"Select a Owner"},{layer:Te,field:"Parcel_Type",filterSelector:"#propertyFilter",alias:"Parcel_Type",message:"Select a Property Type"},{layer:Te,field:"Building_Type",filterSelector:"#buildingFilter",message:"Select a Building Type"},{layer:Te,field:"Building_Use_Code",filterSelector:"#buildingUseFilter",message:"Select a Building Use Type"},{layer:Te,field:"Design_Type",filterSelector:"#designTypeFilter",message:"Select a Design Type"},{layer:Te,field:"Zoning",filterSelector:"#zoningFilter",message:"Select a Zone"},{layer:Te,field:"Neighborhood",filterSelector:"#neighborhoodFilter",message:"Select a Neighborhood"}],ge=[{layer:Te,field:"Appraised_Total",filterSelector:"#streetFilter",minInput:"app-val-min",maxInput:"app-val-max",minValField:"appraisedValueMin",maxValueField:"appraisedValueMax",index:0},{layer:Te,field:"Assessed_Total",filterSelector:"#ownerFilter",minInput:"assess-val-min",maxInput:"assess-val-max",minValField:"assessedValueMin",maxValueField:"assessedValueMax",index:1},{layer:Te,field:"Total_Acres",filterSelector:"#propertyFilter",minInput:"acres-val-min",maxInput:"acres-val-max",minValField:"acresValueMin",maxValueField:"acresValueMax",index:2},{layer:Te,field:"Sale_Date",filterSelector:"#buildingFilter",minInput:"sold_calendar_lowest",maxInput:"sold_calendar_highest",minValField:"soldOnMin",maxValueField:"soldOnMax",index:3},{layer:Te,field:"Sale_Price",filterSelector:"#buildingUseFilter",minInput:"saleP-val-min",maxInput:"saleP-val-max",minValField:"soldPMin",maxValueField:"soldPMax",index:4}],$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#dropdown").hide(),$("#right-arrow-2").show(),$("#left-arrow-2").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#backButton").show(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportSearch").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#featureWid").hide(),$("#exportButtons").hide(),$("#dropdown").show(),$("#WelcomeBox").hide(),$("#select-button").attr("title","Add to Selection Enabled"),document.getElementById("suggestions").innerHTML="",$("#distanceButton").removeClass("btn-warning"),$("#distanceButton").addClass("bg-info"),$("#areaButton").removeClass("btn-warning"),$("#distanceButton").addClass("bg-info"),$("#featureWid").empty(),I.ui.remove(ve),ve&&(ve.destroy(),ve=null),I.graphics.removeAll(),N=[],Object.keys(pe).forEach((e=>{pe[e]=null}));const e=$("#streetFilter"),i=$("#ownerFilter"),n=$("#propertyFilter"),r=$("#buildingFilter"),s=$("#buildingUseFilter"),l=$("#designTypeFilter"),o=$("#zoningFilter"),d=$("#neighborhoodFilter"),c=$("#sold_calendar_lowest"),u=$("#sold_calendar_highest");e.empty(),i.empty(),n.empty(),r.empty(),s.empty(),l.empty(),o.empty(),d.empty(),c.value="",u.value="",c.activeDate=null,u.activeDate=null,Re(0,"Street_Name","#streetFilter","Select a Street Name"),Re(0,"Owner","#ownerFilter","Select a Owner"),Re(0,"Parcel_Type","#propertyFilter","Select a Property Type"),Re(0,"Building_Type","#buildingFilter","Select a Building Type"),Re(0,"Building_Use_Code","#buildingUseFilter","Select a Building Use"),Re(0,"Design_Type","#designTypeFilter","Select a Design Type"),Re(0,"Zoning","#zoningFilter","Select a Zone"),Re(0,"Neighborhood","#neighborhoodFilter","Select a Neighborhood"),a(),$(".wrapper .x-button").click(),$("#streetFilter").value=""}()}),600)}document.addEventListener("DOMContentLoaded",(()=>{t=i()})),$("#saleP-val-min, #saleP-val-max").on("input",(function(){var e=$("#saleP-val-min").val(),t=$("#saleP-val-max").val();e=e.replace(/^\$/,"").replace(/,/g,""),t=t.replace(/^\$/,"").replace(/,/g,"");var i=parseInt(e,10),a=parseInt(t,10);if(isNaN(i)||isNaN(a))console.log("Invalid input");else{var n=i.toLocaleString(),r=a.toLocaleString();$("#saleP-val-min").val("$"+n),$("#saleP-val-max").val("$"+r),pe.soldPMin=i,pe.soldPMax=a,Fe("Sale_Price",i,a),Oe("Sale_Price",i,a)}})),a(),$("#submitFilter").on("click",(function(){!function(){let e=[];if(null!==pe.streetName&&pe.streetName.length>1)if(Array.isArray(pe.streetName)){const t=pe.streetName.map((e=>`Street_Name LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Street_Name LIKE '%${pe.streetName.trim()}%')`);if(null!==pe.owner&&pe.owner.length>1)if(Array.isArray(pe.owner)){const t=pe.owner.map((e=>`Owner LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Owner LIKE '%${pe.owner.trim()}%')`);if(null!==pe.appraisedValueMin&&null!==pe.appraisedValueMax&&e.push(`Appraised_Total BETWEEN ${pe.appraisedValueMin} AND ${pe.appraisedValueMax}`),null!==pe.assessedValueMin&&null!==pe.assessedValueMax&&e.push(`Assessed_Total BETWEEN ${pe.assessedValueMin} AND ${pe.assessedValueMax}`),null!==pe.propertyType&&pe.propertyType.length>1)if(Array.isArray(pe.propertyType)){const t=pe.propertyType.map((e=>`Parcel_Type LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Parcel_Type LIKE '%${pe.propertyType.trim()}%')`);if(null!==pe.zoningType&&pe.zoningType.length>1)if(Array.isArray(pe.zoningType)){const t=pe.zoningType.map((e=>`Zoning LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Zoning LIKE '%${pe.zoningType.trim()}%')`);if(null!==pe.neighborhoodType&&pe.neighborhoodType.length>1)if(Array.isArray(pe.neighborhoodType)){const t=pe.neighborhoodType.map((e=>`Neighborhood LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Neighborhood LIKE '%${pe.neighborhoodType.trim()}%')`);if(null!==pe.buildingType&&pe.buildingType.length>1)if(Array.isArray(pe.buildingType)){const t=pe.buildingType.map((e=>`Building_Type LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Building_Type LIKE '%${pe.buildingType.trim()}%')`);if(null!==pe.buildingUseType&&pe.buildingUseType.length>1)if(Array.isArray(pe.buildingUseType)){const t=pe.buildingUseType.map((e=>`Building_Use_Type LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Building_Use_Type LIKE '%${pe.buildingUseType.trim()}%')`);if(null!==pe.designType&&pe.designType.length>1)if(Array.isArray(pe.designType)){const t=pe.designType.map((e=>`Design_Type LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Design_Type LIKE '%${pe.designType.trim()}%')`);null!==pe.acresValueMin&&null!==pe.acresValueMax&&e.push(`Total_Acres BETWEEN ${pe.acresValueMin} AND ${pe.acresValueMax}`),null!==pe.soldOnMin&&null!==pe.soldOnMax&&e.push(`Sale_Date >= '${pe.soldOnMin}' AND Sale_Date <= '${pe.soldOnMax}'`),null!==pe.soldPMin&&null!==pe.soldPMax&&e.push(`Sale_Price BETWEEN ${pe.soldPMin} AND ${pe.soldPMax}`);let t=e.join(" AND ");if("no"===sessionStorage.getItem("condos")){let e=Le.createQuery();e.where=t,e.returnDistinctValues=!1,e.returnGeometry=!0,e.outFields=["*"],qe(),st(null,e)}else{let e=Le.createQuery();e.where=t,e.returnDistinctValues=!1,e.returnGeometry=!0,e.outFields=["*"],qe(),st(null,e)}}()})),$("#clearFilter").on("click",(function(){n()}))})),$(document).ready((function(){$("#side-Exp").on("click",(function(){$("#sidebar").toggleClass("collapsed"),$("#sidebar").hasClass("collapsed")?($("#small-div").css("right","0px"),$("#right-arrow").hide(),$("#left-arrow").show()):($("#small-div").css("right","250px"),$("#left-arrow").hide(),$("#right-arrow").show())}))})),$(document).ready((function(){$("#Basemap-selector").on("click",(function(){$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#AddDataDiv").hide(),$("#ContactDiv").hide(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#Right-Btn-div").show(),$("#BasemapDiv").show(),$("#group-container-right").show()})),$("#Bookmarks-selector").on("click",(function(){$("#rightPanel").hide(),$("#BasemapDiv").hide(),$("#AddDataDiv").hide(),$("#ContactDiv").hide(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#Right-Btn-div").show(),$("#BookmarksDiv").show(),$("#group-container-right").show()})),$("#Contact-selector").on("click",(function(){$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#AddDataDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#PrintDiv").hide(),$("#Right-Btn-div").show(),$("#ContactDiv").show(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#group-container-right").show()})),$("#addData-selector").on("click",(function(){$(document).keypress((function(e){"Enter"===e.key&&e.preventDefault()})),$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#PrintDiv").hide(),$("#ContactDiv").hide(),$("#Right-Btn-div").show(),$("#AddDataDiv").show(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#group-container-right").show()})),$("#Legend-selector").on("click",(function(){$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#PrintDiv").hide(),$("#ContactDiv").hide(),$("#Right-Btn-div").show(),$("#AddDataDiv").hide(),$("#PrintDiv").hide(),$("#LegendDiv").show(),$("#group-container-right").show()})),$("#right-btn-back").on("click",(function(){$("#group-container-right").hide(),$("#PrintDiv").hide(),$("#AddDataDiv").hide(),$("#BookmarksDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#ContactDiv").hide(),$("#LegendDiv").hide(),$("#rightPanel").show()}))}));var ut={240:"1 inch = 20 feet",600:"1 inch = 50 feet",1200:"1 inch = 100 feet",1800:"1 inch = 150 feet",2400:"1 inch = 200 feet",3600:"1 inch = 300 feet",4800:"1 inch = 400 feet",9600:"1 inch = 800 feet",12e3:"1 inch = 1000 feet",18e3:"1 inch = 1500 feet",24e3:"1 inch = 2000 feet",36e3:"1 inch = 3000 feet",72e3:"1 inch = 6000 feet",144e3:"1 inch = 12000 feet",18e4:"1 inch = 15000 feet"},pt=document.getElementById("scale-dropdown");document.querySelectorAll(".scale-select").forEach((function(e){e.addEventListener("click",(function(e){var t=parseInt(e.target.value),i=e.target.innerHTML;t&&(I.scale=t),$("#scale-value").val(t).html(i)}))})),I.ui.add(pt);r.watch((()=>[I.stationary,I.scale]),(([e,t])=>{e&&function(e){var t=Math.round(e),i=function(e){var t=Object.keys(ut).reduce((function(t,i){return Math.abs(i-e)<Math.abs(t-e)?i:t}));return ut[t]}(t);i&&$("#scale-value").val(t).html(i)}(t)}));function Ue(){var e=document.querySelector(".esri-widget--button.esri-print__refresh-button.esri-icon-refresh");e&&e.click()}$(document).ready((function(){$("#popoverButton").popover({trigger:"hover"})})),$(document).ready((function(){$("#lasso").popover({trigger:"hover"})})),$(document).ready((function(){$("#select-button").popover({trigger:"hover"})})),$(document).ready((function(){$("#clear-btn1").popover({trigger:"hover"})})),$(document).ready((function(){$("#filterButton").popover({trigger:"hover"})})),$(document).ready((function(){$("#layerListBtn").popover({trigger:"hover"})})),$(document).ready((function(){$("#abutters-attributes").popover({trigger:"hover"})})),$(document).ready((function(){$("#abutters-zoom").popover({trigger:"hover"})})),$(document).ready((function(){$("#distanceButton").popover({trigger:"hover"})})),$(document).ready((function(){$("#areaButton").popover({trigger:"hover"})})),I.watch("zoom",(function(e,t){e!==t&&Ue()})),I.watch("center",(function(e,t){e!==t&&Ue()})),$(document).ready((function(){$("#side-Exp2").on("click",(function(){$("#sidebar2").hasClass("collapsed")?($("#results-div").css("left","0px"),$("#sidebar2").css("left","-350px"),$("#right-arrow-2").show(),$("#left-arrow-2").hide()):($("#results-div").css("left","350px"),$("#sidebar2").css("left","0px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide()),$("#sidebar2").toggleClass("collapsed")}))}))}))}));
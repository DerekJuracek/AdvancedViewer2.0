require(["esri/WebMap","esri/views/MapView","esri/layers/FeatureLayer","esri/layers/ImageryLayer","esri/layers/MapImageLayer","esri/core/reactiveUtils","esri/Graphic","esri/geometry/geometryEngine","esri/layers/GraphicsLayer","esri/widgets/Sketch/SketchViewModel","esri/widgets/DistanceMeasurement2D","esri/widgets/AreaMeasurement2D","esri/widgets/BasemapLayerList","esri/widgets/Bookmarks","esri/widgets/Legend"],(function(WebMap,MapView,FeatureLayer,ImageryLayer,MapImageLayer,reactiveUtils,Graphic,geometryEngine,GraphicsLayer,SketchViewModel,DistanceMeasurement2D,AreaMeasurement2D,BasemapLayerList,Bookmarks,Legend){const urlParams=new URLSearchParams(window.location.search);let currentURL=window.location.href,configUrl=urlParams.get("viewer");null!=configUrl&&/\?viewer=cama\/\w+(&\w+=\w+)*$/.test(currentURL)?(configUrl+=".json",$("#whole-app").show()):window.location.href="https://www.qds.biz/gis-service";const configVars={mapId:"",condoLayer:"",title:"",isCondosLayer:"",noCondoLayer:""};fetch(configUrl).then((response=>response.json())).then((config=>{config.layers;function formatDate(timestamp){var date=new Date(timestamp),day=date.getDate();return date.getMonth()+1+"/"+day+"/"+date.getFullYear()}configVars.mapId=config.webmapId||"6448b08504de4244973a28305b18271f",configVars.condoLayer=config.condoLayer,configVars.noCondoLayer=config.noCondoLayer,configVars.title=config.title,configVars.isCondosLayer=config.condos,configVars.masterTable=config.masterTable,configVars.zoom=config.zoom,configVars.parcelZoom=config.parcelZoom,configVars.imageUrl=config.imageUrl,configVars.welcomeImage=config.welcomeImage,configVars.pdf_Image=config.pdf_Image,configVars.pdf_demo=config.pdf_demographics,configVars.taxMap_Url=config.taxMapUrl,configVars.parcelMapUrl=config.parcelMapUrl,configVars.housingUrl=config.housingUrl,configVars.propertyCard=config.propertyCard,configVars.tax_bill=config.tax_bill,configVars.accessorName=config.accessorName,configVars.parcelTitle=config.parcelServiceTitle,configVars.tabTitle=config.tabTitle,configVars.basemapTitle=config.basemapTitle,configVars.parcelRenderer=config.parcelRenderer,configVars.useUniqueIdforParcelMap=config.useUniqueIdforParcelMap,configVars.helpUrl=config.helpUrl,configVars.includeFilter=config.includeFilter,configVars.customWelcomePage=config.customWelcomePage,configVars.customWelcomeMessage=config.customWelcomeMessage,configVars.customDisclaimerPage=config.customDisclaimerPage,configVars.customDisclaimerMessage=config.customDisclaimerMessage,"yes"===configVars.customWelcomePage&&(document.getElementById("welcomeMessage").innerHTML=configVars.customWelcomeMessage),"yes"===configVars.customDisclaimerPage&&(document.getElementById("disclaimer-text").innerHTML=configVars.customDisclaimerMessage),document.getElementById("AccessorName").innerHTML=config.accessorName,$(".help-url").attr("href",configVars.helpUrl),document.getElementById("title").innerHTML=configVars.title,document.getElementById("print-title").innerHTML=configVars.title,document.getElementById("imageContainer").src=configVars.welcomeImage,document.getElementById("print-image").src=configVars.welcomeImage,document.getElementById("tab-title").innerHTML=configVars.tabTitle;const key2="No geometry";sessionStorage.setItem("condos",configVars.isCondosLayer);const searchGraphicsLayers=new GraphicsLayer,sketchGL=new GraphicsLayer,webmap=new WebMap({portalItem:{id:configVars.mapId},layers:[searchGraphicsLayers]});var view=new MapView({container:"viewDiv",map:webmap,units:"imperial",zoom:`${configVars.zoom}`,popupEnabled:!1,ui:{components:["attribution"]},constraints:{minScale:240,maxScale:17e4}});let urlSearchUniqueId,runQuerySearchTerm,clickedToggle;view.when((()=>{configVars.homeExtent=view.extent})),"no"===configVars.includeFilter&&$("#filterButton").remove(),view.when((()=>{"yes"==sessionStorage.getItem("agreedToDisclaimer")||1==urlSearchUniqueId?$("#starterModal").modal("hide"):$("#starterModal").modal("show"),$(document).ready((function(){$("#agreeBtn").prop("disabled",!0),$("#agreeCheck").change((function(){$(this).is(":checked")?($("#agreeBtn").prop("disabled",!1),sessionStorage.setItem("agreedToDisclaimer","yes")):$("#agreeBtn").prop("disabled",!0)}))}))})),view.when((()=>{document.getElementById("urlButton").addEventListener("click",(function(event){let urlValue=urlInput.value;urlValue.length>0&&function(){let urlInputLayer=new FeatureLayer({url:`${urlValue}`});urlInputLayer.load().then((()=>{webmap.add(urlInputLayer),$("#urlMessage").html('<strong><p style="color:green;">Successfully uploaded REST Service.</p></strong>'),webmap.layers.on("change",(function(event){console.log(event),console.log(event," layer was added/removed from the map.")}));var pickListContainer=$("#layerList");addLayerToPickList(urlInputLayer,pickListContainer),urlInput.value=""})).catch((error=>{$("#urlMessage").html('<strong><p style="color:red;">Error uploading REST Service.</p></strong>'),console.error("Error loading the FeatureLayer:",error)}))}()}))})),view.when((()=>{document.getElementById("urlButtonImagery").addEventListener("click",(function(event){let urlValue=urlInputImagery.value;urlValue.length>0&&function(){let urlInputLayer=new ImageryLayer({url:`${urlValue}`});urlInputLayer.load().then((()=>{webmap.add(urlInputLayer),$("#urlMessageImagery").html('<strong><p style="color:green;">Successfully uploaded REST Service.</p></strong>'),webmap.layers.on("change",(function(event){console.log(event),console.log(event," layer was added/removed from the map.")}));var pickListContainer=$("#layerList");addLayerToPickList(urlInputLayer,pickListContainer),urlInput.value=""})).catch((error=>{$("#urlMessageImagery").html('<strong><p style="color:red;">Error uploading REST Service.</p></strong>'),console.error("Error loading the FeatureLayer:",error)}))}()}))})),view.when((()=>{document.getElementById("urlButtonMapService").addEventListener("click",(function(event){let urlValue=urlInputMapService.value;urlValue.length>0&&function(){let urlInputLayer=new MapImageLayer({url:`${urlValue}`});urlInputLayer.load().then((()=>{webmap.add(urlInputLayer),$("#urlMessageMapService").html('<strong><p style="color:green;">Successfully uploaded REST Service.</p></strong>'),webmap.layers.on("change",(function(event){console.log(event),console.log(event," layer was added/removed from the map.")}));var pickListContainer=$("#layerList");addLayerToPickList(urlInputLayer,pickListContainer),urlInput.value=""})).catch((error=>{$("#urlMessageMapService").html('<strong><p style="color:red;">Error uploading REST Service.</p></strong>'),console.error("Error loading the FeatureLayer:",error)}))}()}))})),view.when((()=>{const visibleLayers=webmap.layers.items.filter((layer=>!("group"===layer.type&&layer.title&&"hidden group"===layer.title.toLowerCase()||layer.title&&layer.title===`${configVars.parcelTitle}`)));new Legend({view:view,container:$("#LegendDiv")[0],layerInfos:visibleLayers.map((layer=>({layer:layer})))})})),view.when((()=>{new Bookmarks({view:view,container:$("#BookmarksDiv")[0],dragEnabled:!0})})),view.when((()=>{let originalRenderer;new BasemapLayerList({view:view,container:$("#BasemapDiv")[0],dragEnabled:!0}).visibleElements={statusIndicators:!0,baseLayers:!0,referenceLayers:!1,referenceLayersTitle:!1,errors:!0,heading:!1};let newRenderer={type:"simple",symbol:{type:"simple-fill",color:[255,255,255,0],outline:{width:1,color:`${configVars.parcelRenderer}`}}},OG={type:"simple",symbol:{type:"simple-fill",color:[255,255,255,0],outline:{width:1,color:"#897044"}}};view.map.allLayers.forEach((layer=>{"Parcel Boundaries"===layer.title&&(originalRenderer=layer.renderer)}));const orthoLayers=["Aerial-Ortho 2019","Aerial-Ortho 2016","Aerial-Ortho 2012"];view.map.allLayers.some((layer=>orthoLayers.includes(layer.title)&&layer.visible))&&view.map.allLayers.forEach((layer=>{"Parcel Boundaries"===layer.title&&(layer.renderer=newRenderer)})),originalRenderer="yes"===sessionStorage.getItem("condos")?CondosLayer.renderer:noCondosLayer.renderer;const layerVisibility={};view.map.basemap.baseLayers.forEach((layer=>{layerVisibility[layer.id]=layer.visible})),reactiveUtils.watch((()=>view.map.basemap.baseLayers.map((layer=>layer.visible))),(()=>{console.log("Visibility changed:",view.map.basemap.baseLayers.map((layer=>({title:layer.title,visible:layer.visible})))),function(baseLayers,visibilityTracker){let newlyVisibleLayer=baseLayers.find((layer=>layer.visible&&!visibilityTracker[layer.id]));if(newlyVisibleLayer)console.log(`Newly visible layer: ${newlyVisibleLayer.title}`),baseLayers.forEach((layer=>{layer!==newlyVisibleLayer&&(layer.visible=!1)})),newlyVisibleLayer.title!==`${configVars.basemapTitle}`&&"Washington Basemap"!==newlyVisibleLayer.title?"yes"===sessionStorage.getItem("condos")?CondosLayer.renderer=newRenderer:noCondosLayer.renderer=newRenderer:view.map.allLayers.forEach((layer=>{"Parcel Boundaries"===layer.title&&(layer.renderer=OG)}));else{0===baseLayers.filter((layer=>layer.visible)).length&&baseLayers.forEach((layer=>{layer.visible=visibilityTracker[layer.id]}))}baseLayers.forEach((layer=>{visibilityTracker[layer.id]=layer.visible})),console.log("Updated visibility tracker:",baseLayers.map((layer=>({title:layer.title,wasVisible:visibilityTracker[layer.id]}))))}(view.map.basemap.baseLayers,layerVisibility)}))})),webmap.add(sketchGL);let detailsGeometry,targetExtent,exportResults,uniqueArray,searchResults,bufferGraphicId,polygonGraphics,noCondosParcelGeom,isGisLink,DetailsHandle,clickHandle,removeFromList,detailSelected=[],firstList=[],CondoBuffer=!1,queryUnits="feet",lasso=!1,select=!1,isClickEvent=!1,detailsChanged={isChanged:!1,item:""},regSearch=!1,value=document.getElementById("buffer-value");const clearBtn1=document.getElementById("clear-btn1"),clearBtn2=document.getElementById("clear-btn2");let handleUsed,detailsHandleUsed,exportCsv,zoomToItemId,zoomToObjectID,overRide,oldExtent=view.extent,oldScale=view.scale,oldZoom=view.zoom;reactiveUtils.watch((()=>[view.zoom,view.extent,view.scale]),(([zoom,extent,scale],[wasStationary])=>{if(zoom){if(zoom!==oldZoom&&(oldZoom=zoom),!noCondosLayer.visible&&!CondosLayer.visible&&Number(zoom)>configVars.parcelZoom){if("no"===sessionStorage.getItem("condos")?noCondosLayer.visible=!0:CondosLayer.visible=!0,DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),clickHandle&&(clickHandle?.remove(),clickHandle=null),"click"==handleUsed||"details"==handleUsed||"none yet"==handleUsed)return void $("#select-button").removeClass("btn-warning");clickHandle=view.on("click",handleClick),$("#lasso").removeClass("btn-warning"),$("#select-button").addClass("btn-warning"),select=!0}}else wasStationary&&(oldExtent=extent,oldScale=scale,oldZoom=zoom);return""}));let measureContainer=document.getElementById("topbar");view.ui.add(measureContainer,"bottom-right");let activeWidget1=null;function setActiveWidget(type){switch(type){case"distance":if(activeWidget1=new DistanceMeasurement2D({view:view,unit:"feet"}),activeWidget1.viewModel.start(),DetailsHandle||clickHandle||(handleUsed="none yet"),DetailsHandle)try{handleUsed="details",DetailsHandle?.remove(),DetailsHandle=null}catch(error){console.error("Failed to remove DetailsHandle",error)}if(clickHandle)try{handleUsed="click",clickHandle.remove()}catch(error){console.error("Failed to remove DetailsHandle",error)}activeWidget1&&activeWidget1.viewModel&&activeWidget1.viewModel.watch("state",(function(state){"measured"===state&&("click"==handleUsed?clickHandle=view.on("click",handleClick):"details"==handleUsed&&(DetailsHandle=view.on("click",handleDetailsClick)))})),view.ui.add(activeWidget1,"bottom-right"),setActiveButton(document.getElementById("distanceButton"));break;case"area":if(activeWidget1=new AreaMeasurement2D({view:view,unit:"square-us-feet"}),activeWidget1.viewModel.start(),DetailsHandle||clickHandle||(handleUsed="none yet"),DetailsHandle)try{handleUsed="details",DetailsHandle?.remove(),DetailsHandle=null}catch(error){console.error("Failed to remove DetailsHandle",error)}if(clickHandle)try{handleUsed="click",clickHandle?.remove(),clickHandle=null}catch(error){console.error("Failed to remove DetailsHandle",error)}activeWidget1&&activeWidget1.viewModel&&activeWidget1.viewModel.watch("state",(function(state){"measured"===state&&("click"==handleUsed?clickHandle=view.on("click",handleClick):"details"==handleUsed&&(DetailsHandle=view.on("click",handleDetailsClick)))})),view.ui.add(activeWidget1,"bottom-right"),setActiveButton(document.getElementById("areaButton"));break;case null:activeWidget1&&(view.ui.remove(activeWidget1),activeWidget1.destroy(),activeWidget1=null)}}function setActiveButton(selectedButton){view.focus();let elements=Array.from(document.getElementsByClassName("active"));for(let i=0;i<elements.length;i++)elements[i].classList.remove("active","btn-warning");selectedButton&&(selectedButton.classList.add("active","btn-warning"),selectedButton.classList.remove("bg-info"))}document.getElementById("distanceButton").addEventListener("click",(function(){setActiveWidget(null),this.classList.contains("active")?setActiveButton(null):setActiveWidget("distance")})),document.getElementById("areaButton").addEventListener("click",(function(){setActiveWidget(null),this.classList.contains("active")?setActiveButton(null):setActiveWidget("area")}));let noCondosLayer=new FeatureLayer({url:`${configVars.noCondoLayer}`,visible:!1,popupEnabled:!0,title:"Parcel Boundaries",id:"noCondoLayer"}),CondosLayer=new FeatureLayer({url:`${configVars.condoLayer}`,visible:!1,popupEnabled:!0,title:"Parcel Boundaries",id:"condoLayer"});const CondosTable=new FeatureLayer({url:`${configVars.masterTable}`}),noCondosTable=new FeatureLayer({url:`${configVars.masterTable}`});function addLayerToPickList(layer,container){let turnLayerOff;if(turnLayerOff="yes"===sessionStorage.getItem("condos")?"noCondoLayer":"condoLayer","graphics"!==layer.type&&"Tax Map Annotation"!=layer.title&&"Road Centerline"!=layer.title&&null!=layer.title&&""!=layer.title&&layer.id!=turnLayerOff){var icon;icon=layer.visible?"check-square":"square";var item=$(`<calcite-pick-list-item scale="m" label="${layer.title}" value="${layer.id}" description="${layer.type}">\n      <calcite-action id="action-${layer.id}" slot="actions-end" icon="${icon}" text="${layer.title}"></calcite-action>\n    </calcite-pick-list-item>`);container.append(item)}}function processLayers(layers,container){layers.forEach((function(layer){if("group"===layer.type){if(layer.title&&"hidden group"===layer.title.toLowerCase())return;var groupTitle=layer.title||"Industry",accordionItem=$(`\n              <calcite-accordion scale="m">\n                <calcite-accordion-item heading="${groupTitle}">\n                </calcite-accordion-item>\n              </calcite-accordion>`);processLayers(layer.layers.items,accordionItem.find("calcite-accordion-item")),container.append(accordionItem)}else addLayerToPickList(layer,container)}))}function overRideSelect(bool){overRide=bool}function clearContents(e,string){const newUrl=function(key,sourceURL){let param,rtn=sourceURL.split("?")[0],params_arr=[],queryString=-1!==sourceURL.indexOf("?")?sourceURL.split("?")[1]:"";if(""!==queryString){params_arr=queryString.split("&");for(let i=params_arr.length-1;i>=0;i-=1)param=params_arr[i].split("=")[0],param===key&&params_arr.splice(i,1);rtn=rtn+"?"+params_arr.join("&")}return rtn}("uniqueid",window.location.href);if(window.history.pushState({path:newUrl},"",newUrl),"no"===sessionStorage.getItem("condos")?noCondosLayer.visible=!0:CondosLayer.visible=!0,DetailsHandle)try{DetailsHandle?.remove(),DetailsHandle=null}catch(error){console.error("Failed to remove DetailsHandle",error)}if(clickHandle)try{clickHandle?.remove(),clickHandle=null}catch(error){console.error("Failed to remove DetailsHandle",error)}handleUsed="",overRideSelect(!!select),$("#select-button").removeClass("btn-warning"),$("#select-button").addClass("btn-warning"),clickHandle=view.on("click",handleClick),select=!0,lasso=!1,$("#searchInput ul").remove(),$("#searchInput").val="",$("#select-button").prop("disabled",!1);document.getElementById("searchInput").value="",runQuerySearchTerm="",searchTerm="",firstList=[],secondList=[],zoomToObjectID="",$(".spinner-container").hide(),$("#distanceButton").removeClass("active"),$("#areaButton").removeClass("active"),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#dropdown").toggleClass("expanded"),$("#dropdown").hide(),$("#results-div").css("left","0px"),$("#sidebar2").css("left","-350px"),$("#sidebar2").removeClass("collapsed"),$("#right-arrow-2").show(),$("#left-arrow-2").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#backButton").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportSearch").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#featureWid").hide(),$("#exportButtons").hide(),$("#layerListDiv").hide(),$("#detailBox").hide(),$("#filterDiv").hide(),$("#dropdown").show(),$("#WelcomeBox").show(),$("#select-button").attr("title","Add to Selection Enabled"),$(".center-container").show(),document.getElementById("suggestions").innerHTML="",$("#distanceButton").removeClass("btn-warning"),$("#areaButton").removeClass("btn-warning"),$("#featureWid").empty(),view.ui.remove(activeWidget1),activeWidget1&&(activeWidget1.destroy(),activeWidget1=null),view.graphics.removeAll(),polygonGraphics=[]}function sortUniqueArray(criteria){uniqueArray.sort(((a,b)=>"owner"===criteria?a.owner.toLowerCase().localeCompare(b.owner.toLowerCase()):"location"===criteria?a.location.toLowerCase().localeCompare(b.location.toLowerCase()):"Street_Name"===criteria?a.Street_name.toLowerCase().localeCompare(b.Street_name.toLowerCase()):void 0)),function(){const featureWidDiv=document.getElementById("featureWid");featureWidDiv.innerHTML="";const listGroup=document.createElement("ul");listGroup.classList.add("row","list-group"),uniqueArray.forEach((function(feature){let objectID=feature.objectid,locationVal=feature.location,locationUniqueId=void 0===feature.uniqueId?feature.GIS_LINK:feature.uniqueId,locationGISLINK=feature.GIS_LINK,locationCoOwner=feature.coOwner,locationOwner=feature.owner,locationMBL=feature.MBL,locationGeom=feature.geometry,propertyType=feature.Parcel_Type;feature.Street_Name;const imageUrl=`${configVars.imageUrl}${locationUniqueId}.jpg`,listItem=document.createElement("li"),imageDiv=document.createElement("li");let listItemHTML;imageDiv.innerHTML=`<img class="img-search image" object-id="${objectID}" src="${imageUrl}" alt="Image of ${locationUniqueId}" >`,listItem.classList.add("list-group-item","col-9"),listItem.classList.add("search-list"),imageDiv.setAttribute("object-id",objectID),imageDiv.setAttribute("data-id",locationGISLINK),imageDiv.classList.add("image-div","col-3");sessionStorage.getItem("condos");listItemHTML=!locationCoOwner&&locationGeom||locationGeom?` <div class="listText">UID: ${locationUniqueId} &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;MBL: ${locationMBL} <br> ${locationOwner} ${locationCoOwner} <br> ${locationVal} <br> Property Type: ${propertyType}</div><div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justZoom" title="Zoom to Parcel"><calcite-icon icon="magnifying-glass-plus" scale="s"/>Zoom</button><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`:` <div class="listText">UID: ${locationUniqueId} &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; &nbsp;MBL: ${locationMBL} <br> ${locationOwner} ${locationCoOwner} <br> ${locationVal} <br> Property Type: ${propertyType}</div><div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`,listItem.innerHTML+=listItemHTML,listItem.setAttribute("object-id",objectID),listItem.setAttribute("data-id",locationGISLINK),listGroup.appendChild(imageDiv),listGroup.appendChild(listItem)})),listGroup.addEventListener("click",(function(event){if(event.target.closest(".justZoom")||event.target.closest(".justZoomBtn"))return;clickHandle&&(clickHandle?.remove(),clickHandle=null),DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),$("#select-button").attr("title","Select Enabled");let targetElement=event.target.closest("li");if(!targetElement)return;let itemId=targetElement.getAttribute("data-id"),objectID=targetElement.getAttribute("object-id");zoomToFeature(objectID,polygonGraphics,itemId),$("#details-spinner").show(),$("#WelcomeBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportButtons").hide(),$("#exportSearch").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$(".center-container").hide(),buildDetailsPanel(objectID,itemId)})),featureWidDiv.appendChild(listGroup)}()}function buildResultsPanel(features,polygonGraphics,e,pointGraphic,pointLocation,pointGisLink){$("status-loader").show(),$("#featureWid").empty();let seenIds=new Set,seenUID=new Set;uniqueArray=firstList.filter((obj=>!!obj.geometry&&(seenIds.add(obj.uniqueId),!0))),firstList.forEach((obj=>{!seenIds.has(obj.uniqueId)&&(seenUID.add(obj.uniqueId),uniqueArray.push(obj))})),uniqueArray.sort(((a,b)=>{const ownerA=a.owner?a.owner.toLowerCase():"",ownerB=b.owner?b.owner.toLowerCase():"";return ownerA.localeCompare(ownerB)})),function(pointGraphic,pointLocation,pointGisLink){uniqueArray=uniqueArray.filter((item=>item.objectid!=pointGraphic)),uniqueArray=uniqueArray.filter((item=>item.location!=pointLocation)),firstList=firstList.filter((item=>item.objectid!=pointGraphic)),firstList=firstList.filter((item=>item.location!=pointLocation)),$(`li[object-id="${pointGraphic}"]`).remove(),"no"==sessionStorage.getItem("condos")&&(firstList=firstList.filter((item=>item.GIS_LINK!=pointGisLink)),uniqueArray=uniqueArray.filter((item=>item.GIS_LINK!=pointGisLink)),$(`li[data-id="${pointGisLink}"]`).remove())}(pointGraphic,pointLocation,pointGisLink);const featureWidDiv=document.getElementById("featureWid"),listGroup=document.createElement("ul");uniqueArray.forEach((function(feature){let objectID=feature.objectid,locationVal=feature.location,locationUniqueId=void 0===feature.uniqueId?feature.GIS_LINK:feature.uniqueId,locationGISLINK=feature.GIS_LINK,locationCoOwner=feature.coOwner,locationOwner=feature.owner,locationMBL=feature.MBL,locationGeom=feature.geometry,propertyType=feature.Parcel_Type;const imageUrl=`${configVars.imageUrl}${locationUniqueId}.jpg`;listGroup.classList.add("row"),listGroup.classList.add("list-group");const listItem=document.createElement("li"),imageDiv=document.createElement("li");let listItemHTML,displayNoGeometry;imageDiv.innerHTML=`<img class="img-search image" object-id="${objectID}" src="${imageUrl}" alt="Image of ${locationUniqueId}" >`,listItem.classList.add("list-group-item","col-9"),listItem.classList.add("search-list"),imageDiv.setAttribute("object-id",objectID),imageDiv.setAttribute("data-id",locationGISLINK),imageDiv.classList.add("image-div","col-3"),displayNoGeometry="yes"===sessionStorage.getItem(key2),listItemHTML=!locationCoOwner&&locationGeom?` <div class="listText">UID: ${locationUniqueId}  &nbsp;<br>MBL: ${locationMBL} <br> ${locationOwner} ${locationCoOwner} <br> ${locationVal} <br> Property Type: ${propertyType} <br><a target="_blank" class='pdf-links' rel="noopener noreferrer" href=https://publicweb-gis.s3.amazonaws.com/PDFs/${configVars.parcelMapUrl}/Quick_Maps/QM_${locationUniqueId}.pdf>PDF Map</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a target="_blank" class='pdf-links' rel="noopener noreferrer" href=${configVars.propertyCard}&amp;uniqueid=${locationUniqueId}>Property Card</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </div><div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justZoom" title="Zoom to Parcel"><calcite-icon icon="magnifying-glass-plus" scale="s"/>Zoom</button><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`:locationGeom?` <div class="listText">UID: ${locationUniqueId}  &nbsp;<br>MBL: ${locationMBL} <br> ${locationOwner} ${locationCoOwner} <br> ${locationVal} <br> Property Type: ${propertyType} <br><a target="_blank" class='pdf-links' rel="noopener noreferrer" href=https://publicweb-gis.s3.amazonaws.com/PDFs/${configVars.parcelMapUrl}/Quick_Maps/QM_${locationUniqueId}.pdf>PDF Map</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a target="_blank" class='pdf-links' rel="noopener noreferrer" href=${configVars.propertyCard}&amp;uniqueid=${locationUniqueId}>Property Card</a></div><div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justZoom" title="Zoom to Parcel"><calcite-icon icon="magnifying-glass-plus" scale="s"/>Zoom</button><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`:` <div class="listText">UID: ${locationUniqueId}  &nbsp;<br>MBL: ${locationMBL} <br> ${locationOwner} ${locationCoOwner} <br> ${locationVal} <br> Property Type: ${propertyType} <br><a target="_blank" class='pdf-links' rel="noopener noreferrer" href=https://publicweb-gis.s3.amazonaws.com/PDFs/${configVars.parcelMapUrl}/Quick_Maps/QM_${locationUniqueId}.pdf>PDF Map</a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a target="_blank" class='pdf-links' rel="noopener noreferrer" href=${configVars.propertyCard}&amp;uniqueid=${locationUniqueId}>Property Card</a></div><div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`,listItem.innerHTML+=listItemHTML,listItem.setAttribute("object-id",objectID),listItem.setAttribute("data-id",locationGISLINK),listGroup.appendChild(imageDiv),listGroup.appendChild(listItem)})),searchResults=uniqueArray.length,$("#total-results").show(),$("#ResultDiv").show(),$("#total-results").html(searchResults+" results returned"),$("#backButton").hide(),$("#detailsButton").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#featureWid").show(),$("#detail-content").empty(),$("#dropdown").toggleClass("expanded"),$("status-loader").hide(),$("#dropdown").show(),$("#sidebar2").css("left","0px"),$("#sidebar2").addClass("collapsed"),$("#results-div").css("left","350px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide(),$("#WelcomeBox").hide(),$("#csvExportResults").hide(),$("#exportSearch").show(),$("#results-div").css("height","300px"),$("#exportButtons").show(),$("#exportResults").hide(),$("#csvExportSearch").show(),$(".spinner-container").hide(),$(`li[object-id="${pointGraphic}"]`).remove(),listGroup.addEventListener("click",(function(event){if(event.target.closest(".justZoom")||event.target.closest(".justZoomBtn")||event.target.closest(".pdf-links"))return;clickHandle&&(clickHandle?.remove(),clickHandle=null),DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),$("#select-button").attr("title","Select Enabled");let targetElement=event.target.closest("li");if(!targetElement)return;let itemId=targetElement.getAttribute("data-id"),objectID=targetElement.getAttribute("object-id");zoomToFeature(objectID,polygonGraphics,itemId),$("#details-spinner").show(),$("#WelcomeBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportButtons").hide(),$("#exportSearch").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$(".center-container").hide(),$("#abutters-attributes").prop("disabled",!1),$("#abutters-zoom").prop("disabled",!1),buildDetailsPanel(objectID,itemId)})),featureWidDiv.appendChild(listGroup)}function processFeatures(features,polygonGraphics,e,removeFromList){let pointGraphic,pointLocation,pointGisLink;function createList(features){features.forEach((function(feature){if(""!==feature.attributes.Owner){let objectId=feature.attributes.OBJECTID,locationVal=feature.attributes.Location,locationUniqueId=feature.attributes.Uniqueid,locationGISLINK=feature.attributes.GIS_LINK,locationCoOwner=feature.attributes.Co_Owner,locationOwner=feature.attributes.Owner,locationMBL=feature.attributes.MBL,locationGeom=feature.geometry,mailingAddress=feature.attributes.Mailing_Address_1,mailingAddress2=feature.attributes.Mailing_Address_2,Mailing_City=feature.attributes.Mailing_City,Mail_State=feature.attributes.Mail_State,Mailing_Zip=feature.attributes.Mailing_Zip,Total_Acres=feature.attributes.Total_Acres,Parcel_Primary_Use=feature.attributes.Parcel_Primary_Use,Building_Use_Code=feature.attributes.Building_Use_Code,Parcel_Type=feature.attributes.Parcel_Type,Design_Type=feature.attributes.Design_Type,Zoning=feature.attributes.Zoning,Neighborhood=feature.attributes.Neighborhood,Land_Type_Rate=feature.attributes.Land_Type_Rate,Functional_Obs=feature.attributes.Functional_Obs,External_Obs=feature.attributes.External_Obs,Sale_Date=formatDate(feature.attributes.Sale_Date),Sale_Price=feature.attributes.Sale_Price,Vol_Page=feature.attributes.Vol_Page,Assessed_Total=feature.attributes.Assessed_Total,Appraised_Total=feature.attributes.Appraised_Total,Influence_Factor=feature.attributes.Influence_Factor,Influence_Type=feature.attributes.Influence_Type,Land_Type=feature.attributes.Land_Type,Prior_Assessment_Year=feature.attributes.Prior_Assessment_Year,Prior_Assessed_Total=feature.attributes.Prior_Assessed_Total,Prior_Appraised_Total=feature.attributes.Prior_Appraised_Total,Map=feature.attributes.Map,Lat=feature.attributes.Lat,Lon=feature.attributes.Lon;firstList.push(new Parcel(objectId,locationVal,locationUniqueId,locationGISLINK,locationCoOwner,locationOwner,locationMBL,locationGeom,mailingAddress,mailingAddress2,Mailing_City,Mail_State,Mailing_Zip,Total_Acres,Parcel_Primary_Use,Building_Use_Code,Parcel_Type,Design_Type,Zoning,Neighborhood,Land_Type_Rate,Functional_Obs,External_Obs,Sale_Date,Sale_Price,Vol_Page,Assessed_Total,Appraised_Total,Influence_Factor,Influence_Type,Land_Type,Prior_Assessment_Year,Prior_Assessed_Total,Prior_Appraised_Total,Map,Lat,Lon))}}))}if(e){pointGraphic=features[0].attributes.OBJECTID,pointLocation=features[0].attributes.Location,pointGisLink=features[0].attributes.GIS_LINK;firstList.filter((g=>g.objectid===pointGraphic)).length>=1?buildResultsPanel(0,polygonGraphics,0,pointGraphic,pointLocation,pointGisLink):(createList(features),buildResultsPanel())}else features?features.length>1?(lasso||(features=features.filter((item=>"CONDOMAIN"!=item.attributes.ACCOUNT_TYPE))),createList(features)):createList(features):buildResultsPanel(0,polygonGraphics,0,pointGraphic);e||buildResultsPanel(0,polygonGraphics,0,pointGraphic,pointLocation,pointGisLink)}let features;function addPolygons(polygonGeometries,graphicsLayer,ClickEvent,tableSearch){let count,countCondos;features=tableSearch?polygonGeometries:polygonGeometries.features;let bufferGraphicId,pointGisLink,polygonGraphics2=[];var fillSymbol={type:"simple-fill",color:[127,42,145,.4],outline:{color:[127,42,145,.8],width:2}};if(ClickEvent){bufferGraphicId=polygonGeometries.features[0].attributes.OBJECTID,pointGisLink=features[0].attributes.GIS_LINK;const graphic=new Graphic({geometry:features[0].geometry,symbol:fillSymbol,id:bufferGraphicId});if(polygonGraphics2.push(graphic),countCondos=firstList.filter((g=>g.GIS_LINK===pointGisLink)).length,count=view.graphics.some((g=>g.id===bufferGraphicId)),count){const firstIndex=view.graphics.findIndex((g=>g.id===bufferGraphicId));view.graphics.removeAt(firstIndex);const graphicIndex=polygonGraphics.findIndex((g=>g.id===bufferGraphicId));1===polygonGraphics.length?polygonGraphics.splice(0,1):polygonGraphics.splice(graphicIndex,1),0===polygonGraphics.length&&(DetailsHandle||(DetailsHandle=view.on("click",handleDetailsClick)),clickHandle&&(clickHandle?.remove(),clickHandle=null),clickHandle=view.on("click",handleClick)),view.goTo(polygonGraphics)}else graphicsLayer.addMany(polygonGraphics2)}else if(tableSearch){features.filter((feature=>feature.geometry)).forEach((feature=>{const bufferGraphicId=feature.attributes.OBJECTID,graphic=new Graphic({geometry:feature.geometry,symbol:fillSymbol,id:bufferGraphicId});polygonGraphics2.push(graphic)})),polygonGraphics2.length>=1&&graphicsLayer.addMany(polygonGraphics2),view.goTo(polygonGraphics)}else regSearch=!0,features.map((function(feature){if(bufferGraphicId=feature.attributes.OBJECTID,!feature.geometry||tableSearch)return console.error("Feature does not have geometry:",feature),null;const graphic=new Graphic({geometry:feature.geometry,symbol:fillSymbol,id:bufferGraphicId});polygonGraphics2.push(graphic)})).filter((graphic=>null!==graphic)),polygonGraphics2.length>=1&&graphicsLayer.addMany(polygonGraphics2),view.goTo(polygonGraphics2);if(polygonGraphics||(polygonGraphics=polygonGraphics2),ClickEvent&&!count){let id=polygonGraphics2[0].id;polygonGraphics=[...polygonGraphics,polygonGraphics2[0]],removeFromList=id}regSearch&&(polygonGraphics=polygonGraphics2),count=!1,regSearch=!1}webmap.add(noCondosLayer),webmap.add(CondosLayer),CondosTable.load().then((()=>{webmap.tables.add(CondosTable)})),noCondosTable.load().then((()=>{webmap.tables.add(noCondosTable)})),view.when((function(){let watchLayer;watchLayer="yes"===sessionStorage.getItem("condos")?"condoLayer":"noCondoLayer";var specificLayer=webmap.layers.find((layer=>layer.id===watchLayer));reactiveUtils.watch((()=>specificLayer.visible),(()=>{let isVisible=specificLayer.visible;!function(layerId,isVisible){let actionElement=$(`calcite-pick-list-item[value="${layerId}"] calcite-action`);isVisible?actionElement.attr("icon","check-square"):actionElement.attr("icon","square")}(specificLayer.id,isVisible)}))})),$("#layerList").on("click","calcite-action",(function(event){event.preventDefault(),function(layerId,actionElement){let layer=webmap.findLayerById(layerId);layer&&(layer.visible=!layer.visible,"group"===layer.type&&layer.layers.forEach((subLayer=>{subLayer.visible=layer.visible})),actionElement.attr("icon",layer.visible?"check-square":"square"))}($(this).closest("calcite-pick-list-item").attr("value"),$(this))})),view.when((function(){var pickListContainer=$("#layerList");processLayers(webmap.layers.items,pickListContainer)})),function(){let query=noCondosLayer.createQuery();query.where="1=1 AND Street_Name IS NOT NULL",query.returnDistinctValues=!0,query.returnGeometry=!1,query.orderByFields=["Street_Name ASC"],query.outFields=["Street_Name"],CondosLayer.queryFeatures(query).then((function(response){var features=response.features,comboBox=$("#streetFilter");features.forEach((function(feature){var newItem,name=feature.attributes.Street_Name;""!=name&&(newItem=$('<calcite-combobox-item value="'+name+'" text-label="'+name+'"></calcite-combobox-item>'),comboBox.append(newItem))}))}));let query2=noCondosLayer.createQuery();query2.where="1=1 AND Owner IS NOT NULL",query2.returnDistinctValues=!0,query2.returnGeometry=!1,query2.outFields=["Owner"],CondosLayer.queryFeatures(query2).then((function(response){var features=response.features,comboBox=$("#ownerFilter");features.forEach((function(feature){var newItem,name=feature.attributes.Owner;""!=name&&(newItem=$('<calcite-combobox-item value="'+name+'" text-label="'+name+'"></calcite-combobox-item>'),comboBox.append(newItem))}))}));let query3=noCondosLayer.createQuery();query3.where="1=1 AND Parcel_Type IS NOT NULL",query3.returnDistinctValues=!0,query3.returnGeometry=!1,query3.orderByFields=["Parcel_Type ASC"],query3.outFields=["Parcel_Type"],CondosLayer.queryFeatures(query3).then((function(response){var features=response.features,comboBox=$("#propertyFilter");features.forEach((function(feature){var newItem,name=feature.attributes.Parcel_Type;""!=name&&(newItem=$('<calcite-combobox-item value="'+name+'" text-label="'+name+'"></calcite-combobox-item>'),comboBox.append(newItem))}))}));let query4=noCondosLayer.createQuery();query4.where="1=1 AND Building_Type IS NOT NULL",query4.returnDistinctValues=!0,query4.returnGeometry=!1,query4.outFields=["Building_Type"],CondosLayer.queryFeatures(query4).then((function(response){var features=response.features,comboBox=$("#buildingFilter");features.forEach((function(feature){var newItem,name=feature.attributes.Building_Type;""!=name&&(newItem=$('<calcite-combobox-item value="'+name+'" text-label="'+name+'"></calcite-combobox-item>'),comboBox.append(newItem))}))}));let query5=noCondosLayer.createQuery();query5.where="1=1 AND Building_Use_Code IS NOT NULL",query5.returnDistinctValues=!0,query5.returnGeometry=!1,query5.outFields=["Building_Use_Code"],CondosLayer.queryFeatures(query5).then((function(response){var features=response.features,comboBox=$("#buildingUseFilter");features.forEach((function(feature){var newItem,name=feature.attributes.Building_Use_Code;""!=name&&(newItem=$('<calcite-combobox-item value="'+name+'" text-label="'+name+'"></calcite-combobox-item>'),comboBox.append(newItem))}))}));let query6=noCondosLayer.createQuery();query6.where="1=1 AND Design_Type IS NOT NULL",query6.returnDistinctValues=!0,query6.returnGeometry=!1,query6.outFields=["Design_Type"],CondosLayer.queryFeatures(query6).then((function(response){var features=response.features,comboBox=$("#designTypeFilter");features.forEach((function(feature){var newItem,name=feature.attributes.Design_Type;""!=name&&(newItem=$('<calcite-combobox-item value="'+name+'" text-label="'+name+'"></calcite-combobox-item>'),comboBox.append(newItem))}))}));let query7=noCondosLayer.createQuery();query7.where="1=1 AND Zoning IS NOT NULL",query7.returnDistinctValues=!0,query7.returnGeometry=!1,query7.outFields=["Zoning"],CondosLayer.queryFeatures(query7).then((function(response){var features=response.features,comboBox=$("#zoningFilter");features.forEach((function(feature){var newItem,name=feature.attributes.Zoning;""!=name&&(newItem=$('<calcite-combobox-item value="'+name+'" text-label="'+name+'"></calcite-combobox-item>'),comboBox.append(newItem))}))}));let query8=noCondosLayer.createQuery();query8.where="1=1 AND Neighborhood IS NOT NULL",query8.returnDistinctValues=!0,query8.returnGeometry=!1,query8.outFields=["Neighborhood"],CondosLayer.queryFeatures(query8).then((function(response){var features=response.features,comboBox=$("#neighborhoodFilter");features.forEach((function(feature){var newItem,name=feature.attributes.Neighborhood;""!=name&&(newItem=$('<calcite-combobox-item value="'+name+'" text-label="'+name+'"></calcite-combobox-item>'),comboBox.append(newItem))}))}))}(),document.getElementById("Print-selector").addEventListener("click",(function(){!function(){const printDPI=300,mapWidthInInches=8,mapWidthInPixels=mapWidthInInches*printDPI,mapHeightInPixels=8*printDPI;view.takeScreenshot({width:mapWidthInPixels,height:mapHeightInPixels}).then((function(screenshot){const printWindow=window.open("","_blank"),scaleBarHTML=document.getElementById("scale-value").innerHTML,currentDate=(new Date).toLocaleString();printWindow.document.write(`\n            <!DOCTYPE html>\n            <html lang="en">\n            <head>\n                <meta charset="UTF-8">\n                <meta name="viewport" content="width=device-width, initial-scale=1.0">\n                <title>Print Map</title>\n                <link rel="stylesheet" href="https://js.arcgis.com/4.27/esri/themes/light/main.css">\n                <style>\n                    body {\n                        display: flex;\n                        flex-direction: column;\n                        align-items: center;\n                        justify-content: center;\n                        margin: 0;\n                        padding: 0;\n                    }\n                    .print-title {\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        text-align: center;\n                        font-size: 24px;\n                        margin: 20px 0;\n                    }\n                    .print-scale {\n                        display: flex;\n                        align-items: center;\n                        justify-content: space-around;\n                        text-align: center;\n                        font-size: 14px;\n                        width: 100%;\n                        margin-left: 20px;\n                        margin-right: 20px;\n                    }\n                    .print-title img {\n                        margin-right: 20px;\n                    }\n                    .scale-bar-container {\n                        transform: scale(1.5);\n                        margin-right: 50px;\n                    }\n                    .print-scale-bar {\n                        width: 300px;\n                        height: 30px;\n                    }\n                    .info-writing-container {\n                        display: flex;\n                        justify-content: center;\n                        align-items: flex-start;\n                        width: 80%;\n                        margin: 20px auto;\n                    }\n                    .info-text {\n                        width: 20%;\n                        text-align: left;\n                        margin-right: 20px;\n                    }\n                    .writing-lines {\n                        width: 80%;\n                        text-align: center;\n                    }\n                    .writing-lines div {\n                        border-bottom: 1px solid black;\n                        margin: 10px 0;\n                        height: 20px;\n                    }\n                    @media print {\n                        body * {\n                            visibility: visible;\n                        }\n                    }\n                </style>\n            </head>\n            <body>\n                <div class="print-title" id="print-title">\n                    <img id="town-logo" src="${configVars.welcomeImage}" alt="Town Logo">\n                    <h1 id="title-text">${configVars.title}</h1>\n                </div>\n                <div class="print-map">\n                    <img id="print-map-image" src="${screenshot.dataUrl}" alt="Map Image" style="width: ${mapWidthInInches}in; height: auto; border: 3px solid #A9A9A9; margin: 0 0.75in;">\n                </div>\n                <div class="print-scale">\n                    <div class="print-date" style="font-size: 14px;">Date Printed: ${currentDate}</div>\n                    <div id="to-scale" class="scale-bar-container"></div>\n                    <div id="print-scale-bar" class="scale-bar-container">${scaleBarHTML}</div>\n                </div>\n                <div style="text-align: center;">\n                    <p>Disclaimer: This map is intended for reference and general informational purposes\n                    only and is not a legally recorded map or survey. While reasonable effort has been\n                    made to ensure the accuracy, correctness, and timeliness of materials presented,\n                    the map vendor and the municipality disclaim any and all liability and responsibility for\n                    any errors, omissions, or inaccuracies in the data provided, including without limitation\n                    any liability for direct, indirect, incidental, consequential, special, exemplary,\n                    punitive, or any other type of damages. Users are hereby notified that the primary\n                    information source should be consulted for verification of the data contained herein.\n                    Continued use of this map acknowledges acceptance of these terms.</p>\n                </div>\n                <script>\n                    window.onload = function() {\n                        window.print();\n                    };\n                <\/script>\n            </body>\n            </html>\n          `),printWindow.document.close()}))}()})),$(document).ready((function(){$(document).on("click",".justRemove",(function(event){event.stopPropagation(),event.preventDefault();let targetElement=event.target.closest("li"),objectID=(targetElement.getAttribute("data-id"),targetElement.getAttribute("object-id")),capturedEvent=event;if("no"===sessionStorage.getItem("condos")){let query=CondosLayer.createQuery();query.where=`OBJECTID = ${objectID}`,query.returnGeometry=!0,query.outFields=["*"],noCondosLayer.queryFeatures(query).then((function(response){totalResults=response.features,processFeatures(totalResults,"",capturedEvent),addPolygons(response,view.graphics,true)}))}else{let query2=CondosLayer.createQuery();query2.where=`OBJECTID = ${objectID}`,query2.returnGeometry=!0,query2.outFields=["*"],CondosLayer.queryFeatures(query2).then((function(response){totalResults=response.features,processFeatures(totalResults,"",capturedEvent),addPolygons(response,view.graphics,true)}))}}))})),$(document).ready((function(){$(document).on("click",".justZoom",(function(event){event.stopPropagation(),event.preventDefault();let targetElement=event.target.closest("li"),objectID=(targetElement.getAttribute("data-id"),targetElement.getAttribute("object-id"));if("no"===sessionStorage.getItem("condos")){let whereClause=`OBJECTID = ${objectID}`,query=noCondosLayer.createQuery();query.where=whereClause,query.returnGeometry=!0,query.returnHiddenFields=!0,query.outFields=["*"],noCondosLayer.queryFeatures(query).then((response=>{const geometryExtent=response.features[0].geometry.extent,center=geometryExtent.center,newExtent=geometryExtent.expand(3);view.goTo({target:center,extent:newExtent})}))}else{let whereClause=`OBJECTID = ${objectID}`,query=CondosLayer.createQuery();query.where=whereClause,query.returnGeometry=!0,query.returnHiddenFields=!0,query.outFields=["*"],CondosLayer.queryFeatures(query).then((response=>{const geometryExtent=response.features[0].geometry.extent,center=geometryExtent.center,newExtent=geometryExtent.expand(3);view.goTo({target:center,extent:newExtent})}))}}))})),document.getElementById("sortByOwner").addEventListener("click",(function(){sortUniqueArray("owner")})),document.getElementById("sortByLocation").addEventListener("click",(function(){sortUniqueArray("location")}));let sketch=new SketchViewModel({view:view,layer:sketchGL,defaultCreateOptions:{mode:"freehand"},polygonSymbol:{type:"simple-fill",style:"cross",color:"rgb(145, 199, 61)",outline:{width:3,style:"solid",color:"rgba(127, 42, 145, 1)"}},defaultUpdateOptions:{tool:"reshape",toggleToolOnClick:!1}});$("#lasso").on("click",(function(e){lasso=!lasso,select=!1,$("#select-button").removeClass("btn-warning"),$("#select-button").prop("disabled",!1),lasso&&!select?(sketch.create("polygon"),$("#select-button").removeClass("btn-warning"),$("#lasso").addClass("btn-warning")):(sketch.cancel(),$("#lasso").removeClass("btn-warning"),$("#lasso").addClass("btn-info"),$("#select-button").removeClass("btn-warning"),$("#select-button").addClass("btn-info")),clearContents(),sketchGL.removeAll(),"no"===sessionStorage.getItem("condos")?noCondosLayer.visible=!0:CondosLayer.visible=!0})),sketch.on("create",(function(event){"complete"===event.state&&(sketchGL.remove(event.graphic),sketchGL.add(event.graphic),function(lasso){let totalResults=[],graphicsLayer=view.graphics;function addResultGraphics(finalResults){var fillSymbol={type:"simple-fill",color:[127,42,145,.4],outline:{color:[127,42,145,.8],width:2}};polygonGraphics=finalResults.map((function(feature){return feature.geometry?new Graphic({geometry:feature.geometry,symbol:fillSymbol,id:feature.attributes.OBJECTID}):(console.error("Feature does not have geometry:",feature),null)})).filter((graphic=>null!==graphic)),graphicsLayer.addMany(polygonGraphics),sketchGL.removeAll(),processFeatures(finalResults,polygonGraphics),lasso=!1}"no"==sessionStorage.getItem("condos")?function(){let query=noCondosLayer.createQuery();query.geometry=lasso,query.distance=1,query.units="feet",query.spatialRelationship="intersects",query.returnGeometry=!0,query.outFields=["*"],noCondosLayer.queryFeatures(query).then((function(response){totalResults=response.features,addResultGraphics(totalResults)}))}():function(){let query2=CondosLayer.createQuery();query2.geometry=lasso,query2.distance=1,query2.units="feet",query2.spatialRelationship="intersects",query2.returnGeometry=!0,query2.outFields=["*"],CondosLayer.queryFeatures(query2).then((function(response){totalResults=response.features,addResultGraphics(totalResults)}))}()}(event.graphic.geometry),DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),clickHandle&&(clickHandle?.remove(),clickHandle=null),clickHandle=view.on("click",handleClick),$("#lasso").removeClass("btn-warning"),$("#lasso").addClass("btn-info"),$("#select-button").addClass("btn-warning"))})),$("#select-button").on("click",(function(e){if(sketch.cancel(),select=!!overRide||!select,select||clearContents(),lasso=!1,select&&!lasso?($("#lasso").removeClass("btn-warning"),$("#select-button").addClass("btn-warning")):$("#select-button").removeClass("btn-warning"),"no"===sessionStorage.getItem("condos")?noCondosLayer.visible=!0:CondosLayer.visible=!0,select&&!lasso){if(clickHandle)try{clickHandle?.remove(),clickHandle=null}catch(error){console.error("Failed to remove clickHandle",error)}if(DetailsHandle)try{DetailsHandle?.remove(),DetailsHandle=null}catch(error){console.error("Failed to remove DetailsHandle",error)}clickHandle=view.on("click",handleClick)}else if(select&&lasso)DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),clickHandle&&(clickHandle?.remove(),clickHandle=null),clickHandle=view.on("click",handleClick);else{if(clickHandle)try{clickHandle?.remove(),clickHandle=null}catch(error){console.error("Failed to remove clickHandle",error)}if(DetailsHandle)try{DetailsHandle?.remove(),DetailsHandle=null}catch(error){console.error("Failed to remove DetailsHandle",error)}}})),$("#home").on("click",(function(e){view.goTo(configVars.homeExtent)}));class Parcel{constructor(objectid,location,uniqueId,gisLink,coOwner,owner,MBL,geometry,mailingAddress,mailingAddress2,Mailing_City,Mail_State,Mailing_Zip,Total_Acres,Parcel_Primary_Use,Building_Use_Code,Parcel_Type,Design_Type,Zoning,Neighborhood,Land_Type_Rate,Functional_Obs,External_Obs,Sale_Date,Sale_Price,Vol_Page,Assessed_Total,Appraised_Total,Influence_Factor,Influence_Type,Land_Type,Prior_Assessment_Year,Prior_Assessed_Total,Prior_Appraised_Total,Map,Lat,Lon){this.objectid=objectid,this.location=location,this.uniqueId=uniqueId,this.GIS_LINK=gisLink,this.coOwner=coOwner,this.owner=owner,this.MBL=MBL,this.geometry=geometry,this.mailingAddress=mailingAddress,this.mailingAddress2=mailingAddress2,this.Mailing_City=Mailing_City,this.Mail_State=Mail_State,this.Mailing_Zip=Mailing_Zip,this.Total_Acres=Total_Acres,this.Parcel_Primary_Use=Parcel_Primary_Use,this.Building_Use_Code=Building_Use_Code,this.Parcel_Type=Parcel_Type,this.Design_Type=Design_Type,this.Zoning=Zoning,this.Neighborhood=Neighborhood,this.Land_Type_Rate=Land_Type_Rate,this.Functional_Obs=Functional_Obs,this.External_Obs=External_Obs,this.Sale_Date=Sale_Date,this.Sale_Price=Sale_Price,this.Vol_Page=Vol_Page,this.Assessed_Total=Assessed_Total,this.Appraised_Total=Appraised_Total,this.Influence_Factor=Influence_Factor,this.Influence_Type=Influence_Type,this.Land_Type=Land_Type,this.Prior_Assessment_Year=Prior_Assessment_Year,this.Prior_Assessed_Total=Prior_Assessed_Total,this.Prior_Appraised_Total=Prior_Appraised_Total,this.Map=Map,this.LAT=Lat,this.LON=Lon}}function queryRelatedRecords(searchTerm,urlSearch){"no"===sessionStorage.getItem("condos")?noCondosLayer.visible=!0:CondosLayer.visible=!0,$(".spinner-container").show();let GISLINK,whereClause=`\n          Street_Name LIKE '%${searchTerm}%' OR \n          MBL LIKE '%${searchTerm}%' OR \n          Location LIKE '%${searchTerm}%' OR \n          Co_Owner LIKE '%${searchTerm}%' OR \n          Uniqueid LIKE '%${searchTerm}%' OR \n          Owner LIKE '%${searchTerm}%' OR \n          GIS_LINK LIKE '%${searchTerm}%'\n      `,query=noCondosLayer.createQuery();query.where=whereClause,query.returnGeometry=!0,query.outFields=["*"];let triggerUrl,query2=CondosLayer.createQuery();query2.where=whereClause,query2.returnGeometry=!0,query2.outFields=["*"],"no"===sessionStorage.getItem("condos")?noCondosLayer.queryFeatures(query).then((function(result){if(triggerUrl=result.features,result.features.length>=1)triggerUrl=result.features,noCondosParcelGeom=result.features,addPolygons(result,view.graphics),processFeatures(result.features),urlSearch&&triggerListGroup(triggerUrl,searchTerm),result.features.length,view.goTo({target:result.features});else if(1===result.features.length&&firstList.length>2){const firstQuery=noCondosTable.createQuery();firstQuery.where=whereClause,firstQuery.returnGeometry=!1,firstQuery.outFields=["*"],noCondosTable.queryFeatures(firstQuery).then((function(result){addPolygons(result.features,"","",true),processFeatures(),urlSearch&&triggerListGroup(triggerUrl,searchTerm)}))}else{const firstQuery=noCondosTable.createQuery();firstQuery.where=whereClause,firstQuery.returnGeometry=!1,firstQuery.outFields=["*"],0==result.features.length&&noCondosTable.queryFeatures(firstQuery).then((function(result){result.features.length<=0&&(clearContents(),alert("Search resulted in an error, please try again.")),GISLINK=result.features[0].attributes.GIS_LINK})).then((function(result){const newQuery=noCondosLayer.createQuery();newQuery.where=`GIS_LINK = '${GISLINK}'`,newQuery.returnGeometry=!0,newQuery.outFields=["*"],noCondosLayer.queryFeatures(newQuery).then((function(result){view.goTo({target:result.features}),noCondosParcelGeom=result.features,addPolygons(result,view.graphics),processFeatures(result.features),urlSearch&&triggerListGroup(triggerUrl,searchTerm)}))}))}})):CondosLayer.queryFeatures(query2).then((function(result){triggerUrl=result.features,result.features&&(result.features.length>2?view.goTo(result.features):view.goTo({target:result.features,zoom:15}),addPolygons(result,view.graphics),processFeatures(result.features),urlSearch&&triggerListGroup(triggerUrl,searchTerm))})),clickHandle&&(clickHandle?.remove(),clickHandle=null),DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),DetailsHandle=view.on("click",handleDetailsClick),lasso=!1,select=!1}function handleDetailsClick(event){if(clickHandle&&(clickHandle?.remove(),clickHandle=null),$("#details-spinner").show(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportSearch").hide(),$("#exportButtons").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$("#abutters-attributes").prop("disabled",!1),$("#abutters-zoom").prop("disabled",!1),"no"===sessionStorage.getItem("condos")){let query=CondosLayer.createQuery();query.geometry=event.mapPoint,query.distance=1,query.units="feet",query.spatialRelationship="within",query.returnGeometry=!0,query.outFields=["*"],noCondosLayer.queryFeatures(query).then((function(response){if(totalResults=response.features,!(totalResults.length>0))return $("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$(".center-container").hide(),$("#layerListDiv").hide(),$("#details-spinner").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").html('<h5 style="color: red;">Issue selecting Parcel. Please make another selection.</h5>'),$("#abutters-attributes").prop("disabled",!0),$("#abutters-zoom").prop("disabled",!0),$("#selected-feature").empty(),$("#exportSearch").hide(),void $("#exportButtons").hide();zoomToDetail(response.features[0].attributes.OBJECTID,response.features[0].geometry,response.features[0]),clickDetailsPanel(totalResults)}))}else{let query2=CondosLayer.createQuery();query2.geometry=event.mapPoint,query2.distance=1,query2.units="feet",query2.spatialRelationship="within",query2.returnGeometry=!0,query2.outFields=["*"],CondosLayer.queryFeatures(query2).then((function(response){if(totalResults=response.features,!(totalResults.length>0))return $("#details-spinner").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").html('<h5 style="color: red;">Issue selecting Parcel. Please make another selection.</h5>'),$("#abutters-attributes").prop("disabled",!0),$("#abutters-zoom").prop("disabled",!0),$("#selected-feature").empty(),$("#exportSearch").hide(),$("#exportButtons").hide(),$("#results-div").css("height","300px"),void $("#backButton-div").css("padding-top","0px");zoomToDetail(response.features[0].attributes.OBJECTID,response.features[0].geometry,response.features[0]),clickDetailsPanel(totalResults)}))}}function handleClick(event){if(detailsHandleUsed="click",isClickEvent=!0,DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),"no"===sessionStorage.getItem("condos")){let query=CondosLayer.createQuery();query.geometry=event.mapPoint,query.distance=1,query.units="feet",query.spatialRelationship="within",query.returnGeometry=!0,query.outFields=["*"],noCondosLayer.queryFeatures(query).then((function(response){response.features&&(totalResults=response.features,processFeatures(totalResults,"",event),addPolygons(response,view.graphics,isClickEvent))}))}else{let query2=CondosLayer.createQuery();query2.geometry=event.mapPoint,query2.distance=1,query2.units="feet",query2.spatialRelationship="within",query2.returnGeometry=!0,query2.outFields=["*"],CondosLayer.queryFeatures(query2).then((function(response){response.features&&(totalResults=response.features,processFeatures(totalResults,"",event),addPolygons(response,view.graphics,isClickEvent))}))}}function ExportDetails(type){var listItems;listItems="search"===type?document.querySelectorAll(".export-search-list"):document.querySelectorAll(".abutters-group-list");const originalContents=[];document.querySelectorAll(".search-list").forEach((function(li,index){originalContents[index]=li.innerHTML}));var transformedContent="<ul class='label-list'>";listItems.forEach((function(item){transformedContent+="<li>"+item.innerHTML.trim()+"</li>"})),transformedContent+="</ul>";var win=window.open("","print","left=0,top=0,width=800,height=600,toolbar=0,status=0");win.document.write("<!DOCTYPE html><html><head>"),win.document.write("<title>Print Labels</title>"),win.document.write("<style>body { margin: 0; padding: 0; font-size: 10pt; }.label-list { list-style-type: none; margin: 0; padding: 0; display: flex; align-items: center; text-align: center; flex-wrap: wrap; justify-content: space-between; }.label-list li { box-sizing: border-box; width: 2.225in; height: 1in; margin-bottom: 0.0in; padding: 0.1in; display: flex; align-items: center; justify-content: center; font-size: 8pt; }@media print {  body { margin: 0.0in 0.1875in; }  .label-list { padding: 0; }  .label-list li { margin-right: 0in; margin-bottom: 0; }  @page { margin-top: 0.5in; margin-bottom: 0.5in; margin-left: 0.25in; margin-right: 0.25in }}</style>"),win.document.write("</head><body>"),win.document.write(transformedContent),win.document.write("</body></html>"),win.document.close(),setTimeout((()=>{win.print(),win.close(),document.querySelectorAll(".search-list").forEach((function(li,index){originalContents[index]&&(li.innerHTML=originalContents[index])}))}),250)}function buildAndQueryTable(bufferResults){if(bufferResults.length>0){const queryValues=bufferResults.map((value=>`'${value}'`)).join(" OR GIS_LINK = "),queryString=`GIS_LINK = ${queryValues}`;let query=CondosTable.createQuery();query.where=queryString,query.returnGeometry=!1,query.returnHiddenFields=!0,query.outFields=["*"],CondosTable.queryFeatures(query).then((response=>{!function(results){const abuttersDiv=document.getElementById("parcel-feature");abuttersDiv.innerHTML="";const foundLocs=results.features;totalResults=foundLocs.length,lastResults=totalResults,exportResults=foundLocs,uniqueArray=foundLocs,exportCsv=foundLocs,foundLocs.forEach((function(feature){let locationGISLINK=feature.attributes.GIS_LINK,objectID=feature.attributes.OBJECTID,owner=feature.attributes.Owner,coOwner=feature.attributes.Co_Owner,mailingAddress=feature.attributes.Mailing_Address_1,mailingAddress2=feature.attributes.Mailing_Address_2,Mailing_City=feature.attributes.Mailing_City,Mail_State=feature.attributes.Mail_State,Mailing_Zip=feature.attributes.Mailing_Zip;const listGroup=document.createElement("ul");listGroup.classList.add("row"),listGroup.classList.add("list-group"),listGroup.classList.add("abutters-list");const listItem=document.createElement("li");listItem.classList.add("abutters-group-item","col-12");let listItemHTML="";listItemHTML=` ${owner} ${coOwner} <br> ${mailingAddress} ${mailingAddress2} <br> ${Mailing_City}, ${Mail_State} ${Mailing_Zip}`,listItem.innerHTML+=listItemHTML,listItem.setAttribute("data-id",locationGISLINK),listItem.setAttribute("object-id",objectID),listGroup.appendChild(listItem),abuttersDiv.appendChild(listGroup),$("#abutters-spinner").hide(),$("#abutters-title").html(`Abutting Parcels (${totalResults})`)})),$("#results-div").css("height","300px"),$("#exportResults").show(),$("#csvExportResults").show()}(response)}))}else console.log("No buffer results to query.")}function addOrUpdateBufferGraphic(bufferResults){bufferGraphicId="BufferGraphicId";const existingBufferGraphicIndex=view.graphics.items.findIndex((g=>g.id===bufferGraphicId));existingBufferGraphicIndex>-1&&view.graphics.removeAt(existingBufferGraphicIndex);let newBufferGraphic=new Graphic({geometry:bufferResults,symbol:{type:"simple-fill",color:[51,51,204,.1],style:"forward-diagonal",outline:{color:"rgba(127, 42, 145, 0.8)",width:4}},id:bufferGraphicId});view.graphics.add(newBufferGraphic),view.goTo({target:newBufferGraphic,zoom:oldZoom})}function runAttBuffer(value){$("#abutters-spinner").show(),0===value&&(value=-10);let bufferResults,buffer=value,unit=queryUnits;bufferResults=(sessionStorage.getItem("condos"),geometryEngine.buffer(detailsGeometry,buffer,unit)),addOrUpdateBufferGraphic(bufferResults),function(geometry){const parcelQuery={spatialRelationship:"intersects",geometry:geometry,outFields:["*"],returnGeometry:!0,units:queryUnits};let bufferResults=[];"no"===sessionStorage.getItem("condos")?noCondosLayer.queryFeatures(parcelQuery).then((results=>{results.features.forEach((parcel=>{bufferResults.push(parcel.attributes.GIS_LINK)})),buildAndQueryTable(bufferResults)})):CondosLayer.queryFeatures(parcelQuery).then((results2=>{results2.features.forEach((parcel=>{bufferResults.push(parcel.attributes.GIS_LINK)})),buildAndQueryTable(bufferResults)}))}(bufferResults)}function clickDetailsPanel(item){function formatNumber(value){return void 0===value?"":new Intl.NumberFormat("en-US").format(value)}$("#select-button").prop("disabled",!0),$("#select-button").removeClass("btn-warning"),detailsHandleUsed="detailClick",$("#detail-content").empty(),$("#selected-feature").empty(),$(".center-container").hide(),$("#layerListDiv").hide();let Id,features=item[0].attributes,Location=void 0===features.Location?"":features.Location,locationUniqueId=void 0===features.Uniqueid?"":features.Uniqueid,locationGIS_LINK=void 0===features.GIS_LINK?"":features.GIS_LINK,locationCoOwner=void 0===features.Co_Owner?"":features.Co_Owner,locationOwner=void 0===features.Owner?"":features.Owner,locationMBL=void 0===features.MBL?"":features.MBL,mailingAddress=void 0===features.Mailing_Address_1?"":features.Mailing_Address_1,Mailing_City=void 0===features.Mailing_City?"":features.Mailing_City+", ",Mail_State=void 0===features.Mail_State?"":features.Mail_State,Mailing_Zip=void 0===features.Mailing_Zip?"":features.Mailing_Zip,Total_Acres=void 0===features.Total_Acres?"":features.Total_Acres,Parcel_Primary_Use=void 0===features.Parcel_Primary_Use?"":features.Parcel_Primary_Use,Building_Use_Code=void 0===features.Building_Use_Code?"":features.Building_Use_Code,orig_date=(void 0===features.Parcel_Type||features.Parcel_Type,void 0===features.Design_Type||features.Design_Type,void 0===features.Zoning||features.Zoning,void 0===features.Neighborhood||features.Neighborhood,void 0===features.Land_Type_Rate||features.Land_Type_Rate,void 0===features.Functional_Obs||features.Functional_Obs,void 0===features.External_Obs||features.External_Obs,features.Sale_Date),Sale_Date=void 0===features.Sale_Date?"":formatDate(orig_date),Sale_Price=void 0===features.Sale_Price?"":formatNumber(features.Assessed_Total),Vol_Page=void 0===features.Vol_Page?"":features.Vol_Page,Prior_Appraised_Total=(void 0===features.Assessed_Total||formatNumber(features.Assessed_Total),void 0===features.Appraised_Total||formatNumber(features.Appraised_Total),void 0===features.Prior_Appraised_Total?"":formatNumber(features.Prior_Appraised_Total)),Prior_Assessed_Total=void 0===features.Prior_Assessed_Total?"":formatNumber(features.Prior_Assessed_Total),Prior_Assessment_Year=void 0===features.Prior_Assessment_Year?"":features.Prior_Assessment_Year,map_pdf=void 0===features.Map?"":$.trim(features.Map),objectID2=void 0===features.OBJECTID?"":features.OBJECTID,Lat=void 0===features.Lat?"":features.Lat,Lon=void 0===features.Lon?"":features.Lon;"yes"===configVars.useUniqueIdforParcelMap?(zoomToItemId=locationUniqueId,Id=locationUniqueId):(zoomToItemId=locationGIS_LINK,Id=locationGIS_LINK),zoomToObjectID=objectID2;configVars.imageUrl;const detailsDiv=document.getElementById("detail-content"),details=document.createElement("div");details.innerHTML="",details.classList.add("details"),details.innerHTML=`\n        <p>\n        <span style="font-family:Tahoma;font-size:14px;"><strong>${Location}</strong></span> <br>\n        </p>\n\n        <div>\n        <img class="image" src=${configVars.imageUrl}${locationUniqueId}.jpg alt="Building Photo" width="250" height="125"><br>\n        </div>\n        <p>\n        <span style="font-family:Tahoma;font-size:12px;"><strong>${locationOwner} ${locationCoOwner}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;"><strong>${mailingAddress}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;"><strong>${Mailing_City} ${Mail_State} ${Mailing_Zip}</strong></span><br>\n\n        </p>\n        <p>\n        <span style="font-family:Tahoma;font-size:12px;">Unique ID: <strong>${locationUniqueId}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;">MBL: <strong>${locationMBL}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;">Total Acres: <strong>${Total_Acres}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;">Primary Use: <strong>${Parcel_Primary_Use}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;">Primary Bldg Use: <strong>${Building_Use_Code}</strong></span><br>\n\n        </p>\n        <p>\n        <span style="font-family:Tahoma;font-size:12px;"><strong>Latest Qualified Sale:</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;">Sold on: <strong>${Sale_Date}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;">Sale Price: <strong>$${Sale_Price}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;">Volume/Page: <strong>${Vol_Page}</strong></span><br>\n\n        </p>\n        <p>\n        <span style="font-family:Tahoma;font-size:12px;"><strong>Valuations:</strong></span><br>\n        <span style="font-family:Tahoma;font-size:12px;">GL Year: <strong>${Prior_Assessment_Year}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;">Assessment: <strong>$${Prior_Assessed_Total}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;">Appraised: <strong>$${Prior_Appraised_Total}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;"></span>\n        </p>\n        <p>   \n        <a target="_blank" rel="noopener noreferrer" href=${configVars.propertyCard}&amp;uniqueid=${locationUniqueId}><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></span></a><br>\n        <a target="_blank" rel="noopener noreferrer" href=https://publicweb-gis.s3.amazonaws.com/PDFs/${configVars.parcelMapUrl}/Quick_Maps/QM_${Id}.pdf><span style="font-family:Tahoma;font-size:12px;"><strong>Parcel Map</strong></span></a><span style="font-family:Tahoma;font-size:12px;"> </span><br>\n        <a target="_blank" rel="noopener noreferrer" href=${configVars.taxMap_Url}${map_pdf}.pdf><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Map</strong></span></a><br>\n        <a target="_blank" rel="noopener noreferrer" href=${configVars.tax_bill}&amp;uniqueId=${locationUniqueId}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a><br>\n        <a target="_blank" rel="noopener noreferrer" href=${configVars.pdf_demo}><span style="font-family:Tahoma;font-size:12px;"><strong>Demographics Profile</strong></span></a><br>\n        <a target="_blank" rel="noopener noreferrer" href=${configVars.housingUrl}><span style="font-family:Tahoma;font-size:12px;"><strong>Housing Profile</strong></span></a><br>\n        <a target="_blank" rel="noopener noreferrer" href=https://www.google.com/maps/@${Lat},${Lon},17z/@${Lat},${Lon},17z/data=!5m1!1e2><span style="font-family:Tahoma;font-size:12px;"><strong>View in Google Maps</strong></span></a><br>\n        <a target="_blank" rel="noopener noreferrer" href=https://www.bing.com/maps?cp=${Lat}~${Lon}&lvl=17.0><span style="font-family:Tahoma;font-size:12px;"><strong>View in Bing Maps</strong></span></a><br>\n              \n        `,$("#details-spinner").hide(),detailsDiv.appendChild(details)}function buildDetailsPanel(objectId,itemId){function formatNumber(value){return void 0===value?"":new Intl.NumberFormat("en-US").format(value)}var matchedObject;$("#select-button").prop("disabled",!0),$("#select-button").removeClass("btn-warning"),clickHandle&&(clickHandle?.remove(),clickHandle=null),detailsHandleUsed="detailClick",$("#exportResults").hide(),$("#csvExportResults").hide(),detailSelected=[objectId,itemId],(matchedObject=firstList.find((function(item){return item.objectid===parseInt(objectId)})))||(matchedObject=firstList.find((function(item){return item.GIS_LINK===itemId||item.uniqueId===itemId})));let Id,Location=void 0===matchedObject.location?"":matchedObject.location,locationUniqueId=void 0===matchedObject.uniqueId?"":matchedObject.uniqueId,locationGIS_LINK=void 0===matchedObject.GIS_LINK?"":matchedObject.GIS_LINK,locationCoOwner=void 0===matchedObject.coOwner?"":matchedObject.coOwner,locationOwner=void 0===matchedObject.owner?"":matchedObject.owner,locationMBL=void 0===matchedObject.MBL?"":matchedObject.MBL,mailingAddress=void 0===matchedObject.mailingAddress?"":matchedObject.mailingAddress,Mailing_City=void 0===matchedObject.Mailing_City?"":matchedObject.Mailing_City+", ",Mail_State=void 0===matchedObject.Mail_State?"":matchedObject.Mail_State,Mailing_Zip=void 0===matchedObject.Mailing_Zip?"":matchedObject.Mailing_Zip,Total_Acres=void 0===matchedObject.Total_Acres?"":matchedObject.Total_Acres,Parcel_Primary_Use=(Number(Total_Acres),void 0===matchedObject.Parcel_Primary_Use?"":matchedObject.Parcel_Primary_Use),Building_Use_Code=void 0===matchedObject.Building_Use_Code?"":matchedObject.Building_Use_Code,Parcel_Type=void 0===matchedObject.Parcel_Type?"":matchedObject.Parcel_Type,Sale_Date=(void 0===matchedObject.Design_Type||matchedObject.Design_Type,void 0===matchedObject.Zoning||matchedObject.Zoning,void 0===matchedObject.Neighborhood||matchedObject.Neighborhood,void 0===matchedObject.Land_Type_Rate||matchedObject.Land_Type_Rate,void 0===matchedObject.Functional_Obs||matchedObject.Functional_Obs,void 0===matchedObject.External_Obs||matchedObject.External_Obs,void 0===matchedObject.Sale_Date?"":matchedObject.Sale_Date),Sale_Price=void 0===matchedObject.Sale_Price?"":formatNumber(matchedObject.Sale_Price),Vol_Page=void 0===matchedObject.Vol_Page?"":matchedObject.Vol_Page,Prior_Appraised_Total=(void 0===matchedObject.Assessed_Total||formatNumber(matchedObject.Assessed_Total),void 0===matchedObject.Appraised_Total||formatNumber(matchedObject.Appraised_Total),void 0===matchedObject.Prior_Appraised_Total?"":formatNumber(matchedObject.Prior_Appraised_Total)),Prior_Assessed_Total=void 0===matchedObject.Prior_Assessed_Total?"":formatNumber(matchedObject.Prior_Assessed_Total),Prior_Assessment_Year=void 0===matchedObject.Prior_Assessment_Year?"":matchedObject.Prior_Assessment_Year,map_pdf=(void 0===matchedObject.geometry||matchedObject.geometry,void 0===matchedObject.Map?"":$.trim(matchedObject.Map)),objectID2=void 0===matchedObject.objectid?"":matchedObject.objectid,Lat=void 0===matchedObject.LAT?"":matchedObject.LAT,Lon=void 0===matchedObject.LON?"":matchedObject.LON;"yes"===configVars.useUniqueIdforParcelMap?(zoomToItemId=locationUniqueId,Id=locationUniqueId):(zoomToItemId=locationGIS_LINK,Id=locationGIS_LINK),console.log(Parcel_Type),zoomToObjectID=objectID2;const detailsDiv=document.getElementById("detail-content"),details=document.createElement("div");details.innerHTML="",details.classList.add("details"),details.innerHTML=`\n    <p>\n    <span style="font-family:Tahoma;font-size:14px;"><strong>${Location}</strong></span> <br>\n    </p>\n\n    <div>\n    <img class="image" src=${configVars.imageUrl}${locationUniqueId}.jpg alt="Building Photo" width="250" height="125"><br>\n    </div>\n    <p>\n    <span style="font-family:Tahoma;font-size:12px;"><strong>${locationOwner} ${locationCoOwner}</strong></span> <br>\n    <span style="font-family:Tahoma;font-size:12px;"><strong>${mailingAddress}</strong></span> <br>\n    <span style="font-family:Tahoma;font-size:12px;"><strong>${Mailing_City} ${Mail_State} ${Mailing_Zip}</strong></span><br>\n\n    </p>\n    <p>\n    <span style="font-family:Tahoma;font-size:12px;">Unique ID: <strong>${locationUniqueId}</strong></span> <br>\n    <span style="font-family:Tahoma;font-size:12px;">MBL: <strong>${locationMBL}</strong></span> <br>\n    <span style="font-family:Tahoma;font-size:12px;">Total Acres: <strong>${Total_Acres}</strong></span> <br>\n    <span style="font-family:Tahoma;font-size:12px;">Primary Use: <strong>${Parcel_Primary_Use}</strong></span> <br>\n    <span style="font-family:Tahoma;font-size:12px;">Primary Bldg Use: <strong>${Building_Use_Code}</strong></span><br>\n\n    </p>\n    <p>\n    <span style="font-family:Tahoma;font-size:12px;"><strong>Latest Qualified Sale:</strong></span> <br>\n    <span style="font-family:Tahoma;font-size:12px;">Sold on: <strong>${Sale_Date}</strong></span> <br>\n    <span style="font-family:Tahoma;font-size:12px;">Sale Price: <strong>$${Sale_Price}</strong></span> <br>\n    <span style="font-family:Tahoma;font-size:12px;">Volume/Page: <strong>${Vol_Page}</strong></span><br>\n\n    </p>\n    <p>\n    <span style="font-family:Tahoma;font-size:12px;"><strong>Valuations:</strong></span><br>\n    <span style="font-family:Tahoma;font-size:12px;">GL Year: <strong>${Prior_Assessment_Year}</strong></span> <br>\n    <span style="font-family:Tahoma;font-size:12px;">Assessment: <strong>$${Prior_Assessed_Total}</strong></span> <br>\n    <span style="font-family:Tahoma;font-size:12px;">Appraised: <strong>$${Prior_Appraised_Total}</strong></span> <br>\n    <span style="font-family:Tahoma;font-size:12px;"></span>\n    </p>\n    <p>\n    <a target="_blank" rel="noopener noreferrer" href=${configVars.propertyCard}&amp;uniqueid=${locationUniqueId}><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></span></a><br>\n    <a target="_blank" rel="noopener noreferrer" href=https://publicweb-gis.s3.amazonaws.com/PDFs/${configVars.parcelMapUrl}/Quick_Maps/QM_${Id}.pdf><span style="font-family:Tahoma;font-size:12px;"><strong>Parcel Map</strong></span></a><span style="font-family:Tahoma;font-size:12px;"> </span><br>\n    <a target="_blank" rel="noopener noreferrer" href=${configVars.taxMap_Url}${map_pdf}.pdf><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Map</strong></span></a><br>\n    <a target="_blank" rel="noopener noreferrer" href=${configVars.tax_bill}&amp;uniqueId=${locationUniqueId}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a><br>\n    <a target="_blank" rel="noopener noreferrer" href=${configVars.pdf_demo}><span style="font-family:Tahoma;font-size:12px;"><strong>Demographics Profile</strong></span></a><br>\n    <a target="_blank" rel="noopener noreferrer" href=${configVars.housingUrl}><span style="font-family:Tahoma;font-size:12px;"><strong>Housing Profile</strong></span></a><br>\n    <a target="_blank" rel="noopener noreferrer" href=https://www.google.com/maps/@${Lat},${Lon},17z/@${Lat},${Lon},17z/data=!5m1!1e2><span style="font-family:Tahoma;font-size:12px;"><strong>View in Google Maps</strong></span></a><br>\n    <a target="_blank" rel="noopener noreferrer" href=https://www.bing.com/maps?cp=${Lat}~${Lon}&lvl=17.0><span style="font-family:Tahoma;font-size:12px;"><strong>View in Bing Maps</strong></span></a><br>\n          \n    `,$("#details-spinner").hide(),detailsDiv.appendChild(details)}function zoomToDetail(objectid,geom,item){detailsChanged={isChanged:!0,item:item};view.graphics.removeAll(polygonGraphics);targetExtent=geom,detailsGeometry=geom;const polygonGraphic=new Graphic({geometry:targetExtent,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:3}},id:"uniqueBufferGraphicId"});view.graphics.addMany([polygonGraphic]),view.goTo({target:polygonGraphic,zoom:15})}function zoomToFeature(objectid,notPolygonGraphics,gisLink){detailsChanged={isChanged:!1,item:""},isGisLink=[];view.graphics.removeAll(polygonGraphics);const existingBufferGraphicIndex=view.graphics.items.findIndex((g=>"uniqueBufferGraphicId"===g.id));if(existingBufferGraphicIndex>-1&&view.graphics.removeAt(existingBufferGraphicIndex),isGisLink=firstList.filter((obj=>obj.GIS_LINK==gisLink)),"no"==sessionStorage.getItem("condos")&&isGisLink.length==firstList.length&&isGisLink.length>1)if(noCondosParcelGeom){CondoBuffer=!1,targetExtent=noCondosParcelGeom[0].geometry,detailsGeometry=noCondosParcelGeom[0].geometry;const polygonGraphic=new Graphic({geometry:targetExtent,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:"uniqueBufferGraphicId"});view.graphics.addMany([polygonGraphic]),view.goTo({target:polygonGraphic})}else{let whereClause=`GIS_LINK = '${gisLink}'`,query=noCondosLayer.createQuery();query.where=whereClause,query.returnGeometry=!0,query.returnHiddenFields=!0,query.outFields=["*"],noCondosLayer.queryFeatures(query).then((response=>{let geometry=response.features[0].geometry;targetExtent=geometry,detailsGeometry=geometry,view.goTo({target:geometry});const polygonGraphic=new Graphic({geometry:detailsGeometry,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:"uniqueBufferGraphicId"});view.graphics.addMany([polygonGraphic])}))}else{CondoBuffer=!0;let matchingObject=firstList.filter((obj=>obj.objectid==objectid));if(matchingObject)if(null!=matchingObject[0].geometry&&""!=matchingObject[0].geometry){detailsGeometry=matchingObject[0].geometry,view.goTo({target:detailsGeometry});const polygonGraphic=new Graphic({geometry:detailsGeometry,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:"uniqueBufferGraphicId"});view.graphics.addMany([polygonGraphic])}else{CondoBuffer=!1;let whereClause=`GIS_LINK = '${matchingObject[0].GIS_LINK}'`,query=noCondosLayer.createQuery();query.where=whereClause,query.returnGeometry=!0,query.returnHiddenFields=!0,query.outFields=["*"],noCondosLayer.queryFeatures(query).then((response=>{let geometry=response.features[0].geometry;detailsGeometry=geometry,view.goTo({target:geometry});const polygonGraphic=new Graphic({geometry:detailsGeometry,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:"uniqueBufferGraphicId"});view.graphics.addMany([polygonGraphic])}))}}clickHandle&&(clickHandle?.remove(),clickHandle=null),DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),DetailsHandle=view.on("click",handleDetailsClick)}view.when((function(){document.getElementById("zoom-in").onclick=function(){view.zoom+=1},document.getElementById("zoom-out").onclick=function(){view.zoom-=1}})),clearBtn1.addEventListener("click",(function(){clearContents()})),clearBtn2.addEventListener("click",(function(){clearContents()})),document.getElementById("searchInput").addEventListener("input",(function(e){runQuerySearchTerm=e.target.value.toUpperCase()})),$(document).ready((function(){$("#backButton").on("click",(function(){if(!(polygonGraphics&&polygonGraphics.length>=1))return $("#total-results").hide(),$("#ResultDiv").hide(),$("#backButton").hide(),$("#detailBox").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#dropdown").show(),void $("#WelcomeBox").show();$("#WelcomeBox").hide(),$("#select-button").prop("disabled",!1),$("#detailBox").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#featureWid").show(),$("#total-results").show(),$("#ResultDiv").show(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#detail-content").empty(),$("#backButton").hide(),$("#detailsButton").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").show(),$("#exportButtons").show(),$("#exportSearch").show(),$("#results-div").css("height","300px"),$(".center-container").show(),view.graphics.removeAll(),view.graphics.addMany(polygonGraphics),view.goTo(polygonGraphics),lasso||select?!lasso&&select||!select&&lasso?(clickHandle&&clickHandle.remove(),DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),$("#select-button").addClass("btn-warning"),clickHandle=view.on("click",handleClick)):lasso&&!select?(clickHandle&&(clickHandle?.remove(),clickHandle=null),DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),clickHandle=view.on("click",handleClick),$("#select-button").addClass("btn-warning")):(clickHandle&&(clickHandle?.remove(),clickHandle=null),DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),$("#select-button").addClass("btn-warning"),clickHandle=view.on("click",handleClick)):(DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),clickHandle&&(clickHandle?.remove(),clickHandle=null),clickHandle&&select&&(clickHandle?.remove(),clickHandle=null),$("#select-button").removeClass("btn-warning"),DetailsHandle=view.on("click",handleDetailsClick))}))})),$(document).ready((function(){$("#detailsButton").on("click",(function(){$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detail-content").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportSearch").hide(),$("#exportButtons").hide(),$("#abutters-title").html("Abutting Parcels (0)"),$("#backButton-div").css("padding-top","0px"),$("#results-div").css("height","300px"),DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),DetailsHandle=view.on("click",handleDetailsClick);const existingBufferGraphicIndex=view.graphics.items.findIndex((g=>g.id===bufferGraphicId));existingBufferGraphicIndex>-1&&view.graphics.removeAt(existingBufferGraphicIndex)}))})),$(document).ready((function(){$("#abutters").on("click",(function(e){DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),clickHandle&&(clickHandle?.remove(),clickHandle=null),$("#results-div").css("height","300px"),$("#exportButtons").show(),$("#exportResults").show(),$("#exportSearch").hide(),$("#csvExportResults").show(),$("#csvExportSearch").hide(),$("#WelcomeBox").hide(),$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#abutters-content").show(),$("#selected-feature").empty(),$("#backButton").show(),$("#detailsButton").show(),$("#parcel-feature").empty(),$("#backButton-div").css("padding-top","78px"),$("#abutters-title").html("Abutting Parcels (0)"),buildAbuttersPanel(e),value.value=100,function(value){$("#abutters-spinner").show();let bufferResults,buffer=value,unit=queryUnits;bufferResults="no"==sessionStorage.getItem("condos")?geometryEngine.buffer(targetExtent,buffer,unit):geometryEngine.buffer(detailsGeometry,buffer,unit);addOrUpdateBufferGraphic(bufferResults),function(geometry){let bothResults=[];const abuttersDiv=document.getElementById("parcel-feature");abuttersDiv.innerHTML="";const parcelQuery={spatialRelationship:"intersects",geometry:geometry,outFields:["*"],returnGeometry:!0,units:queryUnits};exportResults=[],"no"===sessionStorage.getItem("condos")?noCondosLayer.queryFeatures(parcelQuery).then((results=>{bothResults=[...results.features];const seenLocations=new Set;bothResults.filter((item=>!seenLocations.has(item.attributes.OBJECTID)&&(seenLocations.add(item.attributes.OBJECTID),!0)));let foundLocs=bothResults.filter((element=>seenLocations.has(element.attributes.OBJECTID)));totalResults=bothResults.length;let noResultDups=bothResults,finalResults=noResultDups.filter(((item,index)=>noResultDups.indexOf(item)===index));lastResults=finalResults,exportResults=bothResults;exportCsv=foundLocs,foundLocs.forEach((function(feature){let locationGISLINK=feature.attributes.GIS_LINK,objectID=feature.attributes.OBJECTID,owner=feature.attributes.Owner,coOwner=feature.attributes.Co_Owner,mailingAddress=feature.attributes.Mailing_Address_1,mailingAddress2=feature.attributes.Mailing_Address_2,Mailing_City=feature.attributes.Mailing_City,Mail_State=feature.attributes.Mail_State,Mailing_Zip=feature.attributes.Mailing_Zip;const listGroup=document.createElement("ul");listGroup.classList.add("row"),listGroup.classList.add("list-group"),listGroup.classList.add("abutters-list");const listItem=document.createElement("li");listItem.classList.add("abutters-group-item","col-12");let listItemHTML="";listItemHTML=` ${owner} ${coOwner} <br> ${mailingAddress} ${mailingAddress2} <br> ${Mailing_City}, ${Mail_State} ${Mailing_Zip}`,listItem.innerHTML+=listItemHTML,listItem.setAttribute("data-id",locationGISLINK),listItem.setAttribute("object-id",objectID),listGroup.appendChild(listItem),abuttersDiv.appendChild(listGroup),$("#abutters-spinner").hide(),$("#abutters-title").html(`Abutting Parcels (${totalResults})`)}))})):CondosLayer.queryFeatures(parcelQuery).then((results2=>{bothResults=[...results2.features];const seenLocations=new Set;bothResults.filter((item=>!seenLocations.has(item.attributes.OBJECTID)&&(seenLocations.add(item.attributes.OBJECTID),!0)));let foundLocs=bothResults.filter((element=>seenLocations.has(element.attributes.OBJECTID)));totalResults=bothResults.length;let noResultDups=bothResults,finalResults=noResultDups.filter(((item,index)=>noResultDups.indexOf(item)===index));lastResults=finalResults,exportResults=bothResults;exportCsv=foundLocs,foundLocs.forEach((function(feature){let locationGISLINK=feature.attributes.GIS_LINK,objectID=feature.attributes.OBJECTID,owner=feature.attributes.Owner,coOwner=feature.attributes.Co_Owner,mailingAddress=feature.attributes.Mailing_Address_1,mailingAddress2=feature.attributes.Mailing_Address_2,Mailing_City=feature.attributes.Mailing_City,Mail_State=feature.attributes.Mail_State,Mailing_Zip=feature.attributes.Mailing_Zip;const listGroup=document.createElement("ul");listGroup.classList.add("row"),listGroup.classList.add("list-group"),listGroup.classList.add("abutters-list");const listItem=document.createElement("li");listItem.classList.add("abutters-group-item","col-12");let listItemHTML="";listItemHTML=` ${owner} ${coOwner} <br> ${mailingAddress} ${mailingAddress2} <br> ${Mailing_City}, ${Mail_State} ${Mailing_Zip}`,listItem.innerHTML+=listItemHTML,listItem.setAttribute("data-id",locationGISLINK),listItem.setAttribute("object-id",objectID),listGroup.appendChild(listItem),abuttersDiv.appendChild(listGroup),$("#abutters-spinner").hide(),$("#abutters-title").html(`Abutting Parcels (${totalResults})`)}))}));$("#results-div").css("height","300px"),$("#exportResults").show(),$("#csvExportResults").show()}(bufferResults)}("100")}))})),$(document).ready((function(){$("#abutters-attributes").on("click",(function(e){DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),clickHandle&&(clickHandle?.remove(),clickHandle=null),$("#results-div").css("height","300px"),$("#exportButtons").show(),$("#exportResults").show(),$("#exportButtons").show(),$("#exportSearch").hide(),$("#csvExportResults").show(),$("#csvExportSearch").hide(),$("#WelcomeBox").hide(),$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#abutters-content").show(),$("#selected-feature").empty(),$("#backButton").show(),$("#detailsButton").show(),$("#parcel-feature").empty(),$("#backButton-div").css("padding-top","78px"),$("#abutters-title").html("Abutting Parcels (0)"),buildAbuttersPanel(e),value.value=100,runAttBuffer("100")}))})),$(document).ready((function(){$("#filterButton").on("click",(function(){$("#WelcomeBox").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#exportSearch").hide(),$("#csvExportSearch").hide(),$("#abutters-content").hide(),$("#layerListDiv").hide(),$("#selected-feature").empty(),$("#backButton").hide(),$("#detailsButton").hide(),$("#dropdown").show(),$("#filterDiv").show(),$("#dropdown").toggleClass("expanded"),$("#sidebar2").css("left","0px"),$("#sidebar2").addClass("collapsed"),$("#results-div").css("left","350px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide(),$("#results-div").css("height","300px"),$("#parcel-feature").empty(),$("#backButton").show(),$("#backButton-div").css("padding-top","0px"),$("#abutters-title").html("Abutting Parcels (0)"),$(".center-container").show()}))})),$(document).ready((function(){$("#layerListBtn").on("click",(function(){$("#WelcomeBox").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#exportSearch").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportButtons").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#backButton").hide(),$("#detailsButton").hide(),$("#dropdown").show(),$("#filterDiv").hide(),$("#backButton").show(),$("#dropdown").toggleClass("expanded"),$("#sidebar2").css("left","0px"),$("#sidebar2").addClass("collapsed"),$("#results-div").css("left","350px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide(),$("#results-div").css("height","300px"),$("#layerListDiv").show(),$("#parcel-feature").empty(),$("#backButton-div").css("padding-top","0px"),$("#abutters-title").html("Abutting Parcels (0)"),$(".center-container").show()}))})),$("#layerListDiv").hide(),$(document).ready((function(){$("#exportSearch").on("click",(function(e){e.stopPropagation();const printContainer=document.createElement("div");printContainer.style.visibility="hidden",document.body.appendChild(printContainer);const resultsListGroup=document.createElement("ul");uniqueArray.forEach((function(feature){let objectID=feature.objectid,owner=feature.owner,coOwner=feature.coOwner,mailingAddress=feature.mailingAddress,Mailing_City=(feature.mailingAddress2,feature.Mailing_City),Mail_State=feature.Mail_State,Mailing_Zip=feature.Mailing_Zip,MBL=(feature.location,feature.MBL);const listItem=document.createElement("li");let listItemHTML;listItem.classList.add("export-search-list"),listItemHTML=` ${owner} ${coOwner} <br> MBL: ${MBL} <br> ${mailingAddress} <br> ${Mailing_City}, ${Mail_State} ${Mailing_Zip}`,listItem.innerHTML+=listItemHTML,listItem.setAttribute("object-id",objectID),resultsListGroup.appendChild(listItem)})),printContainer.appendChild(resultsListGroup),ExportDetails("search"),document.body.removeChild(printContainer)}))})),$(document).ready((function(){$("#csvExportResults").on("click",(function(e){e.stopPropagation();let csvContent=["Owner","Co-Owner","Mailing Address","Mailing Address 2","Mailing City","Mailing State","Mailing Zip","MBL","Location"].join(",")+"\n";exportCsv.forEach((function(feature){let owner=feature.attributes.Owner||"",coOwner=feature.attributes.Co_Owner||"",mailingAddress=feature.attributes.Mailing_Address_1||"",mailingAddress2=feature.attributes.Mailing_Address_2||"",Mailing_City=feature.attributes.Mailing_City||"",Mail_State=feature.attributes.Mail_State||"",Mailing_Zip=feature.attributes.Mailing_Zip||"",Location=feature.attributes.Location||"",MBL=feature.attributes.MBL||"";csvContent+=`"${owner}","${coOwner}","${mailingAddress}","${mailingAddress2}","${Mailing_City}","${Mail_State}","'${Mailing_Zip}'","${MBL}","${Location}"\n`}));const blob=new Blob([csvContent],{type:"text/csv;charset=utf-8;"}),link=document.createElement("a");if(void 0!==link.download){const url=URL.createObjectURL(blob);link.setAttribute("href",url),link.setAttribute("download","export.csv"),link.style.visibility="hidden",document.body.appendChild(link),link.click(),document.body.removeChild(link)}}))})),$(document).ready((function(){$("#csvExportSearch").on("click",(function(e){e.stopPropagation();let csvContent=["Owner","Co-Owner","Mailing Address","Mailing Address 2","Mailing City","Mailing State","Mailing Zip","MBL","Location"].join(",")+"\n";uniqueArray.forEach((function(feature){let owner=feature.owner||"",coOwner=feature.coOwner||"",mailingAddress=feature.mailingAddress||"",mailingAddress2=feature.mailingAddress2||"",Mailing_City=feature.Mailing_City||"",Mail_State=feature.Mail_State||"",Mailing_Zip=feature.Mailing_Zip?`'${feature.Mailing_Zip.toString().padStart(5,"0")}'`:"",Location=feature.location||"",MBL=feature.MBL||"";csvContent+=`"${owner}","${coOwner}","${mailingAddress}","${mailingAddress2}","${Mailing_City}","${Mail_State}","${Mailing_Zip}","${MBL}","${Location}"\n`}));const blob=new Blob([csvContent],{type:"text/csv;charset=utf-8;"}),link=document.createElement("a");if(void 0!==link.download){const url=URL.createObjectURL(blob);link.setAttribute("href",url),link.setAttribute("download","export.csv"),link.style.visibility="hidden",document.body.appendChild(link),link.click(),document.body.removeChild(link)}}))})),$(document).ready((function(){$("#exportResults").on("click",(function(e){e.stopPropagation();const printContainer=document.createElement("div");printContainer.style.visibility="hidden",document.body.appendChild(printContainer);const resultsListGroup=document.createElement("ul");uniqueArray.forEach((function(feature){let objectID=feature.attributes.OBJECTID,owner=feature.attributes.Owner,coOwner=feature.attributes.Co_Owner,mailingAddress=feature.attributes.Mailing_Address_1,Mailing_City=(feature.attributes.Mailing_Address_2,feature.attributes.Mailing_City),Mail_State=feature.attributes.Mail_State,Mailing_Zip=feature.attributes.Mailing_Zip,MBL=(feature.location,feature.attributes.MBL);const listItem=document.createElement("li");let listItemHTML;listItem.classList.add("abutters-group-list"),listItemHTML=` ${owner} ${coOwner} <br> MBL: ${MBL} <br> ${mailingAddress} <br> ${Mailing_City}, ${Mail_State} ${Mailing_Zip}`,listItem.innerHTML+=listItemHTML,listItem.setAttribute("object-id",objectID),resultsListGroup.appendChild(listItem)})),printContainer.appendChild(resultsListGroup),ExportDetails("details"),document.body.removeChild(printContainer)}))})),$(document).ready((function(){let debounceTimer;function bufferPush(){clearTimeout(debounceTimer),debounceTimer=setTimeout((()=>{runAttBuffer(currentVal)}),200)}$("#buffer-value").on("change",(function(e){e.stopPropagation(),currentVal=value.value=parseInt(value.value),$("#parcel-feature").empty(),bufferPush()})),$("#increase").on("click",(function(e){e.stopPropagation(),currentVal=value.value=parseInt(value.value)+1,$("#parcel-feature").empty(),bufferPush()})),$("#decrease").on("click",(function(e){e.stopPropagation(),currentVal=value.value=parseInt(value.value)-1,$("#parcel-feature").empty(),bufferPush()})),$("#submit").on("click",(function(e){e.stopPropagation(),e.preventDefault(),currentVal=value.value=parseInt(value.value),$("#parcel-feature").empty(),bufferPush()})),$("#buffer-value").on("keypress",(function(e){13==e.which&&(currentVal=value.value=parseInt(value.value),e.preventDefault(),bufferPush())})),$(".units").on("click",(function(e){"feet"==e.target.value?(queryUnits="feet",$("#unitSelector").html(queryUnits)):(queryUnits="meters",$("#unitSelector").html(queryUnits))}))})),$(document).ready((function(){$(document).on("click",".abutters-zoom",(function(event){if(event.stopPropagation(),event.preventDefault(),"no"===sessionStorage.getItem("condos")){let whereClause=`OBJECTID = ${zoomToObjectID}`,query=noCondosLayer.createQuery();query.where=whereClause,query.returnGeometry=!0,query.returnHiddenFields=!0,query.outFields=["*"],noCondosLayer.queryFeatures(query).then((response=>{const geometryExtent=response.features[0].geometry.extent,center=geometryExtent.center,newExtent=geometryExtent.expand(3);view.goTo({target:center,extent:newExtent})}))}else{let whereClause=`OBJECTID = ${zoomToObjectID}`,query=CondosLayer.createQuery();query.where=whereClause,query.returnGeometry=!0,query.returnHiddenFields=!0,query.outFields=["*"],CondosLayer.queryFeatures(query).then((response=>{const geometryExtent=response.features[0].geometry.extent,center=geometryExtent.center,newExtent=geometryExtent.expand(3);view.goTo({target:center,extent:newExtent})}))}}))}));const buildAbuttersPanel=function(e,b){$("#abutters-title").html("Abutters");let locationMaillingAddress,locationUniqueId,locationGISLINK,locationOwner,locationCoOwner,locationMailZip,locationAddress,locationAddress2,locationMailCity,locationMailState,locationMBL,itemSelected=detailSelected;if(detailsChanged.isChanged)locationMaillingAddress=detailsChanged.item.attributes.Mailing_Address_1,locationUniqueId=detailsChanged.item.attributes.Uniqueid,locationGISLINK=detailsChanged.item.attributes.GIS_LINK,locationOwner=detailsChanged.item.attributes.Owner,locationMBL=detailsChanged.item.attributes.MBL,locationCoOwner=detailsChanged.item.attributes.Co_Owner,locationAddress=detailsChanged.item.attributes.Mailing_Address_1,locationAddress2=detailsChanged.item.attributes.Mailing_Address_2,locationMailCity=detailsChanged.item.attributes.Mailing_City,locationMailZip=detailsChanged.item.attributes.Mailing_Zip,locationMailState=detailsChanged.item.attributes.Mail_State;else{var matchedObject=firstList.find((function(item){return item.uniqueId===itemSelected[1]&&item.objectid===Number(itemSelected[0])||item.GIS_LINK===itemSelected[1]&&item.objectid===Number(itemSelected[0])}));locationMaillingAddress=void 0===matchedObject.mailingAddress?"":matchedObject.mailingAddress,locationUniqueId=void 0===matchedObject.uniqueId?"":matchedObject.uniqueId,locationGISLINK=void 0===matchedObject.GIS_LINK?"":matchedObject.GIS_LINK,locationOwner=void 0===matchedObject.owner?"":matchedObject.owner,locationCoOwner=void 0===matchedObject.coOwner?"":matchedObject.coOwner,locationAddress=void 0===matchedObject.mailingAddress?"":matchedObject.mailingAddress,locationAddress2=void 0===matchedObject.mailingAddress2?"":matchedObject.mailingAddress2,locationMailCity=void 0===matchedObject.Mailing_City?"":matchedObject.Mailing_City,locationMailState=void 0===matchedObject.Mail_State?"":matchedObject.Mail_State,locationMailZip=void 0===matchedObject.Mailing_Zip?"":matchedObject.Mailing_Zip,locationMBL=void 0===matchedObject.MBL?"":matchedObject.MBL}const abuttersDiv=document.getElementById("selected-feature"),listGroup=document.createElement("ul");listGroup.classList.add("row"),listGroup.classList.add("list-group");const listItem=document.createElement("li");let listItemHTML;listItem.classList.add("abutters-group-item","col-12"),listItemHTML=` ${locationOwner} ${locationCoOwner} <br> ${locationAddress} ${locationAddress2} <br> ${locationMailCity}, ${locationMailState} ${locationMailZip}`,listItem.innerHTML+=listItemHTML,listItem.setAttribute("data-id",locationGISLINK),$("#abutters-spinner").hide(),listGroup.appendChild(listItem),abuttersDiv.appendChild(listGroup)},runQuery=e=>{let features;firstList=[],document.getElementById("suggestions").innerHTML="",clickedToggle&&(runQuerySearchTerm=e);let searchTerm=runQuerySearchTerm;if(searchTerm.length<3||!searchTerm)clearContents();else{$("#dropdown").toggleClass("expanded"),$("#details-btns").hide(),$("#abut-mail").hide(),$("#result-btns").hide(),$("#backButton").hide(),$("#detailsButton").hide(),$("#featureWid").empty(),$("#exportSearch").hide(),$("#csvExportResults").hide(),$("#exportButtons").hide();let whereClause=`\n              Street_Name LIKE '%${searchTerm}%' OR \n              MBL LIKE '%${searchTerm}%' OR \n              Location LIKE '%${searchTerm}%' OR \n              Co_Owner LIKE '%${searchTerm}%' OR \n              Uniqueid LIKE '%${searchTerm}%' OR \n              Owner LIKE '%${searchTerm}%' OR\n              GIS_LINK LIKE '%${searchTerm}%'\n          `,query=noCondosTable.createQuery();query.where=whereClause,query.returnGeometry=!1,query.returnHiddenFields=!0,query.outFields=["*"],noCondosTable.queryFeatures(query).then((response=>{response.features.length>0&&(features=response.features,features.forEach((function(feature){if(""!==feature.attributes.Owner){let objectId=feature.attributes.OBJECTID,locationVal=feature.attributes.Location,locationUniqueId=feature.attributes.Uniqueid,locationGISLINK=feature.attributes.GIS_LINK,locationCoOwner=feature.attributes.Co_Owner,locationOwner=feature.attributes.Owner,locationMBL=feature.attributes.MBL,locationGeom=feature.geometry,mailingAddress=feature.attributes.Mailing_Address_1,mailingAddress2=feature.attributes.Mailing_Address_2,Mailing_City=feature.attributes.Mailing_City,Mail_State=feature.attributes.Mail_State,Mailing_Zip=feature.attributes.Mailing_Zip,Total_Acres=feature.attributes.Total_Acres,Parcel_Primary_Use=feature.attributes.Parcel_Primary_Use,Building_Use_Code=feature.attributes.Building_Use_Code,Parcel_Type=feature.attributes.Parcel_Type,Design_Type=feature.attributes.Design_Type,Zoning=feature.attributes.Zoning,Neighborhood=feature.attributes.Neighborhood,Land_Type_Rate=feature.attributes.Land_Type_Rate,Functional_Obs=feature.attributes.Functional_Obs,External_Obs=feature.attributes.External_Obs,Sale_Date=formatDate(feature.attributes.Sale_Date),Sale_Price=feature.attributes.Sale_Price,Vol_Page=feature.attributes.Vol_Page,Assessed_Total=feature.attributes.Assessed_Total,Appraised_Total=feature.attributes.Appraised_Total,Influence_Factor=feature.attributes.Influence_Factor,Influence_Type=feature.attributes.Influence_Type,Land_Type=feature.attributes.Land_Type,Prior_Assessment_Year=feature.attributes.Prior_Assessment_Year,Prior_Assessed_Total=feature.attributes.Prior_Assessed_Total,Prior_Appraised_Total=feature.attributes.Prior_Appraised_Total,Map=feature.attributes.Map,Lat=feature.attributes.Lat,Lon=feature.attributes.Lon;firstList.push(new Parcel(objectId,locationVal,locationUniqueId,locationGISLINK,locationCoOwner,locationOwner,locationMBL,locationGeom,mailingAddress,mailingAddress2,Mailing_City,Mail_State,Mailing_Zip,Total_Acres,Parcel_Primary_Use,Building_Use_Code,Parcel_Type,Design_Type,Zoning,Neighborhood,Land_Type_Rate,Functional_Obs,External_Obs,Sale_Date,Sale_Price,Vol_Page,Assessed_Total,Appraised_Total,Influence_Factor,Influence_Type,Land_Type,Prior_Assessment_Year,Prior_Assessed_Total,Prior_Appraised_Total,Map,Lat,Lon))}})),queryRelatedRecords(runQuerySearchTerm))})).catch((error=>{console.error("Error querying for details:",error)}))}};function triggerListGroup(results,searchTerm){let items=results;items.length<=0&&(clearContents(),alert("Search resulted in an error, please try again."));let parcel=items.filter((item=>item.attributes.Uniqueid===searchTerm)),itemId=parcel[0].attributes.Uniqueid,objectID=parcel[0].attributes.OBJECTID;parcel[0].attributes.geometry;zoomToFeature(objectID,0,itemId),$("#details-spinner").show(),$("#WelcomeBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportButtons").hide(),$("#exportSearch").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$(".center-container").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),document.getElementById("total-results").style.display="none",buildDetailsPanel(objectID,itemId),$("#total-results").hide(),$("#ResultDiv").hide()}const uniqueId=function(){const queryParams={},pairs=window.location.search.substring(1).split("&");for(let i=0;i<pairs.length;i++){const pair=pairs[i].split("=");pair[0]&&pair[1]&&(queryParams[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1].replace(/\+/g," ")))}return queryParams}().uniqueid;if(uniqueId){urlSearchUniqueId=!0;let urlSearch=!0;view.when((function(){console.log("The view is ready."),queryRelatedRecords(uniqueId,urlSearch)})).catch((function(error){console.error("Error occurred while the view was loading: ",error)}))}let debounceTimer2;document.getElementById("searchInput").addEventListener("input",(function(e){firstList=[],$("#sidebar2").css("left","-350px"),$("#sidebar2").removeClass("collapsed"),$("#results-div").css("left","0px"),$("#dropdown").toggleClass("expanded"),$("#dropdown").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide();var searchTerm=e.target.value.toUpperCase();firstList=[],secondList=[],polygonGraphics=[],$("#select-button").removeClass("btn-warning"),$("#searchInput ul").remove(),$("#suggestions").hide(),$("#featureWid").empty(),$("#featureWid").hide(),$("#ResultDiv").hide(),$("#dropdown").removeClass("expanded"),$("#dropdown").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#right-arrow-2").show(),$("#left-arrow-2").hide(),$("#abutters-content").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#backButton").hide(),$("#detailBox").hide(),$("#exportSearch").hide(),$("#csvExportSearch").hide(),$("#csvExportResults").hide(),$("#exportButtons").hide(),DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),clickHandle&&(clickHandle?.remove(),clickHandle=null),$("#dropdown").show(),$("#WelcomeBox").show(),$(".center-container").show(),document.getElementById("suggestions").innerHTML="",$("#featureWid").empty(),view.graphics.removeAll();let whereClause=`\n            Street_Name LIKE '%${searchTerm}%' OR \n            MBL LIKE '%${searchTerm}%' OR \n            Location LIKE '%${searchTerm}%' OR \n            Co_Owner LIKE '%${searchTerm}%' OR \n            Uniqueid LIKE '%${searchTerm}%' OR \n            Owner LIKE '%${searchTerm}%' OR\n            GIS_LINK LIKE '%${searchTerm}%'\n        `,query=noCondosTable.createQuery();query.where=whereClause,query.returnGeometry=!1,query.outFields=["Street_Name","MBL","Location","Co_Owner","Uniqueid","Owner","GIS_LINK"];let uniqueSuggestions=new Set;noCondosTable.queryFeatures(query).then((response=>{let suggestionsContainer=document.getElementById("suggestions");suggestionsContainer.innerHTML="",response.features.forEach((feature=>{["Street_Name","MBL","Location","Co_Owner","Uniqueid","Owner","GIS_LINK"].forEach((fieldName=>{let value=feature.attributes[fieldName];if(value&&value.includes(searchTerm)&&!uniqueSuggestions.has(value)){let suggestionDiv=document.createElement("div");suggestionDiv.className="list-group-item",suggestionDiv.innerText=`${value}`,suggestionsContainer.appendChild(suggestionDiv),uniqueSuggestions.add(value),suggestionsContainer.style.display="block",suggestionDiv.addEventListener("click",(function(e){clickedToggle=!0,runQuery(e.target.innerHTML),clickedToggle=!1}))}}))}))}))})),document.querySelector(".form-inline").addEventListener("submit",(function(e){"no"===sessionStorage.getItem("condos")?noCondosLayer.visible=!0:CondosLayer.visible=!0,firstList=[],view.graphics.removeAll(),polygonGraphics=[],e.preventDefault(),$("#featureWid").empty(),$("#selected-feature").empty(),DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),clickHandle&&(clickHandle?.remove(),clickHandle=null)})),document.addEventListener("click",(function(e){"searchInput"!==e.target.id&&(document.getElementById("suggestions").style.display="none")})),document.getElementById("searchButton").addEventListener("click",(function(){$("#sidebar2").css("left","-350px"),$("#sidebar2").removeClass("collapsed"),$("#results-div").css("left","0px"),$("#exportResults").hide(),$("#csvExportResults").hide(),clearTimeout(debounceTimer2),debounceTimer2=setTimeout((()=>{"no"===sessionStorage.getItem("condos")?noCondosLayer.visible=!0:CondosLayer.visible=!0,$("#lasso").removeClass("btn-warning"),$("#select-button").removeClass("btn-warning"),$("dropdown").empty(),$("#featureWid").empty(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#total-results").show(),$("#ResultDiv").hide(),$("#backButton").hide(),$("#detailsButton").hide(),$("#detailBox").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#abutters-title").html("Abutting Parcels (0)"),polygonGraphics=[],view.graphics.removeAll(),DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),clickHandle&&(clickHandle?.remove(),clickHandle=null),runQuery()}),300)})),$(document).ready((function(){let queryParameters={streetName:null,owner:null,appraisedValueMin:null,appraisedValueMax:null,assessedValueMin:null,assessedValueMax:null,zoningType:null,neighborhoodType:null,propertyType:null,buildingType:null,buildingUseType:null,designType:null,acresValueMin:null,acresValueMax:null,soldOnMin:null,soldOnMax:null,soldPMin:null,soldPMax:null};async function buildQueries(){let queryValues=[],queryFields=["Appraised_Total","Assessed_Total","Total_Acres","Sale_Date","Sale_Price"];for(let field of queryFields){let query=CondosTable.createQuery();query.outStatistics=[{statisticType:"max",onStatisticField:field,outStatisticFieldName:"maxValue"},{statisticType:"min",onStatisticField:field,outStatisticFieldName:"minValue"}];try{let valPair,response=await CondosTable.queryFeatures(query);if("Sale_Date"===field){let max=new Date(response.features[0].attributes.maxValue);valPair={[field]:{min:new Date(response.features[0].attributes.minValue),max:max}}}else{let max=response.features[0].attributes.maxValue;valPair={[field]:{min:response.features[0].attributes.minValue,max:max}}}queryValues.push(valPair)}catch(error){console.error("Error querying features:",error)}}var vals;vals=queryValues,[{fieldName:"Appraised_Total",minInput:"app-val-min",maxInput:"app-val-max",index:0},{fieldName:"Assessed_Total",minInput:"assess-val-min",maxInput:"assess-val-max",index:1},{fieldName:"Total_Acres",minInput:"acres-val-min",maxInput:"acres-val-max",index:2},{fieldName:"Sale_Date",minInput:"sold_calendar_lowest",maxInput:"sold_calendar_highest",index:3},{fieldName:"Sale_Price",minInput:"saleP-val-min",maxInput:"saleP-val-max",index:4}].forEach((function(slider){if("Sale_Date"==slider.fieldName){var minstr=vals[slider.index][slider.fieldName].min,maxstr=vals[slider.index][slider.fieldName].max;let dateL=new Date(minstr),dateM=new Date(maxstr),formattedDateL=`${dateL.getFullYear()}-${("0"+(dateL.getMonth()+1)).slice(-2)}-${("0"+dateL.getDate()).slice(-2)}`,formattedDateM=`${dateM.getFullYear()}-${("0"+(dateM.getMonth()+1)).slice(-2)}-${("0"+dateM.getDate()).slice(-2)}`;queryParameters.soldOnMin=formattedDateL,queryParameters.soldOnMax=formattedDateM}else{const sliderInputMin=document.getElementById(slider.minInput),sliderInputMax=document.getElementById(slider.maxInput),minVal=sliderInputMin.value=vals[slider.index][slider.fieldName].min,maxVal=sliderInputMax.value=vals[slider.index][slider.fieldName].max;let minStr,maxStr;"Total_Acres"!==slider.fieldName?(minStr="$"+minVal.toLocaleString(),maxStr="$"+maxVal.toLocaleString()):(minStr=minVal.toLocaleString(),maxStr=maxVal.toLocaleString()),sliderInputMin.value=minStr,sliderInputMax.value=maxStr}}))}$("#streetFilter").on("calciteComboboxChange",(function(e){queryParameters.streetName=e.target.value;$("#streetFilter")[0].selectedItems})),$("#ownerFilter").on("calciteComboboxChange",(function(e){queryParameters.owner=e.target.value})),$("#app-val-min, #app-val-max").on("input",(function(){var minValStr=$("#app-val-min").val(),maxValStr=$("#app-val-max").val();minValStr=minValStr.replace(/^\$/,"").replace(/,/g,""),maxValStr=maxValStr.replace(/^\$/,"").replace(/,/g,"");var minVal=parseInt(minValStr,10),maxVal=parseInt(maxValStr,10);if(!isNaN(minVal)&&!isNaN(maxVal)){var formattedMinVal=minVal.toLocaleString(),formattedMaxVal=maxVal.toLocaleString();$("#app-val-min").val("$"+formattedMinVal),$("#app-val-max").val("$"+formattedMaxVal),queryParameters.appraisedValueMin=minVal,queryParameters.appraisedValueMax=maxVal}})),$("#assess-val-min, #assess-val-max").on("input",(function(){var minValStr=$("#assess-val-min").val(),maxValStr=$("#assess-val-max").val();minValStr=minValStr.replace(/^\$/,"").replace(/,/g,""),maxValStr=maxValStr.replace(/^\$/,"").replace(/,/g,"");var minVal=parseInt(minValStr,10),maxVal=parseInt(maxValStr,10);if(isNaN(minVal)||isNaN(maxVal))console.log("Invalid input");else{var formattedMinVal=minVal.toLocaleString(),formattedMaxVal=maxVal.toLocaleString();$("#assess-val-min").val("$"+formattedMinVal),$("#assess-val-max").val("$"+formattedMaxVal),queryParameters.assessedValueMin=minVal,queryParameters.assessedValueMax=maxVal}})),$("#propertyFilter").on("calciteComboboxChange",(function(e){queryParameters.propertyType=e.target.value})),$("#zoningFilter").on("calciteComboboxChange",(function(e){queryParameters.zoningType=e.target.value})),$("#neighborhoodFilter").on("calciteComboboxChange",(function(e){queryParameters.neighborhoodType=e.target.value})),$("#buildingFilter").on("calciteComboboxChange",(function(e){queryParameters.buildingType=e.target.value})),$("#buildingUseFilter").on("calciteComboboxChange",(function(e){queryParameters.buildingUseType=e.target.value})),$("#designTypeFilter").on("calciteComboboxChange",(function(e){queryParameters.designType=e.target.value})),$("#acres-val-min, #acres-val-max").on("input",(function(){var minVal=parseInt($("#acres-val-min").val()),maxVal=parseInt($("#acres-val-max").val());queryParameters.acresValueMin=minVal,queryParameters.acresValueMax=maxVal})),$("#sold_calendar_lowest").on("calciteDatePickerChange",(function(){var dateValue=$("#sold_calendar_lowest").val();queryParameters.soldOnMin=dateValue})),$("#sold_calendar_highest").on("calciteDatePickerChange",(function(){var dateValue=$("#sold_calendar_highest").val();queryParameters.soldOnMax=dateValue})),$("#saleP-val-min, #saleP-val-max").on("input",(function(){var minValStr=$("#saleP-val-min").val(),maxValStr=$("#saleP-val-max").val();minValStr=minValStr.replace(/^\$/,"").replace(/,/g,""),maxValStr=maxValStr.replace(/^\$/,"").replace(/,/g,"");var minVal=parseInt(minValStr,10),maxVal=parseInt(maxValStr,10);if(isNaN(minVal)||isNaN(maxVal))console.log("Invalid input");else{var formattedMinVal=minVal.toLocaleString(),formattedMaxVal=maxVal.toLocaleString();$("#saleP-val-min").val("$"+formattedMinVal),$("#saleP-val-max").val("$"+formattedMaxVal),queryParameters.soldPMin=minVal,queryParameters.soldPMax=maxVal}})),buildQueries(),$("#submitFilter").on("click",(function(){!function(){console.log(queryParameters);let queryParts=[];if(null!==queryParameters.streetName&&queryParameters.streetName.length>1)if(Array.isArray(queryParameters.streetName)){const streetNameParts=queryParameters.streetName.map((name=>`Street_Name LIKE '%${name.trim()}%'`));queryParts.push(`(${streetNameParts.join(" OR ")})`)}else queryParts.push(`(Street_Name LIKE '%${queryParameters.streetName.trim()}%')`);if(null!==queryParameters.owner&&queryParameters.owner.length>1)if(Array.isArray(queryParameters.owner)){const ownerParts=queryParameters.owner.map((name=>`Owner LIKE '%${name.trim()}%'`));queryParts.push(`(${ownerParts.join(" OR ")})`)}else queryParts.push(`(Owner LIKE '%${queryParameters.owner.trim()}%')`);if(null!==queryParameters.appraisedValueMin&&null!==queryParameters.appraisedValueMax&&queryParts.push(`Appraised_Total BETWEEN ${queryParameters.appraisedValueMin} AND ${queryParameters.appraisedValueMax}`),null!==queryParameters.assessedValueMin&&null!==queryParameters.assessedValueMax&&queryParts.push(`Assessed_Total BETWEEN ${queryParameters.assessedValueMin} AND ${queryParameters.assessedValueMax}`),null!==queryParameters.propertyType&&queryParameters.propertyType.length>1)if(Array.isArray(queryParameters.propertyType)){const PropertyParts=queryParameters.propertyType.map((name=>`Parcel_Type LIKE '%${name.trim()}%'`));queryParts.push(`(${PropertyParts.join(" OR ")})`)}else queryParts.push(`(Parcel_Type LIKE '%${queryParameters.propertyType.trim()}%')`);if(null!==queryParameters.zoningType&&queryParameters.zoningType.length>1)if(Array.isArray(queryParameters.zoningType)){const PropertyParts=queryParameters.zoningType.map((name=>`Zoning LIKE '%${name.trim()}%'`));queryParts.push(`(${PropertyParts.join(" OR ")})`)}else queryParts.push(`(Zoning LIKE '%${queryParameters.zoningType.trim()}%')`);if(null!==queryParameters.neighborhoodType&&queryParameters.neighborhoodType.length>1)if(Array.isArray(queryParameters.neighborhoodType)){const PropertyParts=queryParameters.neighborhoodType.map((name=>`Neighborhood LIKE '%${name.trim()}%'`));queryParts.push(`(${PropertyParts.join(" OR ")})`)}else queryParts.push(`(Neighborhood LIKE '%${queryParameters.neighborhoodType.trim()}%')`);if(null!==queryParameters.buildingType&&queryParameters.buildingType.length>1)if(Array.isArray(queryParameters.buildingType)){const BuildingParts=queryParameters.buildingType.map((name=>`Building_Type LIKE '%${name.trim()}%'`));queryParts.push(`(${BuildingParts.join(" OR ")})`)}else queryParts.push(`(Building_Type LIKE '%${queryParameters.buildingType.trim()}%')`);if(null!==queryParameters.buildingUseType&&queryParameters.buildingUseType.length>1)if(Array.isArray(queryParameters.buildingUseType)){const BuildingUseParts=queryParameters.buildingUseType.map((name=>`Building_Use_Type LIKE '%${name.trim()}%'`));queryParts.push(`(${BuildingUseParts.join(" OR ")})`)}else queryParts.push(`(Building_Use_Type LIKE '%${queryParameters.buildingUseType.trim()}%')`);if(null!==queryParameters.designType&&queryParameters.designType.length>1)if(Array.isArray(queryParameters.designType)){const DesignParts=queryParameters.designType.map((name=>`Design_Type LIKE '%${name.trim()}%'`));queryParts.push(`(${DesignParts.join(" OR ")})`)}else queryParts.push(`(Design_Type LIKE '%${queryParameters.designType.trim()}%')`);null!==queryParameters.acresValueMin&&null!==queryParameters.acresValueMax&&queryParts.push(`Total_Acres BETWEEN ${queryParameters.acresValueMin} AND ${queryParameters.acresValueMax}`),null!==queryParameters.soldOnMin&&null!==queryParameters.soldOnMax&&queryParts.push(`Sale_Date >= '${queryParameters.soldOnMin}' AND Sale_Date <= '${queryParameters.soldOnMax}'`),null!==queryParameters.soldPMin&&null!==queryParameters.soldPMax&&queryParts.push(`Sale_Price BETWEEN ${queryParameters.soldPMin} AND ${queryParameters.soldPMax}`);let queryString=queryParts.join(" AND ");if("no"===sessionStorage.getItem("condos")){let query=noCondosLayer.createQuery();query.where=queryString,query.returnDistinctValues=!1,query.returnGeometry=!0,query.outFields=["*"],noCondosLayer.queryFeatures(query).then((function(response){clearContents(),addPolygons(response,view.graphics),processFeatures(response.features),clickHandle&&(clickHandle?.remove(),clickHandle=null),DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),DetailsHandle=view.on("click",handleDetailsClick)}))}else{let query=CondosLayer.createQuery();query.where=queryString,query.returnDistinctValues=!1,query.returnGeometry=!0,query.outFields=["*"],CondosLayer.queryFeatures(query).then((function(response){clearContents(),addPolygons(response,view.graphics),processFeatures(response.features),clickHandle&&(clickHandle?.remove(),clickHandle=null),DetailsHandle&&(DetailsHandle?.remove(),DetailsHandle=null),DetailsHandle=view.on("click",handleDetailsClick)}))}}()})),$("#clearFilter").on("click",(function(){!function(){$("#lasso").removeClass("btn-warning"),$("#searchInput ul").remove(),$("#searchInput").val="",document.getElementById("searchInput").value="",runQuerySearchTerm="",searchTerm="",firstList=[],secondList=[],$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#dropdown").hide(),$("#right-arrow-2").show(),$("#left-arrow-2").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#backButton").show(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportSearch").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#featureWid").hide(),$("#exportButtons").hide(),$("#dropdown").show(),$("#WelcomeBox").hide(),$("#select-button").attr("title","Add to Selection Enabled"),document.getElementById("suggestions").innerHTML="",$("#distanceButton").removeClass("btn-warning"),$("#distanceButton").addClass("bg-info"),$("#areaButton").removeClass("btn-warning"),$("#distanceButton").addClass("bg-info"),$("#featureWid").empty(),view.ui.remove(activeWidget1),activeWidget1&&(activeWidget1.destroy(),activeWidget1=null),view.graphics.removeAll(),polygonGraphics=[],Object.keys(queryParameters).forEach((key=>{queryParameters[key]=null}));const combobox1ID=document.querySelector("#streetFilter"),combobox2ID=document.querySelector("#ownerFilter"),combobox3ID=document.querySelector("#propertyFilter"),combobox4ID=document.querySelector("#buildingFilter"),combobox5ID=document.querySelector("#buildingUseFilter"),combobox6ID=document.querySelector("#designTypeFilter"),combobox7ID=document.querySelector("#zoningFilter"),combobox8ID=document.querySelector("#neighborhoodFilter"),soldOnLowest=document.querySelector("#sold_calendar_lowest"),soldOnHighest=document.querySelector("#sold_calendar_highest");combobox1ID.selectedItems=[],combobox2ID.selectedItems=[],combobox3ID.selectedItems=[],combobox4ID.selectedItems=[],combobox5ID.selectedItems=[],combobox6ID.selectedItems=[],combobox7ID.selectedItems=[],combobox8ID.selectedItems=[],combobox1ID.filteredItems.forEach((item=>{item.active=!1,item.selected=!1})),combobox2ID.filteredItems.forEach((item=>{item.active=!1,item.selected=!1})),combobox3ID.filteredItems.forEach((item=>{item.active=!1,item.selected=!1})),combobox4ID.filteredItems.forEach((item=>{item.active=!1,item.selected=!1})),combobox5ID.filteredItems.forEach((item=>{item.active=!1,item.selected=!1})),combobox6ID.filteredItems.forEach((item=>{item.active=!1,item.selected=!1})),combobox7ID.filteredItems.forEach((item=>{item.active=!1,item.selected=!1})),combobox8ID.filteredItems.forEach((item=>{item.active=!1,item.selected=!1})),combobox1ID.value="",combobox2ID.value="",combobox3ID.value="",combobox4ID.value="",combobox5ID.value="",combobox6ID.value="",combobox7ID.value="",combobox8ID.value="",soldOnLowest.value="",soldOnHighest.value="",soldOnLowest.activeDate=null,soldOnHighest.activeDate=null,buildQueries(),$(".wrapper .x-button").click(),$("#streetFilter").value=""}()}))})),$(document).ready((function(){$("#side-Exp").on("click",(function(){$("#sidebar").toggleClass("collapsed"),$("#sidebar").hasClass("collapsed")?($("#small-div").css("right","0px"),$("#right-arrow").hide(),$("#left-arrow").show()):($("#small-div").css("right","250px"),$("#left-arrow").hide(),$("#right-arrow").show())}))})),$(document).ready((function(){$("#Basemap-selector").on("click",(function(){$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#AddDataDiv").hide(),$("#ContactDiv").hide(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#Right-Btn-div").show(),$("#BasemapDiv").show(),$("#group-container-right").show()})),$("#Bookmarks-selector").on("click",(function(){$("#rightPanel").hide(),$("#BasemapDiv").hide(),$("#AddDataDiv").hide(),$("#ContactDiv").hide(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#Right-Btn-div").show(),$("#BookmarksDiv").show(),$("#group-container-right").show()})),$("#Contact-selector").on("click",(function(){$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#AddDataDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#PrintDiv").hide(),$("#Right-Btn-div").show(),$("#ContactDiv").show(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#group-container-right").show()})),$("#addData-selector").on("click",(function(){$(document).keypress((function(event){"Enter"===event.key&&event.preventDefault()})),$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#PrintDiv").hide(),$("#ContactDiv").hide(),$("#Right-Btn-div").show(),$("#AddDataDiv").show(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#group-container-right").show()})),$("#Legend-selector").on("click",(function(){$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#PrintDiv").hide(),$("#ContactDiv").hide(),$("#Right-Btn-div").show(),$("#AddDataDiv").hide(),$("#PrintDiv").hide(),$("#LegendDiv").show(),$("#group-container-right").show()})),$("#right-btn-back").on("click",(function(){$("#group-container-right").hide(),$("#PrintDiv").hide(),$("#AddDataDiv").hide(),$("#BookmarksDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#ContactDiv").hide(),$("#LegendDiv").hide(),$("#rightPanel").show()}))}));var scaleMapping={240:"1 inch = 20 feet",600:"1 inch = 50 feet",1200:"1 inch = 100 feet",2400:"1 inch = 200 feet",6e3:"1 inch = 500 feet",9600:"1 inch = 800 feet",18e3:"1 inch = 1500 feet",36e3:"1 inch = 3000 feet",72e3:"1 inch = 6000 feet",144e3:"1 inch = 12000 feet"},scaleDropdown=document.getElementById("scale-dropdown");document.querySelectorAll(".scale-select").forEach((function(button){button.addEventListener("click",(function(event){var selectedScale=parseInt(event.target.value),selectedText=event.target.innerHTML;selectedScale&&(view.scale=selectedScale),$("#scale-value").val(selectedScale).html(selectedText)}))})),view.ui.add(scaleDropdown,{position:"bottom-left"});reactiveUtils.watch((()=>[view.stationary,view.scale]),(([stationary,scale])=>{stationary&&(console.log(`Change in scale level: ${scale}`),function(scale){var roundedScale=Math.round(scale),scaleText=function(scale){var closestScale=Object.keys(scaleMapping).reduce((function(prev,curr){return Math.abs(curr-scale)<Math.abs(prev-scale)?curr:prev}));return scaleMapping[closestScale]}(roundedScale);scaleText&&$("#scale-value").val(roundedScale).html(scaleText)}(scale))}));function clickRefreshButton(){var refreshButton=document.querySelector(".esri-widget--button.esri-print__refresh-button.esri-icon-refresh");refreshButton&&refreshButton.click()}$(document).ready((function(){$("#popoverButton").popover({trigger:"hover"})})),$(document).ready((function(){$("#lasso").popover({trigger:"hover"})})),$(document).ready((function(){$("#select-button").popover({trigger:"hover"})})),$(document).ready((function(){$("#clear-btn1").popover({trigger:"hover"})})),$(document).ready((function(){$("#filterButton").popover({trigger:"hover"})})),$(document).ready((function(){$("#layerListBtn").popover({trigger:"hover"})})),$(document).ready((function(){$("#abutters-attributes").popover({trigger:"hover"})})),$(document).ready((function(){$("#abutters-zoom").popover({trigger:"hover"})})),$(document).ready((function(){$("#distanceButton").popover({trigger:"hover"})})),$(document).ready((function(){$("#areaButton").popover({trigger:"hover"})})),view.watch("zoom",(function(newValue,oldValue){newValue!==oldValue&&clickRefreshButton()})),view.watch("center",(function(newValue,oldValue){newValue!==oldValue&&clickRefreshButton()})),$(document).ready((function(){$("#side-Exp2").on("click",(function(){$("#sidebar2").hasClass("collapsed")?($("#results-div").css("left","0px"),$("#sidebar2").css("left","-350px"),$("#right-arrow-2").show(),$("#left-arrow-2").hide()):($("#results-div").css("left","350px"),$("#sidebar2").css("left","0px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide()),$("#sidebar2").toggleClass("collapsed")}))}))}))}));
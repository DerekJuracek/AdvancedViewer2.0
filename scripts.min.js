// @ts-nocheck
require(["esri/WebMap","esri/views/MapView","esri/layers/FeatureLayer","esri/layers/ImageryLayer","esri/layers/MapImageLayer","esri/core/reactiveUtils","esri/Graphic","esri/geometry/geometryEngine","esri/layers/GraphicsLayer","esri/widgets/Sketch/SketchViewModel","esri/widgets/DistanceMeasurement2D","esri/widgets/AreaMeasurement2D","esri/widgets/BasemapLayerList","esri/widgets/Bookmarks","esri/widgets/Legend","esri/widgets/Print","esri/layers/support/TileInfo","esri/geometry/Extent","esri/rest/support/PrintTemplate","esri/rest/support/PrintParameters","esri/widgets/Print/PrintViewModel","esri/widgets/Print/TemplateOptions"],(function(e,t,n,i,a,r,s,o,l,d,c,u,p,m,h,g,f,y,b,v,w,x){const _=new URLSearchParams(window.location.search);let T=window.location.href,I=_.get("viewer");let L=["colebrookct","columbiact","durhamct","haddamct","northcanaanct","roxburyct","roxburyctassessor","scotlandct","warrenct","warrenctassessor","washingtonct","wiltonct","wolcottct"].join("|"),S=new RegExp(`\\?viewer=cama\\/(${L})(\\&\\w+=\\w+)*$`);null!=I&&S.test(T)?(I+=".json",$("#whole-app").show()):"https://terrenogis.com"===window.location.href||"https://terrenogis.com/"===window.location.href?window.location.href="https://www.qds.biz/gis-service":window.location.href="./onload.html";const M={mapId:"",condoLayer:"",title:"",isCondosLayer:"",noCondoLayer:""};fetch(I).then((e=>e.json())).then((f=>{f.layers;function y(e){var t=new Date(e),n=t.getDate();return t.getMonth()+1+"/"+n+"/"+t.getFullYear()}M.mapId=f.webmapId||"6448b08504de4244973a28305b18271f",M.condoLayer=f.condoLayer,M.noCondoLayer=f.noCondoLayer,M.title=f.title,M.isCondosLayer=f.condos,M.masterTable=f.masterTable,M.zoom=f.zoom,M.parcelZoom=f.parcelZoom,M.imageUrl=f.imageUrl,M.welcomeImage=f.welcomeImage,M.pdf_Image=f.pdf_Image,M.pdf_demo=f.pdf_demographics,M.taxMap_Url=f.taxMapUrl,M.parcelMapUrl=f.parcelMapUrl,M.housingUrl=f.housingUrl,M.propertyCardPdf=f.propertyCardPdf,M.propertyCard=f.propertyCard,M.tax_bill=f.tax_bill,M.useVisionForTaxBillUrl=f.useVisionForTaxBillUrl,M.accessorName=f.accessorName,M.parcelTitle=f.parcelServiceTitle,M.tabTitle=f.tabTitle,M.basemapTitle=f.basemapTitle,M.parcelRenderer=f.parcelRenderer,M.useUniqueIdforParcelMap=f.useUniqueIdforParcelMap,M.helpUrl=f.helpUrl,M.includeFilter=f.includeFilter,M.customWelcomePage=f.customWelcomePage,M.customWelcomeMessage=f.customWelcomeMessage,M.showDisclaimer=f.showDisclaimer,M.customDisclaimerPage=f.customDisclaimerPage,M.customDisclaimerMessage=f.customDisclaimerMessage,M.DetailLinks=f.DetailLinks,M.DetailLinksToInclude=f.DetailLinksToInclude,M.includePermitLink=f.includePermitLink,M.scale=f.scale,"no"===M.showDisclaimer&&(sessionStorage.setItem("agreedToDisclaimer","yes"),$("#starterModal").modal("hide")),"yes"===M.customWelcomePage&&(document.getElementById("welcomeMessage").innerHTML=M.customWelcomeMessage),"yes"===M.customDisclaimerPage&&(document.getElementById("disclaimer-text").innerHTML=M.customDisclaimerMessage),"yes"===M.includePermitLink&&(M.permitLink=f.permitLink),document.getElementById("AccessorName").innerHTML=f.accessorName,$(".help-url").attr("href",M.helpUrl),document.getElementById("title").innerHTML=M.title,document.getElementById("print-title").innerHTML=M.title,document.getElementById("imageContainer").src=M.welcomeImage,document.getElementById("print-image").src=M.welcomeImage,document.getElementById("tab-title").innerHTML=M.tabTitle;const b="No geometry";sessionStorage.setItem("condos",M.isCondosLayer);const v=new l,w=new l,_=new e({portalItem:{id:M.mapId},layers:[v]});var T=new t({container:"viewDiv",map:_,units:"imperial",scale:M.scale,popupEnabled:!1,ui:{components:["attribution"]}});T.when((()=>{M.homeExtent=T.extent})),"no"===M.includeFilter&&$("#filterButton").remove(),T.when((()=>{"yes"==sessionStorage.getItem("agreedToDisclaimer")||1==L?$("#starterModal").modal("hide"):$("#starterModal").modal("show"),$(document).ready((function(){$("#agreeBtn").prop("disabled",!0),$("#agreeCheck").change((function(){$(this).is(":checked")?($("#agreeBtn").prop("disabled",!1),sessionStorage.setItem("agreedToDisclaimer","yes")):$("#agreeBtn").prop("disabled",!0)}))}))})),T.when((()=>{document.getElementById("urlButton").addEventListener("click",(function(e){let t=urlInput.value;t.length>0&&function(){let e=new n({url:`${t}`});e.load().then((()=>{_.add(e),$("#urlMessage").html('<strong><p style="color:green;">Successfully uploaded REST Service.</p></strong>'),_.layers.on("change",(function(e){console.log(e," layer was added/removed from the map.")}));var t=$("#layerList");we(e,t),urlInput.value=""})).catch((e=>{$("#urlMessage").html('<strong><p style="color:red;">Error uploading REST Service.</p></strong>'),console.error("Error loading the FeatureLayer:",e)}))}()}))})),T.when((()=>{document.getElementById("urlButtonImagery").addEventListener("click",(function(e){let t=urlInputImagery.value;t.length>0&&function(){let e=new i({url:`${t}`});e.load().then((()=>{_.add(e),$("#urlMessageImagery").html('<strong><p style="color:green;">Successfully uploaded REST Service.</p></strong>'),_.layers.on("change",(function(e){console.log(e," layer was added/removed from the map.")}));var t=$("#layerList");we(e,t),urlInput.value=""})).catch((e=>{$("#urlMessageImagery").html('<strong><p style="color:red;">Error uploading REST Service.</p></strong>'),console.error("Error loading the FeatureLayer:",e)}))}()}))})),T.when((()=>{document.getElementById("urlButtonMapService").addEventListener("click",(function(e){let t=urlInputMapService.value;t.length>0&&function(){let e=new a({url:`${t}`});e.load().then((()=>{_.add(e),$("#urlMessageMapService").html('<strong><p style="color:green;">Successfully uploaded REST Service.</p></strong>'),_.layers.on("change",(function(e){console.log(e," layer was added/removed from the map.")}));var t=$("#layerList");we(e,t),urlInput.value=""})).catch((e=>{$("#urlMessageMapService").html('<strong><p style="color:red;">Error uploading REST Service.</p></strong>'),console.error("Error loading the FeatureLayer:",e)}))}()}))})),T.when((()=>{const e=_.layers.items.filter((e=>!("group"===e.type&&e.title&&"hidden group"===e.title.toLowerCase()||e.title&&e.title===`${M.parcelTitle}`)));new h({view:T,container:$("#LegendDiv")[0],layerInfos:e.map((e=>({layer:e})))})})),T.when((()=>{new m({view:T,container:$("#BookmarksDiv")[0],dragEnabled:!0})}));new x({title:"Print Map at Scale 1:1200",layout:"a4-portrait",scale:1200,scaleEnabled:!0,dpi:96,legendEnabled:!0,northArrowEnabled:!0}),new x({title:"Print Map at Scale 1:2400",layout:"a4-portrait",scale:2400,scaleEnabled:!0,dpi:96,legendEnabled:!0,northArrowEnabled:!0});T.when((()=>{new g({view:T,container:$("#PrintDiv")[0],templateOptions:{title:"Print Map at Scale 1:1200",layout:"a4-portrait",scale:1200,scaleEnabled:!0,dpi:96,legendEnabled:!0,northArrowEnabled:!0},allowedLayouts:["letter-ansi-a-landscape","letter-ansi-a-portrait","tabloid-ansi-b-landscape","tabloid-ansi-b-portrait","a3-landscape","a3-portrait","a4-landscape","a4-portrait"]})})),T.when((()=>{let e;new p({view:T,container:$("#BasemapDiv")[0],dragEnabled:!0}).visibleElements={statusIndicators:!0,baseLayers:!0,referenceLayers:!1,referenceLayersTitle:!1,errors:!0,heading:!1};let t={type:"simple",symbol:{type:"simple-fill",color:[255,255,255,0],outline:{width:1,color:`${M.parcelRenderer}`}}},n={type:"simple",symbol:{type:"simple-fill",color:[255,255,255,0],outline:{width:1,color:"#897044"}}};T.map.allLayers.forEach((t=>{"Parcel Boundaries"===t.title&&(e=t.renderer)}));const i=["Aerial-Ortho 2023","Aerial-Ortho 2019","Aerial-Ortho 2016","Aerial-Ortho 2012"];T.map.allLayers.some((e=>i.includes(e.title)&&e.visible))&&T.map.allLayers.forEach((e=>{"Parcel Boundaries"===e.title&&(e.renderer=t)})),e="yes"===sessionStorage.getItem("condos")?ye.renderer:$e.renderer;const a={};T.map.basemap.baseLayers.forEach((e=>{a[e.id]=e.visible})),r.watch((()=>T.map.basemap.baseLayers.map((e=>e.visible))),(()=>{console.log("Visibility changed:",T.map.basemap.baseLayers.map((e=>({title:e.title,visible:e.visible})))),function(e,i){let a=e.find((e=>e.visible&&!i[e.id]));if(a)console.log(`Newly visible layer: ${a.title}`),e.forEach((e=>{e!==a&&(e.visible=!1)})),a.title!==`${M.basemapTitle}`&&"Washington Basemap"!==a.title?"yes"===sessionStorage.getItem("condos")?ye.renderer=t:$e.renderer=t:T.map.allLayers.forEach((e=>{"Parcel Boundaries"===e.title&&(e.renderer=n)}));else{0===e.filter((e=>e.visible)).length&&e.forEach((e=>{e.visible=i[e.id]}))}e.forEach((e=>{i[e.id]=e.visible})),console.log("Updated visibility tracker:",e.map((e=>({title:e.title,wasVisible:i[e.id]}))))}(T.map.basemap.baseLayers,a)}))})),_.add(w);let I,L,S,B,E,C,P,D,k,A,F,N,O,R,U=!1,q=!1,V=!1,z=!1,G=[],K=[],j="feet",H=!1,Z=!1,W=!1,Q={isChanged:!1,item:""},J=!1,Y=document.getElementById("buffer-value");const X=document.getElementById("clear-btn1"),ee=document.getElementById("clear-btn2");let te,ne,ie,ae,re,se,oe,le,de,ce=T.extent,ue=T.scale,pe=T.zoom;r.watch((()=>[T.zoom,T.extent,T.scale]),(([e,t,n],[i])=>{if(e){if(e!==pe&&(pe=e),!$e.visible&&!ye.visible&&Number(e)>M.parcelZoom){if("no"===sessionStorage.getItem("condos")?$e.visible=!0:ye.visible=!0,O&&(O?.remove(),O=null),R&&(R?.remove(),R=null),"click"==te||"details"==te||"none yet"==te)return void $("#select-button").removeClass("btn-warning");R=T.on("click",Ke),$("#lasso").removeClass("btn-warning"),$("#select-button").addClass("btn-warning"),Z=!0}}else i&&(ce=t,ue=n,pe=e);return""}));let me=document.getElementById("topbar");T.ui.add(me,"bottom-right");let he=null;function ge(e){switch(e){case"distance":if(he=new c({view:T,unit:"feet"}),he.viewModel.start(),O||R||(te="none yet"),O)try{te="details",O?.remove(),O=null}catch(e){console.error("Failed to remove DetailsHandle",e)}if(R)try{te="click",R.remove()}catch(e){console.error("Failed to remove DetailsHandle",e)}he&&he.viewModel&&he.viewModel.watch("state",(function(e){"measured"===e&&("click"==te?R=T.on("click",Ke):"details"==te&&(O=T.on("click",Ge)))})),T.ui.add(he,"bottom-right"),fe(document.getElementById("distanceButton"));break;case"area":if(he=new u({view:T,unit:"acres"}),he.viewModel.start(),O||R||(te="none yet"),O)try{te="details",O?.remove(),O=null}catch(e){console.error("Failed to remove DetailsHandle",e)}if(R)try{te="click",R?.remove(),R=null}catch(e){console.error("Failed to remove DetailsHandle",e)}he&&he.viewModel&&he.viewModel.watch("state",(function(e){"measured"===e&&("click"==te?R=T.on("click",Ke):"details"==te&&(O=T.on("click",Ge)))})),T.ui.add(he,"bottom-right"),fe(document.getElementById("areaButton"));break;case null:he&&(T.ui.remove(he),he.destroy(),he=null)}}function fe(e){T.focus();let t=Array.from(document.getElementsByClassName("active"));for(let e=0;e<t.length;e++)t[e].classList.remove("active","btn-warning");e&&(e.classList.add("active","btn-warning"),e.classList.remove("bg-info"))}document.getElementById("distanceButton").addEventListener("click",(function(){ge(null),this.classList.contains("active")?fe(null):ge("distance")})),document.getElementById("areaButton").addEventListener("click",(function(){ge(null),this.classList.contains("active")?fe(null):ge("area")}));let $e=new n({url:`${M.noCondoLayer}`,visible:!1,popupEnabled:!0,title:"Parcel Boundaries",id:"noCondoLayer"}),ye=new n({url:`${M.condoLayer}`,visible:!1,popupEnabled:!0,title:"Parcel Boundaries",id:"condoLayer"});const be=new n({url:`${M.masterTable}`}),ve=new n({url:`${M.masterTable}`});function we(e,t){let n;if(n="yes"===sessionStorage.getItem("condos")?"noCondoLayer":"condoLayer","graphics"!==e.type&&"Tax Map Annotation"!=e.title&&"Road Centerline"!=e.title&&null!=e.title&&""!=e.title&&e.id!=n){var i;i=e.visible?"check-square":"square";var a=$(`\n          <calcite-list-item scale="m" label="${e.title}" value="${e.id}" style="border: white 0.5px solid;">\n          <calcite-action class="toggle-slider" id="action-${e.id}-dropdown" slot="actions-end" icon="sliders-horizontal" text="${e.title}"></calcite-action>\n            <calcite-action class="layer-vis" id="action-${e.id}" slot="actions-end" icon="${i}" text="${e.title}"></calcite-action>\n            <div id="opacityDiv-${e.id}" class="esri-slider esri-widget esri-slider--horizontal opacity-div " touch-action="none" style="display: none; height: 45px; align-items: center; padding-bottom: 10px; padding-left: 10px;">\n              <label style="margin-right: 10px; padding-top: 20px; font-weight: 500;font-size: 12px;">Layer Opacity (%)</label>\n              <calcite-slider class="slider-opacity" id="${e.id}" style="width: 50%;" value="100" label-handles max-label="100" max-value="100" min-label="0"></calcite-slider>\n              </calcite-slider>\n            </div>\n          </calcite-list-item>\n      `);t.append(a)}}function xe(e,t){e.forEach((function(e){if("group"===e.type){if(e.title&&"hidden group"===e.title.toLowerCase())return;var n=e.title||"Industry",i=$(`\n              <calcite-accordion scale="m">\n                <calcite-accordion-item heading="${n}">\n                </calcite-accordion-item>\n              </calcite-accordion>`);xe(e.layers.items,i.find("calcite-accordion-item")),t.append(i)}else we(e,t)}))}function _e(e){re=e}function Te(e){const t=$(e);"CALCITE-COMBOBOX"===t[0].tagName?(t[0].open=!1,t[0].disabled=!0,t[0].placeholder="Loading..."):"CALCITE-INPUT-TEXT"===t[0].tagName?(t[0].loading=!0,t[0].disabled=!0,t[0].placeholder="Loading..."):"CALCITE-DATE-PICKER"===t[0].tagName&&(t[0].disabled=!0)}function Ie(e,t){const n=$(e);"CALCITE-COMBOBOX"===n[0].tagName?(n[0].disabled=!1,n[0].placeholder=`${t}`):"CALCITE-INPUT-TEXT"===n[0].tagName?(n[0].disabled=!1,n[0].loading=!1,n[0].placeholder=`${t}`):"CALCITE-DATE-PICKER"===n[0].tagName&&(n[0].disabled=!1)}_.add($e),_.add(ye),document.getElementById("clearMeasurement").addEventListener("click",(function(){he&&he.viewModel&&(R&&(R.remove(),R=null),O&&(O.remove(),O=null),he.viewModel.clear(),he.viewModel.start())})),le=[{layer:ye,field:"Appraised_Total",filterSelector:"#app-val-min",filterSelector2:"#app-val-max"},{layer:ye,field:"Assessed_Total",filterSelector:"#assess-val-min",filterSelector2:"#assess-val-max"},{layer:ye,field:"Total_Acres",filterSelector:"#acres-val-min",filterSelector2:"#acres-val-max"},{layer:ye,field:"Sale_Date",filterSelector:"#sold_calendar_lowest",filterSelector2:"#sold_calendar_highest"},{layer:ye,field:"Sale_Price",filterSelector:"#saleP-val-min",filterSelector2:"#saleP-val-max"}],oe=[{layer:ye,field:"Street_Name",filterSelector:"#streetFilter",alias:"Street_Name",message:"Select a Street Name"},{layer:ye,field:"Owner",filterSelector:"#ownerFilter",message:"Select a Owner"},{layer:ye,field:"Parcel_Type",filterSelector:"#propertyFilter",alias:"Parcel_Type",message:"Select a Property Type"},{layer:ye,field:"Building_Type",filterSelector:"#buildingFilter",message:"Select a Building Type"},{layer:ye,field:"Building_Use_Code",filterSelector:"#buildingUseFilter",message:"Select a Building Use Type"},{layer:ye,field:"Design_Type",filterSelector:"#designTypeFilter",message:"Select a Design Type"},{layer:ye,field:"Zoning",filterSelector:"#zoningFilter",message:"Select a Zone"},{layer:ye,field:"Neighborhood",filterSelector:"#neighborhoodFilter",message:"Select a Neighborhood"}],de=[{layer:ye,field:"Appraised_Total",filterSelector:"#streetFilter",minInput:"app-val-min",maxInput:"app-val-max",minValField:"appraisedValueMin",maxValueField:"appraisedValueMax",index:0},{layer:ye,field:"Assessed_Total",filterSelector:"#ownerFilter",minInput:"assess-val-min",maxInput:"assess-val-max",minValField:"assessedValueMin",maxValueField:"assessedValueMax",index:1},{layer:ye,field:"Total_Acres",filterSelector:"#propertyFilter",minInput:"acres-val-min",maxInput:"acres-val-max",minValField:"acresValueMin",maxValueField:"acresValueMax",index:2},{layer:ye,field:"Sale_Date",filterSelector:"#buildingFilter",minInput:"sold_calendar_lowest",maxInput:"sold_calendar_highest",minValField:"soldOnMin",maxValueField:"soldOnMax",index:3},{layer:ye,field:"Sale_Price",filterSelector:"#buildingUseFilter",minInput:"saleP-val-min",maxInput:"saleP-val-max",minValField:"soldPMin",maxValueField:"soldPMax",index:4}],T.when((function(){let e;e="yes"===sessionStorage.getItem("condos")?"condoLayer":"noCondoLayer";var t=_.layers.find((t=>t.id===e));r.watch((()=>t.visible),(()=>{let e=t.visible;!function(e,t){let n=$(`calcite-list-item[value="${e}"] calcite-action`);if(t){if(n.hasClass("layer-vis"))return;n.attr("icon","check-square")}else{if(n.hasClass("layer-vis"))return;n.attr("icon","square")}}(t.id,e)}))})),$(document).ready((function(){$("body").on("click",".toggle-slider",(function(){$(this).closest("calcite-list-item").find(".opacity-div").toggle()}))})),$("#layerList").on("click",".layer-vis",(function(e){e.preventDefault(),function(e,t){let n=_.findLayerById(e);n&&(n.visible=!n.visible,"group"===n.type&&n.layers.forEach((e=>{e.visible=n.visible})),t.attr("icon",n.visible?"check-square":"square"))}($(this).closest("calcite-list-item").attr("value"),$(this))})),T.when((function(){var e=$("#layerList");xe(_.layers.items,e),$(".slider-opacity").on("calciteSliderChange",(function(e){const t=e.target.id;let n=_.findLayerById(t);var i=e.target.value/100;n.opacity=i}))}));let Le,Se,Me,Be={appraisedValueMin:null,appraisedValueMax:null,assessedValueMin:null,assessedValueMax:null,acresValueMin:null,acresValueMax:null,soldOnMin:null,soldOnMax:null,soldPMin:null,soldPMax:null};function Ee(e,t,n){function i(){const i=oe.findIndex((t=>t.field==e));oe.splice(i,1),oe.forEach((i=>{!function(e,t,n,i,a,r,s){Te(n),$(n).empty();let o=be.createQuery();if(Array.isArray(i)&&i.length>0&&!r){let e=i.map((e=>`${t} = '${e}'`));o.where=e.join(" OR ")}else o.where=i&&r?`${t} >= '${i}' AND ${t} <= '${r}'`:`${t} = '${i}'`;o.returnDistinctValues=!0,o.returnGeometry=!1,o.outFields=[a],a&&(o.orderByFields=[`${a} ASC`]);be.queryFeatures(o).then((function(e){var t=e.features,i=$(n);i.empty(),t.forEach((function(e){var t=e.attributes[a];if(t&&t.trim()){var n=$(`<calcite-combobox-item value="${t}" text-label="${t}"></calcite-combobox-item>`);i.append(n)}})),Ie(n,s)}))}(i.layer,e,i.filterSelector,t,i.field,n,i.message)}))}clearTimeout(Le),Le=setTimeout((()=>{i()}),600)}async function Ce(e,t,n,i,a,r){try{let e=be.createQuery();if(Array.isArray(i)&&i.length>0&&!r){let n=i.map((e=>`${t} = '${e}'`));e.where=n.join(" OR ")}else e.where=i&&r?`${t} BETWEEN '${i}' AND '${r}'`:`${t} = '${i}'`;e.returnDistinctValues=!0,e.returnGeometry=!1,e.outFields=[a],a&&(e.orderByFields=[`${a} ASC`]);let n=(await be.queryFeatures(e)).features.map((e=>e.attributes[a])),s=Math.max(...n),o=Math.min(...n);switch(a){case"Sale_Date":let e=new Date(o),t=new Date(s),n=e.getFullYear(),i=("0"+(e.getMonth()+1)).slice(-2),a=("0"+e.getDate()).slice(-2),r=t.getFullYear(),l=("0"+(t.getMonth()+1)).slice(-2),d=("0"+t.getDate()).slice(-2),c=`${n}-${i}-${a}`,u=`${r}-${l}-${d}`;Be.soldOnMin=c,Be.soldOnMax=u;break;case"Appraised_Total":Be.appraisedValueMin=o,Be.appraisedValueMax=s;break;case"Assessed_Total":Be.assessedValueMin=o,Be.assessedValueMax=s;break;case"Sale_Price":Be.soldPMin=o,Be.soldPMax=s;break;case"Total_Acres":Be.acresValueMin=o,Be.acresValueMax=s;break;default:console.log("Sorry, no field found.")}clearTimeout(Se),Se=setTimeout((()=>{!function(e){const t=de.findIndex((t=>t.field==e));de.splice(t,1),de.forEach((e=>{const t=document.getElementById(e.minInput),n=document.getElementById(e.maxInput);let i=Be[e.minValField];const a=Be[e.maxValueField];let r,s;i===a&&(i=0),"Appraised_Total"===e.field||"Assessed_Total"===e.field||"Sale_Price"===e.field?(r="$"+(void 0!==i?i.toLocaleString():""),s="$"+(void 0!==a?a.toLocaleString():""),t.value=r,n.value=s):"Sale_Date"===e.field?(t.value=void 0!==i?i:"",n.value=void 0!==a?a:""):"Total_Acres"===e.field&&(r=void 0!==i?i.toLocaleString():"",s=void 0!==a?a.toLocaleString():"",t.value=r,n.value=s)}))}(t)}),600)}catch(e){console.error("Error querying features:",e)}}function Pe(e,t,n){const i=le.findIndex((t=>t.field==e));le.splice(i,1),async function(e,t,n,i){for(const a of e)await Ce(a.layer,t,a.filterSelector,n,a.field,i)}(le,e,t,n)}function De(e,t,n,i){Te(n),$(n).empty();let a=be.createQuery();a.where=`1=1 AND ${t} IS NOT NULL`,a.returnDistinctValues=!0,a.returnGeometry=!1,t&&(a.orderByFields=[`${t} ASC`]),a.outFields=[t],a.maxRecordCountFactor=5,be.queryFeatures(a).then((function(e){var i=e.features,a=(e.features.length,$(n));i.forEach((function(e){var n=e.attributes[t];if(n&&n.trim()){var i=$(`<calcite-combobox-item value="${n}" text-label="${n}"></calcite-combobox-item>`);a.append(i)}}))})),Ie(n,i)}function ke(){var e=document.querySelector(".esri-widget--button.esri-print__refresh-button.esri-icon-refresh");e&&e.click()}function Ae(e,t){const n=function(e,t){let n,i=t.split("?")[0],a=[],r=-1!==t.indexOf("?")?t.split("?")[1]:"";if(""!==r){a=r.split("&");for(let t=a.length-1;t>=0;t-=1)n=a[t].split("=")[0],n===e&&a.splice(t,1);i=i+"?"+a.join("&")}return i}("uniqueid",window.location.href);if(window.history.pushState({path:n},"",n),"no"===sessionStorage.getItem("condos")?$e.visible=!0:ye.visible=!0,O)try{O?.remove(),O=null}catch(e){console.error("Failed to remove DetailsHandle",e)}if(R)try{R?.remove(),R=null}catch(e){console.error("Failed to remove DetailsHandle",e)}te="",_e(!!Z),$("#select-button").removeClass("btn-warning"),$("#select-button").addClass("btn-warning"),R=T.on("click",Ke),Z=!0,H=!1,$("#searchInput ul").remove(),$("#searchInput").val="",$("#select-button").prop("disabled",!1);document.getElementById("searchInput").value="",S="",searchTerm="",K=[],secondList=[],ae="",L=!1,z=!1,V=!1,U=!1,$(".spinner-container").hide(),$("#distanceButton").removeClass("active"),$("#areaButton").removeClass("active"),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#dropdown").toggleClass("expanded"),$("#dropdown").hide(),$("#results-div").css("left","0px"),$("#sidebar2").css("left","-350px"),$("#sidebar2").removeClass("collapsed"),$("#right-arrow-2").show(),$("#left-arrow-2").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#backButton").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportSearch").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#featureWid").hide(),$("#exportButtons").hide(),$("#layerListDiv").hide(),$("#detailBox").hide(),$("#filterDiv").hide(),$("#dropdown").show(),$("#WelcomeBox").show(),q=!1,$("#select-button").attr("title","Add to Selection Enabled"),$(".center-container").show(),document.getElementById("suggestions").innerHTML="",$("#distanceButton").removeClass("btn-warning"),$("#distanceButton").addClass("bg-info"),$("#areaButton").removeClass("btn-warning"),$("#distanceButton").addClass("bg-info"),$("#featureWid").empty(),T.ui.remove(he),he&&(he.destroy(),he=null),T.graphics.removeAll(),A=[]}function Fe(e){P.sort(((t,n)=>"owner"===e?t.owner.toLowerCase().localeCompare(n.owner.toLowerCase()):"location"===e?t.location.toLowerCase().localeCompare(n.location.toLowerCase()):"Street_Name"===e?t.Street_name.toLowerCase().localeCompare(n.Street_name.toLowerCase()):void 0)),function(){let e,t;const n=document.getElementById("featureWid");n.innerHTML="";const i=document.createElement("ul");i.classList.add("row","list-group"),P.forEach((function(n){let a=n.objectid,r=n.location,s=void 0===n.uniqueId?n.GIS_LINK:n.uniqueId,o=n.GIS_LINK,l=n.coOwner,d=n.owner,c=n.MBL,u=n.geometry,p=n.Parcel_Type;"yes"===M.useUniqueIdforParcelMap?(t=s,e=s):(t=o,e=o);let m=n.Image_Path,h=void 0===n.AcctNum?"":n.AcctNum;const g=`${M.imageUrl}${m}`;i.classList.add("row"),i.classList.add("list-group");const f=document.createElement("li"),$=document.createElement("li"),y=document.createElement("tr");y.classList.add("col-12","list-group-item");let v,w,x=`<div class="extra-links">\n            <a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=https://publicweb-gis.s3.amazonaws.com/PDFs/${M.parcelMapUrl}/Quick_Maps/QM_${e}.pdf><span style="font-family:Tahoma;font-size:12px;"><strong>PDF Map</strong></a>`;"yes"==M.propertyCardPdf?x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.propertyCard}${s}.PDF><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></a>`:x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.propertyCard}${s}><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></a>`,"yes"===M.useVisionForTaxBillUrl?x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.tax_bill}&amp;uniqueId=${h}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`:x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.tax_bill}&amp;uniqueId=${s}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`,"yes"===M.includePermitLink&&(x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.permitLink}?uniqueid=${s} ><span style="font-family:Tahoma;font-size:12px;"><strong>Permits</strong></a>`),x+="</div>",y.innerHTML=x,$.innerHTML=`<img class="img-search image" object-id="${a}" src="${g}" alt="Image of ${s}" >`,f.classList.add("list-group-item","col-9"),f.classList.add("search-list"),$.setAttribute("object-id",a),$.setAttribute("data-id",o),$.classList.add("image-div","col-3"),w="yes"===sessionStorage.getItem(b),!l&&u||u?v=` <div class="listText">UID: ${s}  &nbsp;<br>MBL: ${c} <br> ${d} ${l} <br> ${r} <br> Property Type: ${p}</div>\n            <div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justZoom" title="Zoom to Parcel"><calcite-icon icon="magnifying-glass-plus" scale="s"/>Zoom</button><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`:(v=` <div class="listText noGeometry">UID: ${s}  &nbsp;<br>MBL: ${c} <br> ${d} ${l} <br> ${r} <br> Property Type: ${p} \n             </div><div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`,f.classList.add("no-zoomto")),f.innerHTML+=v,f.setAttribute("object-id",a),f.setAttribute("data-id",o),i.appendChild($),i.appendChild(f),i.appendChild(y)})),D=P.length,i.addEventListener("click",(function(e){if(e.target.closest(".justZoom")||e.target.closest(".justZoomBtn"))return;R&&(R?.remove(),R=null),O&&(O?.remove(),O=null),$("#select-button").attr("title","Select Enabled");let t=e.target.closest("li");if(!t)return;let n=t.getAttribute("data-id"),i=t.getAttribute("object-id");Xe(i,n),$("#details-spinner").show(),$("#WelcomeBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportButtons").hide(),$("#exportSearch").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$(".center-container").hide(),Je(i,n)})),n.appendChild(i)}()}function Ne(e,t,n,i,a,r){$("status-loader").show(),$("#featureWid").empty();let s=new Set,o=new Set;P=K.filter((e=>!!e.geometry&&(s.add(e.uniqueId),!0))),K.forEach((e=>{!s.has(e.uniqueId)&&(o.add(e.uniqueId),P.push(e))})),P.sort(((e,t)=>{const n=e.owner?e.owner.toLowerCase():"",i=t.owner?t.owner.toLowerCase():"";return n.localeCompare(i)})),U||function(e){return K.filter((t=>t.objectid===e)).length}(i)>1&&function(e,t,n){"yes"==sessionStorage.getItem("condos")&&(P=P.filter((t=>t.objectid!=e)),K=K.filter((t=>t.objectid!=e)),$(`li[object-id="${e}"]`).remove()),"no"==sessionStorage.getItem("condos")&&(K=K.filter((e=>e.GIS_LINK!=n)),P=P.filter((e=>e.GIS_LINK!=n)),$(`li[data-id="${n}"]`).remove())}(i,0,r);const l=document.getElementById("featureWid"),d=document.createElement("ul");let c,u;P.forEach((function(e){let t=e.objectid,n=e.location,i=void 0===e.uniqueId?e.GIS_LINK:e.uniqueId,a=e.GIS_LINK,r=e.coOwner,s=e.owner,o=e.MBL,l=e.geometry,p=e.Parcel_Type;"yes"===M.useUniqueIdforParcelMap?(c=i,u=i):(c=a,u=a);let m=e.Image_Path,h=void 0===e.AcctNum?"":e.AcctNum;const g=`${M.imageUrl}${m}`;d.classList.add("row"),d.classList.add("list-group");const f=document.createElement("li"),$=document.createElement("li"),y=document.createElement("tr");y.classList.add("col-12","list-group-item");let v,w,x=`<div class="extra-links">\n            <a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=https://publicweb-gis.s3.amazonaws.com/PDFs/${M.parcelMapUrl}/Quick_Maps/QM_${u}.pdf><span style="font-family:Tahoma;font-size:12px;"><strong>PDF Map</strong></a>`;"yes"==M.propertyCardPdf?x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.propertyCard}${i}.PDF><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></a>`:x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.propertyCard}${i}><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></a>`,"yes"===M.useVisionForTaxBillUrl?x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.tax_bill}&amp;uniqueId=${h}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`:x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.tax_bill}&amp;uniqueId=${i}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`,"yes"===M.includePermitLink&&(x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.permitLink}?uniqueid=${i} ><span style="font-family:Tahoma;font-size:12px;"><strong>Permits</strong></a>`),x+="</div>",y.innerHTML=x,$.innerHTML=`<img class="img-search image" object-id="${t}" src="${g}" alt="Image of ${i}" >`,f.classList.add("list-group-item","col-9"),f.classList.add("search-list"),$.setAttribute("object-id",t),$.setAttribute("data-id",a),$.classList.add("image-div","col-3"),w="yes"===sessionStorage.getItem(b),!r&&l||l?v=` <div class="listText">UID: ${i}  &nbsp;<br>MBL: ${o} <br> ${s} ${r} <br> ${n} <br> Property Type: ${p}</div>\n            <div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justZoom" title="Zoom to Parcel"><calcite-icon icon="magnifying-glass-plus" scale="s"/>Zoom</button><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`:(v=` <div class="listText noGeometry">UID: ${i}  &nbsp;<br>MBL: ${o} <br> ${s} ${r} <br> ${n} <br> Property Type: ${p} \n             </div><div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`,f.classList.add("no-zoomto")),f.innerHTML+=v,f.setAttribute("object-id",t),f.setAttribute("data-id",a),d.appendChild($),d.appendChild(f),d.appendChild(y)})),D=P.length,$("#total-results").html(D+" results returned"),L||($("#total-results").show(),$("#ResultDiv").show(),$("#backButton").hide(),$("#detailsButton").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#featureWid").show(),$("#detail-content").empty(),$("#dropdown").toggleClass("expanded"),$("status-loader").hide(),$("#dropdown").show(),$("#sidebar2").css("left","0px"),$("#sidebar2").addClass("collapsed"),$("#results-div").css("left","350px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide(),$("#WelcomeBox").hide(),$("#csvExportResults").hide(),$("#exportSearch").show(),$("#results-div").css("height","300px"),$("#exportButtons").show(),$("#exportResults").hide(),$("#csvExportSearch").show(),$(".spinner-container").hide(),$(`li[object-id="${i}"]`).remove(),U=!1),d.addEventListener("click",(function(e){let t=!0;if(e.target.closest(".justZoom")||e.target.closest(".justZoomBtn")||e.target.closest(".pdf-links"))return;R&&(R?.remove(),R=null),O&&(O?.remove(),O=null),$("#select-button").attr("title","Select Enabled");let n=e.target.closest("li");if(!n)return;let i=n.getAttribute("data-id"),a=n.getAttribute("object-id");Xe(a,i),$("#details-spinner").show(),$("#WelcomeBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportButtons").hide(),$("#exportSearch").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$(".center-container").hide(),$("#abutters-attributes").prop("disabled",!1),$("#abutters-zoom").prop("disabled",!1),e.target.closest(".no-zoomto")&&(console.log("dont zoom"),t=!1),Je(a,i,t)})),l.appendChild(d),z=!1}function Oe(e,t,n,i){let a,r,s;function o(e){e.forEach((function(e){if(""!==e.attributes.Owner){let t=e.attributes.OBJECTID,n=e.attributes.Location,i=e.attributes.Uniqueid,a=e.attributes.GIS_LINK,r=e.attributes.Co_Owner,s=e.attributes.Owner,o=e.attributes.MBL,l=e.geometry,d=e.attributes.Mailing_Address_1,c=e.attributes.Mailing_Address_2,u=e.attributes.Mailing_City,p=e.attributes.Mail_State,m=e.attributes.Mailing_Zip,h=e.attributes.Total_Acres,g=e.attributes.Parcel_Primary_Use,f=e.attributes.Building_Use_Code,$=e.attributes.Parcel_Type,b=e.attributes.Design_Type,v=e.attributes.Zoning,w=e.attributes.Neighborhood,x=e.attributes.Land_Type_Rate,_=e.attributes.Functional_Obs,T=e.attributes.External_Obs,I=y(e.attributes.Sale_Date),L=e.attributes.Sale_Price,S=e.attributes.Vol_Page,M=e.attributes.Assessed_Total,B=e.attributes.Appraised_Total,E=e.attributes.Influence_Factor,C=e.attributes.Influence_Type,P=e.attributes.Land_Type,D=e.attributes.Prior_Assessment_Year,k=e.attributes.Prior_Assessed_Total,A=e.attributes.Prior_Appraised_Total,F=e.attributes.Map,N=e.attributes.Lat,O=e.attributes.Lon,R=e.attributes.Image_Path,U=e.attributes.AcctNum,q=e.attributes.Match_Status;K.push(new qe(t,n,i,a,r,s,o,l,d,c,u,p,m,h,g,f,$,b,v,w,x,_,T,I,L,S,M,B,E,C,P,D,k,A,F,N,O,R,U,q))}}))}if(n&&null!=n){a=e[0].attributes.OBJECTID,r=e[0].attributes.Location,s=e[0].attributes.GIS_LINK;const t=K.filter((e=>e.objectid===a)).length,n=K.filter((e=>e.GIS_LINK===s)).length;t>=1||0==t&&n>=1?(o(e),Ne(0,0,0,a,0,s)):(o(e),Ne())}else e?e.length>1?(H||(e=e.filter((e=>"CONDOMAIN"!=e.attributes.ACCOUNT_TYPE))),o(e)):o(e):Ne(0,0,0,a);n||Ne(0,0,0,a,0,s)}function Re(e,t,n,i){let a,r;Me=i?e:e.features,w.removeAll();let o,l,d=[];var c={type:"simple-fill",color:[127,42,145,.4],outline:{color:[127,42,145,.8],width:2}};if(n){o=e.features[0].attributes.OBJECTID,l=Me[0].attributes.GIS_LINK;const n=new s({geometry:Me[0].geometry,symbol:c,id:o});if(d.push(n),r=K.filter((e=>e.GIS_LINK===l)).length,a=T.graphics.some((e=>e.id===o)),a){const e=T.graphics.findIndex((e=>e.id===o));T.graphics.removeAt(e);const t=A.findIndex((e=>e.id===o));1===A.length?A.splice(0,1):A.splice(t,1),0===A.length&&(O||(O=T.on("click",Ge)),R&&(R?.remove(),R=null),R=T.on("click",Ke))}else t.addMany(d)}else if(i){Me.filter((e=>e.geometry)).forEach((e=>{const t=e.attributes.OBJECTID,n=new s({geometry:e.geometry,symbol:c,id:t});d.push(n)})),d.length>=1&&t.addMany(d),T.goTo({target:A,zoom:18})}else{let e;if(J=!0,Me.map((function(t){if(o=t.attributes.OBJECTID,!t.geometry||i)return null;e=new s({geometry:t.geometry,symbol:c,id:o}),d.push(e)})).filter((e=>null!==e)),1==d.length){t.addMany(d);const e=Me[0].geometry.extent,n=(e.center,2),i=e.expand(n);T.goTo({target:d,extent:i})}else if(t.addMany(d),d.length>0){const e=d.map((e=>e.geometry.extent)),t=3,n=e.reduce(((e,t)=>e.union(t)),e[0]).expand(t);T.goTo({target:n}).catch((e=>{console.error("Error zooming to extent:",e)}))}else console.warn("No graphics available to calculate extent.")}if(A||(A=d),n&&!a){let e=d[0].id;A=[...A,d[0]],removeFromList=e}J&&(A=d),a=!1,J=!1}De(0,"Street_Name","#streetFilter","Select a Street Name"),De(0,"Owner","#ownerFilter","Select a Owner"),De(0,"Parcel_Type","#propertyFilter","Select a Property Type"),De(0,"Building_Type","#buildingFilter","Select a Building Type"),De(0,"Building_Use_Code","#buildingUseFilter","Select a Building Use"),De(0,"Design_Type","#designTypeFilter","Select a Design Type"),De(0,"Zoning","#zoningFilter","Select a Zone"),De(0,"Neighborhood","#neighborhoodFilter","Select a Neighborhood"),document.getElementById("Print-selector").addEventListener("click",(function(){!function(){const e=600,t=8.8,n=8.8,i=t*e,a=n*e;T.takeScreenshot({width:i,height:a}).then((function(e){const i=window.open("","_blank"),a=document.getElementById("scale-value").innerHTML,r=(new Date).toLocaleString();i.document.write(`\n            <!DOCTYPE html>\n            <html lang="en">\n            <head>\n                <meta charset="UTF-8">\n                <meta name="viewport" content="width=device-width, initial-scale=1.0">\n                <title>Print Map</title>\n                <link rel="stylesheet" href="https://js.arcgis.com/4.27/esri/themes/light/main.css">\n                <style>\n                    body {\n                        display: flex;\n                        flex-direction: column;\n                        align-items: center;\n                        justify-content: center;\n                        margin: 0;\n                        padding: 0;\n                    }\n                    .print-title {\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        text-align: center;\n                        font-size: 18px;\n                    }\n                    .print-scale {\n                        display: flex;\n                        align-items: center;\n                        justify-content: space-around;\n                        text-align: center;\n                        font-size: 14px;\n                        width: 100%;\n                        margin-left: 20px;\n                        margin-right: 20px;\n                    }\n                    .print-title img {\n                        margin-right: 20px;\n                        height: 60px !important;\n                        width: 60px !important;\n                    }\n                    .scale-bar-container {\n                        margin-right: 50px;\n                    }\n                    .print-scale-bar {\n                        width: 300px;\n                        height: 30px;\n                    }\n                    .info-writing-container {\n                        display: flex;\n                        justify-content: center;\n                        align-items: flex-start;\n                        width: 80%;\n                        margin: 20px auto;\n                    }\n                    .info-text {\n                        width: 20%;\n                        text-align: left;\n                        margin-right: 20px;\n                    }\n                    .writing-lines {\n                        width: 80%;\n                        text-align: center;\n                    }\n                    .writing-lines div {\n                        border-bottom: 1px solid black;\n                        margin: 10px 0;\n                        height: 20px;\n                    }\n                    @media print {\n                        body * {\n                            visibility: visible;\n                        }\n                    }\n                </style>\n            </head>\n            <body>\n                <div class="print-title" id="print-title">\n                    <img id="town-logo" src="${M.welcomeImage}" alt="Town Logo">\n                    <h1 id="title-text">${M.title}</h1>\n                </div>\n                <div class="print-map">\n                    <img id="print-map-image" src="${e.dataUrl}" alt="Map Image" style="width: ${t}in; height: ${n}in; border: 3px solid #A9A9A9; margin: 0 0.75in;">\n                </div>\n                <div class="print-scale">\n                    <div class="print-date" style="font-size: 12px;">Date Printed: ${r}</div>\n                    <div id="to-scale" class="scale-bar-container"></div>\n                        <div id="print-scale-bar" class="scale-bar-container">${a} (approx)</div>\n                </div>\n                <div style="text-align: center; font-size: 12px; padding-left: 30px; padding-right: 30px;">\n                    <p>Disclaimer: This map is intended for reference and general informational purposes\n                    only and is not a legally recorded map or survey. While reasonable effort has been\n                    made to ensure the accuracy, correctness, and timeliness of materials presented,\n                    the map vendor and the municipality disclaim any and all liability and responsibility for\n                    any errors, omissions, or inaccuracies in the data provided, including without limitation\n                    any liability for direct, indirect, incidental, consequential, special, exemplary,\n                    punitive, or any other type of damages. Users are hereby notified that the primary\n                    information source should be consulted for verification of the data contained herein.\n                    Continued use of this map acknowledges acceptance of these terms.</p>\n                </div>\n                <script>\n                    window.onload = function() {\n                        window.print();\n                    };\n                <\/script>\n            </body>\n            </html>\n          `),i.document.close()}))}()})),T.watch("zoom",(function(e,t){e!==t&&ke()})),T.watch("center",(function(e,t){e!==t&&ke()})),$(document).ready((function(){$(document).on("click",".justRemove",(function(e){e.stopPropagation(),e.preventDefault();let t=e.target.closest("li"),n=t.getAttribute("data-id"),i=t.getAttribute("object-id"),a=e,r=!0,s=[],o=!1,l=t.querySelector(".listText");if(l){let e=l.classList;s=Array.from(e),o=s.includes("noGeometry")}if("no"===sessionStorage.getItem("condos")){let e=ye.createQuery();e.where=o?`GIS_LINK = '${n}'`:`OBJECTID = '${i}'`,e.returnGeometry=!0,e.outFields=["*"],$e.queryFeatures(e).then((function(e){totalResults=e.features,Oe(totalResults,"",a),Re(e,T.graphics,r)}))}else{let e=ye.createQuery();e.where=`OBJECTID = ${i}`,e.returnGeometry=!0,e.outFields=["*"],ye.queryFeatures(e).then((function(e){totalResults=e.features,Oe(totalResults,"",a),Re(e,T.graphics,r)}))}}))})),$(document).ready((function(){$(document).on("click",".justZoom",(function(e){e.stopPropagation(),e.preventDefault();let t=e.target.closest("li"),n=(t.getAttribute("data-id"),t.getAttribute("object-id"));if("no"===sessionStorage.getItem("condos")){let e=`OBJECTID = ${n}`,t=$e.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],$e.queryFeatures(t).then((e=>{let t=e.features[0].geometry;const n=t.extent;n.center,n.expand(3);T.goTo({target:t})}))}else{let e=`OBJECTID = ${n}`,t=ye.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],ye.queryFeatures(t).then((e=>{let t=e.features[0].geometry;const n=t.extent;n.center,n.expand(3);T.goTo({target:t})}))}}))})),document.getElementById("sortByOwner").addEventListener("click",(function(){Fe("owner")})),document.getElementById("sortByLocation").addEventListener("click",(function(){Fe("location")}));let Ue=new d({view:T,layer:w,defaultCreateOptions:{mode:"freehand"},polygonSymbol:{type:"simple-fill",style:"cross",color:"rgb(145, 199, 61)",outline:{width:3,style:"solid",color:"rgba(127, 42, 145, 1)"}},defaultUpdateOptions:{tool:"reshape",toggleToolOnClick:!1}});$("#lasso").on("click",(function(e){H=!H,Z=!1,$("#select-button").removeClass("btn-warning"),$("#select-button").prop("disabled",!1),H&&!Z?(Ue.create("polygon"),$("#select-button").removeClass("btn-warning"),$("#lasso").addClass("btn-warning")):(Ue.cancel(),$("#lasso").removeClass("btn-warning"),$("#lasso").addClass("btn-info"),$("#select-button").removeClass("btn-warning"),$("#select-button").addClass("btn-info")),Ae(),w.removeAll(),"no"===sessionStorage.getItem("condos")?$e.visible=!0:ye.visible=!0})),Ue.on("create",(function(e){"complete"===e.state&&(w.remove(e.graphic),w.add(e.graphic),function(e){let t=!0;z=!0;let n=[];"no"==sessionStorage.getItem("condos")?function(){let i=$e.createQuery();i.geometry=e,i.distance=1,i.units="feet",i.spatialRelationship="intersects",i.returnGeometry=!0,i.outFields=["*"],$e.queryFeatures(i).then((function(i){i.features.forEach((e=>{n.push(e.attributes.GIS_LINK)})),He(n,t),e=!1}))}():function(){let i=ye.createQuery();i.geometry=e,i.distance=1,i.units="feet",i.spatialRelationship="intersects",i.returnGeometry=!0,i.outFields=["*"],ye.queryFeatures(i).then((function(i){i.features.forEach((e=>{n.push(e.attributes.GIS_LINK)})),He(n,t),e=!1}))}()}(e.graphic.geometry),O&&(O?.remove(),O=null),R&&(R?.remove(),R=null),$("#lasso").removeClass("btn-warning"),$("#lasso").addClass("btn-info"))})),$("#select-button").on("click",(function(e){if(Ue.cancel(),Z=!!re||!Z,Z||Ae(),H=!1,Z&&!H?($("#lasso").removeClass("btn-warning"),$("#select-button").addClass("btn-warning")):$("#select-button").removeClass("btn-warning"),"no"===sessionStorage.getItem("condos")?$e.visible=!0:ye.visible=!0,Z&&!H){if(R)try{R?.remove(),R=null}catch(e){console.error("Failed to remove clickHandle",e)}if(O)try{O?.remove(),O=null}catch(e){console.error("Failed to remove DetailsHandle",e)}R=T.on("click",Ke)}else if(Z&&H)O&&(O?.remove(),O=null),R&&(R?.remove(),R=null),R=T.on("click",Ke);else{if(R)try{R?.remove(),R=null}catch(e){console.error("Failed to remove clickHandle",e)}if(O)try{O?.remove(),O=null}catch(e){console.error("Failed to remove DetailsHandle",e)}}})),$("#home").on("click",(function(e){T.goTo(M.homeExtent)}));class qe{constructor(e,t,n,i,a,r,s,o,l,d,c,u,p,m,h,g,f,$,y,b,v,w,x,_,T,I,L,S,M,B,E,C,P,D,k,A,F,N,O,R){this.objectid=e,this.location=t,this.uniqueId=n,this.GIS_LINK=i,this.coOwner=a,this.owner=r,this.MBL=s,this.geometry=o,this.mailingAddress=l,this.mailingAddress2=d,this.Mailing_City=c,this.Mail_State=u,this.Mailing_Zip=p,this.Total_Acres=m,this.Parcel_Primary_Use=h,this.Building_Use_Code=g,this.Parcel_Type=f,this.Design_Type=$,this.Zoning=y,this.Neighborhood=b,this.Land_Type_Rate=v,this.Functional_Obs=w,this.External_Obs=x,this.Sale_Date=_,this.Sale_Price=T,this.Vol_Page=I,this.Assessed_Total=L,this.Appraised_Total=S,this.Influence_Factor=M,this.Influence_Type=B,this.Land_Type=E,this.Prior_Assessment_Year=C,this.Prior_Assessed_Total=P,this.Prior_Appraised_Total=D,this.Map=k,this.LAT=A,this.LON=F,this.Image_Path=N,this.AcctNum=O,this.Match_Status=R}}function Ve(e,t,n){let i,a,r;"no"===sessionStorage.getItem("condos")?$e.visible=!0:ye.visible=!0,$(".spinner-container").show(),i=`\n          Street_Name LIKE '%${e}%' OR \n          MBL LIKE '%${e}%' OR \n          Location LIKE '%${e}%' OR \n          Co_Owner LIKE '%${e}%' OR \n          Uniqueid LIKE '%${e}%' OR \n          Owner LIKE '%${e}%' OR \n          GIS_LINK LIKE '%${e}%'\n      `,n?a=n:(z||L)&&(a=n,tableSearch=!0),"no"===sessionStorage.getItem("condos")?$e.queryFeatures(a).then((function(s){if(r=s.features,s.features.length>=0)if(r=s.features,F=s.features,U){let n="",i="";const s=ve.createQuery();s.where=a.where,s.returnGeometry=!1,s.outFields=["*"],ve.queryFeatures(s).then((function(e){n=e.features;const t=e.features[0].attributes.GIS_LINK;let i=$e.createQuery();return i.where=`GIS_LINK = '${t}'`,i.returnGeometry=!0,i.returnHiddenFields=!0,i.outFields=["*"],$e.queryFeatures(i)})).then((function(a){r=a.features,i=a.features,F=a.features,Re(a,T.graphics,""),Oe(a.features),t&&setTimeout((()=>{nt(n,i,e)}),200)})).catch((function(e){console.error("Error querying features: ",e)}))}else F=s.features,Re(s,T.graphics,""),Oe(s.features),t&&setTimeout((()=>{nt(r,e)}),200),U=!1;else if(1===s.features.length&&K.length>2){const n=ve.createQuery();n.where=i,n.returnGeometry=!1,n.outFields=["*"],ve.queryFeatures(n).then((function(n){Re(n.features),Oe(),t&&setTimeout((()=>{nt(r,e)}),200)}))}else{const e=ve.createQuery();e.where=n.where,e.returnGeometry=!1,e.outFields=["*"],0==s.features.length&&ve.queryFeatures(e).then((function(e){r=e.features,GISLINK=e.features[0].attributes.GIS_LINK;let n=e.features[0].attributes.Uniqueid;F=e.features,Re(e,T.graphics),Oe(e.features),t&&setTimeout((()=>{V=!0,nt(r,n)}),200)}))}})):ye.queryFeatures(a).then((function(e){if(r=e.features,e.features.length>0){const n=e.features[0].attributes.Uniqueid;Re(e,T.graphics,""),t&&setTimeout((()=>{nt(r,n)}),200)}Oe(e.features)})),R&&(R?.remove(),R=null),O&&(O?.remove(),O=null),z?($("#select-button").addClass("btn-warning"),R=T.on("click",Ke)):(O=T.on("click",Ge),$("#select-button").removeClass("btn-warning")),H=!1,Z=!1}function ze(){$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$(".center-container").hide(),$("#layerListDiv").hide(),$("#details-spinner").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").html('<h5 style="color: red;">Issue selecting Parcel. Please make another selection.</h5>'),$("#abutters-attributes").prop("disabled",!0),$("#abutters-zoom").prop("disabled",!0),$("#selected-feature").empty(),$("#exportSearch").hide(),$("#exportButtons").hide()}function Ge(e){if(R&&(R?.remove(),R=null),$("#details-spinner").show(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportSearch").hide(),$("#exportButtons").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$("#abutters-attributes").prop("disabled",!1),$("#abutters-zoom").prop("disabled",!1),"no"===sessionStorage.getItem("condos")){let t=$e.createQuery();t.geometry=e.mapPoint,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"],$e.queryFeatures(t).then((function(e){if(totalResults=e.features,totalResults.length>0){Ye(e.features[0].attributes.OBJECTID,e.features[0].geometry,e.features[0]),We(totalResults)}else ze()}))}else{let t=ye.createQuery();t.geometry=e.mapPoint,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"],ye.queryFeatures(t).then((function(e){if(totalResults=e.features,totalResults.length>0){Ye(e.features[0].attributes.OBJECTID,e.features[0].geometry,e.features[0]),We(totalResults)}else ze()}))}}function Ke(e){if(ne="click",U=!1,W=!0,O&&(O?.remove(),O=null),"no"===sessionStorage.getItem("condos")){let t=$e.createQuery();t.geometry=e.mapPoint,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"],$e.queryFeatures(t).then((function(t){t.features&&(totalResults=t.features,Oe(totalResults,0,e),Re(t,T.graphics,W))}))}else{let t=ye.createQuery();t.geometry=e.mapPoint,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"],ye.queryFeatures(t).then((function(t){t.features&&(totalResults=t.features,Oe(totalResults,0,e),Re(t,T.graphics,W))}))}}function je(e){var t;t="search"===e?document.querySelectorAll(".export-search-list"):document.querySelectorAll(".abutters-group-list");const n=[];document.querySelectorAll(".search-list").forEach((function(e,t){n[t]=e.innerHTML}));var i="<ul class='label-list'>";t.forEach((function(e){i+="<li>"+e.innerHTML.trim()+"</li>"})),i+="</ul>";var a=window.open("","print","left=0,top=0,width=800,height=600,toolbar=0,status=0");a.document.write("<!DOCTYPE html><html><head>"),a.document.write("<title>Print Labels</title>"),a.document.write("<style>body { margin: 0; padding: 0; font-size: 10pt; }.label-list { list-style-type: none; margin: 0; padding: 0; display: flex; align-items: center; text-align: center; flex-wrap: wrap; justify-content: space-between; }.label-list li { box-sizing: border-box; width: 2.225in; height: 1in; margin-bottom: 0.0in; padding: 0.1in; display: flex; align-items: center; justify-content: center; font-size: 8pt; }@media print {  body { margin: 0.0in 0.1875in; }  .label-list { padding: 0; }  .label-list li { margin-right: 0in; margin-bottom: 0; }  @page { margin-top: 0.5in; margin-bottom: 0.5in; margin-left: 0.25in; margin-right: 0.25in }}</style>"),a.document.write("</head><body>"),a.document.write(i),a.document.write("</body></html>"),a.document.close(),setTimeout((()=>{a.print(),a.close(),document.querySelectorAll(".search-list").forEach((function(e,t){n[t]&&(e.innerHTML=n[t])}))}),250)}function He(e,t){if(e.length>0){let n=[];e.forEach((e=>{n.includes(e)||n.push(e)}));const i=n.map((e=>`'${e}'`)).join(" OR GIS_LINK = "),a=`GIS_LINK = ${i}`;let r=be.createQuery();r.where=a,r.returnGeometry=!1,r.returnHiddenFields=!0,r.outFields=["*"],be.queryFeatures(r).then((e=>{t?tt("","",r):function(e){const t=document.getElementById("parcel-feature");t.innerHTML="";const n=e.features;totalResults=n.length,lastResults=totalResults,exportResults=n,P=n,ie=n,n.forEach((function(e){let n=e.attributes.GIS_LINK,i=e.attributes.OBJECTID,a=e.attributes.Owner,r=e.attributes.Co_Owner,s=e.attributes.Mailing_Address_1,o=e.attributes.Mailing_Address_2,l=e.attributes.Mailing_City,d=e.attributes.Mail_State,c=e.attributes.Mailing_Zip;const u=document.createElement("ul");u.classList.add("row"),u.classList.add("list-group"),u.classList.add("abutters-list");const p=document.createElement("li");p.classList.add("abutters-group-item","col-12");let m="";m=` ${a} ${r} <br> ${s} ${o} <br> ${l}, ${d} ${c}`,p.innerHTML+=m,p.setAttribute("data-id",n),p.setAttribute("object-id",i),u.appendChild(p),t.appendChild(u),$("#abutters-spinner").hide(),$("#abutters-title").html(`Abutting Parcels (${totalResults})`)})),$("#results-div").css("height","300px"),$("#exportResults").show(),$("#csvExportResults").show()}(e)}))}else console.log("No buffer results to query.")}function Ze(e){$("#abutters-spinner").show(),0===e&&(e=-10);let t,n=e,i=j;t=(sessionStorage.getItem("condos"),o.geodesicBuffer(E,n,i)),function(e){k="BufferGraphicId";const t=T.graphics.items.findIndex((e=>e.id===k));t>-1&&T.graphics.removeAt(t);let n=new s({geometry:e,symbol:{type:"simple-fill",color:[51,51,204,.1],style:"forward-diagonal",outline:{color:"rgba(127, 42, 145, 0.8)",width:4}},id:k});T.graphics.add(n),T.goTo({target:n})}(t),function(e){const t={spatialRelationship:"intersects",geometry:e,outFields:["*"],returnGeometry:!0,units:j};let n=[];"no"===sessionStorage.getItem("condos")?$e.queryFeatures(t).then((e=>{e.features.forEach((e=>{n.push(e.attributes.GIS_LINK)})),He(n)})):ye.queryFeatures(t).then((e=>{e.features.forEach((e=>{n.push(e.attributes.GIS_LINK)})),He(n)}))}(t)}function We(e){$("#select-button").prop("disabled",!0),$("#select-button").removeClass("btn-warning"),ne="detailClick",$("#detail-content").empty(),$("#selected-feature").empty(),$(".center-container").hide(),$("#layerListDiv").hide();let t,n,i=e[0].attributes,a=void 0===i.Location?"":i.Location,r=void 0===i.Uniqueid?"":i.Uniqueid,s=void 0===i.GIS_LINK?"":i.GIS_LINK,o=void 0===i.Co_Owner?"":i.Co_Owner,l=void 0===i.Owner?"":i.Owner,d=void 0===i.MBL?"":i.MBL,c=void 0===i.Mailing_Address_1?"":i.Mailing_Address_1,u=void 0===i.Mailing_City?"":i.Mailing_City+", ",p=void 0===i.Mail_State?"":i.Mail_State,m=void 0===i.Mailing_Zip?"":i.Mailing_Zip,h=void 0===i.Total_Acres?"":i.Total_Acres,g=void 0===i.Parcel_Primary_Use?"":i.Parcel_Primary_Use,f=void 0===i.Building_Use_Code?"":i.Building_Use_Code,b=i.Sale_Date,v=void 0===i.Sale_Date?"":y(b),w=void 0===i.Sale_Price?"":Qe(i.Assessed_Total),x=void 0===i.Vol_Page?"":i.Vol_Page,_=void 0===i.Prior_Appraised_Total?"":Qe(i.Prior_Appraised_Total),T=void 0===i.Prior_Assessed_Total?"":Qe(i.Prior_Assessed_Total),L=void 0===i.Prior_Assessment_Year?"":i.Prior_Assessment_Year,S=void 0===i.Map?"":$.trim(i.Map),B=void 0===i.OBJECTID?"":i.OBJECTID,E=void 0===i.Lat?"":i.Lat,C=void 0===i.Lon?"":i.Lon,P=void 0===i.AcctNum?"":i.AcctNum;"yes"===M.useUniqueIdforParcelMap?(zoomToItemId=r,t=r):(zoomToItemId=s,t=s),n="yes"===M.useVisionForTaxBillUrl?P:r,ae=B,I=s;const D=i.Image_Path,k=document.getElementById("detail-content"),A=document.createElement("div");A.innerHTML="",A.classList.add("details");let F=M.DetailLinksToInclude,N=M.DetailLinks,O=[];N.forEach((e=>{let t=e;if(F.includes(e)){let e={[t]:{show:"show"}};O.push(e)}else{let e={[t]:{show:"none"}};O.push(e)}}));let R=`\n        <p>\n        <span style="font-family:Tahoma;font-size:14px;"><strong>${a}</strong></span> <br>\n        </p>\n  \n        <div>\n        <img class="image" src=${M.imageUrl}${D} alt="Building Photo" width="250" height="125">\n        </div>\n        <p>\n        <span style="font-family:Tahoma;font-size:12px;"><strong>${l} ${o}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;"><strong>${c}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;"><strong>${u} ${p} ${m}</strong></span><br>\n    </p>\n    <div id="accordion">\n      <div class="card" id="links" style="display:${O[0].links.show}">\n        <div class="card-header" id="headingOne">\n            <h5 class="mb-0">\n            <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">\n                Property Links\n            </button>\n          </h5>\n      </div>\n  \n      \n      <div id="collapseOne" class="collapse show" aria-labelledby="OneFour" data-parent="#accordion">\n             <div class="card-body" style="text-align: left;">\n      `;"yes"===M.includePermitLink&&(R+=`<a class='mx-auto' href=${M.permitLink}?uniqueid=${n} target="_blank"><span style="font-family:Tahoma;font-size:12px;"><strong>Permits</strong></a><br>`),R+=`\n        <table style="width: 100%; font-family: Tahoma; font-size: 12px; border-collapse: collapse; text-align: left;">\n          <tr>\n            <td>\n              <a target="_blank" rel="noopener noreferrer" href="${M.tax_bill}&uniqueId=${n}">\n                <strong>Tax Bills</strong>\n              </a>\n            </td>\n            <td>`,"yes"==M.propertyCardPdf?R+=`<a target="_blank" rel="noopener noreferrer" href="${M.propertyCard}${r}.PDF"><strong>Property Card</strong></a>`:R+=`<a target="_blank" rel="noopener noreferrer" href="${M.propertyCard}${r}"><strong>Property Card</strong></a>`,R+=`</td>\n        </tr>\n        <tr>\n          <td>\n            <a target="_blank" rel="noopener noreferrer" href="https://publicweb-gis.s3.amazonaws.com/PDFs/${M.parcelMapUrl}/Quick_Maps/QM_${t}.pdf">\n              <strong>Parcel Map</strong>\n            </a>\n          </td>\n          <td>\n            <a target="_blank" rel="noopener noreferrer" href="${M.taxMap_Url}${S}.pdf">\n              <strong>Tax Map</strong>\n            </a>\n          </td>\n        </tr>\n        <tr>\n          <td>\n            <a target="_blank" rel="noopener noreferrer" href="https://www.google.com/maps/@${E},${C},17z/@${E},${C},17z/data=!5m1!1e2">\n              <strong>Google Maps</strong>\n            </a>\n          </td>\n          <td>\n            <a target="_blank" rel="noopener noreferrer" href="https://www.bing.com/maps?cp=${E}~${C}&lvl=17.0">\n              <strong>Bing Maps</strong>\n            </a>\n          </td>\n        </tr>\n        <tr><td colspan="2"> &nbsp </td></tr>\n        <tr>\n          <td colspan="2">\n            <a target="_blank" rel="noopener noreferrer" href="${M.pdf_demo}">\n              <strong>Demographics Profile</strong>\n            </a>\n          </td>\n        </tr>\n        <tr>\n          <td colspan="2">\n            <a target="_blank" rel="noopener noreferrer" href="${M.housingUrl}">\n              <strong>Housing Profile</strong>\n            </a>\n          </td>\n        </tr>\n      </table>\n      </div>\n      </div>\n      </div>\n          <div class="card " id="ids" style="display:${O[1].ids.show}">\n              <div class="card-header" id="headingTwo">\n              <h5 class="mb-0">\n                  <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">\n                  Property Ids & Uses\n                  </button>\n              </h5>\n              </div>\n              <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">\n                  <div class="card-body">\n                    <p>\n                    <span style="font-family:Tahoma;font-size:12px;">Unique ID: <strong>${r}</strong></span> <br>\n                    <span style="font-family:Tahoma;font-size:12px;">MBL: <strong>${d}</strong></span> <br>\n                    <span style="font-family:Tahoma;font-size:12px;">Total Acres: <strong>${h}</strong></span> <br>\n                    <span style="font-family:Tahoma;font-size:12px;">Primary Use: <strong>${g}</strong></span> <br>\n                    <span style="font-family:Tahoma;font-size:12px;">Primary Bldg Use: <strong>${f}</strong></span><br>\n                    </p>\n                  </div>\n              </div>\n          </div>\n      <div class="card" id="sales" style="display:${O[3].sales.show}" >\n      <div class="card-header" id="headingThree">\n        <h5 class="mb-0">\n          <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">\n            Latest Sale / Transfer\n          </button>\n        </h5>\n      </div>\n      <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">\n        <div class="card-body">\n          <p>\n          <span style="font-family:Tahoma;font-size:12px;">Sold on: <strong>${v}</strong></span> <br>\n          <span style="font-family:Tahoma;font-size:12px;">Sale Price: <strong>$${w}</strong></span> <br>\n          <span style="font-family:Tahoma;font-size:12px;">Volume/Page: <strong>${x}</strong></span><br>\n          </p>\n        </div>\n      </div>\n    </div>\n    <div class="card" id="vals" style="display:${O[2].vals.show}">\n      <div class="card-header" id="headingFour">\n          <h5 class="mb-0">\n            <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">\n              Valuations\n            </button>\n          </h5>\n        </div>\n        <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordion">\n          <div class="card-body">\n              <p>\n              <span style="font-family:Tahoma;font-size:12px;"><strong>Valuations:</strong></span><br>\n              <span style="font-family:Tahoma;font-size:12px;">GL Year: <strong>${L}</strong></span> <br>\n              <span style="font-family:Tahoma;font-size:12px;">Assessment: <strong>$${T}</strong></span> <br>\n              <span style="font-family:Tahoma;font-size:12px;">Appraised: <strong>$${_}</strong></span> <br>\n              <span style="font-family:Tahoma;font-size:12px;"></span>\n              </p>\n          </div>\n      </div>\n    </div>\n  </div>\n      `,A.innerHTML=R,$("#details-spinner").hide(),k.appendChild(A)}function Qe(e){return void 0===e?"":new Intl.NumberFormat("en-US").format(e)}function Je(e,t,n){var i;n?$("#abutters-zoom").prop("disabled",!1):$("#abutters-zoom").prop("disabled",!0),$("#select-button").prop("disabled",!0),$("#select-button").removeClass("btn-warning"),R&&(R?.remove(),R=null),ne="detailClick",$("#exportResults").hide(),$("#csvExportResults").hide(),G=[e,t],(i=K.find((function(n){return n.objectid===parseInt(e)&&n.GIS_LINK===t})))||(i=K.find((function(e){return e.GIS_LINK===t||e.uniqueId===t})));let a,r,s=void 0===i.location?"":i.location,o=void 0===i.uniqueId?"":i.uniqueId,l=void 0===i.GIS_LINK?"":i.GIS_LINK,d=void 0===i.coOwner?"":i.coOwner,c=void 0===i.owner?"":i.owner,u=void 0===i.MBL?"":i.MBL,p=void 0===i.mailingAddress?"":i.mailingAddress,m=void 0===i.Mailing_City?"":i.Mailing_City+", ",h=void 0===i.Mail_State?"":i.Mail_State,g=void 0===i.Mailing_Zip?"":i.Mailing_Zip,f=void 0===i.Total_Acres?"":i.Total_Acres,y=void 0===i.Parcel_Primary_Use?"":i.Parcel_Primary_Use,b=void 0===i.Building_Use_Code?"":i.Building_Use_Code,v=void 0===i.Sale_Date?"":i.Sale_Date,w=void 0===i.Sale_Price?"":Qe(i.Sale_Price),x=void 0===i.Vol_Page?"":i.Vol_Page,_=void 0===i.Prior_Appraised_Total?"":Qe(i.Prior_Appraised_Total),T=void 0===i.Prior_Assessed_Total?"":Qe(i.Prior_Assessed_Total),S=void 0===i.Prior_Assessment_Year?"":i.Prior_Assessment_Year,B=(void 0===i.geometry||i.geometry,void 0===i.Map?"":$.trim(i.Map)),E=void 0===i.objectid?"":i.objectid,C=void 0===i.LAT?"":i.LAT,P=void 0===i.LON?"":i.LON,D=void 0===i.AcctNum?"":i.AcctNum,k=void 0===i.Image_Path?"":i.Image_Path;"yes"===M.useUniqueIdforParcelMap?(zoomToItemId=o,a=o):(zoomToItemId=l,a=l),r="yes"===M.useVisionForTaxBillUrl?D:o,ae=E,I=l;const A=document.getElementById("detail-content"),F=document.createElement("div");F.innerHTML="",F.classList.add("details");let N=M.DetailLinksToInclude,O=M.DetailLinks,U=[];O.forEach((e=>{let t=e;if(N.includes(e)){let e={[t]:{show:"show"}};U.push(e)}else{let e={[t]:{show:"none"}};U.push(e)}}));let q=`\n      <p>\n      <span style="font-family:Tahoma;font-size:14px;"><strong>${s}</strong></span> <br>\n      </p>\n\n      <div>\n      <img class="image" src=${M.imageUrl}${k} alt="Building Photo" width="250" height="125">\n      </div>\n      <p>\n      <span style="font-family:Tahoma;font-size:12px;"><strong>${c} ${d}</strong></span> <br>\n      <span style="font-family:Tahoma;font-size:12px;"><strong>${p}</strong></span> <br>\n      <span style="font-family:Tahoma;font-size:12px;"><strong>${m} ${h} ${g}</strong></span><br>\n  </p>\n  <div id="accordion">\n    <div class="card" id="links" style="display:${U[0].links.show}">\n      <div class="card-header" id="headingOne">\n          <h5 class="mb-0">\n          <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">\n              Property Links\n          </button>\n        </h5>\n    </div>\n\n    \n    <div id="collapseOne" class="collapse show" aria-labelledby="OneFour" data-parent="#accordion">\n           <div class="card-body" style="text-align: left;">\n      `;"yes"===M.includePermitLink&&(q+=`<a class='mx-auto' href=${M.permitLink}?uniqueid=${o} target="_blank"><span style="font-family:Tahoma;font-size:12px;"><strong>Permits</strong></a><br>`),q+=`\n        <table style="width: 100%; font-family: Tahoma; font-size: 12px; border-collapse: collapse; text-align: left;">\n  <tr>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="${M.tax_bill}&uniqueId=${r}">\n        <strong>Tax Bills</strong>\n      </a>\n    </td>\n     <td>`,"yes"==M.propertyCardPdf?q+=`<a target="_blank" rel="noopener noreferrer" href="${M.propertyCard}${o}.PDF"><strong>Property Card</strong></a>`:q+=`<a target="_blank" rel="noopener noreferrer" href="${M.propertyCard}${o}"><strong>Property Card</strong></a>`,q+=`</td>\n  </tr>\n  <tr>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="https://publicweb-gis.s3.amazonaws.com/PDFs/${M.parcelMapUrl}/Quick_Maps/QM_${a}.pdf">\n        <strong>Parcel Map</strong>\n      </a>\n    </td>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="${M.taxMap_Url}${B}.pdf">\n        <strong>Tax Map</strong>\n      </a>\n    </td>\n  </tr>\n  <tr>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="https://www.google.com/maps/@${C},${P},17z/@${C},${P},17z/data=!5m1!1e2">\n        <strong>Google Maps</strong>\n      </a>\n    </td>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="https://www.bing.com/maps?cp=${C}~${P}&lvl=17.0">\n        <strong>Bing Maps</strong>\n      </a>\n    </td>\n  </tr>\n  <tr><td colspan="2"> &nbsp </td></tr>\n  <tr>\n    <td colspan="2">\n      <a target="_blank" rel="noopener noreferrer" href="${M.pdf_demo}">\n        <strong>Demographics Profile</strong>\n      </a>\n    </td>\n  </tr>\n  <tr>\n    <td colspan="2">\n      <a target="_blank" rel="noopener noreferrer" href="${M.housingUrl}">\n        <strong>Housing Profile</strong>\n      </a>\n    </td>\n  </tr>\n</table>\n\n          </div>\n        </div>\n      </div>\n        <div class="card " id="ids" style="display:${U[1].ids.show}">\n            <div class="card-header" id="headingTwo">\n            <h5 class="mb-0">\n                <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">\n                Property Ids & Uses\n                </button>\n            </h5>\n            </div>\n            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">\n                <div class="card-body">\n                  <p>\n                  <span style="font-family:Tahoma;font-size:12px;">Unique ID: <strong>${o}</strong></span> <br>\n                  <span style="font-family:Tahoma;font-size:12px;">MBL: <strong>${u}</strong></span> <br>\n                  <span style="font-family:Tahoma;font-size:12px;">Total Acres: <strong>${f}</strong></span> <br>\n                  <span style="font-family:Tahoma;font-size:12px;">Primary Use: <strong>${y}</strong></span> <br>\n                  <span style="font-family:Tahoma;font-size:12px;">Primary Bldg Use: <strong>${b}</strong></span><br>\n                  </p>\n                </div>\n            </div>\n        </div>\n    <div class="card" id="sales" style="display:${U[3].sales.show}" >\n    <div class="card-header" id="headingThree">\n      <h5 class="mb-0">\n        <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">\n          Latest Sale / Transfer\n        </button>\n      </h5>\n    </div>\n    <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">\n      <div class="card-body">\n        <p>\n        <span style="font-family:Tahoma;font-size:12px;">Sold on: <strong>${v}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;">Sale Price: <strong>$${w}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;">Volume/Page: <strong>${x}</strong></span><br>\n        </p>\n      </div>\n    </div>\n  </div>\n  <div class="card" id="vals" style="display:${U[2].vals.show}">\n    <div class="card-header" id="headingFour">\n        <h5 class="mb-0">\n          <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">\n            Valuations\n          </button>\n        </h5>\n      </div>\n      <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordion">\n        <div class="card-body">\n            <p>\n            <span style="font-family:Tahoma;font-size:12px;"><strong>Valuations:</strong></span><br>\n            <span style="font-family:Tahoma;font-size:12px;">GL Year: <strong>${S}</strong></span> <br>\n            <span style="font-family:Tahoma;font-size:12px;">Assessment: <strong>$${T}</strong></span> <br>\n            <span style="font-family:Tahoma;font-size:12px;">Appraised: <strong>$${_}</strong></span> <br>\n            <span style="font-family:Tahoma;font-size:12px;"></span>\n            </p>\n        </div>\n    </div>\n  </div>\n</div>\n    `,F.innerHTML=q,$("#details-spinner").hide(),A.appendChild(F),L&&$(".abutters-zoom").trigger("click"),L=!1}function Ye(e,t,n){Q={isChanged:!0,item:n};T.graphics.removeAll(A);C=t,E=t;const i=new s({geometry:C,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:3}},id:"uniqueBufferGraphicId"}),a=C.extent.expand(2);T.graphics.addMany([i]),T.goTo({target:i,extent:a})}function Xe(e,t,n){T.graphics.removeAll(A),Q={isChanged:!1,item:""},N=[];let i="uniqueBufferGraphicId";const a=T.graphics.items.findIndex((e=>e.id===i));if(a>-1&&T.graphics.removeAt(a),N=K.filter((e=>e.GIS_LINK==t)),"no"==sessionStorage.getItem("condos")&&N.length==K.length&&N.length>1)if(F){CondoBuffer=!1,C=F[0].geometry,E=F[0].geometry;const e={type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},t=2,n=C.extent.expand(t),a=new s({geometry:C,symbol:e,id:i});T.graphics.addMany([a]),T.goTo({target:a,extent:n}).catch((function(e){"AbortError"!=e.name&&console.error(e)}))}else{let e=`GIS_LINK = '${t}'`,n=$e.createQuery();n.where=e,n.returnGeometry=!0,n.returnHiddenFields=!0,n.outFields=["*"],$e.queryFeatures(n).then((e=>{let t=e.features[0].geometry;C=t,E=t;const n=C.extent.expand(2);T.goTo({target:t,extent:n}).catch((function(e){"AbortError"!=e.name&&console.error(e)}));const a=new s({geometry:E,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:i});T.graphics.addMany([a])}))}else{let a;if(CondoBuffer=!0,a=n?K.filter((t=>t.uniqueId==e)):K.filter((t=>t.objectid==e)),a.length>0)if(null!=a[0].geometry&&""!=a[0].geometry){E=a[0].geometry;const e=2,t=E.extent.expand(e);T.goTo({target:E,extent:t}).catch((function(e){"AbortError"!=e.name&&console.error(e)}));const n=new s({geometry:E,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:i});T.graphics.addMany([n])}else{let e;CondoBuffer=!1,e=a.filter((e=>{e.GIS_LINK}))?`GIS_LINK = '${t}'`:`GIS_LINK = '${a[0].GIS_LINK}'`;let n=$e.createQuery();n.where=e,n.returnGeometry=!0,n.returnHiddenFields=!0,n.outFields=["*"],$e.queryFeatures(n).then((e=>{let t=e.features[0].geometry;E=t,C=t;const n=C.extent.expand(2);T.goTo({target:t,extent:n}).catch((function(e){"AbortError"!=e.name&&console.error(e)}));const a=new s({geometry:E,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:i});T.graphics.addMany([a])}))}}R&&(R?.remove(),R=null),O&&(O?.remove(),O=null),O=T.on("click",Ge)}T.when((function(){document.getElementById("zoom-in").onclick=function(){T.zoom+=1},document.getElementById("zoom-out").onclick=function(){T.zoom-=1}})),X.addEventListener("click",(function(){Ae()})),ee.addEventListener("click",(function(){Ae()})),document.getElementById("searchInput").addEventListener("input",(function(e){S=e.target.value.toUpperCase().replace(/&amp;/g,"&")})),$(document).ready((function(){$("#backButton").on("click",(function(){if(A&&A.length>=1||!0===q||K.length>0)if($("#WelcomeBox").hide(),$("#select-button").prop("disabled",!1),$("#detailBox").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#featureWid").show(),$("#total-results").show(),$("#ResultDiv").show(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#detail-content").empty(),$("#backButton").hide(),$("#detailsButton").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").show(),$("#exportButtons").show(),$("#exportSearch").show(),$("#results-div").css("height","300px"),$(".center-container").show(),T.graphics.removeAll(),T.graphics.addMany(A),A.length>1){const e=A.map((e=>e.geometry.extent)),t=3,n=e.reduce(((e,t)=>e.union(t)),e[0]).expand(t);T.goTo({target:n}).catch((e=>{console.error("Error zooming to extent:",e)}))}else{const e=2,t=A[0].geometry.extent.expand(e);T.goTo({target:A,extent:t})}else $("#total-results").hide(),$("#ResultDiv").hide(),$("#abut-mail").hide(),$("#backButton").hide(),$("#details-btns").hide(),$("#detailBox").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#dropdown").show(),$(".center-container").show(),$("#WelcomeBox").show();H||Z?!H&&Z||!Z&&H?(R&&R.remove(),O&&(O?.remove(),O=null),$("#select-button").addClass("btn-warning"),R=T.on("click",Ke)):H&&!Z?(R&&(R?.remove(),R=null),O&&(O?.remove(),O=null),R=T.on("click",Ke),$("#select-button").addClass("btn-warning")):(R&&(R?.remove(),R=null),O&&(O?.remove(),O=null),$("#select-button").addClass("btn-warning"),R=T.on("click",Ke)):(O&&(O?.remove(),O=null),R&&(R?.remove(),R=null),R&&Z&&(R?.remove(),R=null),$("#select-button").removeClass("btn-warning"),O=T.on("click",Ge))}))})),$(document).ready((function(){$("#detailsButton").on("click",(function(){$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detail-content").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportSearch").hide(),$("#exportButtons").hide(),$("#abutters-title").html("Abutting Parcels (0)"),$("#backButton-div").css("padding-top","0px"),$("#results-div").css("height","300px"),O&&(O?.remove(),O=null),O=T.on("click",Ge);const e=T.graphics.items.findIndex((e=>e.id===k));e>-1&&T.graphics.removeAt(e)}))})),$(document).ready((function(){$("#abutters-attributes").on("click",(function(e){O&&(O?.remove(),O=null),R&&(R?.remove(),R=null),$("#results-div").css("height","300px"),$("#exportButtons").show(),$("#exportResults").show(),$("#exportButtons").show(),$("#exportSearch").hide(),$("#csvExportResults").show(),$("#csvExportSearch").hide(),$("#WelcomeBox").hide(),$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#abutters-content").show(),$("#selected-feature").empty(),$("#backButton").show(),$("#detailsButton").show(),$("#parcel-feature").empty(),$("#backButton-div").css("padding-top","78px"),$("#abutters-title").html("Abutting Parcels (0)"),et(e),Y.value=100,Ze("100")}))})),$(document).ready((function(){$("#filterButton").on("click",(function(){$("#WelcomeBox").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#exportSearch").hide(),$("#csvExportSearch").hide(),$("#abutters-content").hide(),$("#layerListDiv").hide(),$("#selected-feature").empty(),$("#backButton").hide(),$("#detailsButton").hide(),$("#dropdown").show(),$("#filterDiv").show(),$("#dropdown").toggleClass("expanded"),$("#sidebar2").css("left","0px"),$("#sidebar2").addClass("collapsed"),$("#results-div").css("left","350px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide(),$("#results-div").css("height","300px"),$("#parcel-feature").empty(),$("#backButton").show(),$("#backButton-div").css("padding-top","0px"),$("#abutters-title").html("Abutting Parcels (0)"),$(".center-container").show()}))})),$(document).ready((function(){$("#layerListBtn").on("click",(function(){$("#WelcomeBox").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#exportSearch").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportButtons").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#backButton").hide(),$("#detailsButton").hide(),$("#dropdown").show(),$("#filterDiv").hide(),$("#backButton").show(),$("#dropdown").toggleClass("expanded"),$("#sidebar2").css("left","0px"),$("#sidebar2").addClass("collapsed"),$("#results-div").css("left","350px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide(),$("#results-div").css("height","300px"),$("#layerListDiv").show(),$("#parcel-feature").empty(),$("#backButton-div").css("padding-top","0px"),$("#abutters-title").html("Abutting Parcels (0)"),$(".center-container").show()}))})),$("#layerListDiv").hide(),$(document).ready((function(){$("#exportSearch").on("click",(function(e){e.stopPropagation();const t=document.createElement("div");t.style.visibility="hidden",document.body.appendChild(t);const n=document.createElement("ul");P.forEach((function(e){let t=e.objectid,i=e.owner,a=e.coOwner,r=e.mailingAddress,s=(e.mailingAddress2,e.Mailing_City),o=e.Mail_State,l=e.Mailing_Zip,d=(e.location,e.MBL);const c=document.createElement("li");let u;c.classList.add("export-search-list"),u=` ${i} ${a} <br> MBL: ${d} <br> ${r} <br> ${s}, ${o} ${l}`,c.innerHTML+=u,c.setAttribute("object-id",t),n.appendChild(c)})),t.appendChild(n),je("search"),document.body.removeChild(t)}))})),$(document).ready((function(){$("#csvExportResults").on("click",(function(e){e.stopPropagation();let t=["Owner","Co-Owner","Mailing Address","Mailing Address 2","Mailing City","Mailing State","Mailing Zip","MBL","Location"].join(",")+"\n";ie.forEach((function(e){let n=e.attributes.Owner||"",i=e.attributes.Co_Owner||"",a=e.attributes.Mailing_Address_1||"",r=e.attributes.Mailing_Address_2||"",s=e.attributes.Mailing_City||"",o=e.attributes.Mail_State||"",l=e.attributes.Mailing_Zip?`\t${e.attributes.Mailing_Zip.toString().padStart(5,"0")}`:"",d=e.attributes.Location||"",c=e.attributes.MBL||"";t+=`"${n}","${i}","${a}","${r}","${s}","${o}","${l}","${c}","${d}"\n`}));const n=new Blob([t],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(void 0!==i.download){const e=URL.createObjectURL(n);i.setAttribute("href",e),i.setAttribute("download","export.csv"),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}}))})),$(document).ready((function(){$("#csvExportSearch").on("click",(function(e){e.stopPropagation();let t=["Owner","Co-Owner","Mailing Address","Mailing Address 2","Mailing City","Mailing State","Mailing Zip","MBL","Location"].join(",")+"\n";P.forEach((function(e){let n=e.owner||"",i=e.coOwner||"",a=e.mailingAddress||"",r=e.mailingAddress2||"",s=e.Mailing_City||"",o=e.Mail_State||"",l=e.Mailing_Zip?`\t${e.Mailing_Zip.toString().padStart(5,"0")}`:"",d=e.location||"",c=e.MBL||"";t+=`"${n}","${i}","${a}","${r}","${s}","${o}","${l}","${c}","${d}"\n`}));const n=new Blob([t],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(void 0!==i.download){const e=URL.createObjectURL(n);i.setAttribute("href",e),i.setAttribute("download","export.csv"),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}}))})),$(document).ready((function(){$("#exportResults").on("click",(function(e){e.stopPropagation();const t=document.createElement("div");t.style.visibility="hidden",document.body.appendChild(t);const n=document.createElement("ul");P.forEach((function(e){let t=e.attributes.OBJECTID,i=e.attributes.Owner,a=e.attributes.Co_Owner,r=e.attributes.Mailing_Address_1,s=(e.attributes.Mailing_Address_2,e.attributes.Mailing_City),o=e.attributes.Mail_State,l=e.attributes.Mailing_Zip,d=(e.location,e.attributes.MBL);const c=document.createElement("li");let u;c.classList.add("abutters-group-list"),u=` ${i} ${a} <br> MBL: ${d} <br> ${r} <br> ${s}, ${o} ${l}`,c.innerHTML+=u,c.setAttribute("object-id",t),n.appendChild(c)})),t.appendChild(n),je("details"),document.body.removeChild(t)}))})),$(document).ready((function(){let e;function t(){clearTimeout(e),e=setTimeout((()=>{Ze(currentVal)}),200)}$("#buffer-value").on("change",(function(e){e.stopPropagation(),currentVal=Y.value=parseInt(Y.value),$("#parcel-feature").empty(),t()})),$("#increase").on("click",(function(e){e.stopPropagation(),currentVal=Y.value=parseInt(Y.value)+1,$("#parcel-feature").empty(),t()})),$("#decrease").on("click",(function(e){e.stopPropagation(),currentVal=Y.value=parseInt(Y.value)-1,$("#parcel-feature").empty(),t()})),$("#submit").on("click",(function(e){e.stopPropagation(),e.preventDefault(),currentVal=Y.value=parseInt(Y.value),$("#parcel-feature").empty(),t()})),$("#buffer-value").on("keypress",(function(e){13==e.which&&(currentVal=Y.value=parseInt(Y.value),e.preventDefault(),t())})),$(".units").on("click",(function(e){"feet"==e.target.value?(j="feet",$("#unitSelector").html(j)):(j="meters",$("#unitSelector").html(j))}))})),$(document).ready((function(){$(document).on("click",".abutters-zoom",(function(e){if(e.stopPropagation(),e.preventDefault(),"no"===sessionStorage.getItem("condos"))if(V){if(V){let e=`GIS_LINK = '${I}'`,t=$e.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],$e.queryFeatures(t).then((e=>{const t=e.features[0].geometry.extent,n=t.center;t.expand(3);T.goTo({target:n,zoom:14})}))}}else{let e=`OBJECTID = ${ae}`,t=$e.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],$e.queryFeatures(t).then((e=>{const t=e.features[0].geometry.extent,n=t.center;t.expand(3);T.goTo({target:n})}))}else{let e=`OBJECTID = ${ae}`,t=ye.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],ye.queryFeatures(t).then((e=>{let n,i,a,r;e.features>0?ye.queryFeatures(t).then((e=>{let t=ye.createQuery();t.where=`GIS_LINK = ${I}`,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"]})).then((e=>{n=e,i=n.features[0].geometry,a=i.extent,r=a.center})):(n=e,i=n.features[0].geometry,a=i.extent,r=a.center),T.goTo({target:r})}))}}))}));const et=function(e,t){$("#abutters-title").html("Abutters");let n,i,a,r,s,o,l,d,c,u=G;if(Q.isChanged)locationMaillingAddress=Q.item.attributes.Mailing_Address_1,locationUniqueId=Q.item.attributes.Uniqueid,n=Q.item.attributes.GIS_LINK,i=Q.item.attributes.Owner,c=Q.item.attributes.MBL,a=Q.item.attributes.Co_Owner,s=Q.item.attributes.Mailing_Address_1,o=Q.item.attributes.Mailing_Address_2,l=Q.item.attributes.Mailing_City,r=Q.item.attributes.Mailing_Zip,d=Q.item.attributes.Mail_State;else{var p=K.find((function(e){return e.uniqueId===u[1]&&e.objectid===Number(u[0])||e.GIS_LINK===u[1]&&e.objectid===Number(u[0])}));locationMaillingAddress=void 0===p.mailingAddress?"":p.mailingAddress,locationUniqueId=void 0===p.uniqueId?"":p.uniqueId,n=void 0===p.GIS_LINK?"":p.GIS_LINK,i=void 0===p.owner?"":p.owner,a=void 0===p.coOwner?"":p.coOwner,s=void 0===p.mailingAddress?"":p.mailingAddress,o=void 0===p.mailingAddress2?"":p.mailingAddress2,l=void 0===p.Mailing_City?"":p.Mailing_City,d=void 0===p.Mail_State?"":p.Mail_State,r=void 0===p.Mailing_Zip?"":p.Mailing_Zip,c=void 0===p.MBL?"":p.MBL}const m=document.getElementById("selected-feature"),h=document.createElement("ul");h.classList.add("row"),h.classList.add("list-group");const g=document.createElement("li");let f;g.classList.add("abutters-group-item","col-12"),f=` ${i} ${a} <br> ${s} ${o} <br> ${l}, ${d} ${r}`,g.innerHTML+=f,g.setAttribute("data-id",n),$("#abutters-spinner").hide(),h.appendChild(g),m.appendChild(h)},tt=(e,t,n)=>{let i;K=[],document.getElementById("suggestions").innerHTML="",B&&(S=e.replace(/&amp;/g,"&"));let a=S;if(!(a?.length<3)||t||a||n){let e,r;$("#dropdown").toggleClass("expanded"),$("#details-btns").hide(),$("#abut-mail").hide(),$("#result-btns").hide(),$("#backButton").hide(),$("#detailsButton").hide(),$("#featureWid").empty(),$("#exportSearch").hide(),$("#csvExportResults").hide(),$("#exportButtons").hide(),e=`\n          Street_Name LIKE '%${a}%' OR \n          MBL LIKE '%${a}%' OR \n          Location LIKE '%${a}%' OR \n          Co_Owner LIKE '%${a}%' OR \n          Uniqueid LIKE '%${a}%' OR \n          Owner LIKE '%${a}%' OR \n          GIS_LINK LIKE '%${a}%'\n      `,t?r=t:z?(r=n,H=!0):L?r=t:(r=be.createQuery(),r.where=e,r.returnGeometry=!1,r.returnHiddenFields=!0,r.outFields=["*"]),be.queryFeatures(r).then((e=>{if(e.features.length>0){let a;i=e.features,"MISMATCH"===e.features[0].attributes.Match_Status&&"Condominium"===e.features[0].attributes.Parcel_Type&&0==H&&(U=!0),i.forEach((function(e){if(""!==e.attributes.Owner){let t=e.attributes.OBJECTID,n=e.attributes.Location,i=e.attributes.Uniqueid,a=e.attributes.GIS_LINK,r=e.attributes.Co_Owner,s=e.attributes.Owner,o=e.attributes.MBL,l=e.geometry,d=e.attributes.Mailing_Address_1,c=e.attributes.Mailing_Address_2,u=e.attributes.Mailing_City,p=e.attributes.Mail_State,m=e.attributes.Mailing_Zip,h=e.attributes.Total_Acres,g=e.attributes.Parcel_Primary_Use,f=e.attributes.Building_Use_Code,$=e.attributes.Parcel_Type,b=e.attributes.Design_Type,v=e.attributes.Zoning,w=e.attributes.Neighborhood,x=e.attributes.Land_Type_Rate,_=e.attributes.Functional_Obs,T=e.attributes.External_Obs,I=y(e.attributes.Sale_Date),L=e.attributes.Sale_Price,S=e.attributes.Vol_Page,M=e.attributes.Assessed_Total,B=e.attributes.Appraised_Total,E=e.attributes.Influence_Factor,C=e.attributes.Influence_Type,P=e.attributes.Land_Type,D=e.attributes.Prior_Assessment_Year,k=e.attributes.Prior_Assessed_Total,A=e.attributes.Prior_Appraised_Total,F=e.attributes.Map,N=e.attributes.Lat,O=e.attributes.Lon,R=e.attributes.Image_Path,U=e.attributes.AcctNum,q=e.attributes.Match_Status;K.push(new qe(t,n,i,a,r,s,o,l,d,c,u,p,m,h,g,f,$,b,v,w,x,_,T,I,L,S,M,B,E,C,P,D,k,A,F,N,O,R,U,q))}})),"no"===sessionStorage.getItem("condos")?(a=$e.createQuery(),a.where=r.where,a.returnDistinctValues=!1,a.returnGeometry=!0,a.outFields=["*"]):(a=ye.createQuery(),a.where=r.where,a.returnDistinctValues=!1,a.returnGeometry=!0,a.outFields=["*"]);let s=null;z?a.where=n.where:L&&(a.where=t.where,s=!0),Ve(S,s,a)}})).catch((e=>{console.error("Error querying for details:",e)}))}else Ae()};function nt(e,t,n){let i=e,a=t;if(i.length<=0)return Ae(),void alert("Search resulted in an error, please try again.");let r=i[0].attributes.Uniqueid,o=i[0].attributes.OBJECTID;$("#details-spinner").show(),$("#WelcomeBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportButtons").hide(),$("#exportSearch").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$(".center-container").hide(),function(e,t){T.graphics.removeAll(A),console.log(e),console.log(t);let n=e[0].geometry,i=e[0].attributes.GIS_LINK;if(n){C=n,E=n;const e=2,t=C.extent.expand(e);T.goTo({target:n,extent:t}).catch((function(e){"AbortError"!=e.name&&console.error(e)}));const i=new s({geometry:n,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}}});T.graphics.addMany([i])}else{let e=`GIS_LINK = '${i}'`,t=$e.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],$e.queryFeatures(t).then((e=>{let t=e.features[0].geometry;C=t,E=t;const n=C.extent.expand(2);T.goTo({target:t,extent:n}).catch((function(e){"AbortError"!=e.name&&console.error(e)}));const i=new s({geometry:E,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:k});T.graphics.addMany([i])}))}R&&(R?.remove(),R=null),O&&(O?.remove(),O=null),O=T.on("click",Ge)}(i,a),Je(o,r),q=!0,U=!1,L=!1,$(".spinner-container").hide()}const it=function(){const e={},t=window.location.search.substring(1).split("&");for(let n=0;n<t.length;n++){const i=t[n].split("=");i[0]&&i[1]&&(e[decodeURIComponent(i[0])]=decodeURIComponent(i[1].replace(/\+/g," ")))}return e}().uniqueid;let at,rt=`Uniqueid = '${it}'`;it&&(L=!0,T.when((function(){query=be.createQuery(),query.where=rt,query.returnGeometry=!1,query.returnHiddenFields=!0,query.outFields=["*"],query=be.createQuery(),query.where=rt,query.returnGeometry=!1,query.returnHiddenFields=!0,query.outFields=["*"],ve.queryFeatures(query).then((e=>{let t=e.features[0].attributes,n=t.Building_Type;"MISMATCH"===t.Match_Status&&"Condominium"===n&&(U=!0),tt(null,query)}))})).catch((function(e){console.error("Error occurred while the view was loading: ",e)}))),document.getElementById("searchInput").addEventListener("input",(function(e){K=[],$("#sidebar2").css("left","-350px"),$("#sidebar2").removeClass("collapsed"),$("#results-div").css("left","0px"),$("#dropdown").toggleClass("expanded"),$("#dropdown").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide();var t=e.target.value.toUpperCase();K=[],secondList=[],A=[],$("#select-button").removeClass("btn-warning"),$("#searchInput ul").remove(),$("#suggestions").hide(),$("#featureWid").empty(),$("#featureWid").hide(),$("#ResultDiv").hide(),$("#dropdown").removeClass("expanded"),$("#dropdown").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#right-arrow-2").show(),$("#left-arrow-2").hide(),$("#abutters-content").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#backButton").hide(),$("#detailBox").hide(),$("#exportSearch").hide(),$("#csvExportSearch").hide(),$("#csvExportResults").hide(),$("#exportButtons").hide(),O&&(O?.remove(),O=null),R&&(R?.remove(),R=null),$("#dropdown").show(),$("#WelcomeBox").show(),$(".center-container").show(),document.getElementById("suggestions").innerHTML="",$("#featureWid").empty(),T.graphics.removeAll();let n=`\n            Street_Name LIKE '%${t}%' OR \n            MBL LIKE '%${t}%' OR \n            Location LIKE '%${t}%' OR \n            Co_Owner LIKE '%${t}%' OR \n            Uniqueid LIKE '%${t}%' OR \n            Owner LIKE '%${t}%' OR\n            GIS_LINK LIKE '%${t}%'\n        `,i=ve.createQuery();i.where=n,i.returnGeometry=!1,i.outFields=["Street_Name","MBL","Location","Co_Owner","Uniqueid","Owner","GIS_LINK"];let a=new Set;ve.queryFeatures(i).then((e=>{let n=document.getElementById("suggestions");n.innerHTML="",e.features.forEach((e=>{["Street_Name","MBL","Location","Co_Owner","Uniqueid","Owner","GIS_LINK"].forEach((i=>{let r=e.attributes[i];if(r&&r.includes(t)&&!a.has(r)){let e=document.createElement("div");e.className="list-group-item",e.innerText=`${r}`,n.appendChild(e),a.add(r),n.style.display="block",e.addEventListener("click",(function(e){B=!0,tt(e.target.innerHTML),B=!1}))}}))}))}))})),document.querySelector(".form-inline").addEventListener("submit",(function(e){"no"===sessionStorage.getItem("condos")?$e.visible=!0:ye.visible=!0,K=[],T.graphics.removeAll(),A=[],e.preventDefault(),$("#featureWid").empty(),$("#selected-feature").empty(),O&&(O?.remove(),O=null),R&&(R?.remove(),R=null)})),document.addEventListener("click",(function(e){"searchInput"!==e.target.id&&(document.getElementById("suggestions").style.display="none")})),document.getElementById("searchButton").addEventListener("click",(function(){$("#sidebar2").css("left","-350px"),$("#sidebar2").removeClass("collapsed"),$("#results-div").css("left","0px"),$("#exportResults").hide(),$("#csvExportResults").hide(),clearTimeout(at),at=setTimeout((()=>{"no"===sessionStorage.getItem("condos")?$e.visible=!0:ye.visible=!0,$("#lasso").removeClass("btn-warning"),$("#select-button").removeClass("btn-warning"),$("dropdown").empty(),$("#featureWid").empty(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#total-results").show(),$("#ResultDiv").hide(),$("#backButton").hide(),$("#detailsButton").hide(),$("#detailBox").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#abutters-title").html("Abutting Parcels (0)"),A=[],T.graphics.removeAll(),O&&(O?.remove(),O=null),R&&(R?.remove(),R=null),tt()}),300)})),$(document).ready((function(){se={streetName:null,owner:null,appraisedValueMin:null,appraisedValueMax:null,assessedValueMin:null,assessedValueMax:null,zoningType:null,neighborhoodType:null,propertyType:null,buildingType:null,buildingUseType:null,designType:null,acresValueMin:null,acresValueMax:null,soldOnMin:null,soldOnMax:null,soldPMin:null,soldPMax:null},$("#streetFilter").on("calciteComboboxChange",(function(e){let t;if(se.streetName=e.target.value,""!==se.streetName&&void 0!==se.streetName&&null!==se.streetName)Ee("Street_Name",e.target.value),Pe("Street_Name",e.target.value);else{clearTimeout(t),t=setTimeout((()=>{n()}),600)}})),$("#ownerFilter").on("calciteComboboxChange",(function(e){if(se.owner=e.target.value,""!==se.owner&&void 0!==se.owner&&null!==se.owner)Ee("Owner",e.target.value),Pe("Owner",e.target.value);else{let e;clearTimeout(e),e=setTimeout((()=>{n()}),600)}})),$("#app-val-min, #app-val-max").on("input",(function(){var e=$("#app-val-min").val(),t=$("#app-val-max").val();e=e.replace(/^\$/,"").replace(/,/g,""),t=t.replace(/^\$/,"").replace(/,/g,"");var n=parseInt(e,10),i=parseInt(t,10);if(!isNaN(n)&&!isNaN(i)){var a=n.toLocaleString(),r=i.toLocaleString();$("#app-val-min").val("$"+a),$("#app-val-max").val("$"+r),se.appraisedValueMin=n,se.appraisedValueMax=i}!isNaN(n)&&!isNaN(i)&&n<=i&&e.length>=6&&t.length>=6&&(se.appraisedValueMin=n,se.appraisedValueMax=i,Ee("Appraised_Total",n,i),Pe("Appraised_Total",n,i))})),$("#assess-val-min, #assess-val-max").on("input",(function(){var e=$("#assess-val-min").val(),t=$("#assess-val-max").val();e=e.replace(/^\$/,"").replace(/,/g,""),t=t.replace(/^\$/,"").replace(/,/g,"");var n=parseInt(e,10),i=parseInt(t,10);if(!isNaN(n)&&!isNaN(i)){var a=n.toLocaleString(),r=i.toLocaleString();$("#assess-val-min").val("$"+a),$("#assess-val-max").val("$"+r),se.assessedValueMin=n,se.assessedValueMax=i}!isNaN(n)&&!isNaN(i)&&n<=i&&e.length>=6&&t.length>=6?(se.assessedValueMin=n,se.assessedValueMax=i,Ee("Assessed_Total",n,i),Pe("Assessed_Total",n,i)):console.log("Invalid input values: ",n,i)})),$("#propertyFilter").on("calciteComboboxChange",(function(e){if(se.propertyType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Ee("Parcel_Type",e.target.value),Pe("Parcel_Type",e.target.value);else{!function(){let e;clearTimeout(e),e=setTimeout((()=>{n()}),600)}()}})),$("#zoningFilter").on("calciteComboboxChange",(function(e){if(se.zoningType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Ee("Zoning",e.target.value),Pe("Zoning",e.target.value);else{let e;clearTimeout(e),e=setTimeout((()=>{n()}),600)}})),$("#neighborhoodFilter").on("calciteComboboxChange",(function(e){if(se.neighborhoodType=e.target.value,""!==e.target.value||void 0!==e.target.value||null!==e.target.value)Ee("Neighborhood",e.target.value),Pe("Neighborhood",e.target.value);else{let e;clearTimeout(e),e=setTimeout((()=>{n()}),600)}})),$("#buildingFilter").on("calciteComboboxChange",(function(e){if(se.buildingType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Ee("Building_Type",e.target.value),Pe("Building_Type",e.target.value);else{let e;clearTimeout(e),e=setTimeout((()=>{n()}),600)}})),$("#buildingUseFilter").on("calciteComboboxChange",(function(e){if(se.buildingUseType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Ee("Building_Use_Code",e.target.value),Pe("Building_Use_Code",e.target.value);else{let e;clearTimeout(e),e=setTimeout((()=>{n()}),600)}})),$("#designTypeFilter").on("calciteComboboxChange",(function(e){if(se.designType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Ee("Design_Type",e.target.value),Pe("Design_Type",e.target.value);else{let e;clearTimeout(e),e=setTimeout((()=>{n()}),600)}})),$("#acres-val-min, #acres-val-max").on("input",(function(){var e=parseFloat($("#acres-val-min").val()),t=parseFloat($("#acres-val-max").val()),n=$("#acres-val-min").val().trim(),i=$("#acres-val-max").val().trim();!isNaN(e)&&!isNaN(t)&&e<=t&&n.length>=0&&i.length>=0?(se.acresValueMin=e,se.acresValueMax=t,Ee("Total_Acres",e,t),Pe("Total_Acres",e,t)):console.log("Invalid input values: ",e,t)})),$("#sold_calendar_lowest").on("calciteDatePickerChange",(function(){var e=$("#sold_calendar_lowest").val(),t=$("#sold_calendar_highest").val();se.soldOnMin=e,se.soldOnMax=t,Ee("Sale_Date",e,t),Pe("Sale_Date",e,t)})),$("#sold_calendar_highest").on("calciteDatePickerChange",(function(){var e=new Date($("#sold_calendar_lowest").val()),t=new Date($("#sold_calendar_highest").val());e.setDate(e.getDate()+1),t.setDate(t.getDate()+1);var n=e.toISOString().split("T")[0],i=t.toISOString().split("T")[0];se.soldOnMin=n,se.soldOnMax=i,Ee("Sale_Date",n,i),Pe("Sale_Date",n,i)}));let e,t=null;function n(){const e=["#designTypeFilter","#buildingUseFilter","#buildingFilter","#neighborhoodFilter","#zoningFilter","#propertyFilter","#ownerFilter","#streetFilter"].map((e=>$(e).val())).every((function(e){return 0===e.length}));return t!==e&&(e&&a(),t=e),e}async function i(){let e=[],t=["Appraised_Total","Assessed_Total","Total_Acres","Sale_Date","Sale_Price"];for(let n of t){let t=be.createQuery();t.outStatistics=[{statisticType:"max",onStatisticField:n,outStatisticFieldName:"maxValue"},{statisticType:"min",onStatisticField:n,outStatisticFieldName:"minValue"}];try{let i,a=await be.queryFeatures(t);if("Sale_Date"===n){let e=new Date(a.features[0].attributes.maxValue),t=new Date(a.features[0].attributes.minValue);i={[n]:{min:t,max:e}}}else{let e=a.features[0].attributes.maxValue,t=a.features[0].attributes.minValue;i={[n]:{min:t,max:e}}}e.push(i)}catch(e){console.error("Error querying features:",e)}}var n;n=e,[{fieldName:"Appraised_Total",minInput:"#app-val-min",maxInput:"#app-val-max",index:0},{fieldName:"Assessed_Total",minInput:"#assess-val-min",maxInput:"#assess-val-max",index:1},{fieldName:"Total_Acres",minInput:"#acres-val-min",maxInput:"#acres-val-max",index:2},{fieldName:"Sale_Date",minInput:"#sold_calendar_lowest",maxInput:"#sold_calendar_highest",index:3},{fieldName:"Sale_Price",minInput:"#saleP-val-min",maxInput:"#saleP-val-max",index:4}].forEach((function(e){if("Sale_Date"==e.fieldName){const a=$(e.minInput),r=$(e.maxInput);Te(e.minInput),Te(e.maxInput),a.empty(),r.empty();var t=n[e.index][e.fieldName].min,i=n[e.index][e.fieldName].max;let s=new Date(t),o=new Date(i),l=`${s.getFullYear()}-${("0"+(s.getMonth()+1)).slice(-2)}-${("0"+s.getDate()).slice(-2)}`,d=`${o.getFullYear()}-${("0"+(o.getMonth()+1)).slice(-2)}-${("0"+o.getDate()).slice(-2)}`;a.val(l),r.val(d),Ie(e.minInput,l),Ie(e.maxInput,d)}else{Te(e.minInput),Te(e.maxInput);const t=$(e.minInput),i=$(e.maxInput),a=t.value=n[e.index][e.fieldName].min,r=i.value=n[e.index][e.fieldName].max;let s,o;"Total_Acres"!==e.fieldName?(s="$"+a.toLocaleString(),o="$"+r.toLocaleString()):(s=a.toLocaleString(),o=r.toLocaleString()),t.val(s),i.val(o),Ie(e.minInput,s),Ie(e.maxInput,o)}}))}function a(){clearTimeout(e),e=setTimeout((()=>{!function(){dontTriggerMultiQuery=!0,t=null,$("#lasso").removeClass("btn-warning"),$("#searchInput ul").remove(),$("#searchInput").val="",document.getElementById("searchInput").value="",S="",searchTerm="",K=[],secondList=[],le=[{layer:ye,field:"Appraised_Total",filterSelector:"#app-val-min",filterSelector2:"#app-val-max"},{layer:ye,field:"Assessed_Total",filterSelector:"#assess-val-min",filterSelector2:"#assess-val-max"},{layer:ye,field:"Total_Acres",filterSelector:"#acres-val-min",filterSelector2:"#acres-val-max"},{layer:ye,field:"Sale_Date",filterSelector:"#sold_calendar_lowest",filterSelector2:"#sold_calendar_highest"},{layer:ye,field:"Sale_Price",filterSelector:"#saleP-val-min",filterSelector2:"#saleP-val-max"}],oe=[{layer:ye,field:"Street_Name",filterSelector:"#streetFilter",alias:"Street_Name",message:"Select a Street Name"},{layer:ye,field:"Owner",filterSelector:"#ownerFilter",message:"Select a Owner"},{layer:ye,field:"Parcel_Type",filterSelector:"#propertyFilter",alias:"Parcel_Type",message:"Select a Property Type"},{layer:ye,field:"Building_Type",filterSelector:"#buildingFilter",message:"Select a Building Type"},{layer:ye,field:"Building_Use_Code",filterSelector:"#buildingUseFilter",message:"Select a Building Use Type"},{layer:ye,field:"Design_Type",filterSelector:"#designTypeFilter",message:"Select a Design Type"},{layer:ye,field:"Zoning",filterSelector:"#zoningFilter",message:"Select a Zone"},{layer:ye,field:"Neighborhood",filterSelector:"#neighborhoodFilter",message:"Select a Neighborhood"}],de=[{layer:ye,field:"Appraised_Total",filterSelector:"#streetFilter",minInput:"app-val-min",maxInput:"app-val-max",minValField:"appraisedValueMin",maxValueField:"appraisedValueMax",index:0},{layer:ye,field:"Assessed_Total",filterSelector:"#ownerFilter",minInput:"assess-val-min",maxInput:"assess-val-max",minValField:"assessedValueMin",maxValueField:"assessedValueMax",index:1},{layer:ye,field:"Total_Acres",filterSelector:"#propertyFilter",minInput:"acres-val-min",maxInput:"acres-val-max",minValField:"acresValueMin",maxValueField:"acresValueMax",index:2},{layer:ye,field:"Sale_Date",filterSelector:"#buildingFilter",minInput:"sold_calendar_lowest",maxInput:"sold_calendar_highest",minValField:"soldOnMin",maxValueField:"soldOnMax",index:3},{layer:ye,field:"Sale_Price",filterSelector:"#buildingUseFilter",minInput:"saleP-val-min",maxInput:"saleP-val-max",minValField:"soldPMin",maxValueField:"soldPMax",index:4}],$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#dropdown").hide(),$("#right-arrow-2").show(),$("#left-arrow-2").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#backButton").show(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportSearch").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#featureWid").hide(),$("#exportButtons").hide(),$("#dropdown").show(),$("#WelcomeBox").hide(),$("#select-button").attr("title","Add to Selection Enabled"),document.getElementById("suggestions").innerHTML="",$("#distanceButton").removeClass("btn-warning"),$("#distanceButton").addClass("bg-info"),$("#areaButton").removeClass("btn-warning"),$("#distanceButton").addClass("bg-info"),$("#featureWid").empty(),T.ui.remove(he),he&&(he.destroy(),he=null),T.graphics.removeAll(),A=[],Object.keys(se).forEach((e=>{se[e]=null}));const e=$("#streetFilter"),n=$("#ownerFilter"),a=$("#propertyFilter"),r=$("#buildingFilter"),s=$("#buildingUseFilter"),o=$("#designTypeFilter"),l=$("#zoningFilter"),d=$("#neighborhoodFilter"),c=$("#sold_calendar_lowest"),u=$("#sold_calendar_highest");e.empty(),n.empty(),a.empty(),r.empty(),s.empty(),o.empty(),l.empty(),d.empty(),c.value="",u.value="",c.activeDate=null,u.activeDate=null,De(0,"Street_Name","#streetFilter","Select a Street Name"),De(0,"Owner","#ownerFilter","Select a Owner"),De(0,"Parcel_Type","#propertyFilter","Select a Property Type"),De(0,"Building_Type","#buildingFilter","Select a Building Type"),De(0,"Building_Use_Code","#buildingUseFilter","Select a Building Use"),De(0,"Design_Type","#designTypeFilter","Select a Design Type"),De(0,"Zoning","#zoningFilter","Select a Zone"),De(0,"Neighborhood","#neighborhoodFilter","Select a Neighborhood"),i(),$(".wrapper .x-button").click(),$("#streetFilter").value=""}()}),600)}document.addEventListener("DOMContentLoaded",(()=>{t=n()})),$("#saleP-val-min, #saleP-val-max").on("input",(function(){var e=$("#saleP-val-min").val(),t=$("#saleP-val-max").val();e=e.replace(/^\$/,"").replace(/,/g,""),t=t.replace(/^\$/,"").replace(/,/g,"");var n=parseInt(e,10),i=parseInt(t,10);if(isNaN(n)||isNaN(i))console.log("Invalid input");else{var a=n.toLocaleString(),r=i.toLocaleString();$("#saleP-val-min").val("$"+a),$("#saleP-val-max").val("$"+r),se.soldPMin=n,se.soldPMax=i,Ee("Sale_Price",n,i),Pe("Sale_Price",n,i)}})),i(),$("#submitFilter").on("click",(function(){!function(){let e=[];if(null!==se.streetName&&se.streetName.length>1)if(Array.isArray(se.streetName)){const t=se.streetName.map((e=>`Street_Name LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Street_Name LIKE '%${se.streetName.trim()}%')`);if(null!==se.owner&&se.owner.length>1)if(Array.isArray(se.owner)){const t=se.owner.map((e=>`Owner LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Owner LIKE '%${se.owner.trim()}%')`);if(null!==se.appraisedValueMin&&null!==se.appraisedValueMax&&e.push(`Appraised_Total BETWEEN ${se.appraisedValueMin} AND ${se.appraisedValueMax}`),null!==se.assessedValueMin&&null!==se.assessedValueMax&&e.push(`Assessed_Total BETWEEN ${se.assessedValueMin} AND ${se.assessedValueMax}`),null!==se.propertyType&&se.propertyType.length>1)if(Array.isArray(se.propertyType)){const t=se.propertyType.map((e=>`Parcel_Type LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Parcel_Type LIKE '%${se.propertyType.trim()}%')`);if(null!==se.zoningType&&se.zoningType.length>1)if(Array.isArray(se.zoningType)){const t=se.zoningType.map((e=>`Zoning LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Zoning LIKE '%${se.zoningType.trim()}%')`);if(null!==se.neighborhoodType&&se.neighborhoodType.length>1)if(Array.isArray(se.neighborhoodType)){const t=se.neighborhoodType.map((e=>`Neighborhood LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Neighborhood LIKE '%${se.neighborhoodType.trim()}%')`);if(null!==se.buildingType&&se.buildingType.length>1)if(Array.isArray(se.buildingType)){const t=se.buildingType.map((e=>`Building_Type LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Building_Type LIKE '%${se.buildingType.trim()}%')`);if(null!==se.buildingUseType&&se.buildingUseType.length>1)if(Array.isArray(se.buildingUseType)){const t=se.buildingUseType.map((e=>`Building_Use_Type LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Building_Use_Type LIKE '%${se.buildingUseType.trim()}%')`);if(null!==se.designType&&se.designType.length>1)if(Array.isArray(se.designType)){const t=se.designType.map((e=>`Design_Type LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Design_Type LIKE '%${se.designType.trim()}%')`);null!==se.acresValueMin&&null!==se.acresValueMax&&e.push(`Total_Acres BETWEEN ${se.acresValueMin} AND ${se.acresValueMax}`),null!==se.soldOnMin&&null!==se.soldOnMax&&e.push(`Sale_Date >= '${se.soldOnMin}' AND Sale_Date <= '${se.soldOnMax}'`),null!==se.soldPMin&&null!==se.soldPMax&&e.push(`Sale_Price BETWEEN ${se.soldPMin} AND ${se.soldPMax}`);let t=e.join(" AND ");if("no"===sessionStorage.getItem("condos")){let e=ve.createQuery();e.where=t,e.returnDistinctValues=!1,e.returnGeometry=!0,e.outFields=["*"],Ae(),tt(null,e)}else{let e=ve.createQuery();e.where=t,e.returnDistinctValues=!1,e.returnGeometry=!0,e.outFields=["*"],Ae(),tt(null,e)}}()})),$("#clearFilter").on("click",(function(){a()}))})),$(document).ready((function(){$("#side-Exp").on("click",(function(){$("#sidebar").toggleClass("collapsed"),$("#sidebar").hasClass("collapsed")?($("#small-div").css("right","0px"),$("#right-arrow").hide(),$("#left-arrow").show()):($("#small-div").css("right","250px"),$("#left-arrow").hide(),$("#right-arrow").show())}))})),$(document).ready((function(){$("#Basemap-selector").on("click",(function(){$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#AddDataDiv").hide(),$("#ContactDiv").hide(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#Right-Btn-div").show(),$("#BasemapDiv").show(),$("#group-container-right").show()})),$("#Bookmarks-selector").on("click",(function(){$("#rightPanel").hide(),$("#BasemapDiv").hide(),$("#AddDataDiv").hide(),$("#ContactDiv").hide(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#Right-Btn-div").show(),$("#BookmarksDiv").show(),$("#group-container-right").show()})),$("#Print-Esri").on("click",(function(){$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#AddDataDiv").hide(),$("#ContactDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").show(),$("#PrintDiv").show(),$("#LegendDiv").hide(),$("#group-container-right").show()})),$("#Contact-selector").on("click",(function(){$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#AddDataDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#PrintDiv").hide(),$("#Right-Btn-div").show(),$("#ContactDiv").show(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#group-container-right").show()})),$("#addData-selector").on("click",(function(){$(document).keypress((function(e){"Enter"===e.key&&e.preventDefault()})),$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#PrintDiv").hide(),$("#ContactDiv").hide(),$("#Right-Btn-div").show(),$("#AddDataDiv").show(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#group-container-right").show()})),$("#Legend-selector").on("click",(function(){$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#PrintDiv").hide(),$("#ContactDiv").hide(),$("#Right-Btn-div").show(),$("#AddDataDiv").hide(),$("#PrintDiv").hide(),$("#LegendDiv").show(),$("#group-container-right").show()})),$("#right-btn-back").on("click",(function(){$("#group-container-right").hide(),$("#PrintDiv").hide(),$("#AddDataDiv").hide(),$("#BookmarksDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#ContactDiv").hide(),$("#LegendDiv").hide(),$("#rightPanel").show()}))}));var st={240:"1 inch = 20 feet",600:"1 inch = 50 feet",1200:"1 inch = 100 feet",1800:"1 inch = 150 feet",2400:"1 inch = 200 feet",3600:"1 inch = 300 feet",4800:"1 inch = 400 feet",9600:"1 inch = 800 feet",12e3:"1 inch = 1000 feet",18e3:"1 inch = 1500 feet",24e3:"1 inch = 2000 feet",36e3:"1 inch = 3000 feet",72e3:"1 inch = 6000 feet",144e3:"1 inch = 12000 feet",18e4:"1 inch = 15000 feet"},ot=document.getElementById("scale-dropdown");document.querySelectorAll(".scale-select").forEach((function(e){e.addEventListener("click",(function(e){var t=parseInt(e.target.value),n=e.target.innerHTML;t&&(T.scale=t,console.log(T.scale)),$("#scale-value").val(t).html(n)}))})),T.ui.add(ot);r.watch((()=>[T.stationary,T.scale]),(([e,t])=>{e&&function(e){var t=Math.round(e),n=function(e){var t=Object.keys(st).reduce((function(t,n){return Math.abs(n-e)<Math.abs(t-e)?n:t}));return st[t]}(t);n&&$("#scale-value").val(t).html(n)}(t)}));function ke(){var e=document.querySelector(".esri-widget--button.esri-print__refresh-button.esri-icon-refresh");e&&e.click()}$(document).ready((function(){$("#popoverButton").popover({trigger:"hover"})})),$(document).ready((function(){$("#lasso").popover({trigger:"hover"})})),$(document).ready((function(){$("#select-button").popover({trigger:"hover"})})),$(document).ready((function(){$("#clear-btn1").popover({trigger:"hover"})})),$(document).ready((function(){$("#filterButton").popover({trigger:"hover"})})),$(document).ready((function(){$("#layerListBtn").popover({trigger:"hover"})})),$(document).ready((function(){$("#abutters-attributes").popover({trigger:"hover"})})),$(document).ready((function(){$("#abutters-zoom").popover({trigger:"hover"})})),$(document).ready((function(){$("#distanceButton").popover({trigger:"hover"})})),$(document).ready((function(){$("#areaButton").popover({trigger:"hover"})})),$(document).ready((function(){$("#clearMeasurement").popover({trigger:"hover"})})),T.watch("zoom",(function(e,t){e!==t&&ke()})),T.watch("center",(function(e,t){e!==t&&ke()})),$(document).ready((function(){$("#side-Exp2").on("click",(function(){$("#sidebar2").hasClass("collapsed")?($("#results-div").css("left","0px"),$("#sidebar2").css("left","-350px"),$("#right-arrow-2").show(),$("#left-arrow-2").hide()):($("#results-div").css("left","350px"),$("#sidebar2").css("left","0px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide()),$("#sidebar2").toggleClass("collapsed")}))}))}))}));
// @ts-nocheck
require(["esri/WebMap","esri/views/MapView","esri/layers/FeatureLayer","esri/layers/ImageryLayer","esri/layers/MapImageLayer","esri/core/reactiveUtils","esri/Graphic","esri/geometry/geometryEngine","esri/layers/GraphicsLayer","esri/widgets/Sketch/SketchViewModel","esri/widgets/DistanceMeasurement2D","esri/widgets/AreaMeasurement2D","esri/widgets/BasemapLayerList","esri/widgets/Bookmarks","esri/widgets/Legend","esri/widgets/Print","esri/layers/support/TileInfo","esri/geometry/Extent","esri/rest/support/PrintTemplate","esri/rest/support/PrintParameters","esri/widgets/Print/PrintViewModel","esri/widgets/Print/TemplateOptions"],(function(e,t,a,i,n,r,s,l,o,d,c,u,p,m,h,g,f,b,y,v,w,x){const _=new URLSearchParams(window.location.search);let T=window.location.href,I=_.get("viewer");let L=["columbiact","columbiactnew","durhamct","haddamct","northcanaanct","roxburyct","roxburyctassessor","scotlandct","warrenct","warrenctassessor","washingtonct","wiltonct","wiltoncttest","wolcottct","woodbridgect","newingtonct"].join("|"),S=new RegExp(`\\?viewer=cama\\/(${L})(\\&\\w+=\\w+)*$`);null!=I&&S.test(T)?(I+=".json",$("#whole-app").show()):"https://terrenogis.com"===window.location.href||"https://terrenogis.com/"===window.location.href?window.location.href="https://www.qds.biz/gis-service":window.location.href="./onload.html";const M={mapId:"",condoLayer:"",title:"",isCondosLayer:"",noCondoLayer:""};fetch(I).then((e=>e.json())).then((b=>{b.layers;function y(e){var t=new Date(e),a=t.getDate();return t.getMonth()+1+"/"+a+"/"+t.getFullYear()}M.mapId=b.webmapId||"6448b08504de4244973a28305b18271f",M.condoLayer=b.condoLayer,M.noCondoLayer=b.noCondoLayer,M.title=b.title,M.isCondosLayer=b.condos,M.masterTable=b.masterTable,M.zoom=b.zoom,M.parcelZoom=b.parcelZoom,M.imageUrl=b.imageUrl,M.welcomeImage=b.welcomeImage,M.pdf_Image=b.pdf_Image,M.pdf_demo=b.pdf_demographics,M.taxMap_Url=b.taxMapUrl,M.parcelMapUrl=b.parcelMapUrl,M.housingUrl=b.housingUrl,M.propertyCardPdf=b.propertyCardPdf,M.propertyCard=b.propertyCard,M.tax_bill=b.tax_bill,M.useVisionForTaxBillUrl=b.useVisionForTaxBillUrl,M.accessorName=b.accessorName,M.parcelTitle=b.parcelServiceTitle,M.tabTitle=b.tabTitle,M.basemapTitle=b.basemapTitle,M.parcelRenderer=b.parcelRenderer,M.useUniqueIdforParcelMap=b.useUniqueIdforParcelMap,M.helpUrl=b.helpUrl,M.includeFilter=b.includeFilter,M.customWelcomePage=b.customWelcomePage,M.customWelcomeMessage=b.customWelcomeMessage,M.showDisclaimer=b.showDisclaimer,M.customDisclaimerPage=b.customDisclaimerPage,M.customDisclaimerMessage=b.customDisclaimerMessage,M.DetailLinks=b.DetailLinks,M.DetailLinksToInclude=b.DetailLinksToInclude,M.includePermitLink=b.includePermitLink,"no"===M.showDisclaimer&&(sessionStorage.setItem("agreedToDisclaimer","yes"),$("#starterModal").modal("hide")),"yes"===M.customWelcomePage&&(document.getElementById("welcomeMessage").innerHTML=M.customWelcomeMessage),"yes"===M.customDisclaimerPage&&(document.getElementById("disclaimer-text").innerHTML=M.customDisclaimerMessage),"yes"===M.includePermitLink&&(M.permitLink=b.permitLink),document.getElementById("AccessorName").innerHTML=b.accessorName,$(".help-url").attr("href",M.helpUrl),document.getElementById("title").innerHTML=M.title,document.getElementById("print-title").innerHTML=M.title,document.getElementById("imageContainer").src=M.welcomeImage,document.getElementById("print-image").src=M.welcomeImage,document.getElementById("tab-title").innerHTML=M.tabTitle;const v="No geometry";sessionStorage.setItem("condos",M.isCondosLayer);const w=new o,_=new o,T=new e({portalItem:{id:M.mapId},layers:[w]}),I=f.create({numLODs:30}).lods;var L=new t({container:"viewDiv",map:T,units:"imperial",zoom:`${M.zoom}`,popupEnabled:!1,ui:{components:["attribution"]},constraints:{lods:I,minScale:240,maxScale:18e4}});L.when((()=>{M.homeExtent=L.extent})),"no"===M.includeFilter&&$("#filterButton").remove(),L.when((()=>{"yes"==sessionStorage.getItem("agreedToDisclaimer")||1==B?$("#starterModal").modal("hide"):$("#starterModal").modal("show"),$(document).ready((function(){$("#agreeBtn").prop("disabled",!0),$("#agreeCheck").change((function(){$(this).is(":checked")?($("#agreeBtn").prop("disabled",!1),sessionStorage.setItem("agreedToDisclaimer","yes")):$("#agreeBtn").prop("disabled",!0)}))}))})),L.when((()=>{document.getElementById("urlButton").addEventListener("click",(function(e){let t=urlInput.value;t.length>0&&function(){let e=new a({url:`${t}`});e.load().then((()=>{T.add(e),$("#urlMessage").html('<strong><p style="color:green;">Successfully uploaded REST Service.</p></strong>'),T.layers.on("change",(function(e){console.log(e," layer was added/removed from the map.")}));var t=$("#layerList");Me(e,t),urlInput.value=""})).catch((e=>{$("#urlMessage").html('<strong><p style="color:red;">Error uploading REST Service.</p></strong>'),console.error("Error loading the FeatureLayer:",e)}))}()}))})),L.when((()=>{document.getElementById("urlButtonImagery").addEventListener("click",(function(e){let t=urlInputImagery.value;t.length>0&&function(){let e=new i({url:`${t}`});e.load().then((()=>{T.add(e),$("#urlMessageImagery").html('<strong><p style="color:green;">Successfully uploaded REST Service.</p></strong>'),T.layers.on("change",(function(e){console.log(e," layer was added/removed from the map.")}));var t=$("#layerList");Me(e,t),urlInput.value=""})).catch((e=>{$("#urlMessageImagery").html('<strong><p style="color:red;">Error uploading REST Service.</p></strong>'),console.error("Error loading the FeatureLayer:",e)}))}()}))})),L.when((()=>{document.getElementById("urlButtonMapService").addEventListener("click",(function(e){let t=urlInputMapService.value;t.length>0&&function(){let e=new n({url:`${t}`});e.load().then((()=>{T.add(e),$("#urlMessageMapService").html('<strong><p style="color:green;">Successfully uploaded REST Service.</p></strong>'),T.layers.on("change",(function(e){console.log(e," layer was added/removed from the map.")}));var t=$("#layerList");Me(e,t),urlInput.value=""})).catch((e=>{$("#urlMessageMapService").html('<strong><p style="color:red;">Error uploading REST Service.</p></strong>'),console.error("Error loading the FeatureLayer:",e)}))}()}))})),L.when((()=>{const e=T.layers.items.filter((e=>!("group"===e.type&&e.title&&"hidden group"===e.title.toLowerCase()||e.title&&e.title===`${M.parcelTitle}`)));new h({view:L,container:$("#LegendDiv")[0],layerInfos:e.map((e=>({layer:e})))})})),L.when((()=>{new m({view:L,container:$("#BookmarksDiv")[0],dragEnabled:!0})}));new x({title:"Print Map at Scale 1:1200",layout:"a4-portrait",scale:1200,scaleEnabled:!0,dpi:96,legendEnabled:!0,northArrowEnabled:!0}),new x({title:"Print Map at Scale 1:2400",layout:"a4-portrait",scale:2400,scaleEnabled:!0,dpi:96,legendEnabled:!0,northArrowEnabled:!0});L.when((()=>{new g({view:L,container:$("#PrintDiv")[0],templateOptions:{title:"Print Map at Scale 1:1200",layout:"a4-portrait",scale:1200,scaleEnabled:!0,dpi:96,legendEnabled:!0,northArrowEnabled:!0},allowedLayouts:["letter-ansi-a-landscape","letter-ansi-a-portrait","tabloid-ansi-b-landscape","tabloid-ansi-b-portrait","a3-landscape","a3-portrait","a4-landscape","a4-portrait"]})})),L.when((()=>{let e;new p({view:L,container:$("#BasemapDiv")[0],dragEnabled:!0}).visibleElements={statusIndicators:!0,baseLayers:!0,referenceLayers:!1,referenceLayersTitle:!1,errors:!0,heading:!1};let t={type:"simple",symbol:{type:"simple-fill",color:[255,255,255,0],outline:{width:1,color:`${M.parcelRenderer}`}}},a={type:"simple",symbol:{type:"simple-fill",color:[255,255,255,0],outline:{width:1,color:"#897044"}}};L.map.allLayers.forEach((t=>{"Parcel Boundaries"===t.title&&(e=t.renderer)}));const i=["Aerial-Ortho 2023","Aerial-Ortho 2019","Aerial-Ortho 2016","Aerial-Ortho 2012"];L.map.allLayers.some((e=>i.includes(e.title)&&e.visible))&&L.map.allLayers.forEach((e=>{"Parcel Boundaries"===e.title&&(e.renderer=t)})),e="yes"===sessionStorage.getItem("condos")?Ie.renderer:Te.renderer;const n={};L.map.basemap.baseLayers.forEach((e=>{n[e.id]=e.visible})),r.watch((()=>L.map.basemap.baseLayers.map((e=>e.visible))),(()=>{console.log("Visibility changed:",L.map.basemap.baseLayers.map((e=>({title:e.title,visible:e.visible})))),function(e,i){let n=e.find((e=>e.visible&&!i[e.id]));if(n)console.log(`Newly visible layer: ${n.title}`),e.forEach((e=>{e!==n&&(e.visible=!1)})),n.title!==`${M.basemapTitle}`&&"Washington Basemap"!==n.title?"yes"===sessionStorage.getItem("condos")?Ie.renderer=t:Te.renderer=t:L.map.allLayers.forEach((e=>{"Parcel Boundaries"===e.title&&(e.renderer=a)}));else{0===e.filter((e=>e.visible)).length&&e.forEach((e=>{e.visible=i[e.id]}))}e.forEach((e=>{i[e.id]=e.visible})),console.log("Updated visibility tracker:",e.map((e=>({title:e.title,wasVisible:i[e.id]}))))}(L.map.basemap.baseLayers,n)}))})),T.add(_);let S,B,E,C,P,D,A,k,F,N,O,R,U,q,V,z,G=!1,K=!1,j=!1,H=!1,Z=[],W=[],Q=!1,J="feet",Y=!1,X=!1,ee=!1,te={isChanged:!1,item:""},ae=!1,ie=document.getElementById("buffer-value");const ne=document.getElementById("clear-btn1"),re=document.getElementById("clear-btn2");let se,le,oe,de,ce,ue,pe,me,he,ge,fe,$e=L.extent,be=L.scale,ye=L.zoom;r.watch((()=>[L.zoom,L.extent,L.scale]),(([e,t,a],[i])=>{if(e){if(e!==ye&&(ye=e),!Te.visible&&!Ie.visible&&Number(e)>M.parcelZoom){if("no"===sessionStorage.getItem("condos")?Te.visible=!0:Ie.visible=!0,q&&(q?.remove(),q=null),V&&(V?.remove(),V=null),"click"==se||"details"==se||"none yet"==se)return void $("#select-button").removeClass("btn-warning");V=L.on("click",Je),$("#lasso").removeClass("btn-warning"),$("#select-button").addClass("btn-warning"),X=!0}}else i&&($e=t,be=a,ye=e);return""}));let ve=document.getElementById("topbar");L.ui.add(ve,"bottom-right");let we=null;function xe(e){switch(e){case"distance":if(we=new c({view:L,unit:"feet"}),we.viewModel.start(),q||V||(se="none yet"),q)try{se="details",q?.remove(),q=null}catch(e){console.error("Failed to remove DetailsHandle",e)}if(V)try{se="click",V.remove()}catch(e){console.error("Failed to remove DetailsHandle",e)}we&&we.viewModel&&we.viewModel.watch("state",(function(e){"measured"===e&&("click"==se?V=L.on("click",Je):"details"==se&&(q=L.on("click",Qe)))})),L.ui.add(we,"bottom-right"),_e(document.getElementById("distanceButton"));break;case"area":if(we=new u({view:L,unit:"square-us-feet"}),we.viewModel.start(),q||V||(se="none yet"),q)try{se="details",q?.remove(),q=null}catch(e){console.error("Failed to remove DetailsHandle",e)}if(V)try{se="click",V?.remove(),V=null}catch(e){console.error("Failed to remove DetailsHandle",e)}we&&we.viewModel&&we.viewModel.watch("state",(function(e){"measured"===e&&("click"==se?V=L.on("click",Je):"details"==se&&(q=L.on("click",Qe)))})),L.ui.add(we,"bottom-right"),_e(document.getElementById("areaButton"));break;case null:we&&(L.ui.remove(we),we.destroy(),we=null)}}function _e(e){L.focus();let t=Array.from(document.getElementsByClassName("active"));for(let e=0;e<t.length;e++)t[e].classList.remove("active","btn-warning");e&&(e.classList.add("active","btn-warning"),e.classList.remove("bg-info"))}document.getElementById("distanceButton").addEventListener("click",(function(){xe(null),this.classList.contains("active")?_e(null):xe("distance")})),document.getElementById("areaButton").addEventListener("click",(function(){xe(null),this.classList.contains("active")?_e(null):xe("area")}));let Te=new a({url:`${M.noCondoLayer}`,visible:!1,popupEnabled:!0,title:"Parcel Boundaries",id:"noCondoLayer"}),Ie=new a({url:`${M.condoLayer}`,visible:!1,popupEnabled:!0,title:"Parcel Boundaries",id:"condoLayer"});const Le=new a({url:`${M.masterTable}`}),Se=new a({url:`${M.masterTable}`});function Me(e,t){let a;if(a="yes"===sessionStorage.getItem("condos")?"noCondoLayer":"condoLayer","graphics"!==e.type&&"Tax Map Annotation"!=e.title&&"Road Centerline"!=e.title&&null!=e.title&&""!=e.title&&e.id!=a){var i;i=e.visible?"check-square":"square";var n=$(`\n          <calcite-list-item scale="m" label="${e.title}" value="${e.id}" style="border: white 0.5px solid;">\n          <calcite-action class="toggle-slider" id="action-${e.id}-dropdown" slot="actions-end" icon="sliders-horizontal" text="${e.title}"></calcite-action>\n            <calcite-action class="layer-vis" id="action-${e.id}" slot="actions-end" icon="${i}" text="${e.title}"></calcite-action>\n            <div id="opacityDiv-${e.id}" class="esri-slider esri-widget esri-slider--horizontal opacity-div " touch-action="none" style="display: none; height: 45px; align-items: center; padding-bottom: 10px; padding-left: 10px;">\n              <label style="margin-right: 10px; padding-top: 20px; font-weight: 500;font-size: 12px;">Layer Opacity (%)</label>\n              <calcite-slider class="slider-opacity" id="${e.id}" style="width: 50%;" value="100" label-handles max-label="100" max-value="100" min-label="0"></calcite-slider>\n              </calcite-slider>\n            </div>\n          </calcite-list-item>\n      `);t.append(n)}}function Be(e,t){e.forEach((function(e){if("group"===e.type){if(e.title&&"hidden group"===e.title.toLowerCase())return;var a=e.title||"Industry",i=$(`\n              <calcite-accordion scale="m">\n                <calcite-accordion-item heading="${a}">\n                </calcite-accordion-item>\n              </calcite-accordion>`);Be(e.layers.items,i.find("calcite-accordion-item")),t.append(i)}else Me(e,t)}))}function Ee(e){ue=e}function Ce(e){const t=$(e);"CALCITE-COMBOBOX"===t[0].tagName?(t[0].open=!1,t[0].disabled=!0,t[0].placeholder="Loading..."):"CALCITE-INPUT-TEXT"===t[0].tagName?(t[0].loading=!0,t[0].disabled=!0,t[0].placeholder="Loading..."):"CALCITE-DATE-PICKER"===t[0].tagName&&(t[0].disabled=!0)}function Pe(e,t){const a=$(e);"CALCITE-COMBOBOX"===a[0].tagName?(a[0].disabled=!1,a[0].placeholder=`${t}`):"CALCITE-INPUT-TEXT"===a[0].tagName?(a[0].disabled=!1,a[0].loading=!1,a[0].placeholder=`${t}`):"CALCITE-DATE-PICKER"===a[0].tagName&&(a[0].disabled=!1)}T.add(Te),T.add(Ie),ge=[{layer:Ie,field:"Appraised_Total",filterSelector:"#app-val-min",filterSelector2:"#app-val-max"},{layer:Ie,field:"Assessed_Total",filterSelector:"#assess-val-min",filterSelector2:"#assess-val-max"},{layer:Ie,field:"Total_Acres",filterSelector:"#acres-val-min",filterSelector2:"#acres-val-max"},{layer:Ie,field:"Sale_Date",filterSelector:"#sold_calendar_lowest",filterSelector2:"#sold_calendar_highest"},{layer:Ie,field:"Sale_Price",filterSelector:"#saleP-val-min",filterSelector2:"#saleP-val-max"}],he=[{layer:Ie,field:"Street_Name",filterSelector:"#streetFilter",alias:"Street_Name",message:"Select a Street Name"},{layer:Ie,field:"Owner",filterSelector:"#ownerFilter",message:"Select a Owner"},{layer:Ie,field:"Parcel_Type",filterSelector:"#propertyFilter",alias:"Parcel_Type",message:"Select a Property Type"},{layer:Ie,field:"Building_Type",filterSelector:"#buildingFilter",message:"Select a Building Type"},{layer:Ie,field:"Building_Use_Code",filterSelector:"#buildingUseFilter",message:"Select a Building Use Type"},{layer:Ie,field:"Design_Type",filterSelector:"#designTypeFilter",message:"Select a Design Type"},{layer:Ie,field:"Zoning",filterSelector:"#zoningFilter",message:"Select a Zone"},{layer:Ie,field:"Neighborhood",filterSelector:"#neighborhoodFilter",message:"Select a Neighborhood"}],fe=[{layer:Ie,field:"Appraised_Total",filterSelector:"#streetFilter",minInput:"app-val-min",maxInput:"app-val-max",minValField:"appraisedValueMin",maxValueField:"appraisedValueMax",index:0},{layer:Ie,field:"Assessed_Total",filterSelector:"#ownerFilter",minInput:"assess-val-min",maxInput:"assess-val-max",minValField:"assessedValueMin",maxValueField:"assessedValueMax",index:1},{layer:Ie,field:"Total_Acres",filterSelector:"#propertyFilter",minInput:"acres-val-min",maxInput:"acres-val-max",minValField:"acresValueMin",maxValueField:"acresValueMax",index:2},{layer:Ie,field:"Sale_Date",filterSelector:"#buildingFilter",minInput:"sold_calendar_lowest",maxInput:"sold_calendar_highest",minValField:"soldOnMin",maxValueField:"soldOnMax",index:3},{layer:Ie,field:"Sale_Price",filterSelector:"#buildingUseFilter",minInput:"saleP-val-min",maxInput:"saleP-val-max",minValField:"soldPMin",maxValueField:"soldPMax",index:4}],L.when((function(){let e;e="yes"===sessionStorage.getItem("condos")?"condoLayer":"noCondoLayer";var t=T.layers.find((t=>t.id===e));r.watch((()=>t.visible),(()=>{let e=t.visible;!function(e,t){let a=$(`calcite-list-item[value="${e}"] calcite-action`);if(t){if(a.hasClass("layer-vis"))return;a.attr("icon","check-square")}else{if(a.hasClass("layer-vis"))return;a.attr("icon","square")}}(t.id,e)}))})),$(document).ready((function(){$("body").on("click",".toggle-slider",(function(){$(this).closest("calcite-list-item").find(".opacity-div").toggle()}))})),$("#layerList").on("click",".layer-vis",(function(e){e.preventDefault(),function(e,t){let a=T.findLayerById(e);a&&(a.visible=!a.visible,"group"===a.type&&a.layers.forEach((e=>{e.visible=a.visible})),t.attr("icon",a.visible?"check-square":"square"))}($(this).closest("calcite-list-item").attr("value"),$(this))})),L.when((function(){var e=$("#layerList");Be(T.layers.items,e),$(".slider-opacity").on("calciteSliderChange",(function(e){const t=e.target.id;let a=T.findLayerById(t);var i=e.target.value/100;a.opacity=i}))}));let De,Ae,ke,Fe={appraisedValueMin:null,appraisedValueMax:null,assessedValueMin:null,assessedValueMax:null,acresValueMin:null,acresValueMax:null,soldOnMin:null,soldOnMax:null,soldPMin:null,soldPMax:null};function Ne(e,t,a){function i(){const i=he.findIndex((t=>t.field==e));he.splice(i,1),he.forEach((i=>{!function(e,t,a,i,n,r,s){Ce(a),$(a).empty();let l=Le.createQuery();if(Array.isArray(i)&&i.length>0&&!r){let e=i.map((e=>`${t} = '${e}'`));l.where=e.join(" OR ")}else l.where=i&&r?`${t} >= '${i}' AND ${t} <= '${r}'`:`${t} = '${i}'`;l.returnDistinctValues=!0,l.returnGeometry=!1,l.outFields=[n],n&&(l.orderByFields=[`${n} ASC`]);Le.queryFeatures(l).then((function(e){var t=e.features,i=$(a);i.empty(),t.forEach((function(e){var t=e.attributes[n];if(t&&t.trim()){var a=$(`<calcite-combobox-item value="${t}" text-label="${t}"></calcite-combobox-item>`);i.append(a)}})),Pe(a,s)}))}(i.layer,e,i.filterSelector,t,i.field,a,i.message)}))}clearTimeout(De),De=setTimeout((()=>{i()}),600)}async function Oe(e,t,a,i,n,r){try{let e=Le.createQuery();if(Array.isArray(i)&&i.length>0&&!r){let a=i.map((e=>`${t} = '${e}'`));e.where=a.join(" OR ")}else e.where=i&&r?`${t} BETWEEN '${i}' AND '${r}'`:`${t} = '${i}'`;e.returnDistinctValues=!0,e.returnGeometry=!1,e.outFields=[n],n&&(e.orderByFields=[`${n} ASC`]);let a=(await Le.queryFeatures(e)).features.map((e=>e.attributes[n])),s=Math.max(...a),l=Math.min(...a);switch(n){case"Sale_Date":let e=new Date(l),t=new Date(s),a=e.getFullYear(),i=("0"+(e.getMonth()+1)).slice(-2),n=("0"+e.getDate()).slice(-2),r=t.getFullYear(),o=("0"+(t.getMonth()+1)).slice(-2),d=("0"+t.getDate()).slice(-2),c=`${a}-${i}-${n}`,u=`${r}-${o}-${d}`;Fe.soldOnMin=c,Fe.soldOnMax=u;break;case"Appraised_Total":Fe.appraisedValueMin=l,Fe.appraisedValueMax=s;break;case"Assessed_Total":Fe.assessedValueMin=l,Fe.assessedValueMax=s;break;case"Sale_Price":Fe.soldPMin=l,Fe.soldPMax=s;break;case"Total_Acres":Fe.acresValueMin=l,Fe.acresValueMax=s;break;default:console.log("Sorry, no field found.")}clearTimeout(Ae),Ae=setTimeout((()=>{!function(e){const t=fe.findIndex((t=>t.field==e));fe.splice(t,1),fe.forEach((e=>{const t=document.getElementById(e.minInput),a=document.getElementById(e.maxInput);let i=Fe[e.minValField];const n=Fe[e.maxValueField];let r,s;i===n&&(i=0),"Appraised_Total"===e.field||"Assessed_Total"===e.field||"Sale_Price"===e.field?(r="$"+(void 0!==i?i.toLocaleString():""),s="$"+(void 0!==n?n.toLocaleString():""),t.value=r,a.value=s):"Sale_Date"===e.field?(t.value=void 0!==i?i:"",a.value=void 0!==n?n:""):"Total_Acres"===e.field&&(r=void 0!==i?i.toLocaleString():"",s=void 0!==n?n.toLocaleString():"",t.value=r,a.value=s)}))}(t)}),600)}catch(e){console.error("Error querying features:",e)}}function Re(e,t,a){const i=ge.findIndex((t=>t.field==e));ge.splice(i,1),async function(e,t,a,i){for(const n of e)await Oe(n.layer,t,n.filterSelector,a,n.field,i)}(ge,e,t,a)}function Ue(e,t,a,i){Ce(a),$(a).empty();let n=Le.createQuery();n.where=`1=1 AND ${t} IS NOT NULL`,n.returnDistinctValues=!0,n.returnGeometry=!1,t&&(n.orderByFields=[`${t} ASC`]),n.outFields=[t],n.maxRecordCountFactor=5,Le.queryFeatures(n).then((function(e){var i=e.features,n=(e.features.length,$(a));i.forEach((function(e){var a=e.attributes[t];if(a&&a.trim()){var i=$(`<calcite-combobox-item value="${a}" text-label="${a}"></calcite-combobox-item>`);n.append(i)}}))})),Pe(a,i)}function qe(){var e=document.querySelector(".esri-widget--button.esri-print__refresh-button.esri-icon-refresh");e&&e.click()}function Ve(e,t){const a=function(e,t){let a,i=t.split("?")[0],n=[],r=-1!==t.indexOf("?")?t.split("?")[1]:"";if(""!==r){n=r.split("&");for(let t=n.length-1;t>=0;t-=1)a=n[t].split("=")[0],a===e&&n.splice(t,1);i=i+"?"+n.join("&")}return i}("uniqueid",window.location.href);if(window.history.pushState({path:a},"",a),"no"===sessionStorage.getItem("condos")?Te.visible=!0:Ie.visible=!0,q)try{q?.remove(),q=null}catch(e){console.error("Failed to remove DetailsHandle",e)}if(V)try{V?.remove(),V=null}catch(e){console.error("Failed to remove DetailsHandle",e)}se="",Ee(!!X),$("#select-button").removeClass("btn-warning"),$("#select-button").addClass("btn-warning"),V=L.on("click",Je),X=!0,Y=!1,$("#searchInput ul").remove(),$("#searchInput").val="",$("#select-button").prop("disabled",!1);document.getElementById("searchInput").value="",E="",searchTerm="",W=[],secondList=[],ce="",B=!1,H=!1,j=!1,G=!1,$(".spinner-container").hide(),$("#distanceButton").removeClass("active"),$("#areaButton").removeClass("active"),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#dropdown").toggleClass("expanded"),$("#dropdown").hide(),$("#results-div").css("left","0px"),$("#sidebar2").css("left","-350px"),$("#sidebar2").removeClass("collapsed"),$("#right-arrow-2").show(),$("#left-arrow-2").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#backButton").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportSearch").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#featureWid").hide(),$("#exportButtons").hide(),$("#layerListDiv").hide(),$("#detailBox").hide(),$("#filterDiv").hide(),$("#dropdown").show(),$("#WelcomeBox").show(),K=!1,$("#select-button").attr("title","Add to Selection Enabled"),$(".center-container").show(),document.getElementById("suggestions").innerHTML="",$("#distanceButton").removeClass("btn-warning"),$("#distanceButton").addClass("bg-info"),$("#areaButton").removeClass("btn-warning"),$("#distanceButton").addClass("bg-info"),$("#featureWid").empty(),L.ui.remove(we),we&&(we.destroy(),we=null),L.graphics.removeAll(),O=[]}function ze(e){k.sort(((t,a)=>"owner"===e?t.owner.toLowerCase().localeCompare(a.owner.toLowerCase()):"location"===e?t.location.toLowerCase().localeCompare(a.location.toLowerCase()):"Street_Name"===e?t.Street_name.toLowerCase().localeCompare(a.Street_name.toLowerCase()):void 0)),function(){let e,t;const a=document.getElementById("featureWid");a.innerHTML="";const i=document.createElement("ul");i.classList.add("row","list-group"),k.forEach((function(a){let n=a.objectid,r=a.location,s=void 0===a.uniqueId?a.GIS_LINK:a.uniqueId,l=a.GIS_LINK,o=a.coOwner,d=a.owner,c=a.MBL,u=a.geometry,p=a.Parcel_Type;"yes"===M.useUniqueIdforParcelMap?(t=s,e=s):(t=l,e=l);let m=a.Image_Path,h=void 0===a.AcctNum?"":a.AcctNum;const g=`${M.imageUrl}${m}`;i.classList.add("row"),i.classList.add("list-group");const f=document.createElement("li"),$=document.createElement("li"),b=document.createElement("tr");b.classList.add("col-12","list-group-item");let y,w,x=`<div class="extra-links">\n            <a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=https://publicweb-gis.s3.amazonaws.com/PDFs/${M.parcelMapUrl}/Quick_Maps/QM_${e}.pdf><span style="font-family:Tahoma;font-size:12px;"><strong>PDF Map</strong></a>`;"yes"==M.propertyCardPdf?x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.propertyCard}${s}.PDF><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></a>`:x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.propertyCard}${s}><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></a>`,"yes"===M.useVisionForTaxBillUrl?x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.tax_bill}&amp;uniqueId=${h}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`:x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.tax_bill}&amp;uniqueId=${s}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`,"yes"===M.includePermitLink&&(x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.permitLink}?uniqueid=${s} ><span style="font-family:Tahoma;font-size:12px;"><strong>Permits</strong></a>`),x+="</div>",b.innerHTML=x,$.innerHTML=`<img class="img-search image" object-id="${n}" src="${g}" alt="Image of ${s}" >`,f.classList.add("list-group-item","col-9"),f.classList.add("search-list"),$.setAttribute("object-id",n),$.setAttribute("data-id",l),$.classList.add("image-div","col-3"),w="yes"===sessionStorage.getItem(v),!o&&u||u?y=` <div class="listText">UID: ${s}  &nbsp;<br>MBL: ${c} <br> ${d} ${o} <br> ${r} <br> Property Type: ${p}</div>\n            <div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justZoom" title="Zoom to Parcel"><calcite-icon icon="magnifying-glass-plus" scale="s"/>Zoom</button><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`:(y=` <div class="listText noGeometry">UID: ${s}  &nbsp;<br>MBL: ${c} <br> ${d} ${o} <br> ${r} <br> Property Type: ${p} \n             </div><div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`,f.classList.add("no-zoomto")),f.innerHTML+=y,f.setAttribute("object-id",n),f.setAttribute("data-id",l),i.appendChild($),i.appendChild(f),i.appendChild(b)})),F=k.length,i.addEventListener("click",(function(e){if(e.target.closest(".justZoom")||e.target.closest(".justZoomBtn"))return;V&&(V?.remove(),V=null),q&&(q?.remove(),q=null),$("#select-button").attr("title","Select Enabled");let t=e.target.closest("li");if(!t)return;let a=t.getAttribute("data-id"),i=t.getAttribute("object-id");rt(i,O,a),$("#details-spinner").show(),$("#WelcomeBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportButtons").hide(),$("#exportSearch").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$(".center-container").hide(),it(i,a)})),a.appendChild(i)}()}function Ge(e,t,a,i,n,r){$("status-loader").show(),$("#featureWid").empty();let s=new Set,l=new Set;k=W.filter((e=>!!e.geometry&&(s.add(e.uniqueId),!0))),W.forEach((e=>{!s.has(e.uniqueId)&&(l.add(e.uniqueId),k.push(e))})),k.sort(((e,t)=>{const a=e.owner?e.owner.toLowerCase():"",i=t.owner?t.owner.toLowerCase():"";return a.localeCompare(i)})),G||function(e){return W.filter((t=>t.objectid===e)).length}(i)>1&&function(e,t,a){"yes"==sessionStorage.getItem("condos")&&(k=k.filter((t=>t.objectid!=e)),W=W.filter((t=>t.objectid!=e)),$(`li[object-id="${e}"]`).remove()),"no"==sessionStorage.getItem("condos")&&(W=W.filter((e=>e.GIS_LINK!=a)),k=k.filter((e=>e.GIS_LINK!=a)),$(`li[data-id="${a}"]`).remove())}(i,0,r);const o=document.getElementById("featureWid"),d=document.createElement("ul");let c,u;k.forEach((function(e){let t=e.objectid,a=e.location,i=void 0===e.uniqueId?e.GIS_LINK:e.uniqueId,n=e.GIS_LINK,r=e.coOwner,s=e.owner,l=e.MBL,o=e.geometry,p=e.Parcel_Type;"yes"===M.useUniqueIdforParcelMap?(c=i,u=i):(c=n,u=n);let m=e.Image_Path,h=void 0===e.AcctNum?"":e.AcctNum;const g=`${M.imageUrl}${m}`;d.classList.add("row"),d.classList.add("list-group");const f=document.createElement("li"),$=document.createElement("li"),b=document.createElement("tr");b.classList.add("col-12","list-group-item");let y,w,x=`<div class="extra-links">\n            <a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=https://publicweb-gis.s3.amazonaws.com/PDFs/${M.parcelMapUrl}/Quick_Maps/QM_${u}.pdf><span style="font-family:Tahoma;font-size:12px;"><strong>PDF Map</strong></a>`;"yes"==M.propertyCardPdf?x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.propertyCard}${i}.PDF><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></a>`:x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.propertyCard}${i}><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></a>`,"yes"===M.useVisionForTaxBillUrl?x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.tax_bill}&amp;uniqueId=${h}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`:x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.tax_bill}&amp;uniqueId=${i}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`,"yes"===M.includePermitLink&&(x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${M.permitLink}?uniqueid=${i} ><span style="font-family:Tahoma;font-size:12px;"><strong>Permits</strong></a>`),x+="</div>",b.innerHTML=x,$.innerHTML=`<img class="img-search image" object-id="${t}" src="${g}" alt="Image of ${i}" >`,f.classList.add("list-group-item","col-9"),f.classList.add("search-list"),$.setAttribute("object-id",t),$.setAttribute("data-id",n),$.classList.add("image-div","col-3"),w="yes"===sessionStorage.getItem(v),!r&&o||o?y=` <div class="listText">UID: ${i}  &nbsp;<br>MBL: ${l} <br> ${s} ${r} <br> ${a} <br> Property Type: ${p}</div>\n            <div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justZoom" title="Zoom to Parcel"><calcite-icon icon="magnifying-glass-plus" scale="s"/>Zoom</button><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`:(y=` <div class="listText noGeometry">UID: ${i}  &nbsp;<br>MBL: ${l} <br> ${s} ${r} <br> ${a} <br> Property Type: ${p} \n             </div><div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`,f.classList.add("no-zoomto")),f.innerHTML+=y,f.setAttribute("object-id",t),f.setAttribute("data-id",n),d.appendChild($),d.appendChild(f),d.appendChild(b)})),F=k.length,$("#total-results").show(),$("#ResultDiv").show(),$("#total-results").html(F+" results returned"),$("#backButton").hide(),$("#detailsButton").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#featureWid").show(),$("#detail-content").empty(),$("#dropdown").toggleClass("expanded"),$("status-loader").hide(),$("#dropdown").show(),$("#sidebar2").css("left","0px"),$("#sidebar2").addClass("collapsed"),$("#results-div").css("left","350px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide(),$("#WelcomeBox").hide(),$("#csvExportResults").hide(),$("#exportSearch").show(),$("#results-div").css("height","300px"),$("#exportButtons").show(),$("#exportResults").hide(),$("#csvExportSearch").show(),$(".spinner-container").hide(),$(`li[object-id="${i}"]`).remove(),G=!1,d.addEventListener("click",(function(e){let a=!0;if(e.target.closest(".justZoom")||e.target.closest(".justZoomBtn")||e.target.closest(".pdf-links"))return;V&&(V?.remove(),V=null),q&&(q?.remove(),q=null),$("#select-button").attr("title","Select Enabled");let i=e.target.closest("li");if(!i)return;let n=i.getAttribute("data-id"),r=i.getAttribute("object-id");rt(r,t,n),$("#details-spinner").show(),$("#WelcomeBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportButtons").hide(),$("#exportSearch").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$(".center-container").hide(),$("#abutters-attributes").prop("disabled",!1),$("#abutters-zoom").prop("disabled",!1),e.target.closest(".no-zoomto")&&(console.log("dont zoom"),a=!1),it(r,n,a)})),o.appendChild(d),H=!1}function Ke(e,t,a,i){let n,r,s;function l(e){e.forEach((function(e){if(""!==e.attributes.Owner){let t=e.attributes.OBJECTID,a=e.attributes.Location,i=e.attributes.Uniqueid,n=e.attributes.GIS_LINK,r=e.attributes.Co_Owner,s=e.attributes.Owner,l=e.attributes.MBL,o=e.geometry,d=e.attributes.Mailing_Address_1,c=e.attributes.Mailing_Address_2,u=e.attributes.Mailing_City,p=e.attributes.Mail_State,m=e.attributes.Mailing_Zip,h=e.attributes.Total_Acres,g=e.attributes.Parcel_Primary_Use,f=e.attributes.Building_Use_Code,$=e.attributes.Parcel_Type,b=e.attributes.Design_Type,v=e.attributes.Zoning,w=e.attributes.Neighborhood,x=e.attributes.Land_Type_Rate,_=e.attributes.Functional_Obs,T=e.attributes.External_Obs,I=y(e.attributes.Sale_Date),L=e.attributes.Sale_Price,S=e.attributes.Vol_Page,M=e.attributes.Assessed_Total,B=e.attributes.Appraised_Total,E=e.attributes.Influence_Factor,C=e.attributes.Influence_Type,P=e.attributes.Land_Type,D=e.attributes.Prior_Assessment_Year,A=e.attributes.Prior_Assessed_Total,k=e.attributes.Prior_Appraised_Total,F=e.attributes.Map,N=e.attributes.Lat,O=e.attributes.Lon,R=e.attributes.Image_Path,U=e.attributes.AcctNum,q=e.attributes.Match_Status;W.push(new Ze(t,a,i,n,r,s,l,o,d,c,u,p,m,h,g,f,$,b,v,w,x,_,T,I,L,S,M,B,E,C,P,D,A,k,F,N,O,R,U,q))}}))}if(a&&null!=a){n=e[0].attributes.OBJECTID,r=e[0].attributes.Location,s=e[0].attributes.GIS_LINK;const a=W.filter((e=>e.objectid===n)).length,i=W.filter((e=>e.GIS_LINK===s)).length;a>=1||0==a&&i>=1?(l(e),Ge(0,t,0,n,0,s)):(l(e),Ge())}else e?e.length>1?(Y||(e=e.filter((e=>"CONDOMAIN"!=e.attributes.ACCOUNT_TYPE))),l(e)):l(e):Ge(0,t,0,n);a||Ge(0,t,0,n,0,s)}function je(e,t,a,i){let n,r;ke=i?e:e.features,_.removeAll();let l,o,d=[];var c={type:"simple-fill",color:[127,42,145,.4],outline:{color:[127,42,145,.8],width:2}};if(a){l=e.features[0].attributes.OBJECTID,o=ke[0].attributes.GIS_LINK;const a=new s({geometry:ke[0].geometry,symbol:c,id:l});if(d.push(a),r=W.filter((e=>e.GIS_LINK===o)).length,n=L.graphics.some((e=>e.id===l)),n){const e=L.graphics.findIndex((e=>e.id===l));L.graphics.removeAt(e);const t=O.findIndex((e=>e.id===l));1===O.length?O.splice(0,1):O.splice(t,1),0===O.length&&(q||(q=L.on("click",Qe)),V&&(V?.remove(),V=null),V=L.on("click",Je))}else t.addMany(d)}else if(i){ke.filter((e=>e.geometry)).forEach((e=>{const t=e.attributes.OBJECTID,a=new s({geometry:e.geometry,symbol:c,id:t});d.push(a)})),d.length>=1&&t.addMany(d),L.goTo({target:O,zoom:18})}else{let e;if(ae=!0,ke.map((function(t){if(l=t.attributes.OBJECTID,!t.geometry||i)return null;e=new s({geometry:t.geometry,symbol:c,id:l}),d.push(e)})).filter((e=>null!==e)),1==d.length){t.addMany(d);const e=ke[0].geometry.extent,a=(e.center,2),i=e.expand(a);L.goTo({target:d,extent:i})}else if(t.addMany(d),d.length>0){const e=d.map((e=>e.geometry.extent)),t=3,a=e.reduce(((e,t)=>e.union(t)),e[0]).expand(t);L.goTo({target:a}).catch((e=>{console.error("Error zooming to extent:",e)}))}else console.warn("No graphics available to calculate extent.")}if(O||(O=d),a&&!n){let e=d[0].id;O=[...O,d[0]],z=e}ae&&(O=d),n=!1,ae=!1}Ue(0,"Street_Name","#streetFilter","Select a Street Name"),Ue(0,"Owner","#ownerFilter","Select a Owner"),Ue(0,"Parcel_Type","#propertyFilter","Select a Property Type"),Ue(0,"Building_Type","#buildingFilter","Select a Building Type"),Ue(0,"Building_Use_Code","#buildingUseFilter","Select a Building Use"),Ue(0,"Design_Type","#designTypeFilter","Select a Design Type"),Ue(0,"Zoning","#zoningFilter","Select a Zone"),Ue(0,"Neighborhood","#neighborhoodFilter","Select a Neighborhood"),document.getElementById("Print-selector").addEventListener("click",(function(){!function(){const e=300,t=8.8,a=t*e,i=7.7*e;L.takeScreenshot({width:a,height:i}).then((function(e){const a=window.open("","_blank"),i=document.getElementById("scale-value").innerHTML,n=(new Date).toLocaleString();a.document.write(`\n            <!DOCTYPE html>\n            <html lang="en">\n            <head>\n                <meta charset="UTF-8">\n                <meta name="viewport" content="width=device-width, initial-scale=1.0">\n                <title>Print Map</title>\n                <link rel="stylesheet" href="https://js.arcgis.com/4.27/esri/themes/light/main.css">\n                <style>\n                    body {\n                        display: flex;\n                        flex-direction: column;\n                        align-items: center;\n                        justify-content: center;\n                        margin: 0;\n                        padding: 0;\n                    }\n                    .print-title {\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        text-align: center;\n                        font-size: 24px;\n                        margin: 20px 0;\n                    }\n                    .print-scale {\n                        display: flex;\n                        align-items: center;\n                        justify-content: space-around;\n                        text-align: center;\n                        font-size: 14px;\n                        width: 100%;\n                        margin-left: 20px;\n                        margin-right: 20px;\n                    }\n                    .print-title img {\n                        margin-right: 20px;\n                    }\n                    .scale-bar-container {\n                        transform: scale(1.5);\n                        margin-right: 50px;\n                    }\n                    .print-scale-bar {\n                        width: 300px;\n                        height: 30px;\n                    }\n                    .info-writing-container {\n                        display: flex;\n                        justify-content: center;\n                        align-items: flex-start;\n                        width: 80%;\n                        margin: 20px auto;\n                    }\n                    .info-text {\n                        width: 20%;\n                        text-align: left;\n                        margin-right: 20px;\n                    }\n                    .writing-lines {\n                        width: 80%;\n                        text-align: center;\n                    }\n                    .writing-lines div {\n                        border-bottom: 1px solid black;\n                        margin: 10px 0;\n                        height: 20px;\n                    }\n                    @media print {\n                        body * {\n                            visibility: visible;\n                        }\n                    }\n                </style>\n            </head>\n            <body>\n                <div class="print-title" id="print-title">\n                    <img id="town-logo" src="${M.welcomeImage}" alt="Town Logo">\n                    <h1 id="title-text">${M.title}</h1>\n                </div>\n                <div class="print-map">\n                    <img id="print-map-image" src="${e.dataUrl}" alt="Map Image" style="width: ${t}in; height: auto; border: 3px solid #A9A9A9; margin: 0 0.75in;">\n                </div>\n                <div class="print-scale">\n                    <div class="print-date" style="font-size: 12px;">Date Printed: ${n}</div>\n                    <div id="to-scale" class="scale-bar-container"></div>\n                    <div id="print-scale-bar" class="scale-bar-container">${i}</div>\n                </div>\n                <div style="text-align: center; font-size: 12px; padding-left: 30px; padding-right: 30px;">\n                    <p>Disclaimer: This map is intended for reference and general informational purposes\n                    only and is not a legally recorded map or survey. While reasonable effort has been\n                    made to ensure the accuracy, correctness, and timeliness of materials presented,\n                    the map vendor and the municipality disclaim any and all liability and responsibility for\n                    any errors, omissions, or inaccuracies in the data provided, including without limitation\n                    any liability for direct, indirect, incidental, consequential, special, exemplary,\n                    punitive, or any other type of damages. Users are hereby notified that the primary\n                    information source should be consulted for verification of the data contained herein.\n                    Continued use of this map acknowledges acceptance of these terms.</p>\n                </div>\n                <script>\n                    window.onload = function() {\n                        window.print();\n                    };\n                <\/script>\n            </body>\n            </html>\n          `),a.document.close()}))}()})),L.watch("zoom",(function(e,t){e!==t&&qe()})),L.watch("center",(function(e,t){e!==t&&qe()})),$(document).ready((function(){$(document).on("click",".justRemove",(function(e){e.stopPropagation(),e.preventDefault();let t=e.target.closest("li"),a=t.getAttribute("data-id"),i=t.getAttribute("object-id"),n=e,r=!0,s=[],l=!1,o=t.querySelector(".listText");if(o){let e=o.classList;s=Array.from(e),l=s.includes("noGeometry")}if("no"===sessionStorage.getItem("condos")){let e=Ie.createQuery();e.where=l?`GIS_LINK = '${a}'`:`OBJECTID = '${i}'`,e.returnGeometry=!0,e.outFields=["*"],Te.queryFeatures(e).then((function(e){totalResults=e.features,Ke(totalResults,"",n),je(e,L.graphics,r)}))}else{let e=Ie.createQuery();e.where=`OBJECTID = ${i}`,e.returnGeometry=!0,e.outFields=["*"],Ie.queryFeatures(e).then((function(e){totalResults=e.features,Ke(totalResults,"",n),je(e,L.graphics,r)}))}}))})),$(document).ready((function(){$(document).on("click",".justZoom",(function(e){e.stopPropagation(),e.preventDefault();let t=e.target.closest("li"),a=(t.getAttribute("data-id"),t.getAttribute("object-id"));if("no"===sessionStorage.getItem("condos")){let e=`OBJECTID = ${a}`,t=Te.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],Te.queryFeatures(t).then((e=>{let t=e.features[0].geometry;const a=t.extent;a.center,a.expand(3);L.goTo({target:t})}))}else{let e=`OBJECTID = ${a}`,t=Ie.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],Ie.queryFeatures(t).then((e=>{let t=e.features[0].geometry;const a=t.extent;a.center,a.expand(3);L.goTo({target:t})}))}}))})),document.getElementById("sortByOwner").addEventListener("click",(function(){ze("owner")})),document.getElementById("sortByLocation").addEventListener("click",(function(){ze("location")}));let He=new d({view:L,layer:_,defaultCreateOptions:{mode:"freehand"},polygonSymbol:{type:"simple-fill",style:"cross",color:"rgb(145, 199, 61)",outline:{width:3,style:"solid",color:"rgba(127, 42, 145, 1)"}},defaultUpdateOptions:{tool:"reshape",toggleToolOnClick:!1}});$("#lasso").on("click",(function(e){Y=!Y,X=!1,$("#select-button").removeClass("btn-warning"),$("#select-button").prop("disabled",!1),Y&&!X?(He.create("polygon"),$("#select-button").removeClass("btn-warning"),$("#lasso").addClass("btn-warning")):(He.cancel(),$("#lasso").removeClass("btn-warning"),$("#lasso").addClass("btn-info"),$("#select-button").removeClass("btn-warning"),$("#select-button").addClass("btn-info")),Ve(),_.removeAll(),"no"===sessionStorage.getItem("condos")?Te.visible=!0:Ie.visible=!0})),He.on("create",(function(e){"complete"===e.state&&(_.remove(e.graphic),_.add(e.graphic),function(e){let t=!0;H=!0;let a=[];"no"==sessionStorage.getItem("condos")?function(){let i=Te.createQuery();i.geometry=e,i.distance=1,i.units="feet",i.spatialRelationship="intersects",i.returnGeometry=!0,i.outFields=["*"],Te.queryFeatures(i).then((function(i){i.features.forEach((e=>{a.push(e.attributes.GIS_LINK)})),Xe(a,t),e=!1}))}():function(){let i=Ie.createQuery();i.geometry=e,i.distance=1,i.units="feet",i.spatialRelationship="intersects",i.returnGeometry=!0,i.outFields=["*"],Ie.queryFeatures(i).then((function(i){i.features.forEach((e=>{a.push(e.attributes.GIS_LINK)})),Xe(a,t),e=!1}))}()}(e.graphic.geometry),q&&(q?.remove(),q=null),V&&(V?.remove(),V=null),$("#lasso").removeClass("btn-warning"),$("#lasso").addClass("btn-info"))})),$("#select-button").on("click",(function(e){if(He.cancel(),X=!!ue||!X,X||Ve(),Y=!1,X&&!Y?($("#lasso").removeClass("btn-warning"),$("#select-button").addClass("btn-warning")):$("#select-button").removeClass("btn-warning"),"no"===sessionStorage.getItem("condos")?Te.visible=!0:Ie.visible=!0,X&&!Y){if(V)try{V?.remove(),V=null}catch(e){console.error("Failed to remove clickHandle",e)}if(q)try{q?.remove(),q=null}catch(e){console.error("Failed to remove DetailsHandle",e)}V=L.on("click",Je)}else if(X&&Y)q&&(q?.remove(),q=null),V&&(V?.remove(),V=null),V=L.on("click",Je);else{if(V)try{V?.remove(),V=null}catch(e){console.error("Failed to remove clickHandle",e)}if(q)try{q?.remove(),q=null}catch(e){console.error("Failed to remove DetailsHandle",e)}}})),$("#home").on("click",(function(e){L.goTo(M.homeExtent)}));class Ze{constructor(e,t,a,i,n,r,s,l,o,d,c,u,p,m,h,g,f,$,b,y,v,w,x,_,T,I,L,S,M,B,E,C,P,D,A,k,F,N,O,R){this.objectid=e,this.location=t,this.uniqueId=a,this.GIS_LINK=i,this.coOwner=n,this.owner=r,this.MBL=s,this.geometry=l,this.mailingAddress=o,this.mailingAddress2=d,this.Mailing_City=c,this.Mail_State=u,this.Mailing_Zip=p,this.Total_Acres=m,this.Parcel_Primary_Use=h,this.Building_Use_Code=g,this.Parcel_Type=f,this.Design_Type=$,this.Zoning=b,this.Neighborhood=y,this.Land_Type_Rate=v,this.Functional_Obs=w,this.External_Obs=x,this.Sale_Date=_,this.Sale_Price=T,this.Vol_Page=I,this.Assessed_Total=L,this.Appraised_Total=S,this.Influence_Factor=M,this.Influence_Type=B,this.Land_Type=E,this.Prior_Assessment_Year=C,this.Prior_Assessed_Total=P,this.Prior_Appraised_Total=D,this.Map=A,this.LAT=k,this.LON=F,this.Image_Path=N,this.AcctNum=O,this.Match_Status=R}}function We(){$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$(".center-container").hide(),$("#layerListDiv").hide(),$("#details-spinner").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").html('<h5 style="color: red;">Issue selecting Parcel. Please make another selection.</h5>'),$("#abutters-attributes").prop("disabled",!0),$("#abutters-zoom").prop("disabled",!0),$("#selected-feature").empty(),$("#exportSearch").hide(),$("#exportButtons").hide()}function Qe(e){if(V&&(V?.remove(),V=null),$("#details-spinner").show(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportSearch").hide(),$("#exportButtons").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$("#abutters-attributes").prop("disabled",!1),$("#abutters-zoom").prop("disabled",!1),"no"===sessionStorage.getItem("condos")){let t=Te.createQuery();t.geometry=e.mapPoint,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"],Te.queryFeatures(t).then((function(e){if(totalResults=e.features,totalResults.length>0){nt(e.features[0].attributes.OBJECTID,e.features[0].geometry,e.features[0]),at(totalResults)}else We()}))}else{let t=Ie.createQuery();t.geometry=e.mapPoint,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"],Ie.queryFeatures(t).then((function(e){if(totalResults=e.features,totalResults.length>0){nt(e.features[0].attributes.OBJECTID,e.features[0].geometry,e.features[0]),at(totalResults)}else We()}))}}function Je(e){if(le="click",G=!1,ee=!0,q&&(q?.remove(),q=null),"no"===sessionStorage.getItem("condos")){let t=Te.createQuery();t.geometry=e.mapPoint,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"],Te.queryFeatures(t).then((function(t){t.features&&(totalResults=t.features,Ke(totalResults,"",e),je(t,L.graphics,ee))}))}else{let t=Ie.createQuery();t.geometry=e.mapPoint,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"],Ie.queryFeatures(t).then((function(t){t.features&&(totalResults=t.features,Ke(totalResults,"",e),je(t,L.graphics,ee))}))}}function Ye(e){var t;t="search"===e?document.querySelectorAll(".export-search-list"):document.querySelectorAll(".abutters-group-list");const a=[];document.querySelectorAll(".search-list").forEach((function(e,t){a[t]=e.innerHTML}));var i="<ul class='label-list'>";t.forEach((function(e){i+="<li>"+e.innerHTML.trim()+"</li>"})),i+="</ul>";var n=window.open("","print","left=0,top=0,width=800,height=600,toolbar=0,status=0");n.document.write("<!DOCTYPE html><html><head>"),n.document.write("<title>Print Labels</title>"),n.document.write("<style>body { margin: 0; padding: 0; font-size: 10pt; }.label-list { list-style-type: none; margin: 0; padding: 0; display: flex; align-items: center; text-align: center; flex-wrap: wrap; justify-content: space-between; }.label-list li { box-sizing: border-box; width: 2.225in; height: 1in; margin-bottom: 0.0in; padding: 0.1in; display: flex; align-items: center; justify-content: center; font-size: 8pt; }@media print {  body { margin: 0.0in 0.1875in; }  .label-list { padding: 0; }  .label-list li { margin-right: 0in; margin-bottom: 0; }  @page { margin-top: 0.5in; margin-bottom: 0.5in; margin-left: 0.25in; margin-right: 0.25in }}</style>"),n.document.write("</head><body>"),n.document.write(i),n.document.write("</body></html>"),n.document.close(),setTimeout((()=>{n.print(),n.close(),document.querySelectorAll(".search-list").forEach((function(e,t){a[t]&&(e.innerHTML=a[t])}))}),250)}function Xe(e,t){if(e.length>0){let a=[];e.forEach((e=>{a.includes(e)||a.push(e)}));const i=a.map((e=>`'${e}'`)).join(" OR GIS_LINK = "),n=`GIS_LINK = ${i}`;let r=Le.createQuery();r.where=n,r.returnGeometry=!1,r.returnHiddenFields=!0,r.outFields=["*"],Le.queryFeatures(r).then((e=>{t?lt("","",r):function(e){const t=document.getElementById("parcel-feature");t.innerHTML="";const a=e.features;totalResults=a.length,lastResults=totalResults,A=a,k=a,oe=a,a.forEach((function(e){let a=e.attributes.GIS_LINK,i=e.attributes.OBJECTID,n=e.attributes.Owner,r=e.attributes.Co_Owner,s=e.attributes.Mailing_Address_1,l=e.attributes.Mailing_Address_2,o=e.attributes.Mailing_City,d=e.attributes.Mail_State,c=e.attributes.Mailing_Zip;const u=document.createElement("ul");u.classList.add("row"),u.classList.add("list-group"),u.classList.add("abutters-list");const p=document.createElement("li");p.classList.add("abutters-group-item","col-12");let m="";m=` ${n} ${r} <br> ${s} ${l} <br> ${o}, ${d} ${c}`,p.innerHTML+=m,p.setAttribute("data-id",a),p.setAttribute("object-id",i),u.appendChild(p),t.appendChild(u),$("#abutters-spinner").hide(),$("#abutters-title").html(`Abutting Parcels (${totalResults})`)})),$("#results-div").css("height","300px"),$("#exportResults").show(),$("#csvExportResults").show()}(e)}))}else console.log("No buffer results to query.")}function et(e){N="BufferGraphicId";const t=L.graphics.items.findIndex((e=>e.id===N));t>-1&&L.graphics.removeAt(t);let a=new s({geometry:e,symbol:{type:"simple-fill",color:[51,51,204,.1],style:"forward-diagonal",outline:{color:"rgba(127, 42, 145, 0.8)",width:4}},id:N});L.graphics.add(a),L.goTo({target:a})}function tt(e){$("#abutters-spinner").show(),0===e&&(e=-10);let t,a=e,i=J;t=(sessionStorage.getItem("condos"),l.buffer(P,a,i)),et(t),function(e){const t={spatialRelationship:"intersects",geometry:e,outFields:["*"],returnGeometry:!0,units:J};let a=[];"no"===sessionStorage.getItem("condos")?Te.queryFeatures(t).then((e=>{e.features.forEach((e=>{a.push(e.attributes.GIS_LINK)})),Xe(a)})):Ie.queryFeatures(t).then((e=>{e.features.forEach((e=>{a.push(e.attributes.GIS_LINK)})),Xe(a)}))}(t)}function at(e){function t(e){return void 0===e?"":new Intl.NumberFormat("en-US").format(e)}$("#select-button").prop("disabled",!0),$("#select-button").removeClass("btn-warning"),le="detailClick",$("#detail-content").empty(),$("#selected-feature").empty(),$(".center-container").hide(),$("#layerListDiv").hide();let a,i,n=e[0].attributes,r=void 0===n.Location?"":n.Location,s=void 0===n.Uniqueid?"":n.Uniqueid,l=void 0===n.GIS_LINK?"":n.GIS_LINK,o=void 0===n.Co_Owner?"":n.Co_Owner,d=void 0===n.Owner?"":n.Owner,c=void 0===n.MBL?"":n.MBL,u=void 0===n.Mailing_Address_1?"":n.Mailing_Address_1,p=void 0===n.Mailing_City?"":n.Mailing_City+", ",m=void 0===n.Mail_State?"":n.Mail_State,h=void 0===n.Mailing_Zip?"":n.Mailing_Zip,g=void 0===n.Total_Acres?"":n.Total_Acres,f=void 0===n.Parcel_Primary_Use?"":n.Parcel_Primary_Use,b=void 0===n.Building_Use_Code?"":n.Building_Use_Code,v=n.Sale_Date,w=void 0===n.Sale_Date?"":y(v),x=void 0===n.Sale_Price?"":t(n.Assessed_Total),_=void 0===n.Vol_Page?"":n.Vol_Page,T=void 0===n.Prior_Appraised_Total?"":t(n.Prior_Appraised_Total),I=void 0===n.Prior_Assessed_Total?"":t(n.Prior_Assessed_Total),L=void 0===n.Prior_Assessment_Year?"":n.Prior_Assessment_Year,B=void 0===n.Map?"":$.trim(n.Map),E=void 0===n.OBJECTID?"":n.OBJECTID,C=void 0===n.Lat?"":n.Lat,P=void 0===n.Lon?"":n.Lon,D=void 0===n.AcctNum?"":n.AcctNum;"yes"===M.useUniqueIdforParcelMap?(de=s,a=s):(de=l,a=l),i="yes"===M.useVisionForTaxBillUrl?D:s,ce=E,S=l;const A=n.Image_Path,k=document.getElementById("detail-content"),F=document.createElement("div");F.innerHTML="",F.classList.add("details");let N=M.DetailLinksToInclude,O=M.DetailLinks,R=[];O.forEach((e=>{let t=e;if(N.includes(e)){let e={[t]:{show:"show"}};R.push(e)}else{let e={[t]:{show:"none"}};R.push(e)}}));let U=`\n        <p>\n        <span style="font-family:Tahoma;font-size:14px;"><strong>${r}</strong></span> <br>\n        </p>\n  \n        <div>\n        <img class="image" src=${M.imageUrl}${A} alt="Building Photo" width="250" height="125">\n        </div>\n        <p>\n        <span style="font-family:Tahoma;font-size:12px;"><strong>${d} ${o}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;"><strong>${u}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;"><strong>${p} ${m} ${h}</strong></span><br>\n    </p>\n    <div id="accordion">\n      <div class="card" id="links" style="display:${R[0].links.show}">\n        <div class="card-header" id="headingOne">\n            <h5 class="mb-0">\n            <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">\n                Property Links\n            </button>\n          </h5>\n      </div>\n  \n      \n      <div id="collapseOne" class="collapse show" aria-labelledby="OneFour" data-parent="#accordion">\n             <div class="card-body" style="text-align: left;">\n      `;"yes"===M.includePermitLink&&(U+=`<a class='mx-auto' href=${M.permitLink}?uniqueid=${i} target="_blank"><span style="font-family:Tahoma;font-size:12px;"><strong>Permits</strong></a><br>`),U+=`\n        <table style="width: 100%; font-family: Tahoma; font-size: 12px; border-collapse: collapse; text-align: left;">\n          <tr>\n            <td>\n              <a target="_blank" rel="noopener noreferrer" href="${M.tax_bill}&uniqueId=${i}">\n                <strong>Tax Bills</strong>\n              </a>\n            </td>\n            <td>`,"yes"==M.propertyCardPdf?U+=`<a target="_blank" rel="noopener noreferrer" href="${M.propertyCard}${s}.PDF"><strong>Property Card</strong></a>`:U+=`<a target="_blank" rel="noopener noreferrer" href="${M.propertyCard}${s}"><strong>Property Card</strong></a>`,U+=`</td>\n        </tr>\n        <tr>\n          <td>\n            <a target="_blank" rel="noopener noreferrer" href="https://publicweb-gis.s3.amazonaws.com/PDFs/${M.parcelMapUrl}/Quick_Maps/QM_${a}.pdf">\n              <strong>Parcel Map</strong>\n            </a>\n          </td>\n          <td>\n            <a target="_blank" rel="noopener noreferrer" href="${M.taxMap_Url}${B}.pdf">\n              <strong>Tax Map</strong>\n            </a>\n          </td>\n        </tr>\n        <tr>\n          <td>\n            <a target="_blank" rel="noopener noreferrer" href="https://www.google.com/maps/@${C},${P},17z/@${C},${P},17z/data=!5m1!1e2">\n              <strong>Google Maps</strong>\n            </a>\n          </td>\n          <td>\n            <a target="_blank" rel="noopener noreferrer" href="https://www.bing.com/maps?cp=${C}~${P}&lvl=17.0">\n              <strong>Bing Maps</strong>\n            </a>\n          </td>\n        </tr>\n        <tr><td colspan="2"> &nbsp </td></tr>\n        <tr>\n          <td colspan="2">\n            <a target="_blank" rel="noopener noreferrer" href="${M.pdf_demo}">\n              <strong>Demographics Profile</strong>\n            </a>\n          </td>\n        </tr>\n        <tr>\n          <td colspan="2">\n            <a target="_blank" rel="noopener noreferrer" href="${M.housingUrl}">\n              <strong>Housing Profile</strong>\n            </a>\n          </td>\n        </tr>\n      </table>\n      </div>\n      </div>\n      </div>\n          <div class="card " id="ids" style="display:${R[1].ids.show}">\n              <div class="card-header" id="headingTwo">\n              <h5 class="mb-0">\n                  <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">\n                  Property Ids & Uses\n                  </button>\n              </h5>\n              </div>\n              <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">\n                  <div class="card-body">\n                    <p>\n                    <span style="font-family:Tahoma;font-size:12px;">Unique ID: <strong>${s}</strong></span> <br>\n                    <span style="font-family:Tahoma;font-size:12px;">MBL: <strong>${c}</strong></span> <br>\n                    <span style="font-family:Tahoma;font-size:12px;">Total Acres: <strong>${g}</strong></span> <br>\n                    <span style="font-family:Tahoma;font-size:12px;">Primary Use: <strong>${f}</strong></span> <br>\n                    <span style="font-family:Tahoma;font-size:12px;">Primary Bldg Use: <strong>${b}</strong></span><br>\n                    </p>\n                  </div>\n              </div>\n          </div>\n      <div class="card" id="sales" style="display:${R[3].sales.show}" >\n      <div class="card-header" id="headingThree">\n        <h5 class="mb-0">\n          <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">\n            Latest Sale / Transfer\n          </button>\n        </h5>\n      </div>\n      <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">\n        <div class="card-body">\n          <p>\n          <span style="font-family:Tahoma;font-size:12px;">Sold on: <strong>${w}</strong></span> <br>\n          <span style="font-family:Tahoma;font-size:12px;">Sale Price: <strong>$${x}</strong></span> <br>\n          <span style="font-family:Tahoma;font-size:12px;">Volume/Page: <strong>${_}</strong></span><br>\n          </p>\n        </div>\n      </div>\n    </div>\n    <div class="card" id="vals" style="display:${R[2].vals.show}">\n      <div class="card-header" id="headingFour">\n          <h5 class="mb-0">\n            <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">\n              Valuations\n            </button>\n          </h5>\n        </div>\n        <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordion">\n          <div class="card-body">\n              <p>\n              <span style="font-family:Tahoma;font-size:12px;"><strong>Valuations:</strong></span><br>\n              <span style="font-family:Tahoma;font-size:12px;">GL Year: <strong>${L}</strong></span> <br>\n              <span style="font-family:Tahoma;font-size:12px;">Assessment: <strong>$${I}</strong></span> <br>\n              <span style="font-family:Tahoma;font-size:12px;">Appraised: <strong>$${T}</strong></span> <br>\n              <span style="font-family:Tahoma;font-size:12px;"></span>\n              </p>\n          </div>\n      </div>\n    </div>\n  </div>\n      `,F.innerHTML=U,$("#details-spinner").hide(),k.appendChild(F)}function it(e,t,a){function i(e){return void 0===e?"":new Intl.NumberFormat("en-US").format(e)}var n;a?$("#abutters-zoom").prop("disabled",!1):$("#abutters-zoom").prop("disabled",!0),$("#select-button").prop("disabled",!0),$("#select-button").removeClass("btn-warning"),V&&(V?.remove(),V=null),le="detailClick",$("#exportResults").hide(),$("#csvExportResults").hide(),Z=[e,t],(n=W.find((function(a){return a.objectid===parseInt(e)&&a.GIS_LINK===t})))||(n=W.find((function(e){return e.GIS_LINK===t||e.uniqueId===t})));let r,s,l=void 0===n.location?"":n.location,o=void 0===n.uniqueId?"":n.uniqueId,d=void 0===n.GIS_LINK?"":n.GIS_LINK,c=void 0===n.coOwner?"":n.coOwner,u=void 0===n.owner?"":n.owner,p=void 0===n.MBL?"":n.MBL,m=void 0===n.mailingAddress?"":n.mailingAddress,h=void 0===n.Mailing_City?"":n.Mailing_City+", ",g=void 0===n.Mail_State?"":n.Mail_State,f=void 0===n.Mailing_Zip?"":n.Mailing_Zip,b=void 0===n.Total_Acres?"":n.Total_Acres,y=void 0===n.Parcel_Primary_Use?"":n.Parcel_Primary_Use,v=void 0===n.Building_Use_Code?"":n.Building_Use_Code,w=void 0===n.Sale_Date?"":n.Sale_Date,x=void 0===n.Sale_Price?"":i(n.Sale_Price),_=void 0===n.Vol_Page?"":n.Vol_Page,T=void 0===n.Prior_Appraised_Total?"":i(n.Prior_Appraised_Total),I=void 0===n.Prior_Assessed_Total?"":i(n.Prior_Assessed_Total),L=void 0===n.Prior_Assessment_Year?"":n.Prior_Assessment_Year,E=(void 0===n.geometry||n.geometry,void 0===n.Map?"":$.trim(n.Map)),C=void 0===n.objectid?"":n.objectid,P=void 0===n.LAT?"":n.LAT,D=void 0===n.LON?"":n.LON,A=void 0===n.AcctNum?"":n.AcctNum,k=void 0===n.Image_Path?"":n.Image_Path;"yes"===M.useUniqueIdforParcelMap?(de=o,r=o):(de=d,r=d),s="yes"===M.useVisionForTaxBillUrl?A:o,ce=C,S=d;const F=document.getElementById("detail-content"),N=document.createElement("div");N.innerHTML="",N.classList.add("details");let O=M.DetailLinksToInclude,R=M.DetailLinks,U=[];R.forEach((e=>{let t=e;if(O.includes(e)){let e={[t]:{show:"show"}};U.push(e)}else{let e={[t]:{show:"none"}};U.push(e)}}));let q=`\n      <p>\n      <span style="font-family:Tahoma;font-size:14px;"><strong>${l}</strong></span> <br>\n      </p>\n\n      <div>\n      <img class="image" src=${M.imageUrl}${k} alt="Building Photo" width="250" height="125">\n      </div>\n      <p>\n      <span style="font-family:Tahoma;font-size:12px;"><strong>${u} ${c}</strong></span> <br>\n      <span style="font-family:Tahoma;font-size:12px;"><strong>${m}</strong></span> <br>\n      <span style="font-family:Tahoma;font-size:12px;"><strong>${h} ${g} ${f}</strong></span><br>\n  </p>\n  <div id="accordion">\n    <div class="card" id="links" style="display:${U[0].links.show}">\n      <div class="card-header" id="headingOne">\n          <h5 class="mb-0">\n          <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">\n              Property Links\n          </button>\n        </h5>\n    </div>\n\n    \n    <div id="collapseOne" class="collapse show" aria-labelledby="OneFour" data-parent="#accordion">\n           <div class="card-body" style="text-align: left;">\n      `;"yes"===M.includePermitLink&&(q+=`<a class='mx-auto' href=${M.permitLink}?uniqueid=${o} target="_blank"><span style="font-family:Tahoma;font-size:12px;"><strong>Permits</strong></a><br>`),q+=`\n        <table style="width: 100%; font-family: Tahoma; font-size: 12px; border-collapse: collapse; text-align: left;">\n  <tr>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="${M.tax_bill}&uniqueId=${s}">\n        <strong>Tax Bills</strong>\n      </a>\n    </td>\n     <td>`,"yes"==M.propertyCardPdf?q+=`<a target="_blank" rel="noopener noreferrer" href="${M.propertyCard}${o}.PDF"><strong>Property Card</strong></a>`:q+=`<a target="_blank" rel="noopener noreferrer" href="${M.propertyCard}${o}"><strong>Property Card</strong></a>`,q+=`</td>\n  </tr>\n  <tr>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="https://publicweb-gis.s3.amazonaws.com/PDFs/${M.parcelMapUrl}/Quick_Maps/QM_${r}.pdf">\n        <strong>Parcel Map</strong>\n      </a>\n    </td>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="${M.taxMap_Url}${E}.pdf">\n        <strong>Tax Map</strong>\n      </a>\n    </td>\n  </tr>\n  <tr>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="https://www.google.com/maps/@${P},${D},17z/@${P},${D},17z/data=!5m1!1e2">\n        <strong>Google Maps</strong>\n      </a>\n    </td>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="https://www.bing.com/maps?cp=${P}~${D}&lvl=17.0">\n        <strong>Bing Maps</strong>\n      </a>\n    </td>\n  </tr>\n  <tr><td colspan="2"> &nbsp </td></tr>\n  <tr>\n    <td colspan="2">\n      <a target="_blank" rel="noopener noreferrer" href="${M.pdf_demo}">\n        <strong>Demographics Profile</strong>\n      </a>\n    </td>\n  </tr>\n  <tr>\n    <td colspan="2">\n      <a target="_blank" rel="noopener noreferrer" href="${M.housingUrl}">\n        <strong>Housing Profile</strong>\n      </a>\n    </td>\n  </tr>\n</table>\n\n          </div>\n        </div>\n      </div>\n        <div class="card " id="ids" style="display:${U[1].ids.show}">\n            <div class="card-header" id="headingTwo">\n            <h5 class="mb-0">\n                <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">\n                Property Ids & Uses\n                </button>\n            </h5>\n            </div>\n            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">\n                <div class="card-body">\n                  <p>\n                  <span style="font-family:Tahoma;font-size:12px;">Unique ID: <strong>${o}</strong></span> <br>\n                  <span style="font-family:Tahoma;font-size:12px;">MBL: <strong>${p}</strong></span> <br>\n                  <span style="font-family:Tahoma;font-size:12px;">Total Acres: <strong>${b}</strong></span> <br>\n                  <span style="font-family:Tahoma;font-size:12px;">Primary Use: <strong>${y}</strong></span> <br>\n                  <span style="font-family:Tahoma;font-size:12px;">Primary Bldg Use: <strong>${v}</strong></span><br>\n                  </p>\n                </div>\n            </div>\n        </div>\n    <div class="card" id="sales" style="display:${U[3].sales.show}" >\n    <div class="card-header" id="headingThree">\n      <h5 class="mb-0">\n        <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">\n          Latest Sale / Transfer\n        </button>\n      </h5>\n    </div>\n    <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">\n      <div class="card-body">\n        <p>\n        <span style="font-family:Tahoma;font-size:12px;">Sold on: <strong>${w}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;">Sale Price: <strong>$${x}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;">Volume/Page: <strong>${_}</strong></span><br>\n        </p>\n      </div>\n    </div>\n  </div>\n  <div class="card" id="vals" style="display:${U[2].vals.show}">\n    <div class="card-header" id="headingFour">\n        <h5 class="mb-0">\n          <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">\n            Valuations\n          </button>\n        </h5>\n      </div>\n      <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordion">\n        <div class="card-body">\n            <p>\n            <span style="font-family:Tahoma;font-size:12px;"><strong>Valuations:</strong></span><br>\n            <span style="font-family:Tahoma;font-size:12px;">GL Year: <strong>${L}</strong></span> <br>\n            <span style="font-family:Tahoma;font-size:12px;">Assessment: <strong>$${I}</strong></span> <br>\n            <span style="font-family:Tahoma;font-size:12px;">Appraised: <strong>$${T}</strong></span> <br>\n            <span style="font-family:Tahoma;font-size:12px;"></span>\n            </p>\n        </div>\n    </div>\n  </div>\n</div>\n    `,N.innerHTML=q,$("#details-spinner").hide(),F.appendChild(N),B&&$(".abutters-zoom").trigger("click"),B=!1}function nt(e,t,a){te={isChanged:!0,item:a};L.graphics.removeAll(O);D=t,P=t;const i=new s({geometry:D,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:3}},id:"uniqueBufferGraphicId"}),n=D.extent.expand(2);L.graphics.addMany([i]),L.goTo({target:i,extent:n})}function rt(e,t,a){te={isChanged:!1,item:""},U=[];let i="uniqueBufferGraphicId";L.graphics.removeAll(O);const n=L.graphics.items.findIndex((e=>e.id===i));if(n>-1&&L.graphics.removeAt(n),U=W.filter((e=>e.GIS_LINK==a)),"no"==sessionStorage.getItem("condos")&&U.length==W.length&&U.length>1)if(R){Q=!1,D=R[0].geometry,P=R[0].geometry;const e={type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},t=2,a=D.extent.expand(t),n=new s({geometry:D,symbol:e,id:i});L.graphics.addMany([n]),L.goTo({target:n,extent:a}).catch((function(e){"AbortError"!=e.name&&console.error(e)}))}else{let e=`GIS_LINK = '${a}'`,t=Te.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],Te.queryFeatures(t).then((e=>{let t=e.features[0].geometry;D=t,P=t;const a=D.extent.expand(2);L.goTo({target:t,extent:a}).catch((function(e){"AbortError"!=e.name&&console.error(e)}));const n=new s({geometry:P,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:i});L.graphics.addMany([n])}))}else{Q=!0;let t=W.filter((t=>t.objectid==e));if(t)if(null!=t[0].geometry&&""!=t[0].geometry){P=t[0].geometry;const e=2,a=P.extent.expand(e);L.goTo({target:P,extent:a}).catch((function(e){"AbortError"!=e.name&&console.error(e)}));const n=new s({geometry:P,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:i});L.graphics.addMany([n])}else{let e;Q=!1,e=t.filter((e=>{e.GIS_LINK}))?`GIS_LINK = '${a}'`:`GIS_LINK = '${t[0].GIS_LINK}'`;let n=Te.createQuery();n.where=e,n.returnGeometry=!0,n.returnHiddenFields=!0,n.outFields=["*"],Te.queryFeatures(n).then((e=>{let t=e.features[0].geometry;P=t,D=t;const a=D.extent.expand(2);L.goTo({target:t,extent:a}).catch((function(e){"AbortError"!=e.name&&console.error(e)}));const n=new s({geometry:P,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:i});L.graphics.addMany([n])}))}}V&&(V?.remove(),V=null),q&&(q?.remove(),q=null),q=L.on("click",Qe)}L.when((function(){document.getElementById("zoom-in").onclick=function(){L.zoom+=1},document.getElementById("zoom-out").onclick=function(){L.zoom-=1}})),ne.addEventListener("click",(function(){Ve()})),re.addEventListener("click",(function(){Ve()})),document.getElementById("searchInput").addEventListener("input",(function(e){E=e.target.value.toUpperCase().replace(/&amp;/g,"&")})),$(document).ready((function(){$("#backButton").on("click",(function(){if(O&&O.length>=1||!0===K||W.length>0)if($("#WelcomeBox").hide(),$("#select-button").prop("disabled",!1),$("#detailBox").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#featureWid").show(),$("#total-results").show(),$("#ResultDiv").show(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#detail-content").empty(),$("#backButton").hide(),$("#detailsButton").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").show(),$("#exportButtons").show(),$("#exportSearch").show(),$("#results-div").css("height","300px"),$(".center-container").show(),L.graphics.removeAll(),L.graphics.addMany(O),O.length>1){const e=O.map((e=>e.geometry.extent)),t=3,a=e.reduce(((e,t)=>e.union(t)),e[0]).expand(t);L.goTo({target:a}).catch((e=>{console.error("Error zooming to extent:",e)}))}else{const e=2,t=O[0].geometry.extent.expand(e);L.goTo({target:O,extent:t})}else $("#total-results").hide(),$("#ResultDiv").hide(),$("#abut-mail").hide(),$("#backButton").hide(),$("#details-btns").hide(),$("#detailBox").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#dropdown").show(),$(".center-container").show(),$("#WelcomeBox").show();Y||X?!Y&&X||!X&&Y?(V&&V.remove(),q&&(q?.remove(),q=null),$("#select-button").addClass("btn-warning"),V=L.on("click",Je)):Y&&!X?(V&&(V?.remove(),V=null),q&&(q?.remove(),q=null),V=L.on("click",Je),$("#select-button").addClass("btn-warning")):(V&&(V?.remove(),V=null),q&&(q?.remove(),q=null),$("#select-button").addClass("btn-warning"),V=L.on("click",Je)):(q&&(q?.remove(),q=null),V&&(V?.remove(),V=null),V&&X&&(V?.remove(),V=null),$("#select-button").removeClass("btn-warning"),q=L.on("click",Qe))}))})),$(document).ready((function(){$("#detailsButton").on("click",(function(){$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detail-content").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportSearch").hide(),$("#exportButtons").hide(),$("#abutters-title").html("Abutting Parcels (0)"),$("#backButton-div").css("padding-top","0px"),$("#results-div").css("height","300px"),q&&(q?.remove(),q=null),q=L.on("click",Qe);const e=L.graphics.items.findIndex((e=>e.id===N));e>-1&&L.graphics.removeAt(e)}))})),$(document).ready((function(){$("#abutters").on("click",(function(e){q&&(q?.remove(),q=null),V&&(V?.remove(),V=null),$("#results-div").css("height","300px"),$("#exportButtons").show(),$("#exportResults").show(),$("#exportSearch").hide(),$("#csvExportResults").show(),$("#csvExportSearch").hide(),$("#WelcomeBox").hide(),$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#abutters-content").show(),$("#selected-feature").empty(),$("#backButton").show(),$("#detailsButton").show(),$("#parcel-feature").empty(),$("#backButton-div").css("padding-top","78px"),$("#abutters-title").html("Abutting Parcels (0)"),st(e),ie.value=100,function(e){$("#abutters-spinner").show();let t,a=e,i=J;t="no"==sessionStorage.getItem("condos")?l.buffer(D,a,i):l.buffer(P,a,i);et(t),function(e){let t=[];const a=document.getElementById("parcel-feature");a.innerHTML="";const i={spatialRelationship:"intersects",geometry:e,outFields:["*"],returnGeometry:!0,units:J};A=[],"no"===sessionStorage.getItem("condos")?Te.queryFeatures(i).then((e=>{t=[...e.features];const i=new Set;t.filter((e=>!i.has(e.attributes.OBJECTID)&&(i.add(e.attributes.OBJECTID),!0)));let n=t.filter((e=>i.has(e.attributes.OBJECTID)));totalResults=t.length;let r=t,s=r.filter(((e,t)=>r.indexOf(e)===t));lastResults=s,A=t,oe=n,n.forEach((function(e){let t=e.attributes.GIS_LINK,i=e.attributes.OBJECTID,n=e.attributes.Owner,r=e.attributes.Co_Owner,s=e.attributes.Mailing_Address_1,l=e.attributes.Mailing_Address_2,o=e.attributes.Mailing_City,d=e.attributes.Mail_State,c=e.attributes.Mailing_Zip;const u=document.createElement("ul");u.classList.add("row"),u.classList.add("list-group"),u.classList.add("abutters-list");const p=document.createElement("li");p.classList.add("abutters-group-item","col-12");let m="";m=` ${n} ${r} <br> ${s} ${l} <br> ${o}, ${d} ${c}`,p.innerHTML+=m,p.setAttribute("data-id",t),p.setAttribute("object-id",i),u.appendChild(p),a.appendChild(u),$("#abutters-spinner").hide(),$("#abutters-title").html(`Abutting Parcels (${totalResults})`)}))})):Ie.queryFeatures(i).then((e=>{t=[...e.features];const i=new Set;t.filter((e=>!i.has(e.attributes.OBJECTID)&&(i.add(e.attributes.OBJECTID),!0)));let n=t.filter((e=>i.has(e.attributes.OBJECTID)));totalResults=t.length;let r=t,s=r.filter(((e,t)=>r.indexOf(e)===t));lastResults=s,A=t,oe=n,n.forEach((function(e){let t=e.attributes.GIS_LINK,i=e.attributes.OBJECTID,n=e.attributes.Owner,r=e.attributes.Co_Owner,s=e.attributes.Mailing_Address_1,l=e.attributes.Mailing_Address_2,o=e.attributes.Mailing_City,d=e.attributes.Mail_State,c=e.attributes.Mailing_Zip;const u=document.createElement("ul");u.classList.add("row"),u.classList.add("list-group"),u.classList.add("abutters-list");const p=document.createElement("li");p.classList.add("abutters-group-item","col-12");let m="";m=` ${n} ${r} <br> ${s} ${l} <br> ${o}, ${d} ${c}`,p.innerHTML+=m,p.setAttribute("data-id",t),p.setAttribute("object-id",i),u.appendChild(p),a.appendChild(u),$("#abutters-spinner").hide(),$("#abutters-title").html(`Abutting Parcels (${totalResults})`)}))}));$("#results-div").css("height","300px"),$("#exportResults").show(),$("#csvExportResults").show()}(t)}("100")}))})),$(document).ready((function(){$("#abutters-attributes").on("click",(function(e){q&&(q?.remove(),q=null),V&&(V?.remove(),V=null),$("#results-div").css("height","300px"),$("#exportButtons").show(),$("#exportResults").show(),$("#exportButtons").show(),$("#exportSearch").hide(),$("#csvExportResults").show(),$("#csvExportSearch").hide(),$("#WelcomeBox").hide(),$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#abutters-content").show(),$("#selected-feature").empty(),$("#backButton").show(),$("#detailsButton").show(),$("#parcel-feature").empty(),$("#backButton-div").css("padding-top","78px"),$("#abutters-title").html("Abutting Parcels (0)"),st(e),ie.value=100,tt("100")}))})),$(document).ready((function(){$("#filterButton").on("click",(function(){$("#WelcomeBox").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#exportSearch").hide(),$("#csvExportSearch").hide(),$("#abutters-content").hide(),$("#layerListDiv").hide(),$("#selected-feature").empty(),$("#backButton").hide(),$("#detailsButton").hide(),$("#dropdown").show(),$("#filterDiv").show(),$("#dropdown").toggleClass("expanded"),$("#sidebar2").css("left","0px"),$("#sidebar2").addClass("collapsed"),$("#results-div").css("left","350px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide(),$("#results-div").css("height","300px"),$("#parcel-feature").empty(),$("#backButton").show(),$("#backButton-div").css("padding-top","0px"),$("#abutters-title").html("Abutting Parcels (0)"),$(".center-container").show()}))})),$(document).ready((function(){$("#layerListBtn").on("click",(function(){$("#WelcomeBox").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#exportSearch").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportButtons").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#backButton").hide(),$("#detailsButton").hide(),$("#dropdown").show(),$("#filterDiv").hide(),$("#backButton").show(),$("#dropdown").toggleClass("expanded"),$("#sidebar2").css("left","0px"),$("#sidebar2").addClass("collapsed"),$("#results-div").css("left","350px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide(),$("#results-div").css("height","300px"),$("#layerListDiv").show(),$("#parcel-feature").empty(),$("#backButton-div").css("padding-top","0px"),$("#abutters-title").html("Abutting Parcels (0)"),$(".center-container").show()}))})),$("#layerListDiv").hide(),$(document).ready((function(){$("#exportSearch").on("click",(function(e){e.stopPropagation();const t=document.createElement("div");t.style.visibility="hidden",document.body.appendChild(t);const a=document.createElement("ul");k.forEach((function(e){let t=e.objectid,i=e.owner,n=e.coOwner,r=e.mailingAddress,s=(e.mailingAddress2,e.Mailing_City),l=e.Mail_State,o=e.Mailing_Zip,d=(e.location,e.MBL);const c=document.createElement("li");let u;c.classList.add("export-search-list"),u=` ${i} ${n} <br> MBL: ${d} <br> ${r} <br> ${s}, ${l} ${o}`,c.innerHTML+=u,c.setAttribute("object-id",t),a.appendChild(c)})),t.appendChild(a),Ye("search"),document.body.removeChild(t)}))})),$(document).ready((function(){$("#csvExportResults").on("click",(function(e){e.stopPropagation();let t=["Owner","Co-Owner","Mailing Address","Mailing Address 2","Mailing City","Mailing State","Mailing Zip","MBL","Location"].join(",")+"\n";oe.forEach((function(e){let a=e.attributes.Owner||"",i=e.attributes.Co_Owner||"",n=e.attributes.Mailing_Address_1||"",r=e.attributes.Mailing_Address_2||"",s=e.attributes.Mailing_City||"",l=e.attributes.Mail_State||"",o=e.attributes.Mailing_Zip?`\t${e.attributes.Mailing_Zip.toString().padStart(5,"0")}`:"",d=e.attributes.Location||"",c=e.attributes.MBL||"";t+=`"${a}","${i}","${n}","${r}","${s}","${l}","${o}","${c}","${d}"\n`}));const a=new Blob([t],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(void 0!==i.download){const e=URL.createObjectURL(a);i.setAttribute("href",e),i.setAttribute("download","export.csv"),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}}))})),$(document).ready((function(){$("#csvExportSearch").on("click",(function(e){e.stopPropagation();let t=["Owner","Co-Owner","Mailing Address","Mailing Address 2","Mailing City","Mailing State","Mailing Zip","MBL","Location"].join(",")+"\n";k.forEach((function(e){let a=e.owner||"",i=e.coOwner||"",n=e.mailingAddress||"",r=e.mailingAddress2||"",s=e.Mailing_City||"",l=e.Mail_State||"",o=e.Mailing_Zip?`\t${e.Mailing_Zip.toString().padStart(5,"0")}`:"",d=e.location||"",c=e.MBL||"";t+=`"${a}","${i}","${n}","${r}","${s}","${l}","${o}","${c}","${d}"\n`}));const a=new Blob([t],{type:"text/csv;charset=utf-8;"}),i=document.createElement("a");if(void 0!==i.download){const e=URL.createObjectURL(a);i.setAttribute("href",e),i.setAttribute("download","export.csv"),i.style.visibility="hidden",document.body.appendChild(i),i.click(),document.body.removeChild(i)}}))})),$(document).ready((function(){$("#exportResults").on("click",(function(e){e.stopPropagation();const t=document.createElement("div");t.style.visibility="hidden",document.body.appendChild(t);const a=document.createElement("ul");k.forEach((function(e){let t=e.attributes.OBJECTID,i=e.attributes.Owner,n=e.attributes.Co_Owner,r=e.attributes.Mailing_Address_1,s=(e.attributes.Mailing_Address_2,e.attributes.Mailing_City),l=e.attributes.Mail_State,o=e.attributes.Mailing_Zip,d=(e.location,e.attributes.MBL);const c=document.createElement("li");let u;c.classList.add("abutters-group-list"),u=` ${i} ${n} <br> MBL: ${d} <br> ${r} <br> ${s}, ${l} ${o}`,c.innerHTML+=u,c.setAttribute("object-id",t),a.appendChild(c)})),t.appendChild(a),Ye("details"),document.body.removeChild(t)}))})),$(document).ready((function(){let e;function t(){clearTimeout(e),e=setTimeout((()=>{tt(currentVal)}),200)}$("#buffer-value").on("change",(function(e){e.stopPropagation(),currentVal=ie.value=parseInt(ie.value),$("#parcel-feature").empty(),t()})),$("#increase").on("click",(function(e){e.stopPropagation(),currentVal=ie.value=parseInt(ie.value)+1,$("#parcel-feature").empty(),t()})),$("#decrease").on("click",(function(e){e.stopPropagation(),currentVal=ie.value=parseInt(ie.value)-1,$("#parcel-feature").empty(),t()})),$("#submit").on("click",(function(e){e.stopPropagation(),e.preventDefault(),currentVal=ie.value=parseInt(ie.value),$("#parcel-feature").empty(),t()})),$("#buffer-value").on("keypress",(function(e){13==e.which&&(currentVal=ie.value=parseInt(ie.value),e.preventDefault(),t())})),$(".units").on("click",(function(e){"feet"==e.target.value?(J="feet",$("#unitSelector").html(J)):(J="meters",$("#unitSelector").html(J))}))})),$(document).ready((function(){$(document).on("click",".abutters-zoom",(function(e){if(e.stopPropagation(),e.preventDefault(),"no"===sessionStorage.getItem("condos"))if(j){if(j){let e=`GIS_LINK = '${S}'`,t=Te.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],Te.queryFeatures(t).then((e=>{const t=e.features[0].geometry.extent,a=t.center;t.expand(3);L.goTo({target:a,zoom:14})}))}}else{let e=`OBJECTID = ${ce}`,t=Te.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],Te.queryFeatures(t).then((e=>{const t=e.features[0].geometry.extent,a=t.center;t.expand(3);L.goTo({target:a})}))}else{let e=`OBJECTID = ${ce}`,t=Ie.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],Ie.queryFeatures(t).then((e=>{let a,i,n,r;e.features>0?Ie.queryFeatures(t).then((e=>{let t=Ie.createQuery();t.where=`GIS_LINK = ${S}`,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"]})).then((e=>{a=e,i=a.features[0].geometry,n=i.extent,r=n.center})):(a=e,i=a.features[0].geometry,n=i.extent,r=n.center),L.goTo({target:r})}))}}))}));const st=function(e,t){$("#abutters-title").html("Abutters");let a,i,n,r,s,l,o,d,c,u,p,m=Z;if(te.isChanged)a=te.item.attributes.Mailing_Address_1,i=te.item.attributes.Uniqueid,n=te.item.attributes.GIS_LINK,r=te.item.attributes.Owner,p=te.item.attributes.MBL,s=te.item.attributes.Co_Owner,o=te.item.attributes.Mailing_Address_1,d=te.item.attributes.Mailing_Address_2,c=te.item.attributes.Mailing_City,l=te.item.attributes.Mailing_Zip,u=te.item.attributes.Mail_State;else{var h=W.find((function(e){return e.uniqueId===m[1]&&e.objectid===Number(m[0])||e.GIS_LINK===m[1]&&e.objectid===Number(m[0])}));a=void 0===h.mailingAddress?"":h.mailingAddress,i=void 0===h.uniqueId?"":h.uniqueId,n=void 0===h.GIS_LINK?"":h.GIS_LINK,r=void 0===h.owner?"":h.owner,s=void 0===h.coOwner?"":h.coOwner,o=void 0===h.mailingAddress?"":h.mailingAddress,d=void 0===h.mailingAddress2?"":h.mailingAddress2,c=void 0===h.Mailing_City?"":h.Mailing_City,u=void 0===h.Mail_State?"":h.Mail_State,l=void 0===h.Mailing_Zip?"":h.Mailing_Zip,p=void 0===h.MBL?"":h.MBL}const g=document.getElementById("selected-feature"),f=document.createElement("ul");f.classList.add("row"),f.classList.add("list-group");const b=document.createElement("li");let y;b.classList.add("abutters-group-item","col-12"),y=` ${r} ${s} <br> ${o} ${d} <br> ${c}, ${u} ${l}`,b.innerHTML+=y,b.setAttribute("data-id",n),$("#abutters-spinner").hide(),f.appendChild(b),g.appendChild(f)},lt=(e,t,a)=>{let i;W=[],document.getElementById("suggestions").innerHTML="",C&&(E=e.replace(/&amp;/g,"&"));let n=E;if(!(n?.length<3)||t||n||a){let e,r;$("#dropdown").toggleClass("expanded"),$("#details-btns").hide(),$("#abut-mail").hide(),$("#result-btns").hide(),$("#backButton").hide(),$("#detailsButton").hide(),$("#featureWid").empty(),$("#exportSearch").hide(),$("#csvExportResults").hide(),$("#exportButtons").hide(),e=`\n          Street_Name LIKE '%${n}%' OR \n          MBL LIKE '%${n}%' OR \n          Location LIKE '%${n}%' OR \n          Co_Owner LIKE '%${n}%' OR \n          Uniqueid LIKE '%${n}%' OR \n          Owner LIKE '%${n}%' OR \n          GIS_LINK LIKE '%${n}%'\n      `,t?r=t:H?(r=a,Y=!0):B?r=t:(r=Le.createQuery(),r.where=e,r.returnGeometry=!1,r.returnHiddenFields=!0,r.outFields=["*"]),Le.queryFeatures(r).then((e=>{if(e.features.length>0){let n;i=e.features,"MISMATCH"===e.features[0].attributes.Match_Status&&"Condominium"===e.features[0].attributes.Parcel_Type&&0==Y&&(G=!0),i.forEach((function(e){if(""!==e.attributes.Owner){let t=e.attributes.OBJECTID,a=e.attributes.Location,i=e.attributes.Uniqueid,n=e.attributes.GIS_LINK,r=e.attributes.Co_Owner,s=e.attributes.Owner,l=e.attributes.MBL,o=e.geometry,d=e.attributes.Mailing_Address_1,c=e.attributes.Mailing_Address_2,u=e.attributes.Mailing_City,p=e.attributes.Mail_State,m=e.attributes.Mailing_Zip,h=e.attributes.Total_Acres,g=e.attributes.Parcel_Primary_Use,f=e.attributes.Building_Use_Code,$=e.attributes.Parcel_Type,b=e.attributes.Design_Type,v=e.attributes.Zoning,w=e.attributes.Neighborhood,x=e.attributes.Land_Type_Rate,_=e.attributes.Functional_Obs,T=e.attributes.External_Obs,I=y(e.attributes.Sale_Date),L=e.attributes.Sale_Price,S=e.attributes.Vol_Page,M=e.attributes.Assessed_Total,B=e.attributes.Appraised_Total,E=e.attributes.Influence_Factor,C=e.attributes.Influence_Type,P=e.attributes.Land_Type,D=e.attributes.Prior_Assessment_Year,A=e.attributes.Prior_Assessed_Total,k=e.attributes.Prior_Appraised_Total,F=e.attributes.Map,N=e.attributes.Lat,O=e.attributes.Lon,R=e.attributes.Image_Path,U=e.attributes.AcctNum,q=e.attributes.Match_Status;W.push(new Ze(t,a,i,n,r,s,l,o,d,c,u,p,m,h,g,f,$,b,v,w,x,_,T,I,L,S,M,B,E,C,P,D,A,k,F,N,O,R,U,q))}})),"no"===sessionStorage.getItem("condos")?(n=Te.createQuery(),n.where=r.where,n.returnDistinctValues=!1,n.returnGeometry=!0,n.outFields=["*"]):(n=Ie.createQuery(),n.where=r.where,n.returnDistinctValues=!1,n.returnGeometry=!0,n.outFields=["*"]);let s=null;H?n.where=a.where:B&&(n.where=t.where,s=!0),function(e,t,a){"no"===sessionStorage.getItem("condos")?Te.visible=!0:Ie.visible=!0,$(".spinner-container").show();const i=!0;let n,r,s,l;n=`\n          Street_Name LIKE '%${e}%' OR \n          MBL LIKE '%${e}%' OR \n          Location LIKE '%${e}%' OR \n          Co_Owner LIKE '%${e}%' OR \n          Uniqueid LIKE '%${e}%' OR \n          Owner LIKE '%${e}%' OR \n          GIS_LINK LIKE '%${e}%'\n      `,a?r=a:(H||B)&&(r=a,i=!0),"no"===sessionStorage.getItem("condos")?Te.queryFeatures(r).then((function(i){if(l=i.features,i.features.length>=0)if(l=i.features,R=i.features,G){let a="",i="";const n=Se.createQuery();n.where=r.where,n.returnGeometry=!1,n.outFields=["*"],Se.queryFeatures(n).then((function(e){a=e.features;const t=e.features[0].attributes.GIS_LINK;let i=Te.createQuery();return i.where=`GIS_LINK = '${t}'`,i.returnGeometry=!0,i.returnHiddenFields=!0,i.outFields=["*"],Te.queryFeatures(i)})).then((function(n){l=n.features,i=n.features,R=n.features,je(n,L.graphics,""),Ke(n.features),t&&ot(a,i,e)})).catch((function(e){console.error("Error querying features: ",e)}))}else R=i.features,je(i,L.graphics,""),Ke(i.features),t&&ot(l,e),G=!1;else if(1===i.features.length&&W.length>2){const a=Se.createQuery();a.where=n,a.returnGeometry=!1,a.outFields=["*"],Se.queryFeatures(a).then((function(a){je(a.features),Ke(),t&&ot(l,e)}))}else{const e=Se.createQuery();e.where=a.where,e.returnGeometry=!1,e.outFields=["*"],0==i.features.length&&Se.queryFeatures(e).then((function(e){l=e.features,s=e.features[0].attributes.GIS_LINK;let a=e.features[0].attributes.Uniqueid;R=e.features,je(e,L.graphics),Ke(e.features),t&&(j=!0,ot(l,a))}))}})):Ie.queryFeatures(r).then((function(e){l=e.features;const a=e.features[0].attributes.Uniqueid;e.features&&(je(e,L.graphics,""),Ke(e.features),t&&ot(l,a))})),V&&(V?.remove(),V=null),q&&(q?.remove(),q=null),H?($("#select-button").addClass("btn-warning"),V=L.on("click",Je)):(q=L.on("click",Qe),$("#select-button").removeClass("btn-warning")),Y=!1,X=!1}(E,s,n)}})).catch((e=>{console.error("Error querying for details:",e)}))}else Ve()};function ot(e,t,a){let i=e,n=t;changeAbuttersZoom=!0,i.length<=0&&(Ve(),alert("Search resulted in an error, please try again."));let r=i[0].attributes.Uniqueid,s=i[0].attributes.OBJECTID,l=n[0].attributes.OBJECTID;$("#details-spinner").show(),$("#WelcomeBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportButtons").hide(),$("#exportSearch").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$(".center-container").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),document.getElementById("total-results").style.display="none",it(s,r),rt(l,0,r),$("#total-results").hide(),$("#ResultDiv").hide(),K=!0,G=!1,B=!1,urlSearch=!1}const dt=function(){const e={},t=window.location.search.substring(1).split("&");for(let a=0;a<t.length;a++){const i=t[a].split("=");i[0]&&i[1]&&(e[decodeURIComponent(i[0])]=decodeURIComponent(i[1].replace(/\+/g," ")))}return e}().uniqueid;let ct,ut=`Uniqueid = '${dt}'`;if(dt){B=!0;L.when((function(){query=Le.createQuery(),query.where=ut,query.returnGeometry=!1,query.returnHiddenFields=!0,query.outFields=["*"],query=Le.createQuery(),query.where=ut,query.returnGeometry=!1,query.returnHiddenFields=!0,query.outFields=["*"],Se.queryFeatures(query).then((e=>{let t=e.features[0].attributes,a=(t.Uniqueid,t.Building_Type);"MISMATCH"===t.Match_Status&&"Condominium"===a&&(G=!0),lt(null,query)}))})).catch((function(e){console.error("Error occurred while the view was loading: ",e)}))}document.getElementById("searchInput").addEventListener("input",(function(e){W=[],$("#sidebar2").css("left","-350px"),$("#sidebar2").removeClass("collapsed"),$("#results-div").css("left","0px"),$("#dropdown").toggleClass("expanded"),$("#dropdown").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide();var t=e.target.value.toUpperCase();W=[],secondList=[],O=[],$("#select-button").removeClass("btn-warning"),$("#searchInput ul").remove(),$("#suggestions").hide(),$("#featureWid").empty(),$("#featureWid").hide(),$("#ResultDiv").hide(),$("#dropdown").removeClass("expanded"),$("#dropdown").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#right-arrow-2").show(),$("#left-arrow-2").hide(),$("#abutters-content").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#backButton").hide(),$("#detailBox").hide(),$("#exportSearch").hide(),$("#csvExportSearch").hide(),$("#csvExportResults").hide(),$("#exportButtons").hide(),q&&(q?.remove(),q=null),V&&(V?.remove(),V=null),$("#dropdown").show(),$("#WelcomeBox").show(),$(".center-container").show(),document.getElementById("suggestions").innerHTML="",$("#featureWid").empty(),L.graphics.removeAll();let a=`\n            Street_Name LIKE '%${t}%' OR \n            MBL LIKE '%${t}%' OR \n            Location LIKE '%${t}%' OR \n            Co_Owner LIKE '%${t}%' OR \n            Uniqueid LIKE '%${t}%' OR \n            Owner LIKE '%${t}%' OR\n            GIS_LINK LIKE '%${t}%'\n        `,i=Se.createQuery();i.where=a,i.returnGeometry=!1,i.outFields=["Street_Name","MBL","Location","Co_Owner","Uniqueid","Owner","GIS_LINK"];let n=new Set;Se.queryFeatures(i).then((e=>{let a=document.getElementById("suggestions");a.innerHTML="",e.features.forEach((e=>{["Street_Name","MBL","Location","Co_Owner","Uniqueid","Owner","GIS_LINK"].forEach((i=>{let r=e.attributes[i];if(r&&r.includes(t)&&!n.has(r)){let e=document.createElement("div");e.className="list-group-item",e.innerText=`${r}`,a.appendChild(e),n.add(r),a.style.display="block",e.addEventListener("click",(function(e){C=!0,lt(e.target.innerHTML),C=!1}))}}))}))}))})),document.querySelector(".form-inline").addEventListener("submit",(function(e){"no"===sessionStorage.getItem("condos")?Te.visible=!0:Ie.visible=!0,W=[],L.graphics.removeAll(),O=[],e.preventDefault(),$("#featureWid").empty(),$("#selected-feature").empty(),q&&(q?.remove(),q=null),V&&(V?.remove(),V=null)})),document.addEventListener("click",(function(e){"searchInput"!==e.target.id&&(document.getElementById("suggestions").style.display="none")})),document.getElementById("searchButton").addEventListener("click",(function(){$("#sidebar2").css("left","-350px"),$("#sidebar2").removeClass("collapsed"),$("#results-div").css("left","0px"),$("#exportResults").hide(),$("#csvExportResults").hide(),clearTimeout(ct),ct=setTimeout((()=>{"no"===sessionStorage.getItem("condos")?Te.visible=!0:Ie.visible=!0,$("#lasso").removeClass("btn-warning"),$("#select-button").removeClass("btn-warning"),$("dropdown").empty(),$("#featureWid").empty(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#total-results").show(),$("#ResultDiv").hide(),$("#backButton").hide(),$("#detailsButton").hide(),$("#detailBox").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#abutters-title").html("Abutting Parcels (0)"),O=[],L.graphics.removeAll(),q&&(q?.remove(),q=null),V&&(V?.remove(),V=null),lt()}),300)})),$(document).ready((function(){me={streetName:null,owner:null,appraisedValueMin:null,appraisedValueMax:null,assessedValueMin:null,assessedValueMax:null,zoningType:null,neighborhoodType:null,propertyType:null,buildingType:null,buildingUseType:null,designType:null,acresValueMin:null,acresValueMax:null,soldOnMin:null,soldOnMax:null,soldPMin:null,soldPMax:null},$("#streetFilter").on("calciteComboboxChange",(function(e){let t;if(me.streetName=e.target.value,""!==me.streetName&&void 0!==me.streetName&&null!==me.streetName)Ne("Street_Name",e.target.value),Re("Street_Name",e.target.value);else{clearTimeout(t),t=setTimeout((()=>{a()}),600)}})),$("#ownerFilter").on("calciteComboboxChange",(function(e){if(me.owner=e.target.value,""!==me.owner&&void 0!==me.owner&&null!==me.owner)Ne("Owner",e.target.value),Re("Owner",e.target.value);else{let e;clearTimeout(e),e=setTimeout((()=>{a()}),600)}})),$("#app-val-min, #app-val-max").on("input",(function(){var e=$("#app-val-min").val(),t=$("#app-val-max").val();e=e.replace(/^\$/,"").replace(/,/g,""),t=t.replace(/^\$/,"").replace(/,/g,"");var a=parseInt(e,10),i=parseInt(t,10);if(!isNaN(a)&&!isNaN(i)){var n=a.toLocaleString(),r=i.toLocaleString();$("#app-val-min").val("$"+n),$("#app-val-max").val("$"+r),me.appraisedValueMin=a,me.appraisedValueMax=i}!isNaN(a)&&!isNaN(i)&&a<=i&&e.length>=6&&t.length>=6&&(me.appraisedValueMin=a,me.appraisedValueMax=i,Ne("Appraised_Total",a,i),Re("Appraised_Total",a,i))})),$("#assess-val-min, #assess-val-max").on("input",(function(){var e=$("#assess-val-min").val(),t=$("#assess-val-max").val();e=e.replace(/^\$/,"").replace(/,/g,""),t=t.replace(/^\$/,"").replace(/,/g,"");var a=parseInt(e,10),i=parseInt(t,10);if(!isNaN(a)&&!isNaN(i)){var n=a.toLocaleString(),r=i.toLocaleString();$("#assess-val-min").val("$"+n),$("#assess-val-max").val("$"+r),me.assessedValueMin=a,me.assessedValueMax=i}!isNaN(a)&&!isNaN(i)&&a<=i&&e.length>=6&&t.length>=6?(me.assessedValueMin=a,me.assessedValueMax=i,Ne("Assessed_Total",a,i),Re("Assessed_Total",a,i)):console.log("Invalid input values: ",a,i)})),$("#propertyFilter").on("calciteComboboxChange",(function(e){if(me.propertyType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Ne("Parcel_Type",e.target.value),Re("Parcel_Type",e.target.value);else{!function(){let e;clearTimeout(e),e=setTimeout((()=>{a()}),600)}()}})),$("#zoningFilter").on("calciteComboboxChange",(function(e){if(me.zoningType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Ne("Zoning",e.target.value),Re("Zoning",e.target.value);else{let e;clearTimeout(e),e=setTimeout((()=>{a()}),600)}})),$("#neighborhoodFilter").on("calciteComboboxChange",(function(e){if(me.neighborhoodType=e.target.value,""!==e.target.value||void 0!==e.target.value||null!==e.target.value)Ne("Neighborhood",e.target.value),Re("Neighborhood",e.target.value);else{let e;clearTimeout(e),e=setTimeout((()=>{a()}),600)}})),$("#buildingFilter").on("calciteComboboxChange",(function(e){if(me.buildingType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Ne("Building_Type",e.target.value),Re("Building_Type",e.target.value);else{let e;clearTimeout(e),e=setTimeout((()=>{a()}),600)}})),$("#buildingUseFilter").on("calciteComboboxChange",(function(e){if(me.buildingUseType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Ne("Building_Use_Code",e.target.value),Re("Building_Use_Code",e.target.value);else{let e;clearTimeout(e),e=setTimeout((()=>{a()}),600)}})),$("#designTypeFilter").on("calciteComboboxChange",(function(e){if(me.designType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Ne("Design_Type",e.target.value),Re("Design_Type",e.target.value);else{let e;clearTimeout(e),e=setTimeout((()=>{a()}),600)}})),$("#acres-val-min, #acres-val-max").on("input",(function(){var e=parseFloat($("#acres-val-min").val()),t=parseFloat($("#acres-val-max").val()),a=$("#acres-val-min").val().trim(),i=$("#acres-val-max").val().trim();!isNaN(e)&&!isNaN(t)&&e<=t&&a.length>=0&&i.length>=0?(me.acresValueMin=e,me.acresValueMax=t,Ne("Total_Acres",e,t),Re("Total_Acres",e,t)):console.log("Invalid input values: ",e,t)})),$("#sold_calendar_lowest").on("calciteDatePickerChange",(function(){var e=$("#sold_calendar_lowest").val(),t=$("#sold_calendar_highest").val();me.soldOnMin=e,me.soldOnMax=t,Ne("Sale_Date",e,t),Re("Sale_Date",e,t)})),$("#sold_calendar_highest").on("calciteDatePickerChange",(function(){var e=new Date($("#sold_calendar_lowest").val()),t=new Date($("#sold_calendar_highest").val());e.setDate(e.getDate()+1),t.setDate(t.getDate()+1);var a=e.toISOString().split("T")[0],i=t.toISOString().split("T")[0];me.soldOnMin=a,me.soldOnMax=i,Ne("Sale_Date",a,i),Re("Sale_Date",a,i)}));let e,t=null;function a(){const e=["#designTypeFilter","#buildingUseFilter","#buildingFilter","#neighborhoodFilter","#zoningFilter","#propertyFilter","#ownerFilter","#streetFilter"].map((e=>$(e).val())).every((function(e){return 0===e.length}));return t!==e&&(e&&n(),t=e),e}async function i(){let e=[],t=["Appraised_Total","Assessed_Total","Total_Acres","Sale_Date","Sale_Price"];for(let a of t){let t=Le.createQuery();t.outStatistics=[{statisticType:"max",onStatisticField:a,outStatisticFieldName:"maxValue"},{statisticType:"min",onStatisticField:a,outStatisticFieldName:"minValue"}];try{let i,n=await Le.queryFeatures(t);if("Sale_Date"===a){let e=new Date(n.features[0].attributes.maxValue),t=new Date(n.features[0].attributes.minValue);i={[a]:{min:t,max:e}}}else{let e=n.features[0].attributes.maxValue,t=n.features[0].attributes.minValue;i={[a]:{min:t,max:e}}}e.push(i)}catch(e){console.error("Error querying features:",e)}}var a;a=e,[{fieldName:"Appraised_Total",minInput:"#app-val-min",maxInput:"#app-val-max",index:0},{fieldName:"Assessed_Total",minInput:"#assess-val-min",maxInput:"#assess-val-max",index:1},{fieldName:"Total_Acres",minInput:"#acres-val-min",maxInput:"#acres-val-max",index:2},{fieldName:"Sale_Date",minInput:"#sold_calendar_lowest",maxInput:"#sold_calendar_highest",index:3},{fieldName:"Sale_Price",minInput:"#saleP-val-min",maxInput:"#saleP-val-max",index:4}].forEach((function(e){if("Sale_Date"==e.fieldName){const n=$(e.minInput),r=$(e.maxInput);Ce(e.minInput),Ce(e.maxInput),n.empty(),r.empty();var t=a[e.index][e.fieldName].min,i=a[e.index][e.fieldName].max;let s=new Date(t),l=new Date(i),o=`${s.getFullYear()}-${("0"+(s.getMonth()+1)).slice(-2)}-${("0"+s.getDate()).slice(-2)}`,d=`${l.getFullYear()}-${("0"+(l.getMonth()+1)).slice(-2)}-${("0"+l.getDate()).slice(-2)}`;n.val(o),r.val(d),Pe(e.minInput,o),Pe(e.maxInput,d)}else{Ce(e.minInput),Ce(e.maxInput);const t=$(e.minInput),i=$(e.maxInput),n=t.value=a[e.index][e.fieldName].min,r=i.value=a[e.index][e.fieldName].max;let s,l;"Total_Acres"!==e.fieldName?(s="$"+n.toLocaleString(),l="$"+r.toLocaleString()):(s=n.toLocaleString(),l=r.toLocaleString()),t.val(s),i.val(l),Pe(e.minInput,s),Pe(e.maxInput,l)}}))}function n(){clearTimeout(e),e=setTimeout((()=>{!function(){pe=!0,t=null,$("#lasso").removeClass("btn-warning"),$("#searchInput ul").remove(),$("#searchInput").val="",document.getElementById("searchInput").value="",E="",searchTerm="",W=[],secondList=[],ge=[{layer:Ie,field:"Appraised_Total",filterSelector:"#app-val-min",filterSelector2:"#app-val-max"},{layer:Ie,field:"Assessed_Total",filterSelector:"#assess-val-min",filterSelector2:"#assess-val-max"},{layer:Ie,field:"Total_Acres",filterSelector:"#acres-val-min",filterSelector2:"#acres-val-max"},{layer:Ie,field:"Sale_Date",filterSelector:"#sold_calendar_lowest",filterSelector2:"#sold_calendar_highest"},{layer:Ie,field:"Sale_Price",filterSelector:"#saleP-val-min",filterSelector2:"#saleP-val-max"}],he=[{layer:Ie,field:"Street_Name",filterSelector:"#streetFilter",alias:"Street_Name",message:"Select a Street Name"},{layer:Ie,field:"Owner",filterSelector:"#ownerFilter",message:"Select a Owner"},{layer:Ie,field:"Parcel_Type",filterSelector:"#propertyFilter",alias:"Parcel_Type",message:"Select a Property Type"},{layer:Ie,field:"Building_Type",filterSelector:"#buildingFilter",message:"Select a Building Type"},{layer:Ie,field:"Building_Use_Code",filterSelector:"#buildingUseFilter",message:"Select a Building Use Type"},{layer:Ie,field:"Design_Type",filterSelector:"#designTypeFilter",message:"Select a Design Type"},{layer:Ie,field:"Zoning",filterSelector:"#zoningFilter",message:"Select a Zone"},{layer:Ie,field:"Neighborhood",filterSelector:"#neighborhoodFilter",message:"Select a Neighborhood"}],fe=[{layer:Ie,field:"Appraised_Total",filterSelector:"#streetFilter",minInput:"app-val-min",maxInput:"app-val-max",minValField:"appraisedValueMin",maxValueField:"appraisedValueMax",index:0},{layer:Ie,field:"Assessed_Total",filterSelector:"#ownerFilter",minInput:"assess-val-min",maxInput:"assess-val-max",minValField:"assessedValueMin",maxValueField:"assessedValueMax",index:1},{layer:Ie,field:"Total_Acres",filterSelector:"#propertyFilter",minInput:"acres-val-min",maxInput:"acres-val-max",minValField:"acresValueMin",maxValueField:"acresValueMax",index:2},{layer:Ie,field:"Sale_Date",filterSelector:"#buildingFilter",minInput:"sold_calendar_lowest",maxInput:"sold_calendar_highest",minValField:"soldOnMin",maxValueField:"soldOnMax",index:3},{layer:Ie,field:"Sale_Price",filterSelector:"#buildingUseFilter",minInput:"saleP-val-min",maxInput:"saleP-val-max",minValField:"soldPMin",maxValueField:"soldPMax",index:4}],$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#dropdown").hide(),$("#right-arrow-2").show(),$("#left-arrow-2").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#backButton").show(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportSearch").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#featureWid").hide(),$("#exportButtons").hide(),$("#dropdown").show(),$("#WelcomeBox").hide(),$("#select-button").attr("title","Add to Selection Enabled"),document.getElementById("suggestions").innerHTML="",$("#distanceButton").removeClass("btn-warning"),$("#distanceButton").addClass("bg-info"),$("#areaButton").removeClass("btn-warning"),$("#distanceButton").addClass("bg-info"),$("#featureWid").empty(),L.ui.remove(we),we&&(we.destroy(),we=null),L.graphics.removeAll(),O=[],Object.keys(me).forEach((e=>{me[e]=null}));const e=$("#streetFilter"),a=$("#ownerFilter"),n=$("#propertyFilter"),r=$("#buildingFilter"),s=$("#buildingUseFilter"),l=$("#designTypeFilter"),o=$("#zoningFilter"),d=$("#neighborhoodFilter"),c=$("#sold_calendar_lowest"),u=$("#sold_calendar_highest");e.empty(),a.empty(),n.empty(),r.empty(),s.empty(),l.empty(),o.empty(),d.empty(),c.value="",u.value="",c.activeDate=null,u.activeDate=null,Ue(0,"Street_Name","#streetFilter","Select a Street Name"),Ue(0,"Owner","#ownerFilter","Select a Owner"),Ue(0,"Parcel_Type","#propertyFilter","Select a Property Type"),Ue(0,"Building_Type","#buildingFilter","Select a Building Type"),Ue(0,"Building_Use_Code","#buildingUseFilter","Select a Building Use"),Ue(0,"Design_Type","#designTypeFilter","Select a Design Type"),Ue(0,"Zoning","#zoningFilter","Select a Zone"),Ue(0,"Neighborhood","#neighborhoodFilter","Select a Neighborhood"),i(),$(".wrapper .x-button").click(),$("#streetFilter").value=""}()}),600)}document.addEventListener("DOMContentLoaded",(()=>{t=a()})),$("#saleP-val-min, #saleP-val-max").on("input",(function(){var e=$("#saleP-val-min").val(),t=$("#saleP-val-max").val();e=e.replace(/^\$/,"").replace(/,/g,""),t=t.replace(/^\$/,"").replace(/,/g,"");var a=parseInt(e,10),i=parseInt(t,10);if(isNaN(a)||isNaN(i))console.log("Invalid input");else{var n=a.toLocaleString(),r=i.toLocaleString();$("#saleP-val-min").val("$"+n),$("#saleP-val-max").val("$"+r),me.soldPMin=a,me.soldPMax=i,Ne("Sale_Price",a,i),Re("Sale_Price",a,i)}})),i(),$("#submitFilter").on("click",(function(){!function(){let e=[];if(null!==me.streetName&&me.streetName.length>1)if(Array.isArray(me.streetName)){const t=me.streetName.map((e=>`Street_Name LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Street_Name LIKE '%${me.streetName.trim()}%')`);if(null!==me.owner&&me.owner.length>1)if(Array.isArray(me.owner)){const t=me.owner.map((e=>`Owner LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Owner LIKE '%${me.owner.trim()}%')`);if(null!==me.appraisedValueMin&&null!==me.appraisedValueMax&&e.push(`Appraised_Total BETWEEN ${me.appraisedValueMin} AND ${me.appraisedValueMax}`),null!==me.assessedValueMin&&null!==me.assessedValueMax&&e.push(`Assessed_Total BETWEEN ${me.assessedValueMin} AND ${me.assessedValueMax}`),null!==me.propertyType&&me.propertyType.length>1)if(Array.isArray(me.propertyType)){const t=me.propertyType.map((e=>`Parcel_Type LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Parcel_Type LIKE '%${me.propertyType.trim()}%')`);if(null!==me.zoningType&&me.zoningType.length>1)if(Array.isArray(me.zoningType)){const t=me.zoningType.map((e=>`Zoning LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Zoning LIKE '%${me.zoningType.trim()}%')`);if(null!==me.neighborhoodType&&me.neighborhoodType.length>1)if(Array.isArray(me.neighborhoodType)){const t=me.neighborhoodType.map((e=>`Neighborhood LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Neighborhood LIKE '%${me.neighborhoodType.trim()}%')`);if(null!==me.buildingType&&me.buildingType.length>1)if(Array.isArray(me.buildingType)){const t=me.buildingType.map((e=>`Building_Type LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Building_Type LIKE '%${me.buildingType.trim()}%')`);if(null!==me.buildingUseType&&me.buildingUseType.length>1)if(Array.isArray(me.buildingUseType)){const t=me.buildingUseType.map((e=>`Building_Use_Type LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Building_Use_Type LIKE '%${me.buildingUseType.trim()}%')`);if(null!==me.designType&&me.designType.length>1)if(Array.isArray(me.designType)){const t=me.designType.map((e=>`Design_Type LIKE '%${e.trim()}%'`));e.push(`(${t.join(" OR ")})`)}else e.push(`(Design_Type LIKE '%${me.designType.trim()}%')`);null!==me.acresValueMin&&null!==me.acresValueMax&&e.push(`Total_Acres BETWEEN ${me.acresValueMin} AND ${me.acresValueMax}`),null!==me.soldOnMin&&null!==me.soldOnMax&&e.push(`Sale_Date >= '${me.soldOnMin}' AND Sale_Date <= '${me.soldOnMax}'`),null!==me.soldPMin&&null!==me.soldPMax&&e.push(`Sale_Price BETWEEN ${me.soldPMin} AND ${me.soldPMax}`);let t=e.join(" AND ");if("no"===sessionStorage.getItem("condos")){let e=Se.createQuery();e.where=t,e.returnDistinctValues=!1,e.returnGeometry=!0,e.outFields=["*"],Ve(),lt(null,e)}else{let e=Se.createQuery();e.where=t,e.returnDistinctValues=!1,e.returnGeometry=!0,e.outFields=["*"],Ve(),lt(null,e)}}()})),$("#clearFilter").on("click",(function(){n()}))})),$(document).ready((function(){$("#side-Exp").on("click",(function(){$("#sidebar").toggleClass("collapsed"),$("#sidebar").hasClass("collapsed")?($("#small-div").css("right","0px"),$("#right-arrow").hide(),$("#left-arrow").show()):($("#small-div").css("right","250px"),$("#left-arrow").hide(),$("#right-arrow").show())}))})),$(document).ready((function(){$("#Basemap-selector").on("click",(function(){$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#AddDataDiv").hide(),$("#ContactDiv").hide(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#Right-Btn-div").show(),$("#BasemapDiv").show(),$("#group-container-right").show()})),$("#Bookmarks-selector").on("click",(function(){$("#rightPanel").hide(),$("#BasemapDiv").hide(),$("#AddDataDiv").hide(),$("#ContactDiv").hide(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#Right-Btn-div").show(),$("#BookmarksDiv").show(),$("#group-container-right").show()})),$("#Contact-selector").on("click",(function(){$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#AddDataDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#PrintDiv").hide(),$("#Right-Btn-div").show(),$("#ContactDiv").show(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#group-container-right").show()})),$("#addData-selector").on("click",(function(){$(document).keypress((function(e){"Enter"===e.key&&e.preventDefault()})),$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#PrintDiv").hide(),$("#ContactDiv").hide(),$("#Right-Btn-div").show(),$("#AddDataDiv").show(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#group-container-right").show()})),$("#Legend-selector").on("click",(function(){$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#PrintDiv").hide(),$("#ContactDiv").hide(),$("#Right-Btn-div").show(),$("#AddDataDiv").hide(),$("#PrintDiv").hide(),$("#LegendDiv").show(),$("#group-container-right").show()})),$("#right-btn-back").on("click",(function(){$("#group-container-right").hide(),$("#PrintDiv").hide(),$("#AddDataDiv").hide(),$("#BookmarksDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#ContactDiv").hide(),$("#LegendDiv").hide(),$("#rightPanel").show()}))}));var pt={240:"1 inch = 20 feet",600:"1 inch = 50 feet",1200:"1 inch = 100 feet",1800:"1 inch = 150 feet",2400:"1 inch = 200 feet",3600:"1 inch = 300 feet",4800:"1 inch = 400 feet",9600:"1 inch = 800 feet",12e3:"1 inch = 1000 feet",18e3:"1 inch = 1500 feet",24e3:"1 inch = 2000 feet",36e3:"1 inch = 3000 feet",72e3:"1 inch = 6000 feet",144e3:"1 inch = 12000 feet",18e4:"1 inch = 15000 feet"},mt=document.getElementById("scale-dropdown");document.querySelectorAll(".scale-select").forEach((function(e){e.addEventListener("click",(function(e){var t=parseInt(e.target.value),a=e.target.innerHTML;t&&(L.scale=t),$("#scale-value").val(t).html(a)}))})),L.ui.add(mt);r.watch((()=>[L.stationary,L.scale]),(([e,t])=>{e&&function(e){var t=Math.round(e),a=function(e){var t=Object.keys(pt).reduce((function(t,a){return Math.abs(a-e)<Math.abs(t-e)?a:t}));return pt[t]}(t);a&&$("#scale-value").val(t).html(a)}(t)}));function qe(){var e=document.querySelector(".esri-widget--button.esri-print__refresh-button.esri-icon-refresh");e&&e.click()}$(document).ready((function(){$("#popoverButton").popover({trigger:"hover"})})),$(document).ready((function(){$("#lasso").popover({trigger:"hover"})})),$(document).ready((function(){$("#select-button").popover({trigger:"hover"})})),$(document).ready((function(){$("#clear-btn1").popover({trigger:"hover"})})),$(document).ready((function(){$("#filterButton").popover({trigger:"hover"})})),$(document).ready((function(){$("#layerListBtn").popover({trigger:"hover"})})),$(document).ready((function(){$("#abutters-attributes").popover({trigger:"hover"})})),$(document).ready((function(){$("#abutters-zoom").popover({trigger:"hover"})})),$(document).ready((function(){$("#distanceButton").popover({trigger:"hover"})})),$(document).ready((function(){$("#areaButton").popover({trigger:"hover"})})),L.watch("zoom",(function(e,t){e!==t&&qe()})),L.watch("center",(function(e,t){e!==t&&qe()})),$(document).ready((function(){$("#side-Exp2").on("click",(function(){$("#sidebar2").hasClass("collapsed")?($("#results-div").css("left","0px"),$("#sidebar2").css("left","-350px"),$("#right-arrow-2").show(),$("#left-arrow-2").hide()):($("#results-div").css("left","350px"),$("#sidebar2").css("left","0px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide()),$("#sidebar2").toggleClass("collapsed")}))}))}))}));
// @ts-nocheck
require(["esri/WebMap","esri/views/MapView","esri/geometry/projection","esri/geometry/SpatialReference","esri/layers/FeatureLayer","esri/layers/ImageryLayer","esri/layers/MapImageLayer","esri/core/reactiveUtils","esri/Graphic","esri/geometry/geometryEngine","esri/layers/GraphicsLayer","esri/widgets/Sketch/SketchViewModel","esri/widgets/DistanceMeasurement2D","esri/widgets/AreaMeasurement2D","esri/widgets/BasemapLayerList","esri/widgets/Bookmarks","esri/widgets/Legend","esri/widgets/Print","esri/layers/support/TileInfo","esri/geometry/Extent","esri/rest/support/PrintTemplate","esri/rest/support/PrintParameters","esri/widgets/Print/PrintViewModel","esri/widgets/Print/TemplateOptions","esri/geometry/geometryEngineAsync"],function(e,t,n,a,i,r,s,o,l,d,c,u,p,m,h,g,f,y,b,v,w,x,_,T,I){const L=new URLSearchParams(window.location.search);let S=window.location.href,M=L.get("viewer");let B=["canaanct","colebrookct","colebrookctassessor","columbiact","cornwallct","durhamct","franklinct","haddamct","northcanaanct","roxburyct","roxburyctassessor","salisburyct","scotlandct","warrenct","warrenctassessor","washingtonct","wiltonct","wolcottct","woodbridgect"].join("|"),E=new RegExp(`\\?viewer=cama\\/(${B})(\\&\\w+=[\\w-]+)*$`);null!=M&&E.test(S)?(M+=".json",$("#whole-app").show()):"https://terrenogis.com"===window.location.href||"https://terrenogis.com/"===window.location.href||"http://terrenogis.com/desktop/"===window.location.href||"http://terrenogis.com/desktop/home.html"===window.location.href?window.location.href="https://www.qds.biz/gis-service":window.location.href="./onload.html";const C={mapId:"",condoLayer:"",title:"",isCondosLayer:"",noCondoLayer:""};fetch(M).then(e=>e.json()).then(d=>{d.layers;if(C.mapId=d.webmapId||"6448b08504de4244973a28305b18271f",C.condoLayer=d.condoLayer,C.noCondoLayer=d.noCondoLayer,C.title=d.title,C.isCondosLayer=d.condos,C.masterTable=d.masterTable,C.parcelZoom=d.parcelZoom,C.imageUrl=d.imageUrl,C.welcomeImage=d.welcomeImage,C.pdf_Image=d.pdf_Image,C.pdf_demo=d.pdf_demographics,C.taxMap_Url=d.taxMapUrl,C.parcelMapUrl=d.parcelMapUrl,C.housingUrl=d.housingUrl,C.propertyCardPdf=d.propertyCardPdf,C.propertyCard=d.propertyCard,C.tax_bill=d.tax_bill,C.useVisionForTaxBillUrl=d.useVisionForTaxBillUrl,C.accessorName=d.accessorName,C.parcelTitle=d.parcelServiceTitle,C.tabTitle=d.tabTitle,C.basemapTitle=d.basemapTitle,C.parcelRenderer=d.parcelRenderer,C.useUniqueIdforParcelMap=d.useUniqueIdforParcelMap,C.helpUrl=d.helpUrl,C.includeFilter=d.includeFilter,C.customWelcomePage=d.customWelcomePage,C.customWelcomeMessage=d.customWelcomeMessage,C.showDisclaimer=d.showDisclaimer,C.customDisclaimerPage=d.customDisclaimerPage,C.customDisclaimerMessage=d.customDisclaimerMessage,C.DetailLinks=d.DetailLinks,C.DetailLinksToInclude=d.DetailLinksToInclude,C.includePermitLink=d.includePermitLink,C.scale=d.scale,C.customLegend=d.customLegend,C.legendImages=d.legendImages,"no"===C.showDisclaimer&&(sessionStorage.setItem("agreedToDisclaimer","yes"),$("#starterModal").modal("hide")),"yes"===C.customWelcomePage&&(document.getElementById("welcomeMessage").innerHTML=C.customWelcomeMessage),"yes"===C.customDisclaimerPage&&(document.getElementById("disclaimer-text").innerHTML=C.customDisclaimerMessage),"yes"===C.includePermitLink&&(C.permitLink=d.permitLink),"yes"===C.customLegend){const e=C.legendImages;$("#legendHeader").show();const t=$("#legendPopup"),n=$("#legendTitle"),a=$("#legendImagesContainer");t.draggable({handle:".popup-header",containment:"window"}),$("#openLegend").on("click",function(i){i.preventDefault(),n.text("Basemap Legend"),a.empty(),e.forEach(e=>{$("<img>").attr("src",e).addClass("legend-img").appendTo(a)}),t.fadeIn(200)}),$("#closeLegend").on("click",function(){t.fadeOut(200)})}function b(e){var t=new Date(e),n=t.getDate();return t.getMonth()+1+"/"+n+"/"+t.getFullYear()}document.getElementById("AccessorName").innerHTML=d.accessorName,$(".help-url").attr("href",C.helpUrl),document.getElementById("title").innerHTML=C.title,document.getElementById("print-title").innerHTML=C.title,document.getElementById("imageContainer").src=C.welcomeImage,document.getElementById("print-image").src=C.welcomeImage,document.getElementById("tab-title").innerHTML=C.tabTitle;const v="No geometry";sessionStorage.setItem("condos",C.isCondosLayer);const w=new c,x=new c,_=new e({portalItem:{id:C.mapId},layers:[w]});var L=new t({container:"viewDiv",map:_,units:"imperial",scale:C.scale,popupEnabled:!1,ui:{components:["attribution"]}});L.when(()=>{C.homeExtent=L.extent}),"no"===C.includeFilter&&$("#filterButton").remove(),L.when(()=>{"yes"==sessionStorage.getItem("agreedToDisclaimer")||1==M?$("#starterModal").modal("hide"):$("#starterModal").modal("show"),$(document).ready(function(){$("#agreeBtn").prop("disabled",!0),$("#agreeCheck").change(function(){$(this).is(":checked")?($("#agreeBtn").prop("disabled",!1),sessionStorage.setItem("agreedToDisclaimer","yes")):$("#agreeBtn").prop("disabled",!0)})})}),L.when(()=>{document.getElementById("urlButton").addEventListener("click",function(e){let t=urlInput.value;t.length>0&&function(){let e=new i({url:`${t}`});e.load().then(()=>{_.add(e),$("#urlMessage").html('<strong><p style="color:green;">Successfully uploaded REST Service.</p></strong>'),_.layers.on("change",function(e){console.log(e," layer was added/removed from the map.")});var t=$("#layerList");_e(e,t),urlInput.value=""}).catch(e=>{$("#urlMessage").html('<strong><p style="color:red;">Error uploading REST Service.</p></strong>'),console.error("Error loading the FeatureLayer:",e)})}()})}),L.when(()=>{document.getElementById("urlButtonImagery").addEventListener("click",function(e){let t=urlInputImagery.value;t.length>0&&function(){let e=new r({url:`${t}`});e.load().then(()=>{_.add(e),$("#urlMessageImagery").html('<strong><p style="color:green;">Successfully uploaded REST Service.</p></strong>'),_.layers.on("change",function(e){console.log(e," layer was added/removed from the map.")});var t=$("#layerList");_e(e,t),urlInput.value=""}).catch(e=>{$("#urlMessageImagery").html('<strong><p style="color:red;">Error uploading REST Service.</p></strong>'),console.error("Error loading the FeatureLayer:",e)})}()})}),L.when(()=>{document.getElementById("urlButtonMapService").addEventListener("click",function(e){let t=urlInputMapService.value;t.length>0&&function(){let e=new s({url:`${t}`});e.load().then(()=>{_.add(e),$("#urlMessageMapService").html('<strong><p style="color:green;">Successfully uploaded REST Service.</p></strong>'),_.layers.on("change",function(e){console.log(e," layer was added/removed from the map.")});var t=$("#layerList");_e(e,t),urlInput.value=""}).catch(e=>{$("#urlMessageMapService").html('<strong><p style="color:red;">Error uploading REST Service.</p></strong>'),console.error("Error loading the FeatureLayer:",e)})}()})}),L.when(()=>{const e=_.layers.items.filter(e=>!("group"===e.type&&e.title&&"hidden group"===e.title.toLowerCase()||e.title&&e.title===`${C.parcelTitle}`));new f({view:L,container:$("#LegendDiv")[0],layerInfos:e.map(e=>({layer:e}))})}),L.when(()=>{new g({view:L,container:$("#BookmarksDiv")[0],dragEnabled:!0})});new T({title:"Print Map at Scale 1:1200",layout:"a4-portrait",scale:1200,scaleEnabled:!0,dpi:96,legendEnabled:!0,northArrowEnabled:!0}),new T({title:"Print Map at Scale 1:2400",layout:"a4-portrait",scale:2400,scaleEnabled:!0,dpi:96,legendEnabled:!0,northArrowEnabled:!0});L.when(()=>{new y({view:L,container:$("#PrintDiv")[0],templateOptions:{title:"Print Map at Scale 1:1200",layout:"a4-portrait",scale:1200,scaleEnabled:!0,dpi:96,legendEnabled:!0,northArrowEnabled:!0},allowedLayouts:["letter-ansi-a-landscape","letter-ansi-a-portrait","tabloid-ansi-b-landscape","tabloid-ansi-b-portrait","a3-landscape","a3-portrait","a4-landscape","a4-portrait"]})}),L.when(()=>{let e;new h({view:L,container:$("#BasemapDiv")[0],dragEnabled:!0}).visibleElements={statusIndicators:!0,baseLayers:!0,referenceLayers:!1,referenceLayersTitle:!1,errors:!0,heading:!1};let t={type:"simple",symbol:{type:"simple-fill",color:[255,255,255,0],outline:{width:1,color:`${C.parcelRenderer}`}}},n={type:"simple",symbol:{type:"simple-fill",color:[255,255,255,0],outline:{width:1,color:"#897044"}}};L.map.allLayers.forEach(t=>{"Parcel Boundaries"===t.title&&(e=t.renderer)});const a=["Aerial-Ortho 2023","Aerial-Ortho 2019","Aerial-Ortho 2016","Aerial-Ortho 2012"];L.map.allLayers.some(e=>a.includes(e.title)&&e.visible)&&L.map.allLayers.forEach(e=>{"Parcel Boundaries"===e.title&&(e.renderer=t)}),e="yes"===sessionStorage.getItem("condos")?ve.renderer:be.renderer;const i={};L.map.basemap.baseLayers.forEach(e=>{i[e.id]=e.visible}),o.watch(()=>L.map.basemap.baseLayers.map(e=>e.visible),()=>{console.log("Visibility changed:",L.map.basemap.baseLayers.map(e=>({title:e.title,visible:e.visible}))),function(e,a){let i=e.find(e=>e.visible&&!a[e.id]);if(i)console.log(`Newly visible layer: ${i.title}`),e.forEach(e=>{e!==i&&(e.visible=!1)}),i.title!==`${C.basemapTitle}`&&"Washington Basemap"!==i.title?"yes"===sessionStorage.getItem("condos")?ve.renderer=t:be.renderer=t:L.map.allLayers.forEach(e=>{"Parcel Boundaries"===e.title&&(e.renderer=n)});else{0===e.filter(e=>e.visible).length&&e.forEach(e=>{e.visible=a[e.id]})}e.forEach(e=>{a[e.id]=e.visible}),console.log("Updated visibility tracker:",e.map(e=>({title:e.title,wasVisible:a[e.id]})))}(L.map.basemap.baseLayers,i)})}),_.add(x);let S,M,B,E,P,k,A,D,F,N,O,R,U,q,V=!1,z=!1,G=!1,K=!1,j=[],H=[],Z="feet",W=!1,Q=!1,Y=!1,J={isChanged:!1,item:""},X=!1,ee=document.getElementById("buffer-value");const te=document.getElementById("clear-btn1"),ne=document.getElementById("clear-btn2");let ae,ie,re,se,oe,le,de,ce,ue,pe=L.extent,me=L.scale,he=L.zoom;o.watch(()=>[L.zoom,L.extent,L.scale],([e,t,n],[a])=>{if(e){if(e!==he&&(he=e),!be.visible&&!ve.visible&&Number(e)>C.parcelZoom){if("no"===sessionStorage.getItem("condos")?be.visible=!0:ve.visible=!0,U&&(U?.remove(),U=null),q&&(q?.remove(),q=null),"click"==ae||"details"==ae||"none yet"==ae)return void $("#select-button").removeClass("btn-warning");q=L.on("click",He),$("#lasso").removeClass("btn-warning"),$("#select-button").addClass("btn-warning"),Q=!0}}else a&&(pe=t,me=n,he=e);return""});let ge=document.getElementById("topbar");L.ui.add(ge,"bottom-right");let fe=null;function $e(e){switch(e){case"distance":if(fe=new p({view:L,unit:"feet"}),fe.viewModel.start(),U||q||(ae="none yet"),U)try{ae="details",U?.remove(),U=null}catch(e){console.error("Failed to remove DetailsHandle",e)}if(q)try{ae="click",q.remove()}catch(e){console.error("Failed to remove DetailsHandle",e)}fe&&fe.viewModel&&fe.viewModel.watch("state",function(e){"measured"===e&&("click"==ae?q=L.on("click",He):"details"==ae&&(U=L.on("click",je)))}),L.ui.add(fe,"bottom-right"),ye(document.getElementById("distanceButton"));break;case"area":if(fe=new m({view:L,unit:"acres"}),fe.viewModel.start(),U||q||(ae="none yet"),U)try{ae="details",U?.remove(),U=null}catch(e){console.error("Failed to remove DetailsHandle",e)}if(q)try{ae="click",q?.remove(),q=null}catch(e){console.error("Failed to remove DetailsHandle",e)}fe&&fe.viewModel&&fe.viewModel.watch("state",function(e){"measured"===e&&("click"==ae?q=L.on("click",He):"details"==ae&&(U=L.on("click",je)))}),L.ui.add(fe,"bottom-right"),ye(document.getElementById("areaButton"));break;case null:fe&&(L.ui.remove(fe),fe.destroy(),fe=null)}}function ye(e){L.focus();let t=Array.from(document.getElementsByClassName("active"));for(let e=0;e<t.length;e++)t[e].classList.remove("active","btn-warning");e&&(e.classList.add("active","btn-warning"),e.classList.remove("bg-info"))}document.getElementById("distanceButton").addEventListener("click",function(){$e(null),this.classList.contains("active")?ye(null):$e("distance")}),document.getElementById("areaButton").addEventListener("click",function(){$e(null),this.classList.contains("active")?ye(null):$e("area")});let be=new i({url:`${C.noCondoLayer}`,visible:!1,popupEnabled:!0,title:"Parcel Boundaries",id:"noCondoLayer"}),ve=new i({url:`${C.condoLayer}`,visible:!1,popupEnabled:!0,title:"Parcel Boundaries",id:"condoLayer"});const we=new i({url:`${C.masterTable}`}),xe=new i({url:`${C.masterTable}`});function _e(e,t){let n;if(n="yes"===sessionStorage.getItem("condos")?"noCondoLayer":"condoLayer","graphics"!==e.type&&"Tax Map Annotation"!=e.title&&"Road Centerline"!=e.title&&"Parcel Boundaries"!=e.title&&null!=e.title&&""!=e.title&&e.id!=n){var a;a=e.visible?"check-square":"square";var i=$(`\n          <calcite-list-item scale="m" label="${e.title}" value="${e.id}" style="border: white 0.5px solid;">\n          <calcite-action class="toggle-slider" id="action-${e.id}-dropdown" slot="actions-end" icon="sliders-horizontal" text="${e.title}"></calcite-action>\n            <calcite-action class="layer-vis" id="action-${e.id}" slot="actions-end" icon="${a}" text="${e.title}"></calcite-action>\n            <div id="opacityDiv-${e.id}" class="esri-slider esri-widget esri-slider--horizontal opacity-div " touch-action="none" style="display: none; height: 45px; align-items: center; padding-bottom: 10px; padding-left: 10px;">\n              <label style="margin-right: 10px; padding-top: 20px; font-weight: 500;font-size: 12px;">Layer Opacity (%)</label>\n              <calcite-slider class="slider-opacity" id="${e.id}" style="width: 50%;" value="100" label-handles max-label="100" max-value="100" min-label="0"></calcite-slider>\n              </calcite-slider>\n            </div>\n          </calcite-list-item>\n      `);t.append(i)}}function Te(e,t){e.forEach(function(e){if("group"===e.type){if(e.title&&"hidden group"===e.title.toLowerCase())return;var n=e.title||"Industry",a=$(`\n              <calcite-accordion scale="m">\n                <calcite-accordion-item heading="${n}">\n                </calcite-accordion-item>\n              </calcite-accordion>`);Te(e.layers.items,a.find("calcite-accordion-item")),t.append(a)}else _e(e,t)})}function Ie(e){oe=e}function Le(e){const t=$(e);"CALCITE-COMBOBOX"===t[0].tagName?(t[0].open=!1,t[0].disabled=!0,t[0].placeholder="Loading..."):"CALCITE-INPUT-TEXT"===t[0].tagName?(t[0].loading=!0,t[0].disabled=!0,t[0].placeholder="Loading..."):"CALCITE-DATE-PICKER"===t[0].tagName&&(t[0].disabled=!0)}function Se(e,t){const n=$(e);"CALCITE-COMBOBOX"===n[0].tagName?(n[0].disabled=!1,n[0].placeholder=`${t}`):"CALCITE-INPUT-TEXT"===n[0].tagName?(n[0].disabled=!1,n[0].loading=!1,n[0].placeholder=`${t}`):"CALCITE-DATE-PICKER"===n[0].tagName&&(n[0].disabled=!1)}_.add(be),_.add(ve),document.getElementById("clearMeasurement").addEventListener("click",function(){fe&&fe.viewModel&&(q&&(q.remove(),q=null),U&&(U.remove(),U=null),fe.viewModel.clear(),fe.viewModel.start())}),ce=[{layer:ve,field:"Appraised_Total",filterSelector:"#app-val-min",filterSelector2:"#app-val-max"},{layer:ve,field:"Assessed_Total",filterSelector:"#assess-val-min",filterSelector2:"#assess-val-max"},{layer:ve,field:"Total_Acres",filterSelector:"#acres-val-min",filterSelector2:"#acres-val-max"},{layer:ve,field:"Sale_Date",filterSelector:"#sold_calendar_lowest",filterSelector2:"#sold_calendar_highest"},{layer:ve,field:"Sale_Price",filterSelector:"#saleP-val-min",filterSelector2:"#saleP-val-max"}],de=[{layer:ve,field:"Street_Name",filterSelector:"#streetFilter",alias:"Street_Name",message:"Select a Street Name"},{layer:ve,field:"Owner",filterSelector:"#ownerFilter",message:"Select a Owner"},{layer:ve,field:"Parcel_Type",filterSelector:"#propertyFilter",alias:"Parcel_Type",message:"Select a Property Type"},{layer:ve,field:"Building_Type",filterSelector:"#buildingFilter",message:"Select a Building Type"},{layer:ve,field:"Building_Use_Code",filterSelector:"#buildingUseFilter",message:"Select a Building Use Type"},{layer:ve,field:"Design_Type",filterSelector:"#designTypeFilter",message:"Select a Design Type"},{layer:ve,field:"Zoning",filterSelector:"#zoningFilter",message:"Select a Zone"},{layer:ve,field:"Neighborhood",filterSelector:"#neighborhoodFilter",message:"Select a Neighborhood"}],ue=[{layer:ve,field:"Appraised_Total",filterSelector:"#streetFilter",minInput:"app-val-min",maxInput:"app-val-max",minValField:"appraisedValueMin",maxValueField:"appraisedValueMax",index:0},{layer:ve,field:"Assessed_Total",filterSelector:"#ownerFilter",minInput:"assess-val-min",maxInput:"assess-val-max",minValField:"assessedValueMin",maxValueField:"assessedValueMax",index:1},{layer:ve,field:"Total_Acres",filterSelector:"#propertyFilter",minInput:"acres-val-min",maxInput:"acres-val-max",minValField:"acresValueMin",maxValueField:"acresValueMax",index:2},{layer:ve,field:"Sale_Date",filterSelector:"#buildingFilter",minInput:"sold_calendar_lowest",maxInput:"sold_calendar_highest",minValField:"soldOnMin",maxValueField:"soldOnMax",index:3},{layer:ve,field:"Sale_Price",filterSelector:"#buildingUseFilter",minInput:"saleP-val-min",maxInput:"saleP-val-max",minValField:"soldPMin",maxValueField:"soldPMax",index:4}],L.when(function(){let e;e="yes"===sessionStorage.getItem("condos")?"condoLayer":"noCondoLayer";var t=_.layers.find(t=>t.id===e);o.watch(()=>t.visible,()=>{let e=t.visible;!function(e,t){let n=$(`calcite-list-item[value="${e}"] calcite-action`);if(t){if(n.hasClass("layer-vis"))return;n.attr("icon","check-square")}else{if(n.hasClass("layer-vis"))return;n.attr("icon","square")}}(t.id,e)})}),$(document).ready(function(){$("body").on("click",".toggle-slider",function(){$(this).closest("calcite-list-item").find(".opacity-div").toggle()})}),$("#layerList").on("click",".layer-vis",function(e){e.preventDefault(),function(e,t){let n=_.findLayerById(e);n&&(n.visible=!n.visible,"group"===n.type&&n.layers.forEach(e=>{e.visible=n.visible}),t.attr("icon",n.visible?"check-square":"square"))}($(this).closest("calcite-list-item").attr("value"),$(this))}),L.when(function(){var e=$("#layerList");Te(_.layers.items,e),$(".slider-opacity").on("calciteSliderChange",function(e){const t=e.target.id;let n=_.findLayerById(t);var a=e.target.value/100;n.opacity=a})});let Me,Be,Ee,Ce={appraisedValueMin:null,appraisedValueMax:null,assessedValueMin:null,assessedValueMax:null,acresValueMin:null,acresValueMax:null,soldOnMin:null,soldOnMax:null,soldPMin:null,soldPMax:null};function Pe(e,t,n){function a(){const a=de.findIndex(t=>t.field==e);de.splice(a,1),de.forEach(a=>{!function(e,t,n,a,i,r,s){Le(n),$(n).empty();let o=we.createQuery();if(Array.isArray(a)&&a.length>0&&!r){let e=a.map(e=>`${t} = '${e}'`);o.where=e.join(" OR ")}else o.where=a&&r?`${t} >= '${a}' AND ${t} <= '${r}'`:`${t} = '${a}'`;o.returnDistinctValues=!0,o.returnGeometry=!1,o.outFields=[i],i&&(o.orderByFields=[`${i} ASC`]);we.queryFeatures(o).then(function(e){var t=e.features,a=$(n);a.empty(),t.forEach(function(e){var t=e.attributes[i];if(t&&t.trim()){var n=$(`<calcite-combobox-item value="${t}" text-label="${t}"></calcite-combobox-item>`);a.append(n)}}),Se(n,s)})}(a.layer,e,a.filterSelector,t,a.field,n,a.message)})}clearTimeout(Me),Me=setTimeout(()=>{a()},600)}async function ke(e,t,n,a,i,r){try{let e=we.createQuery();if(Array.isArray(a)&&a.length>0&&!r){let n=a.map(e=>`${t} = '${e}'`);e.where=n.join(" OR ")}else e.where=a&&r?`${t} BETWEEN '${a}' AND '${r}'`:`${t} = '${a}'`;e.returnDistinctValues=!0,e.returnGeometry=!1,e.outFields=[i],i&&(e.orderByFields=[`${i} ASC`]);let n=(await we.queryFeatures(e)).features.map(e=>e.attributes[i]),s=Math.max(...n),o=Math.min(...n);switch(i){case"Sale_Date":let e=new Date(o),t=new Date(s),n=e.getFullYear(),a=("0"+(e.getMonth()+1)).slice(-2),i=("0"+e.getDate()).slice(-2),r=t.getFullYear(),l=("0"+(t.getMonth()+1)).slice(-2),d=("0"+t.getDate()).slice(-2),c=`${n}-${a}-${i}`,u=`${r}-${l}-${d}`;Ce.soldOnMin=c,Ce.soldOnMax=u;break;case"Appraised_Total":Ce.appraisedValueMin=o,Ce.appraisedValueMax=s;break;case"Assessed_Total":Ce.assessedValueMin=o,Ce.assessedValueMax=s;break;case"Sale_Price":Ce.soldPMin=o,Ce.soldPMax=s;break;case"Total_Acres":Ce.acresValueMin=o,Ce.acresValueMax=s;break;default:console.log("Sorry, no field found.")}clearTimeout(Be),Be=setTimeout(()=>{!function(e){const t=ue.findIndex(t=>t.field==e);ue.splice(t,1),ue.forEach(e=>{const t=document.getElementById(e.minInput),n=document.getElementById(e.maxInput);let a=Ce[e.minValField];const i=Ce[e.maxValueField];let r,s;a===i&&(a=0),"Appraised_Total"===e.field||"Assessed_Total"===e.field||"Sale_Price"===e.field?(r="$"+(void 0!==a?a.toLocaleString():""),s="$"+(void 0!==i?i.toLocaleString():""),t.value=r,n.value=s):"Sale_Date"===e.field?(t.value=void 0!==a?a:"",n.value=void 0!==i?i:""):"Total_Acres"===e.field&&(r=void 0!==a?a.toLocaleString():"",s=void 0!==i?i.toLocaleString():"",t.value=r,n.value=s)})}(t)},600)}catch(e){console.error("Error querying features:",e)}}function Ae(e,t,n){const a=ce.findIndex(t=>t.field==e);ce.splice(a,1),async function(e,t,n,a){for(const i of e)await ke(i.layer,t,i.filterSelector,n,i.field,a)}(ce,e,t,n)}function De(e,t,n,a){Le(n),$(n).empty();let i=we.createQuery();i.where=`1=1 AND ${t} IS NOT NULL`,i.returnDistinctValues=!0,i.returnGeometry=!1,t&&(i.orderByFields=[`${t} ASC`]),i.outFields=[t],i.maxRecordCountFactor=5,we.queryFeatures(i).then(function(e){var a=e.features,i=(e.features.length,$(n));a.forEach(function(e){var n=e.attributes[t];if(n&&n.trim()){var a=$(`<calcite-combobox-item value="${n}" text-label="${n}"></calcite-combobox-item>`);i.append(a)}})}),Se(n,a)}function Fe(){var e=document.querySelector(".esri-widget--button.esri-print__refresh-button.esri-icon-refresh");e&&e.click()}function Ne(e,t){const n=function(e,t){let n,a=t.split("?")[0],i=[],r=-1!==t.indexOf("?")?t.split("?")[1]:"";if(""!==r){i=r.split("&");for(let t=i.length-1;t>=0;t-=1)n=i[t].split("=")[0],n===e&&i.splice(t,1);a=a+"?"+i.join("&")}return a}("uniqueid",window.location.href);if(window.history.pushState({path:n},"",n),"no"===sessionStorage.getItem("condos")?be.visible=!0:ve.visible=!0,U)try{U?.remove(),U=null}catch(e){console.error("Failed to remove DetailsHandle",e)}if(q)try{q?.remove(),q=null}catch(e){console.error("Failed to remove DetailsHandle",e)}ae="",Ie(!!Q),$("#select-button").removeClass("btn-warning"),$("#select-button").addClass("btn-warning"),q=L.on("click",He),Q=!0,W=!1,$("#searchInput ul").remove(),$("#searchInput").val="",$("#select-button").prop("disabled",!1);document.getElementById("searchInput").value="",B="",searchTerm="",H=[],secondList=[],se="",M=!1,K=!1,G=!1,V=!1,$(".spinner-container").hide(),$("#distanceButton").removeClass("active"),$("#areaButton").removeClass("active"),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#dropdown").toggleClass("expanded"),$("#dropdown").hide(),$("#results-div").css("left","0px"),$("#sidebar2").css("left","-350px"),$("#sidebar2").removeClass("collapsed"),$("#right-arrow-2").show(),$("#left-arrow-2").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#backButton").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportSearch").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#featureWid").hide(),$("#exportButtons").hide(),$("#layerListDiv").hide(),$("#detailBox").hide(),$("#filterDiv").hide(),$("#dropdown").show(),$("#WelcomeBox").show(),z=!1,$("#select-button").attr("title","Add to Selection Enabled"),$(".center-container").show(),document.getElementById("suggestions").innerHTML="",$("#distanceButton").removeClass("btn-warning"),$("#distanceButton").addClass("bg-info"),$("#areaButton").removeClass("btn-warning"),$("#distanceButton").addClass("bg-info"),$("#featureWid").empty(),L.ui.remove(fe),fe&&(fe.destroy(),fe=null),L.graphics.removeAll(),N=[]}function Oe(e){A.sort((t,n)=>"owner"===e?t.owner.toLowerCase().localeCompare(n.owner.toLowerCase()):"location"===e?t.location.toLowerCase().localeCompare(n.location.toLowerCase()):"Street_Name"===e?t.Street_name.toLowerCase().localeCompare(n.Street_name.toLowerCase()):void 0),function(){let e,t;const n=document.getElementById("featureWid");n.innerHTML="";const a=document.createElement("ul");a.classList.add("row","list-group"),A.forEach(function(n){let i=n.objectid,r=n.location,s=void 0===n.uniqueId?n.GIS_LINK:n.uniqueId,o=n.GIS_LINK,l=n.coOwner,d=n.owner,c=n.MBL,u=n.geometry,p=n.Parcel_Type;"yes"===C.useUniqueIdforParcelMap?(t=s,e=s):(t=o,e=o);let m=n.Image_Path,h=void 0===n.AcctNum?"":n.AcctNum;const g=`${C.imageUrl}${m}`;a.classList.add("row"),a.classList.add("list-group");const f=document.createElement("li"),$=document.createElement("li"),y=document.createElement("tr");y.classList.add("col-12","list-group-item");let b,w,x=`<div class="extra-links">\n            <a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=https://publicweb-gis.s3.amazonaws.com/PDFs/${C.parcelMapUrl}/Quick_Maps/QM_${e}.pdf><span style="font-family:Tahoma;font-size:12px;"><strong>PDF Map</strong></a>`;"yes"==C.propertyCardPdf?x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${C.propertyCard}${s}.PDF><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></a>`:x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${C.propertyCard}${s}><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></a>`,"yes"===C.useVisionForTaxBillUrl?x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${C.tax_bill}&amp;uniqueId=${h}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`:x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${C.tax_bill}&amp;uniqueId=${s}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`,"yes"===C.includePermitLink&&(x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${C.permitLink}?uniqueid=${s} ><span style="font-family:Tahoma;font-size:12px;"><strong>Permits</strong></a>`),x+="</div>",y.innerHTML=x,$.innerHTML=`<img class="img-search image" object-id="${i}" src="${g}" alt="Image of ${s}" >`,f.classList.add("list-group-item","col-9"),f.classList.add("search-list"),$.setAttribute("object-id",i),$.setAttribute("data-id",o),$.classList.add("image-div","col-3"),w="yes"===sessionStorage.getItem(v),!l&&u||u?b=` <div class="listText">UID: ${s}  &nbsp;<br>MBL: ${c} <br> ${d} ${l} <br> ${r} <br> Property Type: ${p}</div>\n            <div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justZoom" title="Zoom to Parcel"><calcite-icon icon="magnifying-glass-plus" scale="s"/>Zoom</button><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`:(b=` <div class="listText noGeometry">UID: ${s}  &nbsp;<br>MBL: ${c} <br> ${d} ${l} <br> ${r} <br> Property Type: ${p} \n             </div><div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`,f.classList.add("no-zoomto")),f.innerHTML+=b,f.setAttribute("object-id",i),f.setAttribute("data-id",o),a.appendChild($),a.appendChild(f),a.appendChild(y)}),D=A.length,a.addEventListener("click",function(e){if(e.target.closest(".justZoom")||e.target.closest(".justZoomBtn"))return;q&&(q?.remove(),q=null),U&&(U?.remove(),U=null),$("#select-button").attr("title","Select Enabled");let t=e.target.closest("li");if(!t)return;let n=t.getAttribute("data-id"),a=t.getAttribute("object-id");tt(a,n),$("#details-spinner").show(),$("#WelcomeBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportButtons").hide(),$("#exportSearch").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$(".center-container").hide(),Xe(a,n)}),n.appendChild(a)}()}function Re(e,t,n,a,i,r){$("status-loader").show(),$("#featureWid").empty(),console.log(H);let s=new Set,o=new Set;A=H.filter(e=>!!e.geometry&&(s.add(e.uniqueId),!0)),H.forEach(e=>{!s.has(e.uniqueId)&&(o.add(e.uniqueId),A.push(e))}),A.sort((e,t)=>{const n=e.owner?e.owner.toLowerCase():"",a=t.owner?t.owner.toLowerCase():"";return n.localeCompare(a)}),V||function(e){return H.filter(t=>t.objectid===e).length}(a)>1&&function(e,t,n){"yes"==sessionStorage.getItem("condos")&&(A=A.filter(t=>t.objectid!=e),H=H.filter(t=>t.objectid!=e),$(`li[object-id="${e}"]`).remove()),"no"==sessionStorage.getItem("condos")&&(H=H.filter(e=>e.GIS_LINK!=n),A=A.filter(e=>e.GIS_LINK!=n),$(`li[data-id="${n}"]`).remove())}(a,0,r);const l=document.getElementById("featureWid"),d=document.createElement("ul");let c,u;console.log(A),A.forEach(function(e){let t=e.objectid,n=e.location,a=void 0===e.uniqueId?e.GIS_LINK:e.uniqueId,i=e.GIS_LINK,r=e.coOwner,s=e.owner,o=e.MBL,l=e.geometry,p=e.Parcel_Type;"yes"===C.useUniqueIdforParcelMap?(c=a,u=a):(c=i,u=i);let m=e.Image_Path,h=void 0===e.AcctNum?"":e.AcctNum;const g=`${C.imageUrl}${m}`;d.classList.add("row"),d.classList.add("list-group");const f=document.createElement("li"),$=document.createElement("li"),y=document.createElement("tr");y.classList.add("col-12","list-group-item");let b,w,x=`<div class="extra-links">\n            <a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=https://publicweb-gis.s3.amazonaws.com/PDFs/${C.parcelMapUrl}/Quick_Maps/QM_${u}.pdf><span style="font-family:Tahoma;font-size:12px;"><strong>PDF Map</strong></a>`;"yes"==C.propertyCardPdf?x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${C.propertyCard}${a}.PDF><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></a>`:x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${C.propertyCard}${a}><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></a>`,"yes"===C.useVisionForTaxBillUrl?x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${C.tax_bill}&amp;uniqueId=${h}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`:x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${C.tax_bill}&amp;uniqueId=${a}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`,"yes"===C.includePermitLink&&(x+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${C.permitLink}?uniqueid=${a} ><span style="font-family:Tahoma;font-size:12px;"><strong>Permits</strong></a>`),x+="</div>",y.innerHTML=x,$.innerHTML=`<img class="img-search image" object-id="${t}" src="${g}" alt="Image of ${a}" >`,f.classList.add("list-group-item","col-9"),f.classList.add("search-list"),$.setAttribute("object-id",t),$.setAttribute("data-id",i),$.classList.add("image-div","col-3"),w="yes"===sessionStorage.getItem(v),!r&&l||l?b=` <div class="listText">UID: ${a}  &nbsp;<br>MBL: ${o} <br> ${s} ${r} <br> ${n} <br> Property Type: ${p}</div>\n            <div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justZoom" title="Zoom to Parcel"><calcite-icon icon="magnifying-glass-plus" scale="s"/>Zoom</button><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`:(b=` <div class="listText noGeometry">UID: ${a}  &nbsp;<br>MBL: ${o} <br> ${s} ${r} <br> ${n} <br> Property Type: ${p} \n             </div><div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justRemove" title="Remove from Search List"><calcite-icon icon="minus-circle" scale="s"/>Remove</button></div>`,f.classList.add("no-zoomto")),f.innerHTML+=b,f.setAttribute("object-id",t),f.setAttribute("data-id",i),d.appendChild($),d.appendChild(f),d.appendChild(y)}),D=A.length,$("#total-results").html(D+" results returned"),M||($("#total-results").show(),$("#ResultDiv").show(),$("#backButton").hide(),$("#detailsButton").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#featureWid").show(),$("#detail-content").empty(),$("#dropdown").toggleClass("expanded"),$("status-loader").hide(),$("#dropdown").show(),$("#sidebar2").css("left","0px"),$("#sidebar2").addClass("collapsed"),$("#results-div").css("left","350px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide(),$("#WelcomeBox").hide(),$("#csvExportResults").hide(),$("#exportSearch").show(),$("#results-div").css("height","300px"),$("#exportButtons").show(),$("#exportResults").hide(),$("#csvExportSearch").show(),$(".spinner-container").hide(),$(`li[object-id="${a}"]`).remove(),V=!1),d.addEventListener("click",function(e){let t=!0;if(e.target.closest(".justZoom")||e.target.closest(".justZoomBtn")||e.target.closest(".pdf-links"))return;q&&(q?.remove(),q=null),U&&(U?.remove(),U=null),$("#select-button").attr("title","Select Enabled");let n=e.target.closest("li");if(!n)return;let a=n.getAttribute("data-id"),i=n.getAttribute("object-id");tt(i,a),$("#details-spinner").show(),$("#WelcomeBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportButtons").hide(),$("#exportSearch").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$(".center-container").hide(),$("#abutters-attributes").prop("disabled",!1),$("#abutters-zoom").prop("disabled",!1),e.target.closest(".no-zoomto")&&(console.log("dont zoom"),t=!1),Xe(i,a,t)}),l.appendChild(d),K=!1}function Ue(e,t,n,a){let i,r,s,o=!1;function l(e){console.log("process features:",e),e.forEach(function(e){if(""!==e.attributes.Owner&&"RESIDENT"!==e.attributes.Owner||W||o){let t=e.attributes.OBJECTID,n=e.attributes.Location,a=e.attributes.Uniqueid,i=e.attributes.GIS_LINK,r=e.attributes.Co_Owner,s=e.attributes.Owner,o=e.attributes.MBL,l=e.geometry,d=e.attributes.Mailing_Address_1,c=e.attributes.Mailing_Address_2,u=e.attributes.Mailing_City,p=e.attributes.Mail_State,m=e.attributes.Mailing_Zip,h=e.attributes.Total_Acres,g=e.attributes.Parcel_Primary_Use,f=e.attributes.Building_Use_Code,$=e.attributes.Parcel_Type,y=e.attributes.Design_Type,v=e.attributes.Zoning,w=e.attributes.Neighborhood,x=e.attributes.Land_Type_Rate,_=e.attributes.Functional_Obs,T=e.attributes.External_Obs,I=b(e.attributes.Sale_Date),L=e.attributes.Sale_Price,S=e.attributes.Vol_Page,M=e.attributes.Assessed_Total,B=e.attributes.Appraised_Total,E=e.attributes.Influence_Factor,C=e.attributes.Influence_Type,P=e.attributes.Land_Type,k=e.attributes.Prior_Assessment_Year,A=e.attributes.Prior_Assessed_Total,D=e.attributes.Prior_Appraised_Total,F=e.attributes.Map,N=e.attributes.Lat,O=e.attributes.Lon,R=e.attributes.Image_Path,U=e.attributes.AcctNum,q=e.attributes.Match_Status,V=e.attributes.ACCOUNT_TYPE;H.push(new ze(t,n,a,i,r,s,o,l,d,c,u,p,m,h,g,f,$,y,v,w,x,_,T,I,L,S,M,B,E,C,P,k,A,D,F,N,O,R,U,q,V))}}),W=!1,o=!1}if(n&&null!=n){o=!0,i=e[0].attributes.OBJECTID,r=e[0].attributes.Location,s=e[0].attributes.GIS_LINK;const t=H.filter(e=>e.objectid===i).length,n=H.filter(e=>e.GIS_LINK===s).length;t>=1||0==t&&n>=1?(l(e),Re(0,0,0,i,0,s)):(l(e),Re())}else e?(e.length,l(e)):Re(0,0,0,i);n||Re(0,0,0,i,0,s)}function qe(e,t,n,a){let i,r;if(e.features.length>0&&(i=e.features[0].attributes.Owner),"RESIDENT"!=i||n){Ee=a?e:e.features,x.removeAll();let i,o,d=[];var s={type:"simple-fill",color:[127,42,145,.4],outline:{color:[127,42,145,.8],width:2}};if(n){i=e.features[0].attributes.OBJECTID,o=Ee[0].attributes.GIS_LINK;const n=new l({geometry:Ee[0].geometry,symbol:s,id:i});if(d.push(n),countCondos=H.filter(e=>e.GIS_LINK===o).length,r=L.graphics.some(e=>e.id===i),r){const e=L.graphics.findIndex(e=>e.id===i);L.graphics.removeAt(e);const t=N.findIndex(e=>e.id===i);1===N.length?N.splice(0,1):N.splice(t,1),0===N.length&&(U||(U=L.on("click",je)),q&&(q?.remove(),q=null),q=L.on("click",He))}else t.addMany(d)}else if(a){Ee.filter(e=>e.geometry).forEach(e=>{const t=e.attributes.OBJECTID,n=new l({geometry:e.geometry,symbol:s,id:t});d.push(n)}),d.length>=1&&t.addMany(d),L.goTo({target:N,zoom:18})}else{let e;if(X=!0,Ee.map(function(t){if(i=t.attributes.OBJECTID,!t.geometry||a)return null;e=new l({geometry:t.geometry,symbol:s,id:i}),d.push(e)}).filter(e=>null!==e),1==d.length){t.addMany(d);const e=Ee[0].geometry.extent,n=(e.center,2),a=e.expand(n);L.goTo({target:d,extent:a})}else if(t.addMany(d),d.length>0){const e=d.map(e=>e.geometry.extent),t=3,n=e.reduce((e,t)=>e.union(t),e[0]).expand(t);L.goTo({target:n}).catch(e=>{console.error("Error zooming to extent:",e)})}else console.warn("No graphics available to calculate extent.")}if(N||(N=d),n&&!r){let e=d[0].id;N=[...N,d[0]],removeFromList=e}X&&(N=d),r=!1,X=!1}else console.log("serach on resident not clicking")}De(0,"Street_Name","#streetFilter","Select a Street Name"),De(0,"Owner","#ownerFilter","Select a Owner"),De(0,"Parcel_Type","#propertyFilter","Select a Property Type"),De(0,"Building_Type","#buildingFilter","Select a Building Type"),De(0,"Building_Use_Code","#buildingUseFilter","Select a Building Use"),De(0,"Design_Type","#designTypeFilter","Select a Design Type"),De(0,"Zoning","#zoningFilter","Select a Zone"),De(0,"Neighborhood","#neighborhoodFilter","Select a Neighborhood"),document.getElementById("Print-selector").addEventListener("click",function(){!function(){const e=600,t=8.8,n=8.8,a=t*e,i=n*e;L.takeScreenshot({width:a,height:i}).then(function(e){const a=window.open("","_blank"),i=document.getElementById("scale-value").innerHTML,r=(new Date).toLocaleString();a.document.write(`\n            <!DOCTYPE html>\n            <html lang="en">\n            <head>\n                <meta charset="UTF-8">\n                <meta name="viewport" content="width=device-width, initial-scale=1.0">\n                <title>Print Map</title>\n                <link rel="stylesheet" href="https://js.arcgis.com/4.27/esri/themes/light/main.css">\n                <style>\n                    body {\n                        display: flex;\n                        flex-direction: column;\n                        align-items: center;\n                        justify-content: center;\n                        margin: 0;\n                        padding: 0;\n                    }\n                    .print-title {\n                        display: flex;\n                        align-items: center;\n                        justify-content: center;\n                        text-align: center;\n                        font-size: 18px;\n                    }\n                    .print-scale {\n                        display: flex;\n                        align-items: center;\n                        justify-content: space-around;\n                        text-align: center;\n                        font-size: 14px;\n                        width: 100%;\n                        margin-left: 20px;\n                        margin-right: 20px;\n                    }\n                    .print-title img {\n                        margin-right: 20px;\n                        height: 60px !important;\n                        width: 60px !important;\n                    }\n                    .scale-bar-container {\n                        margin-right: 50px;\n                    }\n                    .print-scale-bar {\n                        width: 300px;\n                        height: 30px;\n                    }\n                    .info-writing-container {\n                        display: flex;\n                        justify-content: center;\n                        align-items: flex-start;\n                        width: 80%;\n                        margin: 20px auto;\n                    }\n                    .info-text {\n                        width: 20%;\n                        text-align: left;\n                        margin-right: 20px;\n                    }\n                    .writing-lines {\n                        width: 80%;\n                        text-align: center;\n                    }\n                    .writing-lines div {\n                        border-bottom: 1px solid black;\n                        margin: 10px 0;\n                        height: 20px;\n                    }\n                    @media print {\n                        body * {\n                            visibility: visible;\n                        }\n                    }\n                </style>\n            </head>\n            <body>\n                <div class="print-title" id="print-title">\n                    <img id="town-logo" src="${C.welcomeImage}" alt="Town Logo">\n                    <h1 id="title-text">${C.title}</h1>\n                </div>\n                <div class="print-map">\n                    <img id="print-map-image" src="${e.dataUrl}" alt="Map Image" style="width: ${t}in; height: ${n}in; border: 3px solid #A9A9A9; margin: 0 0.75in;">\n                </div>\n                <div class="print-scale">\n                    <div class="print-date" style="font-size: 12px;">Date Printed: ${r}</div>\n                    <div id="to-scale" class="scale-bar-container"></div>\n                        <div id="print-scale-bar" class="scale-bar-container">${i} (approx)</div>\n                </div>\n                <div style="text-align: center; font-size: 12px; padding-left: 30px; padding-right: 30px;">\n                    <p>Disclaimer: This map is intended for reference and general informational purposes\n                    only and is not a legally recorded map or survey. While reasonable effort has been\n                    made to ensure the accuracy, correctness, and timeliness of materials presented,\n                    the map vendor and the municipality disclaim any and all liability and responsibility for\n                    any errors, omissions, or inaccuracies in the data provided, including without limitation\n                    any liability for direct, indirect, incidental, consequential, special, exemplary,\n                    punitive, or any other type of damages. Users are hereby notified that the primary\n                    information source should be consulted for verification of the data contained herein.\n                    Continued use of this map acknowledges acceptance of these terms.</p>\n                </div>\n                <script>\n                    window.onload = function() {\n                        window.print();\n                    };\n                <\/script>\n            </body>\n            </html>\n          `),a.document.close()})}()}),L.watch("zoom",function(e,t){e!==t&&Fe()}),L.watch("center",function(e,t){e!==t&&Fe()}),$(document).on("click","#condomain-show-all",function(e){let t=e.target.getAttribute("data-gis-link");B=t,at()}),$(document).ready(function(){$(document).on("click",".justRemove",function(e){e.stopPropagation(),e.preventDefault();let t=e.target.closest("li"),n=t.getAttribute("data-id"),a=t.getAttribute("object-id"),i=e,r=!0,s=[],o=!1,l=t.querySelector(".listText");if(l){let e=l.classList;s=Array.from(e),o=s.includes("noGeometry")}if("no"===sessionStorage.getItem("condos")){let e=ve.createQuery();e.where=o?`GIS_LINK = '${n}'`:`OBJECTID = '${a}'`,e.returnGeometry=!0,e.outFields=["*"],be.queryFeatures(e).then(function(e){totalResults=e.features,Ue(totalResults,"",i),qe(e,L.graphics,r)})}else{let e=ve.createQuery();e.where=`OBJECTID = ${a}`,e.returnGeometry=!0,e.outFields=["*"],ve.queryFeatures(e).then(function(e){totalResults=e.features,Ue(totalResults,"",i),qe(e,L.graphics,r)})}})}),$(document).ready(function(){$(document).on("click",".justZoom",function(e){e.stopPropagation(),e.preventDefault();let t=e.target.closest("li"),n=(t.getAttribute("data-id"),t.getAttribute("object-id"));if("no"===sessionStorage.getItem("condos")){let e=`OBJECTID = ${n}`,t=be.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],be.queryFeatures(t).then(e=>{let t=e.features[0].geometry;const n=t.extent;n.center,n.expand(3);L.goTo({target:t})})}else{let e=`OBJECTID = ${n}`,t=ve.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],ve.queryFeatures(t).then(e=>{let t=e.features[0].geometry;const n=t.extent;n.center,n.expand(3);L.goTo({target:t})})}})}),document.getElementById("sortByOwner").addEventListener("click",function(){Oe("owner")}),document.getElementById("sortByLocation").addEventListener("click",function(){Oe("location")});let Ve=new u({view:L,layer:x,defaultCreateOptions:{mode:"freehand"},polygonSymbol:{type:"simple-fill",style:"cross",color:"rgb(145, 199, 61)",outline:{width:3,style:"solid",color:"rgba(127, 42, 145, 1)"}},defaultUpdateOptions:{tool:"reshape",toggleToolOnClick:!1}});$("#lasso").on("click",function(e){W=!W,Q=!1,$("#select-button").removeClass("btn-warning"),$("#select-button").prop("disabled",!1),W&&!Q?(Ve.create("polygon"),$("#select-button").removeClass("btn-warning"),$("#lasso").addClass("btn-warning")):(Ve.cancel(),$("#lasso").removeClass("btn-warning"),$("#lasso").addClass("btn-info"),$("#select-button").removeClass("btn-warning"),$("#select-button").addClass("btn-info")),Ne(),x.removeAll(),"no"===sessionStorage.getItem("condos")?be.visible=!0:ve.visible=!0}),Ve.on("create",function(e){"complete"===e.state&&(x.remove(e.graphic),x.add(e.graphic),function(e){let t=!0;K=!0;let n=[];"no"==sessionStorage.getItem("condos")?function(){let a=be.createQuery();a.geometry=e,a.distance=1,a.units="feet",a.spatialRelationship="intersects",a.returnGeometry=!0,a.outFields=["*"],be.queryFeatures(a).then(function(a){a.features.forEach(e=>{n.push(e.attributes.GIS_LINK)}),We(n,t),e=!1})}():function(){let a=ve.createQuery();a.geometry=e,a.distance=1,a.units="feet",a.spatialRelationship="intersects",a.returnGeometry=!0,a.outFields=["*"],ve.queryFeatures(a).then(function(a){a.features.forEach(e=>{n.push(e.attributes.GIS_LINK)}),We(n,t),e=!0})}()}(e.graphic.geometry),U&&(U?.remove(),U=null),q&&(q?.remove(),q=null),$("#lasso").removeClass("btn-warning"),$("#lasso").addClass("btn-info"))}),$("#select-button").on("click",function(e){if(Ve.cancel(),Q=!!oe||!Q,Q||Ne(),W=!1,Q&&!W?($("#lasso").removeClass("btn-warning"),$("#select-button").addClass("btn-warning")):$("#select-button").removeClass("btn-warning"),"no"===sessionStorage.getItem("condos")?be.visible=!0:ve.visible=!0,Q&&!W){if(q)try{q?.remove(),q=null}catch(e){console.error("Failed to remove clickHandle",e)}if(U)try{U?.remove(),U=null}catch(e){console.error("Failed to remove DetailsHandle",e)}q=L.on("click",He)}else if(Q&&W)U&&(U?.remove(),U=null),q&&(q?.remove(),q=null),q=L.on("click",He);else{if(q)try{q?.remove(),q=null}catch(e){console.error("Failed to remove clickHandle",e)}if(U)try{U?.remove(),U=null}catch(e){console.error("Failed to remove DetailsHandle",e)}}}),$("#home").on("click",function(e){L.goTo(C.homeExtent)});class ze{constructor(e,t,n,a,i,r,s,o,l,d,c,u,p,m,h,g,f,$,y,b,v,w,x,_,T,I,L,S,M,B,E,C,P,k,A,D,F,N,O,R,U){this.objectid=e,this.location=t,this.uniqueId=n,this.GIS_LINK=a,this.coOwner=i,this.owner=r,this.MBL=s,this.geometry=o,this.mailingAddress=l,this.mailingAddress2=d,this.Mailing_City=c,this.Mail_State=u,this.Mailing_Zip=p,this.Total_Acres=m,this.Parcel_Primary_Use=h,this.Building_Use_Code=g,this.Parcel_Type=f,this.Design_Type=$,this.Zoning=y,this.Neighborhood=b,this.Land_Type_Rate=v,this.Functional_Obs=w,this.External_Obs=x,this.Sale_Date=_,this.Sale_Price=T,this.Vol_Page=I,this.Assessed_Total=L,this.Appraised_Total=S,this.Influence_Factor=M,this.Influence_Type=B,this.Land_Type=E,this.Prior_Assessment_Year=C,this.Prior_Assessed_Total=P,this.Prior_Appraised_Total=k,this.Map=A,this.LAT=D,this.LON=F,this.Image_Path=N,this.AcctNum=O,this.Match_Status=R,this.Account_Type=U}}function Ge(e,t,n){let a,i,r;"no"===sessionStorage.getItem("condos")?be.visible=!0:ve.visible=!0,$(".spinner-container").show(),a=`\n          Street_Name LIKE '%${e}%' OR \n          MBL LIKE '%${e}%' OR \n          Location LIKE '%${e}%' OR \n          Co_Owner LIKE '%${e}%' OR \n          Uniqueid LIKE '%${e}%' OR \n          Owner LIKE '%${e}%' OR \n          GIS_LINK LIKE '%${e}%'\n      `,n?i=n:(K||M)&&(i=n,tableSearch=!0),"no"===sessionStorage.getItem("condos")?be.queryFeatures(i).then(function(s){if(r=s.features,s.features.length>=0)if(r=s.features,O=s.features,V){let n="",a="";const s=xe.createQuery();s.where=i.where,s.returnGeometry=!1,s.outFields=["*"],xe.queryFeatures(s).then(function(e){n=e.features;const t=e.features[0].attributes.GIS_LINK;let a=be.createQuery();return a.where=`GIS_LINK = '${t}'`,a.returnGeometry=!0,a.returnHiddenFields=!0,a.outFields=["*"],be.queryFeatures(a)}).then(function(i){r=i.features,a=i.features,O=i.features,qe(i,L.graphics,""),Ue(i.features),t&&setTimeout(()=>{it(n,a,e)},200)}).catch(function(e){console.error("Error querying features: ",e)})}else O=s.features,qe(s,L.graphics,""),Ue(s.features),t&&setTimeout(()=>{it(r,e)},200),V=!1;else if(1===s.features.length&&H.length>2){const n=xe.createQuery();n.where=a,n.returnGeometry=!1,n.outFields=["*"],xe.queryFeatures(n).then(function(n){qe(n.features),Ue(),t&&setTimeout(()=>{it(r,e)},200)})}else{const e=xe.createQuery();e.where=n.where,e.returnGeometry=!1,e.outFields=["*"],0==s.features.length&&xe.queryFeatures(e).then(function(e){r=e.features,GISLINK=e.features[0].attributes.GIS_LINK;let n=e.features[0].attributes.Uniqueid;O=e.features,qe(e,L.graphics),Ue(e.features),t&&setTimeout(()=>{G=!0,it(r,n)},200)})}}):ve.queryFeatures(i).then(function(e){if(r=e.features,e.features.length>0){const n=e.features[0].attributes.Uniqueid;qe(e,L.graphics,""),t&&setTimeout(()=>{it(r,n)},200)}console.log("from layer:",e.features),Ue(e.features)}),q&&(q?.remove(),q=null),U&&(U?.remove(),U=null),K?($("#select-button").addClass("btn-warning"),q=L.on("click",He)):(U=L.on("click",je),$("#select-button").removeClass("btn-warning")),Q=!1}function Ke(){$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$(".center-container").hide(),$("#layerListDiv").hide(),$("#details-spinner").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").html('<h5 style="color: red;">Issue selecting Parcel. Please make another selection.</h5>'),$("#abutters-attributes").prop("disabled",!0),$("#abutters-zoom").prop("disabled",!0),$("#selected-feature").empty(),$("#exportSearch").hide(),$("#exportButtons").hide()}function je(e){if(q&&(q?.remove(),q=null),$("#details-spinner").show(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportSearch").hide(),$("#exportButtons").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$("#abutters-attributes").prop("disabled",!1),$("#abutters-zoom").prop("disabled",!1),"no"===sessionStorage.getItem("condos")){let t=be.createQuery();t.geometry=e.mapPoint,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"],be.queryFeatures(t).then(function(e){if(totalResults=e.features,totalResults.length>0){et(e.features[0].attributes.OBJECTID,e.features[0].geometry,e.features[0]),Ye(totalResults)}else Ke()})}else{let t=ve.createQuery();t.geometry=e.mapPoint,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"],ve.queryFeatures(t).then(function(e){if(totalResults=e.features,totalResults.length>0){et(e.features[0].attributes.OBJECTID,e.features[0].geometry,e.features[0]),Ye(totalResults)}else Ke()})}}function He(e){if(ie="click",V=!1,Y=!0,U&&(U?.remove(),U=null),"no"===sessionStorage.getItem("condos")){let t=be.createQuery();t.geometry=e.mapPoint,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"],be.queryFeatures(t).then(function(t){t.features&&(totalResults=t.features,Ue(totalResults,0,e),qe(t,L.graphics,Y))})}else{let t=ve.createQuery();t.geometry=e.mapPoint,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"],ve.queryFeatures(t).then(function(t){t.features&&(totalResults=t.features,Ue(totalResults,0,e),qe(t,L.graphics,Y))})}}function Ze(e){var t;t="search"===e?document.querySelectorAll(".export-search-list"):document.querySelectorAll(".abutters-group-list");const n=[];document.querySelectorAll(".search-list").forEach(function(e,t){n[t]=e.innerHTML});var a="<ul class='label-list'>";t.forEach(function(e){a+="<li>"+e.innerHTML.trim()+"</li>"}),a+="</ul>";var i=window.open("","print","left=0,top=0,width=800,height=600,toolbar=0,status=0");i.document.write("<!DOCTYPE html><html><head>"),i.document.write("<title>Print Labels</title>"),i.document.write("<style>body { margin: 0; padding: 0; font-size: 10pt; }.label-list { list-style-type: none; margin: 0; padding: 0; display: flex; align-items: center; text-align: center; flex-wrap: wrap; justify-content: space-between; }.label-list li { box-sizing: border-box; width: 2.225in; height: 1in; margin-bottom: 0.0in; padding: 0.1in; display: flex; align-items: center; justify-content: center; font-size: 8pt; }@media print {  body { margin: 0.0in 0.1875in; }  .label-list { padding: 0; }  .label-list li { margin-right: 0in; margin-bottom: 0; }  @page { margin-top: 0.5in; margin-bottom: 0.5in; margin-left: 0.25in; margin-right: 0.25in }}</style>"),i.document.write("</head><body>"),i.document.write(a),i.document.write("</body></html>"),i.document.close(),setTimeout(()=>{i.print(),i.close(),document.querySelectorAll(".search-list").forEach(function(e,t){n[t]&&(e.innerHTML=n[t])})},250)}function We(e,t){if(e.length>0){let n=[];e.forEach(e=>{n.includes(e)||n.push(e)});const a=n.map(e=>`'${e}'`).join(" OR GIS_LINK = "),i=`GIS_LINK = ${a}`;let r=we.createQuery();r.where=i,r.returnGeometry=!1,r.returnHiddenFields=!0,r.outFields=["*"],we.queryFeatures(r).then(e=>{t?at("","",r):function(e){const t=document.getElementById("parcel-feature");t.innerHTML="";const n=e.features;totalResults=n.length,lastResults=totalResults,exportResults=n,A=n,re=n,n.forEach(function(e){let n=e.attributes.GIS_LINK,a=e.attributes.OBJECTID,i=e.attributes.Owner,r=e.attributes.Co_Owner,s=e.attributes.Mailing_Address_1,o=e.attributes.Mailing_Address_2,l=e.attributes.Mailing_City,d=e.attributes.Mail_State,c=e.attributes.Mailing_Zip;const u=document.createElement("ul");u.classList.add("row"),u.classList.add("list-group"),u.classList.add("abutters-list");const p=document.createElement("li");p.classList.add("abutters-group-item","col-12");let m="";m=` ${i} ${r} <br> ${s} ${o} <br> ${l}, ${d} ${c}`,p.innerHTML+=m,p.setAttribute("data-id",n),p.setAttribute("object-id",a),u.appendChild(p),t.appendChild(u),$("#abutters-spinner").hide(),$("#abutters-title").html(`Abutting Parcels (${totalResults})`)}),$("#results-div").css("height","300px"),$("#exportResults").show(),$("#csvExportResults").show()}(e)})}else console.log("No buffer results to query.")}async function Qe(e){$("#abutters-spinner").show();try{0===e&&(e=-10);const t=e,i=Z,r=P?.spatialReference;await n.load();const s=new a({wkid:4326});let o=P;if(!r?.isWGS84&&4326!==r?.wkid&&(o=n.project(P,s),!o))throw new Error(`Projection failed: ${r?.wkid} -> 4326`);const d=await I.geodesicBuffer(o,t,i);!function(e){F="BufferGraphicId";const t=L.graphics.items.findIndex(e=>e.id===F);t>-1&&L.graphics.removeAt(t);let n=new l({geometry:e,symbol:{type:"simple-fill",color:[51,51,204,.1],style:"forward-diagonal",outline:{color:"rgba(127, 42, 145, 0.8)",width:4}},id:F});L.graphics.add(n),L.goTo({target:n})}(d),function(e){const t={spatialRelationship:"intersects",geometry:e,outFields:["*"],returnGeometry:!0,units:Z};let n=[];"no"===sessionStorage.getItem("condos")?be.queryFeatures(t).then(e=>{e.features.forEach(e=>{n.push(e.attributes.GIS_LINK)}),We(n)}):ve.queryFeatures(t).then(e=>{e.features.forEach(e=>{n.push(e.attributes.GIS_LINK)}),We(n)})}(d)}catch(e){console.error("runAttBuffer failed:",e)}finally{$("#abutters-spinner").hide()}}function Ye(e){$("#select-button").prop("disabled",!0),$("#select-button").removeClass("btn-warning"),$("#detail-content").empty(),$("#selected-feature").empty(),$(".center-container").hide(),$("#layerListDiv").hide(),ie="detailClick";let t,n,a=e[0].attributes,i=null===a.ACCOUNT_TYPE?"":a.ACCOUNT_TYPE,r=void 0===a.Location?"":a.Location,s=void 0===a.Uniqueid?"":a.Uniqueid,o=void 0===a.GIS_LINK?"":a.GIS_LINK,l=void 0===a.Co_Owner?"":a.Co_Owner,d=void 0===a.Owner?"":a.Owner,c=void 0===a.MBL?"":a.MBL,u=void 0===a.Mailing_Address_1?"":a.Mailing_Address_1,p=void 0===a.Mailing_City?"":a.Mailing_City+", ",m=void 0===a.Mail_State?"":a.Mail_State,h=void 0===a.Mailing_Zip?"":a.Mailing_Zip,g=void 0===a.Total_Acres?"":a.Total_Acres,f=void 0===a.Parcel_Primary_Use?"":a.Parcel_Primary_Use,y=void 0===a.Building_Use_Code?"":a.Building_Use_Code,v=a.Sale_Date,w=void 0===a.Sale_Date?"":b(v),x=void 0===a.Sale_Price?"":Je(a.Sale_Price),_=void 0===a.Vol_Page?"":a.Vol_Page,T=void 0===a.Prior_Appraised_Total?"":Je(a.Prior_Appraised_Total),I=void 0===a.Prior_Assessed_Total?"":Je(a.Prior_Assessed_Total),L=void 0===a.Prior_Assessment_Year?"":a.Prior_Assessment_Year,M=void 0===a.Map?"":$.trim(a.Map),B=void 0===a.OBJECTID?"":a.OBJECTID,E=void 0===a.Lat?"":a.Lat,P=void 0===a.Lon?"":a.Lon,k=void 0===a.AcctNum?"":a.AcctNum;"yes"===C.useUniqueIdforParcelMap?(zoomToItemId=s,t=s):(zoomToItemId=o,t=o),n="yes"===C.useVisionForTaxBillUrl?k:s,se=B,S=o;const A=a.Image_Path,D=document.getElementById("detail-content"),F=document.createElement("div");F.innerHTML="",F.classList.add("details");let N=C.DetailLinksToInclude,O=C.DetailLinks,R=[];O.forEach(e=>{let t=e;if(N.includes(e)){let e={[t]:{show:"show"}};R.push(e)}else{let e={[t]:{show:"none"}};R.push(e)}});let U="";"CONDOMAIN"==i.toUpperCase()&&(U=`\n            <div style="padding-left: 20px; padding-top: 20px;">\n              <button\n                type="button"\n                class="btn btn-info mr-3"\n                id="condomain-show-all"\n                data-toggle="popover"\n                data-placement="left"\n                data-gis-link=${o}\n                data-html="true"\n                data-content="Use abutters tool to draw buffer around selected parcel and to recieve mailing list."\n              >Lookup All Condos\n              \n              </button>\n            </div>`),U+=`\n        <p>\n        <span style="font-family:Tahoma;font-size:14px;"><strong>${r}</strong></span> <br>\n        </p>\n  \n        <div>\n        <img class="image" src=${C.imageUrl}${A} alt="Building Photo" width="250" height="125">\n        </div>\n        <p>\n        <span style="font-family:Tahoma;font-size:12px;"><strong>${d} ${l}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;"><strong>${u}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;"><strong>${p} ${m} ${h}</strong></span><br>\n    </p>\n    <div id="accordion">\n      <div class="card" id="links" style="display:${R[0].links.show}">\n        <div class="card-header" id="headingOne">\n            <h5 class="mb-0">\n            <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">\n                Property Links\n            </button>\n          </h5>\n      </div>\n  \n      \n      <div id="collapseOne" class="collapse show" aria-labelledby="OneFour" data-parent="#accordion">\n             <div class="card-body" style="text-align: left;">\n      `,"yes"===C.includePermitLink&&(U+=`<a class='mx-auto' href=${C.permitLink}?uniqueid=${n} target="_blank"><span style="font-family:Tahoma;font-size:12px;"><strong>Permits</strong></a><br>`),U+=`\n        <table style="width: 100%; font-family: Tahoma; font-size: 12px; border-collapse: collapse; text-align: left;">\n          <tr>\n            <td>\n              <a target="_blank" rel="noopener noreferrer" href="${C.tax_bill}&uniqueId=${n}">\n                <strong>Tax Bills</strong>\n              </a>\n            </td>\n            <td>`,"yes"==C.propertyCardPdf?U+=`<a target="_blank" rel="noopener noreferrer" href="${C.propertyCard}${s}.PDF"><strong>Property Card</strong></a>`:U+=`<a target="_blank" rel="noopener noreferrer" href="${C.propertyCard}${s}"><strong>Property Card</strong></a>`,U+=`</td>\n        </tr>\n        <tr>\n          <td>\n            <a target="_blank" rel="noopener noreferrer" href="https://publicweb-gis.s3.amazonaws.com/PDFs/${C.parcelMapUrl}/Quick_Maps/QM_${t}.pdf">\n              <strong>Parcel Map</strong>\n            </a>\n          </td>\n          <td>\n            <a target="_blank" rel="noopener noreferrer" href="${C.taxMap_Url}${M}.pdf">\n              <strong>Tax Map</strong>\n            </a>\n          </td>\n        </tr>\n        <tr>\n          <td>\n            <a target="_blank" rel="noopener noreferrer" href="https://www.google.com/maps/@${E},${P},17z/@${E},${P},17z/data=!5m1!1e2">\n              <strong>Google Maps</strong>\n            </a>\n          </td>\n          <td>\n            <a target="_blank" rel="noopener noreferrer" href="https://www.bing.com/maps?cp=${E}~${P}&lvl=17.0">\n              <strong>Bing Maps</strong>\n            </a>\n          </td>\n        </tr>\n        <tr><td colspan="2"> &nbsp </td></tr>\n        <tr>\n          <td colspan="2">\n            <a target="_blank" rel="noopener noreferrer" href="${C.pdf_demo}">\n              <strong>Demographics Profile</strong>\n            </a>\n          </td>\n        </tr>\n        <tr>\n          <td colspan="2">\n            <a target="_blank" rel="noopener noreferrer" href="${C.housingUrl}">\n              <strong>Housing Profile</strong>\n            </a>\n          </td>\n        </tr>\n      </table>\n      </div>\n      </div>\n      </div>\n          <div class="card " id="ids" style="display:${R[1].ids.show}">\n              <div class="card-header" id="headingTwo">\n              <h5 class="mb-0">\n                  <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">\n                  Property Ids & Uses\n                  </button>\n              </h5>\n              </div>\n              <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">\n                  <div class="card-body">\n                    <p>\n                    <span style="font-family:Tahoma;font-size:12px;">Unique ID: <strong>${s}</strong></span> <br>\n                    <span style="font-family:Tahoma;font-size:12px;">MBL: <strong>${c}</strong></span> <br>\n                    <span style="font-family:Tahoma;font-size:12px;">Total Acres: <strong>${g}</strong></span> <br>\n                    <span style="font-family:Tahoma;font-size:12px;">Primary Use: <strong>${f}</strong></span> <br>\n                    <span style="font-family:Tahoma;font-size:12px;">Primary Bldg Use: <strong>${y}</strong></span><br>\n                    </p>\n                  </div>\n              </div>\n          </div>\n      <div class="card" id="sales" style="display:${R[3].sales.show}" >\n      <div class="card-header" id="headingThree">\n        <h5 class="mb-0">\n          <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">\n            Latest Sale / Transfer\n          </button>\n        </h5>\n      </div>\n      <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">\n        <div class="card-body">\n          <p>\n          <span style="font-family:Tahoma;font-size:12px;">Sold on: <strong>${w}</strong></span> <br>\n          <span style="font-family:Tahoma;font-size:12px;">Sale Price: <strong>$${x}</strong></span> <br>\n          <span style="font-family:Tahoma;font-size:12px;">Volume/Page: <strong>${_}</strong></span><br>\n          </p>\n        </div>\n      </div>\n    </div>\n    <div class="card" id="vals" style="display:${R[2].vals.show}">\n      <div class="card-header" id="headingFour">\n          <h5 class="mb-0">\n            <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">\n              Valuations\n            </button>\n          </h5>\n        </div>\n        <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordion">\n          <div class="card-body">\n              <p>\n              <span style="font-family:Tahoma;font-size:12px;"><strong>Valuations:</strong></span><br>\n              <span style="font-family:Tahoma;font-size:12px;">GL Year: <strong>${L}</strong></span> <br>\n              <span style="font-family:Tahoma;font-size:12px;">Assessment: <strong>$${I}</strong></span> <br>\n              <span style="font-family:Tahoma;font-size:12px;">Appraised: <strong>$${T}</strong></span> <br>\n              <span style="font-family:Tahoma;font-size:12px;"></span>\n              </p>\n          </div>\n      </div>\n    </div>\n  </div>\n      `,F.innerHTML=U,$("#details-spinner").hide(),D.appendChild(F)}function Je(e){return void 0===e?"":new Intl.NumberFormat("en-US").format(e)}function Xe(e,t,n){var a;n?$("#abutters-zoom").prop("disabled",!1):$("#abutters-zoom").prop("disabled",!0),$("#select-button").prop("disabled",!0),$("#select-button").removeClass("btn-warning"),q&&(q?.remove(),q=null),ie="detailClick",$("#exportResults").hide(),$("#csvExportResults").hide(),j=[e,t],(a=H.find(function(n){return n.objectid===parseInt(e)&&n.GIS_LINK===t}))||(a=H.find(function(e){return e.GIS_LINK===t||e.uniqueId===t}));let i,r,s=null===a.Account_Type?"":a.Account_Type,o=void 0===a.location?"":a.location,l=void 0===a.uniqueId?"":a.uniqueId,d=void 0===a.GIS_LINK?"":a.GIS_LINK,c=void 0===a.coOwner?"":a.coOwner,u=void 0===a.owner?"":a.owner,p=void 0===a.MBL?"":a.MBL,m=void 0===a.mailingAddress?"":a.mailingAddress,h=void 0===a.Mailing_City?"":a.Mailing_City+", ",g=void 0===a.Mail_State?"":a.Mail_State,f=void 0===a.Mailing_Zip?"":a.Mailing_Zip,y=void 0===a.Total_Acres?"":a.Total_Acres,b=void 0===a.Parcel_Primary_Use?"":a.Parcel_Primary_Use,v=void 0===a.Building_Use_Code?"":a.Building_Use_Code,w=void 0===a.Sale_Date?"":a.Sale_Date,x=void 0===a.Sale_Price?"":Je(a.Sale_Price),_=void 0===a.Vol_Page?"":a.Vol_Page,T=void 0===a.Prior_Appraised_Total?"":Je(a.Prior_Appraised_Total),I=void 0===a.Prior_Assessed_Total?"":Je(a.Prior_Assessed_Total),L=void 0===a.Prior_Assessment_Year?"":a.Prior_Assessment_Year,B=(void 0===a.geometry||a.geometry,void 0===a.Map?"":$.trim(a.Map)),E=void 0===a.objectid?"":a.objectid,P=void 0===a.LAT?"":a.LAT,k=void 0===a.LON?"":a.LON,A=void 0===a.AcctNum?"":a.AcctNum,D=void 0===a.Image_Path?"":a.Image_Path;"yes"===C.useUniqueIdforParcelMap?(zoomToItemId=l,i=l):(zoomToItemId=d,i=d),r="yes"===C.useVisionForTaxBillUrl?A:l,se=E,S=d;const F=document.getElementById("detail-content"),N=document.createElement("div");N.innerHTML="",N.classList.add("details");let O=C.DetailLinksToInclude,R=C.DetailLinks,U=[];R.forEach(e=>{let t=e;if(O.includes(e)){let e={[t]:{show:"show"}};U.push(e)}else{let e={[t]:{show:"none"}};U.push(e)}});let V="";"CONDOMAIN"==s?.toUpperCase()&&(V=`\n            <div style="padding-left: 20px; padding-top: 20px;">\n              <button\n                type="button"\n                class="btn btn-info mr-3"\n                id="condomain-show-all"\n                data-toggle="popover"\n                data-placement="left"\n                data-gis-link=${d}\n                data-html="true"\n                data-content="Use abutters tool to draw buffer around selected parcel and to recieve mailing list."\n              >Lookup All Condos\n              \n              </button>\n            </div>`),V+=`\n      <p>\n      <span style="font-family:Tahoma;font-size:14px;"><strong>${o}</strong></span> <br>\n      </p>\n\n      <div>\n      <img class="image" src=${C.imageUrl}${D} alt="Building Photo" width="250" height="125">\n      </div>\n      <p>\n      <span style="font-family:Tahoma;font-size:12px;"><strong>${u} ${c}</strong></span> <br>\n      <span style="font-family:Tahoma;font-size:12px;"><strong>${m}</strong></span> <br>\n      <span style="font-family:Tahoma;font-size:12px;"><strong>${h} ${g} ${f}</strong></span><br>\n  </p>\n  <div id="accordion">\n    <div class="card" id="links" style="display:${U[0].links.show}">\n      <div class="card-header" id="headingOne">\n          <h5 class="mb-0">\n          <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseOne" aria-expanded="false" aria-controls="collapseOne">\n              Property Links\n          </button>\n        </h5>\n    </div>\n\n    \n    <div id="collapseOne" class="collapse show" aria-labelledby="OneFour" data-parent="#accordion">\n           <div class="card-body" style="text-align: left;">\n      `,"yes"===C.includePermitLink&&(V+=`<a class='mx-auto' href=${C.permitLink}?uniqueid=${l} target="_blank"><span style="font-family:Tahoma;font-size:12px;"><strong>Permits</strong></a><br>`),V+=`\n        <table style="width: 100%; font-family: Tahoma; font-size: 12px; border-collapse: collapse; text-align: left;">\n  <tr>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="${C.tax_bill}&uniqueId=${r}">\n        <strong>Tax Bills</strong>\n      </a>\n    </td>\n     <td>`,"yes"==C.propertyCardPdf?V+=`<a target="_blank" rel="noopener noreferrer" href="${C.propertyCard}${l}.PDF"><strong>Property Card</strong></a>`:V+=`<a target="_blank" rel="noopener noreferrer" href="${C.propertyCard}${l}"><strong>Property Card</strong></a>`,V+=`</td>\n  </tr>\n  <tr>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="https://publicweb-gis.s3.amazonaws.com/PDFs/${C.parcelMapUrl}/Quick_Maps/QM_${i}.pdf">\n        <strong>Parcel Map</strong>\n      </a>\n    </td>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="${C.taxMap_Url}${B}.pdf">\n        <strong>Tax Map</strong>\n      </a>\n    </td>\n  </tr>\n  <tr>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="https://www.google.com/maps/@${P},${k},17z/@${P},${k},17z/data=!5m1!1e2">\n        <strong>Google Maps</strong>\n      </a>\n    </td>\n    <td>\n      <a target="_blank" rel="noopener noreferrer" href="https://www.bing.com/maps?cp=${P}~${k}&lvl=17.0">\n        <strong>Bing Maps</strong>\n      </a>\n    </td>\n  </tr>\n  <tr><td colspan="2"> &nbsp </td></tr>\n  <tr>\n    <td colspan="2">\n      <a target="_blank" rel="noopener noreferrer" href="${C.pdf_demo}">\n        <strong>Demographics Profile</strong>\n      </a>\n    </td>\n  </tr>\n  <tr>\n    <td colspan="2">\n      <a target="_blank" rel="noopener noreferrer" href="${C.housingUrl}">\n        <strong>Housing Profile</strong>\n      </a>\n    </td>\n  </tr>\n</table>\n\n          </div>\n        </div>\n      </div>\n        <div class="card " id="ids" style="display:${U[1].ids.show}">\n            <div class="card-header" id="headingTwo">\n            <h5 class="mb-0">\n                <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">\n                Property Ids & Uses\n                </button>\n            </h5>\n            </div>\n            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordion">\n                <div class="card-body">\n                  <p>\n                  <span style="font-family:Tahoma;font-size:12px;">Unique ID: <strong>${l}</strong></span> <br>\n                  <span style="font-family:Tahoma;font-size:12px;">MBL: <strong>${p}</strong></span> <br>\n                  <span style="font-family:Tahoma;font-size:12px;">Total Acres: <strong>${y}</strong></span> <br>\n                  <span style="font-family:Tahoma;font-size:12px;">Primary Use: <strong>${b}</strong></span> <br>\n                  <span style="font-family:Tahoma;font-size:12px;">Primary Bldg Use: <strong>${v}</strong></span><br>\n                  </p>\n                </div>\n            </div>\n        </div>\n    <div class="card" id="sales" style="display:${U[3].sales.show}" >\n    <div class="card-header" id="headingThree">\n      <h5 class="mb-0">\n        <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">\n          Latest Sale / Transfer\n        </button>\n      </h5>\n    </div>\n    <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordion">\n      <div class="card-body">\n        <p>\n        <span style="font-family:Tahoma;font-size:12px;">Sold on: <strong>${w}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;">Sale Price: <strong>$${x}</strong></span> <br>\n        <span style="font-family:Tahoma;font-size:12px;">Volume/Page: <strong>${_}</strong></span><br>\n        </p>\n      </div>\n    </div>\n  </div>\n  <div class="card" id="vals" style="display:${U[2].vals.show}">\n    <div class="card-header" id="headingFour">\n        <h5 class="mb-0">\n          <button class="btn btn-link collapsed" style="width: fit-content;" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">\n            Valuations\n          </button>\n        </h5>\n      </div>\n      <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordion">\n        <div class="card-body">\n            <p>\n            <span style="font-family:Tahoma;font-size:12px;"><strong>Valuations:</strong></span><br>\n            <span style="font-family:Tahoma;font-size:12px;">GL Year: <strong>${L}</strong></span> <br>\n            <span style="font-family:Tahoma;font-size:12px;">Assessment: <strong>$${I}</strong></span> <br>\n            <span style="font-family:Tahoma;font-size:12px;">Appraised: <strong>$${T}</strong></span> <br>\n            <span style="font-family:Tahoma;font-size:12px;"></span>\n            </p>\n        </div>\n    </div>\n  </div>\n</div>\n    `,N.innerHTML=V,$("#details-spinner").hide(),F.appendChild(N),M&&$(".abutters-zoom").trigger("click"),M=!1}function et(e,t,n){J={isChanged:!0,item:n};L.graphics.removeAll(N);k=t,P=t;const a=new l({geometry:k,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:3}},id:"uniqueBufferGraphicId"}),i=k.extent.expand(2);L.graphics.addMany([a]),L.goTo({target:a,extent:i})}function tt(e,t,n){L.graphics.removeAll(N),J={isChanged:!1,item:""},R=[];let a="uniqueBufferGraphicId";const i=L.graphics.items.findIndex(e=>e.id===a);if(i>-1&&L.graphics.removeAt(i),R=H.filter(e=>e.GIS_LINK==t),"no"==sessionStorage.getItem("condos")&&R.length==H.length&&R.length>1)if(O){CondoBuffer=!1,k=O[0].geometry,P=O[0].geometry;const e={type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},t=3,n=k.extent.expand(t),i=new l({geometry:k,symbol:e,id:a});L.graphics.addMany([i]),L.goTo({target:i,extent:n}).catch(function(e){"AbortError"!=e.name&&console.error(e)})}else{let e=`GIS_LINK = '${t}'`,n=be.createQuery();n.where=e,n.returnGeometry=!0,n.returnHiddenFields=!0,n.outFields=["*"],be.queryFeatures(n).then(e=>{let t=e.features[0].geometry;k=t,P=t;const n=k.extent.expand(4);L.goTo({target:t,extent:n}).catch(function(e){"AbortError"!=e.name&&console.error(e)});const i=new l({geometry:P,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:a});L.graphics.addMany([i])})}else{let i;if(CondoBuffer=!0,i=n?H.filter(t=>t.uniqueId==e):H.filter(t=>t.objectid==e),i.length>0)if(null!=i[0].geometry&&""!=i[0].geometry){P=i[0].geometry;const e=4,t=P.extent.expand(e);L.goTo({target:P,extent:t}).catch(function(e){"AbortError"!=e.name&&console.error(e)});const n=new l({geometry:P,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:a});L.graphics.addMany([n])}else{let e;CondoBuffer=!1,e=i.filter(e=>{e.GIS_LINK})?`GIS_LINK = '${t}'`:`GIS_LINK = '${i[0].GIS_LINK}'`;let n=be.createQuery();n.where=e,n.returnGeometry=!0,n.returnHiddenFields=!0,n.outFields=["*"],be.queryFeatures(n).then(e=>{let t=e.features[0].geometry;P=t,k=t;const n=k.extent.expand(4);L.goTo({target:t,extent:n}).catch(function(e){"AbortError"!=e.name&&console.error(e)});const i=new l({geometry:P,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:a});L.graphics.addMany([i])})}}q&&(q?.remove(),q=null),U&&(U?.remove(),U=null),U=L.on("click",je)}L.when(function(){document.getElementById("zoom-in").onclick=function(){L.zoom+=1},document.getElementById("zoom-out").onclick=function(){L.zoom-=1}}),te.addEventListener("click",function(){Ne()}),ne.addEventListener("click",function(){Ne()}),document.getElementById("searchInput").addEventListener("input",function(e){B=e.target.value.toUpperCase().replace(/&amp;/g,"&")}),$(document).ready(function(){$("#backButton").on("click",function(){if(N&&N.length>=1||!0===z||H.length>0)if($("#WelcomeBox").hide(),$("#select-button").prop("disabled",!1),$("#detailBox").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#featureWid").show(),$("#total-results").show(),$("#ResultDiv").show(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#detail-content").empty(),$("#backButton").hide(),$("#detailsButton").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").show(),$("#exportButtons").show(),$("#exportSearch").show(),$("#results-div").css("height","300px"),$(".center-container").show(),L.graphics.removeAll(),console.log(N),L.graphics.addMany(N),N.length>1){const e=N.map(e=>e.geometry.extent),t=3,n=e.reduce((e,t)=>e.union(t),e[0]).expand(t);L.goTo({target:n}).catch(e=>{console.error("Error zooming to extent:",e)})}else{const e=2,t=N[0].geometry.extent.expand(e);L.goTo({target:N,extent:t})}else $("#total-results").hide(),$("#ResultDiv").hide(),$("#abut-mail").hide(),$("#backButton").hide(),$("#details-btns").hide(),$("#detailBox").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#dropdown").show(),$(".center-container").show(),$("#WelcomeBox").show();W||Q?!W&&Q||!Q&&W?(q&&q.remove(),U&&(U?.remove(),U=null),$("#select-button").addClass("btn-warning"),q=L.on("click",He)):W&&!Q?(q&&(q?.remove(),q=null),U&&(U?.remove(),U=null),q=L.on("click",He),$("#select-button").addClass("btn-warning")):(q&&(q?.remove(),q=null),U&&(U?.remove(),U=null),$("#select-button").addClass("btn-warning"),q=L.on("click",He)):(U&&(U?.remove(),U=null),q&&(q?.remove(),q=null),q&&Q&&(q?.remove(),q=null),$("#select-button").removeClass("btn-warning"),U=L.on("click",je))})}),$(document).ready(function(){$("#detailsButton").on("click",function(){$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detail-content").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportSearch").hide(),$("#exportButtons").hide(),$("#abutters-title").html("Abutting Parcels (0)"),$("#backButton-div").css("padding-top","0px"),$("#results-div").css("height","300px"),U&&(U?.remove(),U=null),U=L.on("click",je);const e=L.graphics.items.findIndex(e=>e.id===F);e>-1&&L.graphics.removeAt(e)})}),$(document).ready(function(){$("#abutters-attributes").on("click",function(e){U&&(U?.remove(),U=null),q&&(q?.remove(),q=null),$("#results-div").css("height","300px"),$("#exportButtons").show(),$("#exportResults").show(),$("#exportButtons").show(),$("#exportSearch").hide(),$("#csvExportResults").show(),$("#csvExportSearch").hide(),$("#WelcomeBox").hide(),$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#filterDiv").hide(),$("#layerListDiv").hide(),$("#abutters-content").show(),$("#selected-feature").empty(),$("#backButton").show(),$("#detailsButton").show(),$("#parcel-feature").empty(),$("#backButton-div").css("padding-top","78px"),$("#abutters-title").html("Abutting Parcels (0)"),nt(e),ee.value=100,Qe("100")})}),$(document).ready(function(){$("#filterButton").on("click",function(){$("#WelcomeBox").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#exportSearch").hide(),$("#csvExportSearch").hide(),$("#abutters-content").hide(),$("#layerListDiv").hide(),$("#selected-feature").empty(),$("#backButton").hide(),$("#detailsButton").hide(),$("#dropdown").show(),$("#filterDiv").show(),$("#dropdown").toggleClass("expanded"),$("#sidebar2").css("left","0px"),$("#sidebar2").addClass("collapsed"),$("#results-div").css("left","350px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide(),$("#results-div").css("height","300px"),$("#parcel-feature").empty(),$("#backButton").show(),$("#backButton-div").css("padding-top","0px"),$("#abutters-title").html("Abutting Parcels (0)"),$(".center-container").show()})}),$(document).ready(function(){$("#layerListBtn").on("click",function(){$("#WelcomeBox").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#detailBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#exportSearch").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportButtons").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#backButton").hide(),$("#detailsButton").hide(),$("#dropdown").show(),$("#filterDiv").hide(),$("#backButton").show(),$("#dropdown").toggleClass("expanded"),$("#sidebar2").css("left","0px"),$("#sidebar2").addClass("collapsed"),$("#results-div").css("left","350px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide(),$("#results-div").css("height","300px"),$("#layerListDiv").show(),$("#parcel-feature").empty(),$("#backButton-div").css("padding-top","0px"),$("#abutters-title").html("Abutting Parcels (0)"),$(".center-container").show()})}),$("#layerListDiv").hide(),$(document).ready(function(){$("#exportSearch").on("click",function(e){e.stopPropagation();const t=document.createElement("div");t.style.visibility="hidden",document.body.appendChild(t);const n=document.createElement("ul");A.forEach(function(e){let t=e.objectid,a=e.owner,i=e.coOwner,r=e.mailingAddress,s=(e.mailingAddress2,e.Mailing_City),o=e.Mail_State,l=e.Mailing_Zip,d=(e.location,e.MBL);const c=document.createElement("li");let u;c.classList.add("export-search-list"),u=` ${a} ${i} <br> MBL: ${d} <br> ${r} <br> ${s}, ${o} ${l}`,c.innerHTML+=u,c.setAttribute("object-id",t),n.appendChild(c)}),t.appendChild(n),Ze("search"),document.body.removeChild(t)})}),$(document).ready(function(){$("#csvExportResults").on("click",function(e){e.stopPropagation();let t=["Owner","Co-Owner","Mailing Address","Mailing Address 2","Mailing City","Mailing State","Mailing Zip","MBL","Location"].join(",")+"\n";re.forEach(function(e){let n=e.attributes.Owner||"",a=e.attributes.Co_Owner||"",i=e.attributes.Mailing_Address_1||"",r=e.attributes.Mailing_Address_2||"",s=e.attributes.Mailing_City||"",o=e.attributes.Mail_State||"",l=e.attributes.Mailing_Zip?`\t${e.attributes.Mailing_Zip.toString().padStart(5,"0")}`:"",d=e.attributes.Location||"",c=e.attributes.MBL||"";c=c.replace(/"/g,'""'),c=`="${c}"`,t+=`"${n}","${a}","${i}","${r}","${s}","${o}","${l}",${c},"${d}"\n`});const n=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");if(void 0!==a.download){const e=URL.createObjectURL(n);a.setAttribute("href",e),a.setAttribute("download","export.csv"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}})}),$(document).ready(function(){$("#csvExportSearch").on("click",function(e){e.stopPropagation();let t=["Owner","Co-Owner","Mailing Address","Mailing Address 2","Mailing City","Mailing State","Mailing Zip","MBL","Location"].join(",")+"\n";A.forEach(function(e){let n=e.owner||"",a=e.coOwner||"",i=e.mailingAddress||"",r=e.mailingAddress2||"",s=e.Mailing_City||"",o=e.Mail_State||"",l=e.Mailing_Zip?`\t${e.Mailing_Zip.toString().padStart(5,"0")}`:"",d=e.location||"",c=e.MBL||"";c=c.replace(/"/g,'""'),c=`="${c}"`,t+=`"${n}","${a}","${i}","${r}","${s}","${o}","${l}",${c},"${d}"\n`});const n=new Blob([t],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a");if(void 0!==a.download){const e=URL.createObjectURL(n);a.setAttribute("href",e),a.setAttribute("download","export.csv"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)}})}),$(document).ready(function(){$("#exportResults").on("click",function(e){e.stopPropagation();const t=document.createElement("div");t.style.visibility="hidden",document.body.appendChild(t);const n=document.createElement("ul");A.forEach(function(e){let t=e.attributes.OBJECTID,a=e.attributes.Owner,i=e.attributes.Co_Owner,r=e.attributes.Mailing_Address_1,s=(e.attributes.Mailing_Address_2,e.attributes.Mailing_City),o=e.attributes.Mail_State,l=e.attributes.Mailing_Zip,d=(e.location,e.attributes.MBL);const c=document.createElement("li");let u;c.classList.add("abutters-group-list"),u=` ${a} ${i} <br> MBL: ${d} <br> ${r} <br> ${s}, ${o} ${l}`,c.innerHTML+=u,c.setAttribute("object-id",t),n.appendChild(c)}),t.appendChild(n),Ze("details"),document.body.removeChild(t)})}),$(document).ready(function(){let e;function t(){clearTimeout(e),e=setTimeout(()=>{Qe(currentVal)},200)}$("#buffer-value").on("change",function(e){e.stopPropagation(),currentVal=ee.value=parseInt(ee.value),$("#parcel-feature").empty(),t()}),$("#increase").on("click",function(e){e.stopPropagation(),currentVal=ee.value=parseInt(ee.value)+1,$("#parcel-feature").empty(),t()}),$("#decrease").on("click",function(e){e.stopPropagation(),currentVal=ee.value=parseInt(ee.value)-1,$("#parcel-feature").empty(),t()}),$("#submit").on("click",function(e){e.stopPropagation(),e.preventDefault(),currentVal=ee.value=parseInt(ee.value),$("#parcel-feature").empty(),t()}),$("#buffer-value").on("keypress",function(e){13==e.which&&(currentVal=ee.value=parseInt(ee.value),e.preventDefault(),t())}),$(".units").on("click",function(e){"feet"==e.target.value?(Z="feet",$("#unitSelector").html(Z)):(Z="meters",$("#unitSelector").html(Z))})}),$(document).ready(function(){$(document).on("click",".abutters-zoom",function(e){if(e.stopPropagation(),e.preventDefault(),"no"===sessionStorage.getItem("condos"))if(G){if(G){let e=`GIS_LINK = '${S}'`,t=be.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],be.queryFeatures(t).then(e=>{const t=e.features[0].geometry.extent,n=t.center;t.expand(3);L.goTo({target:n,zoom:14})})}}else{let e=`OBJECTID = ${se}`,t=be.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],be.queryFeatures(t).then(e=>{const t=e.features[0].geometry.extent,n=t.center;t.expand(3);L.goTo({target:n})})}else{let e=`OBJECTID = ${se}`,t=ve.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],ve.queryFeatures(t).then(e=>{let n,a,i,r;e.features>0?ve.queryFeatures(t).then(e=>{let t=ve.createQuery();t.where=`GIS_LINK = ${S}`,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"]}).then(e=>{n=e,a=n.features[0].geometry,i=a.extent,r=i.center}):(n=e,a=n.features[0].geometry,i=a.extent,r=i.center),L.goTo({target:r})})}})});const nt=function(e,t){$("#abutters-title").html("Abutters");let n,a,i,r,s,o,l,d,c,u=j;if(J.isChanged)locationMaillingAddress=J.item.attributes.Mailing_Address_1,locationUniqueId=J.item.attributes.Uniqueid,n=J.item.attributes.GIS_LINK,a=J.item.attributes.Owner,c=J.item.attributes.MBL,i=J.item.attributes.Co_Owner,s=J.item.attributes.Mailing_Address_1,o=J.item.attributes.Mailing_Address_2,l=J.item.attributes.Mailing_City,r=J.item.attributes.Mailing_Zip,d=J.item.attributes.Mail_State;else{var p=H.find(function(e){return e.uniqueId===u[1]&&e.objectid===Number(u[0])||e.GIS_LINK===u[1]&&e.objectid===Number(u[0])});locationMaillingAddress=void 0===p.mailingAddress?"":p.mailingAddress,locationUniqueId=void 0===p.uniqueId?"":p.uniqueId,n=void 0===p.GIS_LINK?"":p.GIS_LINK,a=void 0===p.owner?"":p.owner,i=void 0===p.coOwner?"":p.coOwner,s=void 0===p.mailingAddress?"":p.mailingAddress,o=void 0===p.mailingAddress2?"":p.mailingAddress2,l=void 0===p.Mailing_City?"":p.Mailing_City,d=void 0===p.Mail_State?"":p.Mail_State,r=void 0===p.Mailing_Zip?"":p.Mailing_Zip,c=void 0===p.MBL?"":p.MBL}const m=document.getElementById("selected-feature"),h=document.createElement("ul");h.classList.add("row"),h.classList.add("list-group");const g=document.createElement("li");let f;g.classList.add("abutters-group-item","col-12"),f=` ${a} ${i} <br> ${s} ${o} <br> ${l}, ${d} ${r}`,g.innerHTML+=f,g.setAttribute("data-id",n),$("#abutters-spinner").hide(),h.appendChild(g),m.appendChild(h)};const at=(e,t,n)=>{let a;H=[],document.getElementById("suggestions").innerHTML="",E&&(B=e.replace(/&amp;/g,"&"));let i=B;if(!(i?.length<3)||t||i||n){let e,r;$("#dropdown").toggleClass("expanded"),$("#details-btns").hide(),$("#abut-mail").hide(),$("#result-btns").hide(),$("#backButton").hide(),$("#detailsButton").hide(),$("#featureWid").empty(),$("#exportSearch").hide(),$("#csvExportResults").hide(),$("#exportButtons").hide(),$(".center-container").show(),e=`\n          Street_Name LIKE '%${i}%' OR \n          MBL LIKE '%${i}%' OR \n          Location LIKE '%${i}%' OR \n          Co_Owner LIKE '%${i}%' OR \n          Uniqueid LIKE '%${i}%' OR \n          Owner LIKE '%${i}%' OR \n          GIS_LINK LIKE '%${i}%'\n      `,t?r=t:K?(r=n,W=!0):M?r=t:(r=we.createQuery(),r.where=e,r.returnGeometry=!1,r.returnHiddenFields=!0,r.outFields=["*"]),we.queryFeatures(r).then(e=>{if(e.features.length>0){let s;a=e.features,"MISMATCH"===e.features[0].attributes.Match_Status&&"Condominium"===e.features[0].attributes.Parcel_Type&&0==W&&(V=!0),a.forEach(function(e){const t=function(e,t){const n=t.attributes?.Location;return n.includes(e)}(i,e);if(""!==e.attributes.Owner&&("RESIDENT"!==e.attributes.Owner||t)){let t=e.attributes.OBJECTID,n=e.attributes.Location,a=e.attributes.Uniqueid,i=e.attributes.GIS_LINK,r=e.attributes.Co_Owner,s=e.attributes.Owner,o=e.attributes.MBL,l=e.geometry,d=e.attributes.Mailing_Address_1,c=e.attributes.Mailing_Address_2,u=e.attributes.Mailing_City,p=e.attributes.Mail_State,m=e.attributes.Mailing_Zip,h=e.attributes.Total_Acres,g=e.attributes.Parcel_Primary_Use,f=e.attributes.Building_Use_Code,$=e.attributes.Parcel_Type,y=e.attributes.Design_Type,v=e.attributes.Zoning,w=e.attributes.Neighborhood,x=e.attributes.Land_Type_Rate,_=e.attributes.Functional_Obs,T=e.attributes.External_Obs,I=b(e.attributes.Sale_Date),L=e.attributes.Sale_Price,S=e.attributes.Vol_Page,M=e.attributes.Assessed_Total,B=e.attributes.Appraised_Total,E=e.attributes.Influence_Factor,C=e.attributes.Influence_Type,P=e.attributes.Land_Type,k=e.attributes.Prior_Assessment_Year,A=e.attributes.Prior_Assessed_Total,D=e.attributes.Prior_Appraised_Total,F=e.attributes.Map,N=e.attributes.Lat,O=e.attributes.Lon,R=e.attributes.Image_Path,U=e.attributes.AcctNum,q=e.attributes.Match_Status,V=e.attributes.ACCOUNT_TYPE;H.push(new ze(t,n,a,i,r,s,o,l,d,c,u,p,m,h,g,f,$,y,v,w,x,_,T,I,L,S,M,B,E,C,P,k,A,D,F,N,O,R,U,q,V))}}),console.log("from table:",H),"no"===sessionStorage.getItem("condos")?(s=be.createQuery(),s.where=r.where,s.returnDistinctValues=!1,s.returnGeometry=!0,s.outFields=["*"]):(s=ve.createQuery(),s.where=r.where,s.returnDistinctValues=!1,s.returnGeometry=!0,s.outFields=["*"]);let o=null;K?s.where=n.where:M&&(s.where=t.where,o=!0),Ge(B,o,s)}}).catch(e=>{console.error("Error querying for details:",e)})}else Ne()};function it(e,t,n){let a=e,i=t;if(a.length<=0)return Ne(),void alert("Search resulted in an error, please try again.");let r=a[0].attributes.Uniqueid,s=a[0].attributes.OBJECTID;$("#details-spinner").show(),$("#WelcomeBox").hide(),$("#featureWid").hide(),$("#result-btns").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#abutters-content").hide(),$("#details-btns").show(),$("#abut-mail").show(),$("#detailBox").show(),$("#backButton").show(),$("#detailsButton").hide(),$("#detail-content").empty(),$("#selected-feature").empty(),$("#exportButtons").hide(),$("#exportSearch").hide(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#results-div").css("height","300px"),$("#backButton-div").css("padding-top","0px"),$(".center-container").hide(),function(e,t){L.graphics.removeAll(N),console.log(e),console.log(t);let n=e[0].geometry,a=e[0].attributes.GIS_LINK;if(n){k=n,P=n;const e=2,t=k.extent.expand(e);L.goTo({target:n,extent:t}).catch(function(e){"AbortError"!=e.name&&console.error(e)});const a=new l({geometry:n,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}}});L.graphics.addMany([a])}else{let e=`GIS_LINK = '${a}'`,t=be.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],be.queryFeatures(t).then(e=>{let t=e.features[0].geometry;k=t,P=t;const n=k.extent.expand(2);L.goTo({target:t,extent:n}).catch(function(e){"AbortError"!=e.name&&console.error(e)});const a=new l({geometry:P,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:F});L.graphics.addMany([a])})}q&&(q?.remove(),q=null),U&&(U?.remove(),U=null),U=L.on("click",je)}(a,i),Xe(s,r),z=!0,V=!1,M=!1,$(".spinner-container").hide()}const rt=function(){const e={},t=window.location.search.substring(1).split("&");for(let n=0;n<t.length;n++){const a=t[n].split("=");a[0]&&a[1]&&(e[decodeURIComponent(a[0])]=decodeURIComponent(a[1].replace(/\+/g," ")))}return e}().uniqueid;let st,ot=`Uniqueid = '${rt}'`;rt&&(M=!0,L.when(function(){query=we.createQuery(),query.where=ot,query.returnGeometry=!1,query.returnHiddenFields=!0,query.outFields=["*"],query=we.createQuery(),query.where=ot,query.returnGeometry=!1,query.returnHiddenFields=!0,query.outFields=["*"],xe.queryFeatures(query).then(e=>{let t=e.features[0].attributes,n=t.Building_Type;"MISMATCH"===t.Match_Status&&"Condominium"===n&&(V=!0),at(null,query)})}).catch(function(e){console.error("Error occurred while the view was loading: ",e)})),document.getElementById("searchInput").addEventListener("input",function(e){H=[],$("#sidebar2").css("left","-350px"),$("#sidebar2").removeClass("collapsed"),$("#results-div").css("left","0px"),$("#dropdown").toggleClass("expanded"),$("#dropdown").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide();var t=e.target.value.toUpperCase();H=[],secondList=[],N=[],$("#select-button").removeClass("btn-warning"),$("#searchInput ul").remove(),$("#suggestions").hide(),$("#featureWid").empty(),$("#featureWid").hide(),$("#ResultDiv").hide(),$("#dropdown").removeClass("expanded"),$("#dropdown").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#right-arrow-2").show(),$("#left-arrow-2").hide(),$("#abutters-content").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#backButton").hide(),$("#detailBox").hide(),$("#exportSearch").hide(),$("#csvExportSearch").hide(),$("#csvExportResults").hide(),$("#exportButtons").hide(),U&&(U?.remove(),U=null),q&&(q?.remove(),q=null),$("#dropdown").show(),$("#WelcomeBox").show(),$(".center-container").show(),document.getElementById("suggestions").innerHTML="",$("#featureWid").empty(),L.graphics.removeAll();let n=`\n            Street_Name LIKE '%${t}%' OR \n            MBL LIKE '%${t}%' OR \n            Location LIKE '%${t}%' OR \n            Co_Owner LIKE '%${t}%' OR \n            Uniqueid LIKE '%${t}%' OR \n            Owner LIKE '%${t}%' OR\n            GIS_LINK LIKE '%${t}%'\n        `,a=xe.createQuery();a.where=n,a.returnGeometry=!1,a.outFields=["Street_Name","MBL","Location","Co_Owner","Uniqueid","Owner","GIS_LINK"];let i=new Set;xe.queryFeatures(a).then(e=>{let n=document.getElementById("suggestions");n.innerHTML="",e.features.forEach(e=>{["Street_Name","MBL","Location","Co_Owner","Uniqueid","Owner","GIS_LINK"].forEach(a=>{let r=e.attributes[a];if(r&&r.includes(t)&&!i.has(r)){let e=document.createElement("div");e.className="list-group-item",e.innerText=`${r}`,n.appendChild(e),i.add(r),n.style.display="block",e.addEventListener("click",function(e){E=!0,at(e.target.innerHTML),E=!1})}})})})}),document.querySelector(".form-inline").addEventListener("submit",function(e){"no"===sessionStorage.getItem("condos")?be.visible=!0:ve.visible=!0,H=[],L.graphics.removeAll(),N=[],e.preventDefault(),$("#featureWid").empty(),$("#selected-feature").empty(),U&&(U?.remove(),U=null),q&&(q?.remove(),q=null)}),document.addEventListener("click",function(e){"searchInput"!==e.target.id&&(document.getElementById("suggestions").style.display="none")}),document.getElementById("searchButton").addEventListener("click",function(){$("#sidebar2").css("left","-350px"),$("#sidebar2").removeClass("collapsed"),$("#results-div").css("left","0px"),$("#exportResults").hide(),$("#csvExportResults").hide(),clearTimeout(st),st=setTimeout(()=>{"no"===sessionStorage.getItem("condos")?be.visible=!0:ve.visible=!0,$("#lasso").removeClass("btn-warning"),$("#select-button").removeClass("btn-warning"),$("dropdown").empty(),$("#featureWid").empty(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#total-results").show(),$("#ResultDiv").hide(),$("#backButton").hide(),$("#detailsButton").hide(),$("#detailBox").hide(),$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#abutters-title").html("Abutting Parcels (0)"),N=[],L.graphics.removeAll(),U&&(U?.remove(),U=null),q&&(q?.remove(),q=null),at()},300)}),$(document).ready(function(){le={streetName:null,owner:null,appraisedValueMin:null,appraisedValueMax:null,assessedValueMin:null,assessedValueMax:null,zoningType:null,neighborhoodType:null,propertyType:null,buildingType:null,buildingUseType:null,designType:null,acresValueMin:null,acresValueMax:null,soldOnMin:null,soldOnMax:null,soldPMin:null,soldPMax:null},$("#streetFilter").on("calciteComboboxChange",function(e){let t;if(le.streetName=e.target.value,""!==le.streetName&&void 0!==le.streetName&&null!==le.streetName)Pe("Street_Name",e.target.value),Ae("Street_Name",e.target.value);else{clearTimeout(t),t=setTimeout(()=>{n()},600)}}),$("#ownerFilter").on("calciteComboboxChange",function(e){if(le.owner=e.target.value,""!==le.owner&&void 0!==le.owner&&null!==le.owner)Pe("Owner",e.target.value),Ae("Owner",e.target.value);else{let e;clearTimeout(e),e=setTimeout(()=>{n()},600)}}),$("#app-val-min, #app-val-max").on("input",function(){var e=$("#app-val-min").val(),t=$("#app-val-max").val();e=e.replace(/^\$/,"").replace(/,/g,""),t=t.replace(/^\$/,"").replace(/,/g,"");var n=parseInt(e,10),a=parseInt(t,10);if(!isNaN(n)&&!isNaN(a)){var i=n.toLocaleString(),r=a.toLocaleString();$("#app-val-min").val("$"+i),$("#app-val-max").val("$"+r),le.appraisedValueMin=n,le.appraisedValueMax=a}!isNaN(n)&&!isNaN(a)&&n<=a&&e.length>=6&&t.length>=6&&(le.appraisedValueMin=n,le.appraisedValueMax=a,Pe("Appraised_Total",n,a),Ae("Appraised_Total",n,a))}),$("#assess-val-min, #assess-val-max").on("input",function(){var e=$("#assess-val-min").val(),t=$("#assess-val-max").val();e=e.replace(/^\$/,"").replace(/,/g,""),t=t.replace(/^\$/,"").replace(/,/g,"");var n=parseInt(e,10),a=parseInt(t,10);if(!isNaN(n)&&!isNaN(a)){var i=n.toLocaleString(),r=a.toLocaleString();$("#assess-val-min").val("$"+i),$("#assess-val-max").val("$"+r),le.assessedValueMin=n,le.assessedValueMax=a}!isNaN(n)&&!isNaN(a)&&n<=a&&e.length>=6&&t.length>=6?(le.assessedValueMin=n,le.assessedValueMax=a,Pe("Assessed_Total",n,a),Ae("Assessed_Total",n,a)):console.log("Invalid input values: ",n,a)}),$("#propertyFilter").on("calciteComboboxChange",function(e){if(le.propertyType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Pe("Parcel_Type",e.target.value),Ae("Parcel_Type",e.target.value);else{!function(){let e;clearTimeout(e),e=setTimeout(()=>{n()},600)}()}}),$("#zoningFilter").on("calciteComboboxChange",function(e){if(le.zoningType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Pe("Zoning",e.target.value),Ae("Zoning",e.target.value);else{let e;clearTimeout(e),e=setTimeout(()=>{n()},600)}}),$("#neighborhoodFilter").on("calciteComboboxChange",function(e){if(le.neighborhoodType=e.target.value,""!==e.target.value||void 0!==e.target.value||null!==e.target.value)Pe("Neighborhood",e.target.value),Ae("Neighborhood",e.target.value);else{let e;clearTimeout(e),e=setTimeout(()=>{n()},600)}}),$("#buildingFilter").on("calciteComboboxChange",function(e){if(le.buildingType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Pe("Building_Type",e.target.value),Ae("Building_Type",e.target.value);else{let e;clearTimeout(e),e=setTimeout(()=>{n()},600)}}),$("#buildingUseFilter").on("calciteComboboxChange",function(e){if(le.buildingUseType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Pe("Building_Use_Code",e.target.value),Ae("Building_Use_Code",e.target.value);else{let e;clearTimeout(e),e=setTimeout(()=>{n()},600)}}),$("#designTypeFilter").on("calciteComboboxChange",function(e){if(le.designType=e.target.value,""!==e.target.value&&void 0!==e.target.value&&null!==e.target.value)Pe("Design_Type",e.target.value),Ae("Design_Type",e.target.value);else{let e;clearTimeout(e),e=setTimeout(()=>{n()},600)}}),$("#acres-val-min, #acres-val-max").on("input",function(){var e=parseFloat($("#acres-val-min").val()),t=parseFloat($("#acres-val-max").val()),n=$("#acres-val-min").val().trim(),a=$("#acres-val-max").val().trim();!isNaN(e)&&!isNaN(t)&&e<=t&&n.length>=0&&a.length>=0?(le.acresValueMin=e,le.acresValueMax=t,Pe("Total_Acres",e,t),Ae("Total_Acres",e,t)):console.log("Invalid input values: ",e,t)}),$("#sold_calendar_lowest").on("calciteDatePickerChange",function(){var e=$("#sold_calendar_lowest").val(),t=$("#sold_calendar_highest").val();le.soldOnMin=e,le.soldOnMax=t,Pe("Sale_Date",e,t),Ae("Sale_Date",e,t)}),$("#sold_calendar_highest").on("calciteDatePickerChange",function(){var e=new Date($("#sold_calendar_lowest").val()),t=new Date($("#sold_calendar_highest").val());e.setDate(e.getDate()+1),t.setDate(t.getDate()+1);var n=e.toISOString().split("T")[0],a=t.toISOString().split("T")[0];le.soldOnMin=n,le.soldOnMax=a,Pe("Sale_Date",n,a),Ae("Sale_Date",n,a)});let e,t=null;function n(){const e=["#designTypeFilter","#buildingUseFilter","#buildingFilter","#neighborhoodFilter","#zoningFilter","#propertyFilter","#ownerFilter","#streetFilter"].map(e=>$(e).val()).every(function(e){return 0===e.length});return t!==e&&(e&&i(),t=e),e}async function a(){let e=[],t=["Appraised_Total","Assessed_Total","Total_Acres","Sale_Date","Sale_Price"];for(let n of t){let t=we.createQuery();t.outStatistics=[{statisticType:"max",onStatisticField:n,outStatisticFieldName:"maxValue"},{statisticType:"min",onStatisticField:n,outStatisticFieldName:"minValue"}];try{let a,i=await we.queryFeatures(t);if("Sale_Date"===n){let e=new Date(i.features[0].attributes.maxValue),t=new Date(i.features[0].attributes.minValue);a={[n]:{min:t,max:e}}}else{let e=i.features[0].attributes.maxValue,t=i.features[0].attributes.minValue;a={[n]:{min:t,max:e}}}e.push(a)}catch(e){console.error("Error querying features:",e)}}var n;n=e,[{fieldName:"Appraised_Total",minInput:"#app-val-min",maxInput:"#app-val-max",index:0},{fieldName:"Assessed_Total",minInput:"#assess-val-min",maxInput:"#assess-val-max",index:1},{fieldName:"Total_Acres",minInput:"#acres-val-min",maxInput:"#acres-val-max",index:2},{fieldName:"Sale_Date",minInput:"#sold_calendar_lowest",maxInput:"#sold_calendar_highest",index:3},{fieldName:"Sale_Price",minInput:"#saleP-val-min",maxInput:"#saleP-val-max",index:4}].forEach(function(e){if("Sale_Date"==e.fieldName){const i=$(e.minInput),r=$(e.maxInput);Le(e.minInput),Le(e.maxInput),i.empty(),r.empty();var t=n[e.index][e.fieldName].min,a=n[e.index][e.fieldName].max;let s=new Date(t),o=new Date(a),l=`${s.getFullYear()}-${("0"+(s.getMonth()+1)).slice(-2)}-${("0"+s.getDate()).slice(-2)}`,d=`${o.getFullYear()}-${("0"+(o.getMonth()+1)).slice(-2)}-${("0"+o.getDate()).slice(-2)}`;i.val(l),r.val(d),Se(e.minInput,l),Se(e.maxInput,d)}else{Le(e.minInput),Le(e.maxInput);const t=$(e.minInput),a=$(e.maxInput),i=t.value=n[e.index][e.fieldName].min,r=a.value=n[e.index][e.fieldName].max;let s,o;"Total_Acres"!==e.fieldName?(s="$"+i.toLocaleString(),o="$"+r.toLocaleString()):(s=i.toLocaleString(),o=r.toLocaleString()),t.val(s),a.val(o),Se(e.minInput,s),Se(e.maxInput,o)}})}function i(){clearTimeout(e),e=setTimeout(()=>{!function(){dontTriggerMultiQuery=!0,t=null,$("#lasso").removeClass("btn-warning"),$("#searchInput ul").remove(),$("#searchInput").val="",document.getElementById("searchInput").value="",B="",searchTerm="",H=[],secondList=[],ce=[{layer:ve,field:"Appraised_Total",filterSelector:"#app-val-min",filterSelector2:"#app-val-max"},{layer:ve,field:"Assessed_Total",filterSelector:"#assess-val-min",filterSelector2:"#assess-val-max"},{layer:ve,field:"Total_Acres",filterSelector:"#acres-val-min",filterSelector2:"#acres-val-max"},{layer:ve,field:"Sale_Date",filterSelector:"#sold_calendar_lowest",filterSelector2:"#sold_calendar_highest"},{layer:ve,field:"Sale_Price",filterSelector:"#saleP-val-min",filterSelector2:"#saleP-val-max"}],de=[{layer:ve,field:"Street_Name",filterSelector:"#streetFilter",alias:"Street_Name",message:"Select a Street Name"},{layer:ve,field:"Owner",filterSelector:"#ownerFilter",message:"Select a Owner"},{layer:ve,field:"Parcel_Type",filterSelector:"#propertyFilter",alias:"Parcel_Type",message:"Select a Property Type"},{layer:ve,field:"Building_Type",filterSelector:"#buildingFilter",message:"Select a Building Type"},{layer:ve,field:"Building_Use_Code",filterSelector:"#buildingUseFilter",message:"Select a Building Use Type"},{layer:ve,field:"Design_Type",filterSelector:"#designTypeFilter",message:"Select a Design Type"},{layer:ve,field:"Zoning",filterSelector:"#zoningFilter",message:"Select a Zone"},{layer:ve,field:"Neighborhood",filterSelector:"#neighborhoodFilter",message:"Select a Neighborhood"}],ue=[{layer:ve,field:"Appraised_Total",filterSelector:"#streetFilter",minInput:"app-val-min",maxInput:"app-val-max",minValField:"appraisedValueMin",maxValueField:"appraisedValueMax",index:0},{layer:ve,field:"Assessed_Total",filterSelector:"#ownerFilter",minInput:"assess-val-min",maxInput:"assess-val-max",minValField:"assessedValueMin",maxValueField:"assessedValueMax",index:1},{layer:ve,field:"Total_Acres",filterSelector:"#propertyFilter",minInput:"acres-val-min",maxInput:"acres-val-max",minValField:"acresValueMin",maxValueField:"acresValueMax",index:2},{layer:ve,field:"Sale_Date",filterSelector:"#buildingFilter",minInput:"sold_calendar_lowest",maxInput:"sold_calendar_highest",minValField:"soldOnMin",maxValueField:"soldOnMax",index:3},{layer:ve,field:"Sale_Price",filterSelector:"#buildingUseFilter",minInput:"saleP-val-min",maxInput:"saleP-val-max",minValField:"soldPMin",maxValueField:"soldPMax",index:4}],$("#result-btns").hide(),$("#details-btns").hide(),$("#abut-mail").hide(),$("#dropdown").hide(),$("#right-arrow-2").show(),$("#left-arrow-2").hide(),$("#abutters-content").hide(),$("#selected-feature").empty(),$("#parcel-feature").empty(),$("#backButton").show(),$("#exportResults").hide(),$("#csvExportResults").hide(),$("#csvExportSearch").hide(),$("#exportSearch").hide(),$("#total-results").hide(),$("#ResultDiv").hide(),$("#featureWid").hide(),$("#exportButtons").hide(),$("#dropdown").show(),$("#WelcomeBox").hide(),$("#select-button").attr("title","Add to Selection Enabled"),document.getElementById("suggestions").innerHTML="",$("#distanceButton").removeClass("btn-warning"),$("#distanceButton").addClass("bg-info"),$("#areaButton").removeClass("btn-warning"),$("#distanceButton").addClass("bg-info"),$("#featureWid").empty(),L.ui.remove(fe),fe&&(fe.destroy(),fe=null),L.graphics.removeAll(),N=[],Object.keys(le).forEach(e=>{le[e]=null});const e=$("#streetFilter"),n=$("#ownerFilter"),i=$("#propertyFilter"),r=$("#buildingFilter"),s=$("#buildingUseFilter"),o=$("#designTypeFilter"),l=$("#zoningFilter"),d=$("#neighborhoodFilter"),c=$("#sold_calendar_lowest"),u=$("#sold_calendar_highest");e.empty(),n.empty(),i.empty(),r.empty(),s.empty(),o.empty(),l.empty(),d.empty(),c.value="",u.value="",c.activeDate=null,u.activeDate=null,De(0,"Street_Name","#streetFilter","Select a Street Name"),De(0,"Owner","#ownerFilter","Select a Owner"),De(0,"Parcel_Type","#propertyFilter","Select a Property Type"),De(0,"Building_Type","#buildingFilter","Select a Building Type"),De(0,"Building_Use_Code","#buildingUseFilter","Select a Building Use"),De(0,"Design_Type","#designTypeFilter","Select a Design Type"),De(0,"Zoning","#zoningFilter","Select a Zone"),De(0,"Neighborhood","#neighborhoodFilter","Select a Neighborhood"),a(),$(".wrapper .x-button").click(),$("#streetFilter").value=""}()},600)}document.addEventListener("DOMContentLoaded",()=>{t=n()}),$("#saleP-val-min, #saleP-val-max").on("input",function(){var e=$("#saleP-val-min").val(),t=$("#saleP-val-max").val();e=e.replace(/^\$/,"").replace(/,/g,""),t=t.replace(/^\$/,"").replace(/,/g,"");var n=parseInt(e,10),a=parseInt(t,10);if(isNaN(n)||isNaN(a))console.log("Invalid input");else{var i=n.toLocaleString(),r=a.toLocaleString();$("#saleP-val-min").val("$"+i),$("#saleP-val-max").val("$"+r),le.soldPMin=n,le.soldPMax=a,Pe("Sale_Price",n,a),Ae("Sale_Price",n,a)}}),a(),$("#submitFilter").on("click",function(){!function(){let e=[];if(null!==le.streetName&&le.streetName.length>1)if(Array.isArray(le.streetName)){const t=le.streetName.map(e=>`Street_Name LIKE '%${e.trim()}%'`);e.push(`(${t.join(" OR ")})`)}else e.push(`(Street_Name LIKE '%${le.streetName.trim()}%')`);if(null!==le.owner&&le.owner.length>1)if(Array.isArray(le.owner)){const t=le.owner.map(e=>`Owner LIKE '%${e.trim()}%'`);e.push(`(${t.join(" OR ")})`)}else e.push(`(Owner LIKE '%${le.owner.trim()}%')`);if(null!==le.appraisedValueMin&&null!==le.appraisedValueMax&&e.push(`Appraised_Total BETWEEN ${le.appraisedValueMin} AND ${le.appraisedValueMax}`),null!==le.assessedValueMin&&null!==le.assessedValueMax&&e.push(`Assessed_Total BETWEEN ${le.assessedValueMin} AND ${le.assessedValueMax}`),null!==le.propertyType&&le.propertyType.length>1)if(Array.isArray(le.propertyType)){const t=le.propertyType.map(e=>`Parcel_Type LIKE '%${e.trim()}%'`);e.push(`(${t.join(" OR ")})`)}else e.push(`(Parcel_Type LIKE '%${le.propertyType.trim()}%')`);if(null!==le.zoningType&&le.zoningType.length>1)if(Array.isArray(le.zoningType)){const t=le.zoningType.map(e=>`Zoning LIKE '%${e.trim()}%'`);e.push(`(${t.join(" OR ")})`)}else e.push(`(Zoning LIKE '%${le.zoningType.trim()}%')`);if(null!==le.neighborhoodType&&le.neighborhoodType.length>1)if(Array.isArray(le.neighborhoodType)){const t=le.neighborhoodType.map(e=>`Neighborhood LIKE '%${e.trim()}%'`);e.push(`(${t.join(" OR ")})`)}else e.push(`(Neighborhood LIKE '%${le.neighborhoodType.trim()}%')`);if(null!==le.buildingType&&le.buildingType.length>1)if(Array.isArray(le.buildingType)){const t=le.buildingType.map(e=>`Building_Type LIKE '%${e.trim()}%'`);e.push(`(${t.join(" OR ")})`)}else e.push(`(Building_Type LIKE '%${le.buildingType.trim()}%')`);if(null!==le.buildingUseType&&le.buildingUseType.length>1)if(Array.isArray(le.buildingUseType)){const t=le.buildingUseType.map(e=>`Building_Use_Type LIKE '%${e.trim()}%'`);e.push(`(${t.join(" OR ")})`)}else e.push(`(Building_Use_Type LIKE '%${le.buildingUseType.trim()}%')`);if(null!==le.designType&&le.designType.length>1)if(Array.isArray(le.designType)){const t=le.designType.map(e=>`Design_Type LIKE '%${e.trim()}%'`);e.push(`(${t.join(" OR ")})`)}else e.push(`(Design_Type LIKE '%${le.designType.trim()}%')`);null!==le.acresValueMin&&null!==le.acresValueMax&&e.push(`Total_Acres BETWEEN ${le.acresValueMin} AND ${le.acresValueMax}`),null!==le.soldOnMin&&null!==le.soldOnMax&&e.push(`Sale_Date >= '${le.soldOnMin}' AND Sale_Date <= '${le.soldOnMax}'`),null!==le.soldPMin&&null!==le.soldPMax&&e.push(`Sale_Price BETWEEN ${le.soldPMin} AND ${le.soldPMax}`);let t=e.join(" AND ");if("no"===sessionStorage.getItem("condos")){let e=xe.createQuery();e.where=t,e.returnDistinctValues=!1,e.returnGeometry=!0,e.outFields=["*"],Ne(),at(null,e)}else{let e=xe.createQuery();e.where=t,e.returnDistinctValues=!1,e.returnGeometry=!0,e.outFields=["*"],Ne(),at(null,e)}}()}),$("#clearFilter").on("click",function(){i()})}),$(document).ready(function(){$("#side-Exp").on("click",function(){$("#sidebar").toggleClass("collapsed"),$("#sidebar").hasClass("collapsed")?($("#small-div").css("right","0px"),$("#right-arrow").hide(),$("#left-arrow").show()):($("#small-div").css("right","250px"),$("#left-arrow").hide(),$("#right-arrow").show())})}),$(document).ready(function(){$("#Basemap-selector").on("click",function(){$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#AddDataDiv").hide(),$("#ContactDiv").hide(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#Right-Btn-div").show(),$("#BasemapDiv").show(),$("#group-container-right").show()}),$("#Bookmarks-selector").on("click",function(){$("#rightPanel").hide(),$("#BasemapDiv").hide(),$("#AddDataDiv").hide(),$("#ContactDiv").hide(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#Right-Btn-div").show(),$("#BookmarksDiv").show(),$("#group-container-right").show()}),$("#Print-Esri").on("click",function(){$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#AddDataDiv").hide(),$("#ContactDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").show(),$("#PrintDiv").show(),$("#LegendDiv").hide(),$("#group-container-right").show()}),$("#Contact-selector").on("click",function(){$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#AddDataDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#PrintDiv").hide(),$("#Right-Btn-div").show(),$("#ContactDiv").show(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#group-container-right").show()}),$("#addData-selector").on("click",function(){$(document).keypress(function(e){"Enter"===e.key&&e.preventDefault()}),$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#PrintDiv").hide(),$("#ContactDiv").hide(),$("#Right-Btn-div").show(),$("#AddDataDiv").show(),$("#PrintDiv").hide(),$("#LegendDiv").hide(),$("#group-container-right").show()}),$("#Legend-selector").on("click",function(){$("#rightPanel").hide(),$("#BookmarksDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#PrintDiv").hide(),$("#ContactDiv").hide(),$("#Right-Btn-div").show(),$("#AddDataDiv").hide(),$("#PrintDiv").hide(),$("#LegendDiv").show(),$("#group-container-right").show()}),$("#right-btn-back").on("click",function(){$("#group-container-right").hide(),$("#PrintDiv").hide(),$("#AddDataDiv").hide(),$("#BookmarksDiv").hide(),$("#BasemapDiv").hide(),$("#Right-Btn-div").hide(),$("#ContactDiv").hide(),$("#LegendDiv").hide(),$("#rightPanel").show()})});var lt={240:"1 inch = 20 feet",600:"1 inch = 50 feet",1200:"1 inch = 100 feet",1800:"1 inch = 150 feet",2400:"1 inch = 200 feet",3600:"1 inch = 300 feet",4800:"1 inch = 400 feet",9600:"1 inch = 800 feet",12e3:"1 inch = 1000 feet",18e3:"1 inch = 1500 feet",24e3:"1 inch = 2000 feet",36e3:"1 inch = 3000 feet",72e3:"1 inch = 6000 feet",144e3:"1 inch = 12000 feet",18e4:"1 inch = 15000 feet"},dt=document.getElementById("scale-dropdown");document.querySelectorAll(".scale-select").forEach(function(e){e.addEventListener("click",function(e){var t=parseInt(e.target.value),n=e.target.innerHTML;t&&(L.scale=t,console.log(L.scale)),$("#scale-value").val(t).html(n)})}),L.ui.add(dt);o.watch(()=>[L.stationary,L.scale],([e,t])=>{e&&function(e){var t=Math.round(e),n=function(e){var t=Object.keys(lt).reduce(function(t,n){return Math.abs(n-e)<Math.abs(t-e)?n:t});return lt[t]}(t);n&&$("#scale-value").val(t).html(n)}(t)});function Fe(){var e=document.querySelector(".esri-widget--button.esri-print__refresh-button.esri-icon-refresh");e&&e.click()}$(document).ready(function(){$("#popoverButton").popover({trigger:"hover"})}),$(document).ready(function(){$("#lasso").popover({trigger:"hover"})}),$(document).ready(function(){$("#select-button").popover({trigger:"hover"})}),$(document).ready(function(){$("#clear-btn1").popover({trigger:"hover"})}),$(document).ready(function(){$("#filterButton").popover({trigger:"hover"})}),$(document).ready(function(){$("#layerListBtn").popover({trigger:"hover"})}),$(document).ready(function(){$("#abutters-attributes").popover({trigger:"hover"})}),$(document).ready(function(){$("#abutters-zoom").popover({trigger:"hover"})}),$(document).ready(function(){$("#distanceButton").popover({trigger:"hover"})}),$(document).ready(function(){$("#areaButton").popover({trigger:"hover"})}),$(document).ready(function(){$("#clearMeasurement").popover({trigger:"hover"})}),L.watch("zoom",function(e,t){e!==t&&Fe()}),L.watch("center",function(e,t){e!==t&&Fe()}),$(document).ready(function(){$("#side-Exp2").on("click",function(){$("#sidebar2").hasClass("collapsed")?($("#results-div").css("left","0px"),$("#sidebar2").css("left","-350px"),$("#right-arrow-2").show(),$("#left-arrow-2").hide()):($("#results-div").css("left","350px"),$("#sidebar2").css("left","0px"),$("#left-arrow-2").show(),$("#right-arrow-2").hide()),$("#sidebar2").toggleClass("collapsed")})})})});
// @ts-nocheck
require(["esri/WebMap","esri/views/MapView","esri/layers/FeatureLayer","esri/core/reactiveUtils","esri/Graphic","esri/layers/GraphicsLayer","esri/widgets/BasemapLayerList","esri/renderers/SimpleRenderer","esri/widgets/Locate"],function(e,t,r,n,o,i,a,s,l){const c=new URLSearchParams(window.location.search);let d=window.location.href,u=c.get("viewer");let m=["canaanct","colebrookct","colebrookctassessor","columbiact","cornwallct","durhamct","franklinct","haddamct","northcanaanct","roxburyct","roxburyctassessor","salisburyct","scotlandct","warrenct","warrenctassessor","washingtonct","wiltonct","wolcottct","woodbridgect"].join("|"),p=new RegExp(`\\?viewer=cama\\/(${m})(\\&\\w+=[\\w-]+)*$`);null!=u&&p.test(d)?u+=".json":"https://terrenogis.com"===window.location.href||"https://terrenogis.com/"===window.location.href||"http://terrenogis.com/mobile/"===window.location.href||"http://terrenogis.com/mobile/mobile.html"===window.location.href?window.location.href="https://www.qds.biz/gis-service":window.location.href="./onload.html";const g={mapId:"",condoLayer:"",title:"",isCondosLayer:"",noCondoLayer:""};fetch(u).then(e=>e.json()).then(s=>{g.mapId=s.webmapId||"6448b08504de4244973a28305b18271f",g.condoLayer=s.condoLayer,g.noCondoLayer=s.noCondoLayer,g.title=s.title,g.isCondosLayer=s.condos,g.masterTable=s.masterTable,g.parcelZoom=s.parcelZoom,g.imageUrl=s.imageUrl,g.welcomeImage=s.welcomeImage,g.pdf_Image=s.pdf_Image,g.pdf_demo=s.pdf_demographics,g.taxMap_Url=s.taxMapUrl,g.parcelMapUrl=s.parcelMapUrl,g.housingUrl=s.housingUrl,g.propertyCardPdf=s.propertyCardPdf,g.propertyCard=s.propertyCard,g.tax_bill=s.tax_bill,g.useVisionForTaxBillUrl=s.useVisionForTaxBillUrl,g.accessorName=s.accessorName,g.parcelTitle=s.parcelServiceTitle,g.tabTitle=s.tabTitle,g.basemapTitle=s.basemapTitle,g.parcelRenderer=s.parcelRenderer,g.useUniqueIdforParcelMap=s.useUniqueIdforParcelMap,g.helpUrl=s.helpUrl,g.includeFilter=s.includeFilter,g.customWelcomePage=s.customWelcomePage,g.customWelcomeMessage=s.customWelcomeMessage,g.showDisclaimer=s.showDisclaimer,g.customDisclaimerPage=s.customDisclaimerPage,g.customDisclaimerMessage=s.customDisclaimerMessage,g.DetailLinks=s.DetailLinks,g.DetailLinksToInclude=s.DetailLinksToInclude,g.includePermitLink=s.includePermitLink,g.scale=s.scale,"yes"===g.includePermitLink&&(g.permitLink=s.permitLink),$(".help-url").attr("href",g.helpUrl),document.getElementById("imageContainer").src=g.welcomeImage;const c=document.getElementById("clear-btn"),d=new i;let u,m,p,h,f,y,b,w,I=[],L=!0,v=!1,E=!1;const _=new e({portalItem:{id:g.mapId},layers:[d]});var x=new t({container:"viewDiv",map:_,units:"imperial",scale:g.scale,popupEnabled:!1,ui:{components:["attribution"]}});x.when(()=>{g.homeExtent=x.extent});const T=new r({url:`${g.noCondoLayer}`,visible:!1,popupEnabled:!0,title:"Parcel Boundaries",id:"noCondoLayer"}),S=new r({url:`${g.condoLayer}`,visible:!1,popupEnabled:!0,title:"Parcel Boundaries",id:"condoLayer"});"no"===sessionStorage.getItem("condos")?(_.add(T),T.visible=!0,console.log("no condos layer added")):(_.add(S),S.visible=!0,console.log("condos layer added"));const G=new r({url:`${g.masterTable}`}),C=new r({url:`${g.masterTable}`});y=x.extent,b=x.scale,w=x.zoom;const q=document.querySelector(".top-dropdown"),k=q.querySelector(".dropdown-toggle");function P(e){if(H(),detailsHandleUsed="click",v=!1,"no"===sessionStorage.getItem("condos")){let t=T.createQuery();t.geometry=e.mapPoint,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"],T.queryFeatures(t).then(function(t){t.features&&(totalResults=t.features,N(totalResults,"",e),K(t,x.graphics))})}else{let t=S.createQuery();t.geometry=e.mapPoint,t.spatialRelationship="intersects",t.returnGeometry=!0,t.outFields=["*"],S.queryFeatures(t).then(function(t){t.features&&(totalResults=t.features,N(totalResults,"",e),K(t,x.graphics))})}}function M(e,t){e.forEach(function(e){if("group"===e.type){if(e.title&&"hidden group"===e.title.toLowerCase())return;var r=e.title||"Industry",n=$(`\n              <calcite-accordion scale="m">\n                <calcite-accordion-item heading="${r}">\n                </calcite-accordion-item>\n              </calcite-accordion>`);M(e.layers.items,n.find("calcite-accordion-item")),t.append(n)}else!function(e,t){let r;if(r="yes"===sessionStorage.getItem("condos")?"noCondoLayer":"condoLayer","graphics"!==e.type&&"Tax Map Annotation"!=e.title&&"Road Centerline"!=e.title&&"Parcel Boundaries"!=e.title&&null!=e.title&&""!=e.title&&e.id!=r){var n;n=e.visible?"check-square":"square";var o=$(`\n          <calcite-list-item scale="m" label="${e.title}" value="${e.id}" style="border: white 0.5px solid;">\n          <calcite-action class="toggle-slider" id="action-${e.id}-dropdown" slot="actions-end" icon="sliders-horizontal" text="${e.title}"></calcite-action>\n            <calcite-action class="layer-vis" id="action-${e.id}" slot="actions-end" icon="${n}" text="${e.title}"></calcite-action>\n            <div id="opacityDiv-${e.id}" class="esri-slider esri-widget esri-slider--horizontal opacity-div " touch-action="none" style="display: none; height: 45px; align-items: center; padding-bottom: 10px; padding-left: 10px;">\n              <label style="margin-right: 10px; padding-top: 20px; font-weight: 500;font-size: 12px;">Layer Opacity (%)</label>\n              <calcite-slider class="slider-opacity" id="${e.id}" style="width: 50%;" value="100" label-handles max-label="100" max-value="100" min-label="0"></calcite-slider>\n              </calcite-slider>\n            </div>\n          </calcite-list-item>\n      `);t.append(o)}}(e,t)})}function F(e){let t=e.attributes.OBJECTID,r=e.attributes.Location,n=e.attributes.Uniqueid,o=e.attributes.GIS_LINK,i=e.attributes.Co_Owner,a=e.attributes.Owner,s=e.attributes.MBL,l=e.geometry,c=e.attributes.Mailing_Address_1,d=e.attributes.Mailing_Address_2,u=e.attributes.Mailing_City,m=e.attributes.Mail_State,p=e.attributes.Mailing_Zip,g=e.attributes.Total_Acres,h=e.attributes.Parcel_Primary_Use,f=e.attributes.Building_Use_Code,y=e.attributes.Parcel_Type,b=e.attributes.Design_Type,w=e.attributes.Zoning,L=e.attributes.Neighborhood,$=e.attributes.Land_Type_Rate,v=e.attributes.Functional_Obs,E=e.attributes.External_Obs,_=e.attributes.Sale_Date,x=(T=new Date(_),S=T.getDate(),T.getMonth()+1+"/"+S+"/"+T.getFullYear());var T,S;let G=e.attributes.Sale_Price,C=e.attributes.Vol_Page,q=e.attributes.Assessed_Total,k=e.attributes.Appraised_Total,P=e.attributes.Influence_Factor,M=e.attributes.Influence_Type,F=e.attributes.Land_Type,O=e.attributes.Prior_Assessment_Year,B=e.attributes.Prior_Assessed_Total,A=e.attributes.Prior_Appraised_Total,K=e.attributes.Map,N=e.attributes.Lat,D=e.attributes.Lon,R=e.attributes.Image_Path,U=e.attributes.AcctNum,H=e.attributes.Match_Status,j=e.attributes.ACCOUNT_TYPE;I.push(new Parcel(t,r,n,o,i,a,s,l,c,d,u,m,p,g,h,f,y,b,w,L,$,v,E,x,G,C,q,k,P,M,F,O,B,A,K,N,D,R,U,H,j))}function O(e){e.addEventListener("click",function(e){let t=!0;if(e.target.closest(".justZoom")||e.target.closest(".justZoomBtn")||e.target.closest(".pdf-links"))return;let r=e.target.closest("li");if(!r)return;let n=r.getAttribute("data-id"),i=r.getAttribute("object-id");E||(!function(e,t,r){x.graphics.removeAll(m),detailsChanged={isChanged:!1,item:""},h=[];let n="uniqueBufferGraphicId";const i=x.graphics.items.findIndex(e=>e.id===n);if(i>-1&&x.graphics.removeAt(i),h=I.filter(e=>e.GIS_LINK==t),"no"==sessionStorage.getItem("condos")&&h.length==I.length&&h.length>1)if(noCondosParcelGeom){CondoBuffer=!1,targetExtent=noCondosParcelGeom[0].geometry,detailsGeometry=noCondosParcelGeom[0].geometry;const e={type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},t=3,r=(targetExtent.extent.expand(t),new o({geometry:targetExtent,symbol:e,id:n}));if(x.graphics.addMany([r]),!L)return;x.goTo({target:r}).catch(function(e){"AbortError"!=e.name&&console.error(e)})}else{let e=`GIS_LINK = '${t}'`,r=T.createQuery();if(r.where=e,r.returnGeometry=!0,r.returnHiddenFields=!0,r.outFields=["*"],T.queryFeatures(r).then(e=>{let t=e.features[0].geometry;targetExtent=t,detailsGeometry=t,targetExtent.extent.expand(4);const r=new o({geometry:detailsGeometry,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:n});x.graphics.addMany([r])}),!L)return;x.goTo({target:geometry}).catch(function(e){"AbortError"!=e.name&&console.error(e)})}else{let i;if(CondoBuffer=!0,i=r?I.filter(t=>t.uniqueId==e):I.filter(t=>t.objectid==e),i.length>0)if(null!=i[0].geometry&&""!=i[0].geometry){detailsGeometry=i[0].geometry;const e=4,t=(detailsGeometry.extent.expand(e),new o({geometry:detailsGeometry,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:n}));if(x.graphics.addMany([t]),!L)return;x.goTo({target:detailsGeometry}).catch(function(e){"AbortError"!=e.name&&console.error(e)})}else{let e;CondoBuffer=!1,e=i.filter(e=>{e.GIS_LINK})?`GIS_LINK = '${t}'`:`GIS_LINK = '${i[0].GIS_LINK}'`;let r=T.createQuery();r.where=e,r.returnGeometry=!0,r.returnHiddenFields=!0,r.outFields=["*"],T.queryFeatures(r).then(e=>{let t=e.features[0].geometry;detailsGeometry=t,targetExtent=t,targetExtent.extent.expand(4);const r=new o({geometry:detailsGeometry,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:n});x.graphics.addMany([r]),L&&x.goTo({target:t}).catch(function(e){"AbortError"!=e.name&&console.error(e)})})}}}(i,n),e.target.closest(".no-zoomto")&&(t=!1))})}function B(e,t,r,n,o,i){$("status-loader").show(),$("#results").empty();let{uniqueArray:a,seenIds:s}=function(e){let t=new Set,r=new Set,n=e.filter(e=>!!e.geometry&&(t.add(e.uniqueId),!0));return e.forEach(e=>{t.has(e.uniqueId)||(r.add(e.uniqueId),n.push(e))}),{uniqueArray:n,seenIds:t}}(I);var l;a=a.sort((e,t)=>{const r=e.owner?e.owner.toLowerCase():"",n=t.owner?t.owner.toLowerCase():"";return r.localeCompare(n)}),l=n,I.filter(e=>e.objectid===l).length>1&&(a=function(e,t,r,n){return"yes"===sessionStorage.getItem("condos")?($(`li[object-id="${t}"]`).remove(),e.filter(e=>e.objectid!==t)):($(`li[data-id="${n}"]`).remove(),e.filter(e=>e.GIS_LINK!==n))}(a,n,0,i)),function(e){const t=document.getElementById("results"),r=document.createElement("ul");let n,o;1==e.length&&(L=!1),e.forEach(function(e){let t=e.objectid,i=e.location,a=void 0===e.uniqueId?e.GIS_LINK:e.uniqueId,s=e.GIS_LINK,l=e.coOwner,c=e.owner,d=e.MBL,u=e.geometry,m=e.Parcel_Type;"yes"===g.useUniqueIdforParcelMap?(n=a,o=a):(n=s,o=s);let p=e.Image_Path,h=void 0===e.AcctNum?"":e.AcctNum;const f=`${g.imageUrl}${p}`;r.classList.add("row"),r.classList.add("list-group");const y=document.createElement("li"),b=document.createElement("li"),w=document.createElement("tr");w.classList.add("col-12","list-group-item");let I,L,$=`<div class="extra-links">\n            <a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=https://publicweb-gis.s3.amazonaws.com/PDFs/${g.parcelMapUrl}/Quick_Maps/QM_${o}.pdf><span style="font-family:Tahoma;font-size:12px;"><strong>PDF Map</strong></a>`;"yes"==g.propertyCardPdf?$+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${g.propertyCard}${a}.PDF><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></a>`:$+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${g.propertyCard}${a}><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></a>`,"yes"===g.useVisionForTaxBillUrl?$+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${g.tax_bill}&amp;uniqueId=${h}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`:$+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${g.tax_bill}&amp;uniqueId=${a}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`,"yes"===g.includePermitLink&&($+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${g.permitLink}?uniqueid=${a} ><span style="font-family:Tahoma;font-size:12px;"><strong>Permits</strong></a>`),$+="</div>",w.innerHTML=$,b.innerHTML=`<img class="img-search image" object-id="${t}" src="${f}" alt="Image of ${a}" >`,y.classList.add("list-group-item","col-9"),y.classList.add("search-list"),b.setAttribute("object-id",t),b.setAttribute("data-id",s),b.classList.add("image-div","col-3"),L="yes"===sessionStorage.getItem("No geometry"),!l&&u||u?I=` <div class="listText">UID: ${a}  &nbsp;<br>MBL: ${d} <br> ${c} ${l} <br> ${i} <br> Property Type: ${m}</div>\n            <div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justZoom" title="Zoom to Parcel"><calcite-icon icon="magnifying-glass-plus" scale="s"/>Zoom</button></div>`:(I=` <div class="listText noGeometry">UID: ${a}  &nbsp;<br>MBL: ${d} <br> ${c} ${l} <br> ${i} <br> Property Type: ${m} \n             </div></div>`,y.classList.add("no-zoomto")),y.innerHTML+=I,y.setAttribute("object-id",t),y.setAttribute("data-id",s),r.appendChild(b),r.appendChild(y),r.appendChild(w)}),O(r),t.appendChild(r)}(a);W($(".action-btn").first().data("target")),searchResults=a.length,$("#total-results").html(searchResults+" results returned")}let A;function K(e,t,r,n){let i,a;if(e.features.length>0&&(i=e.features[0].attributes.Owner),"RESIDENT"!=i||r){A=n?e:e.features;let i,l,c=[];var s={type:"simple-fill",color:[127,42,145,.4],outline:{color:[127,42,145,.8],width:2}};if(r){i=e.features[0].attributes.OBJECTID,l=A[0].attributes.GIS_LINK;const r=new o({geometry:A[0].geometry,symbol:s,id:i});if(c.push(r),countCondos=I.filter(e=>e.GIS_LINK===l).length,a=x.graphics.some(e=>e.id===i),a){const e=x.graphics.findIndex(e=>e.id===i);x.graphics.removeAt(e);const t=m.findIndex(e=>e.id===i);1===m.length?m.splice(0,1):m.splice(t,1),0===m.length&&(DetailsHandle||(DetailsHandle=x.on("click",handleDetailsClick)),clickHandle&&(clickHandle?.remove(),clickHandle=null),clickHandle=x.on("click",P))}else t.addMany(c)}else if(n){A.filter(e=>e.geometry).forEach(e=>{const t=e.attributes.OBJECTID,r=new o({geometry:e.geometry,symbol:s,id:t});c.push(r)}),c.length>=1&&t.addMany(c),x.goTo({target:m,zoom:18})}else{let e;if(regSearch=!0,A.map(function(t){if(i=t.attributes.OBJECTID,!t.geometry||n)return null;e=new o({geometry:t.geometry,symbol:s,id:i}),c.push(e)}).filter(e=>null!==e),1==c.length){t.addMany(c);const e=A[0].geometry.extent,r=(e.center,2);e.expand(r);x.goTo({target:c})}else if(t.addMany(c),c.length>0){const e=c.map(e=>e.geometry.extent),t=3;e.reduce((e,t)=>e.union(t),e[0]).expand(t);x.goTo({polygonGraphics2:c}).catch(e=>{console.error("Error zooming to extent:",e)})}else console.warn("No graphics available to calculate extent.")}if(m||(m=c),r&&!a){let e=c[0].id;m=[...m,c[0]],removeFromList=e}regSearch&&(m=c),a=!1,regSearch=!1}}function N(e,t,r,n){let o,i,a,s=!1;function l(e){e.forEach(function(e){(""!==e.attributes.Owner&&"RESIDENT"!==e.attributes.Owner||lasso||s)&&F(e)})}if(r&&null!=r&&e[0]){s=!0,o=e[0].attributes.OBJECTID,i=e[0].attributes.Location,a=e[0].attributes.GIS_LINK;const t=I.filter(e=>e.objectid===o).length,r=I.filter(e=>e.GIS_LINK===a).length;t>=1||0==t&&r>=1?(l(e),B(0,0,0,o,0,a)):(l(e),B())}else e?(e.length,l(e)):B(0,0,0,o);r||B(0,0,0,o,0,a)}function D(e,t,r){let n=e;if(n.length<=0)return H(),void alert("Search resulted in an error, please try again.");n[0].attributes.Uniqueid,n[0].attributes.OBJECTID;!function(e){x.graphics.removeAll(m);let t=e[0].geometry,r=e[0].attributes.GIS_LINK;if(E=!0,t){targetExtent=t,detailsGeometry=t;const e=2,r=(targetExtent.extent.expand(e),new o({geometry:t,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}}}));if(x.graphics.addMany([r]),!L)return;x.goTo({target:t}).catch(function(e){"AbortError"!=e.name&&console.error(e)})}else{let e=`GIS_LINK = '${r}'`,t=T.createQuery();t.where=e,t.returnGeometry=!0,t.returnHiddenFields=!0,t.outFields=["*"],T.queryFeatures(t).then(e=>{let t=e.features[0].geometry;targetExtent=t,detailsGeometry=t,targetExtent.extent.expand(2);const r=new o({geometry:detailsGeometry,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:bufferGraphicId});x.graphics.addMany([r]),L&&x.goTo({target:t}).catch(function(e){"AbortError"!=e.name&&console.error(e)})})}}(n),urlBackButton=!0,v=!1,u=!1,$(".spinner-container").hide()}function R(e,t,r){let n,o,i;"no"===sessionStorage.getItem("condos")?T.visible=!0:S.visible=!0,$(".spinner-container").show(),n=`\n          Street_Name LIKE '%${e}%' OR \n          MBL LIKE '%${e}%' OR \n          Location LIKE '%${e}%' OR \n          Co_Owner LIKE '%${e}%' OR \n          Uniqueid LIKE '%${e}%' OR \n          Owner LIKE '%${e}%' OR \n          GIS_LINK LIKE '%${e}%'\n      `,r?o=r:u&&(o=r,tableSearch=!0),"no"===sessionStorage.getItem("condos")?T.queryFeatures(o).then(function(e){if(i=e.features,e.features.length>=0)if(i=e.features,noCondosParcelGeom=e.features,v){let e="",r="";const n=C.createQuery();n.where=o.where,n.returnGeometry=!1,n.outFields=["*"],C.queryFeatures(n).then(function(t){e=t.features;const r=t.features[0].attributes.GIS_LINK;let n=T.createQuery();return n.where=`GIS_LINK = '${r}'`,n.returnGeometry=!0,n.returnHiddenFields=!0,n.outFields=["*"],T.queryFeatures(n)}).then(function(n){i=n.features,r=n.features,noCondosParcelGeom=n.features,K(n,x.graphics,""),N(n.features),t&&setTimeout(()=>{D(e)},200)}).catch(function(e){console.error("Error querying features: ",e)})}else noCondosParcelGeom=e.features,K(e,x.graphics,""),N(e.features),t&&setTimeout(()=>{D(i)},200),v=!1;else if(1===e.features.length&&I.length>2){const e=C.createQuery();e.where=n,e.returnGeometry=!1,e.outFields=["*"],C.queryFeatures(e).then(function(e){K(e.features),N(),t&&setTimeout(()=>{D(i)},200)})}else{const n=C.createQuery();n.where=r.where,n.returnGeometry=!1,n.outFields=["*"],0==e.features.length&&C.queryFeatures(n).then(function(e){i=e.features,GISLINK=e.features[0].attributes.GIS_LINK;e.features[0].attributes.Uniqueid;noCondosParcelGeom=e.features,K(e,x.graphics),N(e.features),t&&setTimeout(()=>{needToSearchGisLink=!0,D(i)},200)})}}):S.queryFeatures(o).then(function(e){if(i=e.features,e.features.length>0){e.features[0].attributes.Uniqueid;K(e,x.graphics,""),t&&setTimeout(()=>{D(i)},200)}N(e.features)})}k.addEventListener("click",e=>{e.stopPropagation();const t=q.classList.toggle("open");k.setAttribute("aria-expanded",String(t))}),document.addEventListener("click",()=>{q.classList.remove("open"),k.setAttribute("aria-expanded","false")}),document.addEventListener("keydown",e=>{"Escape"===e.key&&(q.classList.remove("open"),k.setAttribute("aria-expanded","false"))}),q.querySelectorAll(".dropdown-item").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const r=e.dataset.action;console.log("clicked:",r),q.classList.remove("open"),k.setAttribute("aria-expanded","false")})}),x.on("click",P),n.watch(()=>[x.zoom,x.extent,x.scale],([e,t,r],[n])=>(e?(e!==w&&(w=e),T.visible||S.visible||Number(e)>g.parcelZoom&&("no"===sessionStorage.getItem("condos")?T.visible=!0:S.visible=!0)):n&&(y=t,b=r,w=e),"")),$("#layerList").on("click",".layer-vis",function(e){e.preventDefault(),function(e,t){let r=_.findLayerById(e);r&&(r.visible=!r.visible,"group"===r.type&&r.layers.forEach(e=>{e.visible=r.visible}),t.attr("icon",r.visible?"check-square":"square"))}($(this).closest("calcite-list-item").attr("value"),$(this))}),$(document).ready(function(){$("body").on("click",".toggle-slider",function(){$(this).closest("calcite-list-item").find(".opacity-div").toggle()})}),x.when(function(){var e=$("#layerList");M(_.layers.items,e),$(".slider-opacity").on("calciteSliderChange",function(e){const t=e.target.id;let r=_.findLayerById(t),n=e.target.value/100;r.opacity=n})}),x.when(()=>{new a({view:x,container:$(".basemaps")[0],dragEnabled:!0}).visibleElements={statusIndicators:!0,baseLayers:!0,referenceLayers:!1,referenceLayersTitle:!1,errors:!0,heading:!1};let e={type:"simple",symbol:{type:"simple-fill",color:[255,255,255,.1],outline:{width:1,color:"#17ed3bff"}}},t={type:"simple",symbol:{type:"simple-fill",color:[255,255,255,.1],outline:{width:1,color:"#897044"}}};x.map.allLayers.forEach(e=>{"Parcel Boundaries"===e.title&&(originalRenderer=e.renderer)});const r=["Aerial-Ortho 2023","Aerial-Ortho 2019","Aerial-Ortho 2016","Aerial-Ortho 2012"];x.map.allLayers.some(e=>r.includes(e.title)&&e.visible)&&x.map.allLayers.forEach(t=>{"Parcel Boundaries"===t.title&&(t.renderer=e)}),"no"===sessionStorage.getItem("condos")?originalRenderer=T.renderer:originalRenderer=S.renderer;const o={};x.map.basemap.baseLayers.forEach(e=>{o[e.id]=e.visible});const i=[];function s(r,n){let o=r.find(e=>e.visible&&!n[e.id]);if(o)r.forEach(e=>{e!==o&&(e.visible=!1)}),o.title!==`${g.basemapTitle}`&&"Washington Basemap"!==o.title?"no"===sessionStorage.getItem("condos")?T.renderer=e:S.renderer=e:x.map.allLayers.forEach(e=>{console.log(e),console.log("reverting renderer"),"Parcel Boundaries"===e.title&&(e.renderer=t)});else{0===r.filter(e=>e.visible).length&&r.forEach(e=>{e.visible=n[e.id]})}r.forEach(e=>{n[e.id]=e.visible})}x.map.basemap.baseLayers.forEach(e=>{const t=n.watch(()=>e.visible,()=>{s(x.map.basemap.baseLayers,o)});i.push(t)}),n.watch(()=>x.map.basemap,()=>{s(x.map.basemap.baseLayers,o)})});const U=e=>{let t;I=[],$("#suggestions").val("").html("");let r=p;if(!(r?.length<3)&&r||u){let n;u?n=e:(n=G.createQuery(),n.where=`\n              Street_Name LIKE '%${r}%' OR \n              MBL LIKE '%${r}%' OR \n              Location LIKE '%${r}%' OR \n              Co_Owner LIKE '%${r}%' OR \n              Uniqueid LIKE '%${r}%' OR \n              Owner LIKE '%${r}%' OR\n              GIS_LINK LIKE '%${r}%'\n            `,n.returnGeometry=!1,n.returnHiddenFields=!0,n.outFields=["*"]),G.queryFeatures(n).then(o=>{if(o.features.length>0){t=o.features,"MISMATCH"===o.features[0].attributes.Match_Status&&"Condominium"===o.features[0].attributes.Parcel_Type&&(v=!0),t.forEach(function(e){const t=function(e,t){const r=t.attributes?.Location;return r.includes(e)}(r,e);""===e.attributes.Owner||"RESIDENT"===e.attributes.Owner&&!t||F(e)});let i=function(){let e;return"no"===sessionStorage.getItem("condos")?(e=T.createQuery(),e.where="1=1",e.returnDistinctValues=!1,e.returnGeometry=!0,e.outFields=["*"]):(e=S.createQuery(),e.where="1=1",e.returnDistinctValues=!1,e.returnGeometry=!0,e.outFields=["*"]),e}(),a=null;u&&(i.where=e.where,a=!0);const s=function(e){let t;return"no"===sessionStorage.getItem("condos")?(t=T.createQuery(),t.where=e.where,t.returnDistinctValues=!1,t.returnGeometry=!0,t.outFields=["*"]):(t=S.createQuery(),t.where=e.where,t.returnDistinctValues=!1,t.returnGeometry=!0,t.outFields=["*"]),t}(n);R(p,a,s)}}).catch(e=>{console.error("Error querying for details:",e)})}else H()};function H(e,t){const r=function(e,t){let r,n=t.split("?")[0],o=[],i=-1!==t.indexOf("?")?t.split("?")[1]:"";if(""!==i){o=i.split("&");for(let t=o.length-1;t>=0;t-=1)r=o[t].split("=")[0],r===e&&o.splice(t,1);n=n+"?"+o.join("&")}return n}("uniqueid",window.location.href);window.history.pushState({path:r},"",r),"no"===sessionStorage.getItem("condos")?T.visible=!0:S.visible=!0,p="",$("#searchInput ul").remove(),$("#searchInput").val="",$("#results").empty(),$("#total-results").html("No Parcels Selected");document.getElementById("searchInput").value="",searchTerm="",I=[],secondList=[],zoomToObjectID="",u=!1,v=!1,L=!0,E=!1,$(".spinner-container").hide(),$("#dropdown").hide(),$("#suggestions").hide(),$("#closed").show(),$("#open").hide(),$(".content").hide(),$(".content > div").hide(),V=null,document.getElementById("suggestions").innerHTML="",x.graphics.removeAll(),m=[]}document.getElementById("searchInput").addEventListener("input",function(e){e.preventDefault(),I=[],secondList=[],m=[],x.graphics.removeAll(),$("#suggestions").html(""),p=e.target.value.toUpperCase().replace(/&amp;/g,"&"),p.length>1?function(e){const t=["Street_Name","MBL","Location","Co_Owner","Uniqueid","Owner","GIS_LINK"];$("#searchInput ul").remove(),$("#suggestions").hide(),$("#dropdown").show();let r=`\n            Street_Name LIKE '%${e}%' OR \n            MBL LIKE '%${e}%' OR \n            Location LIKE '%${e}%' OR \n            Co_Owner LIKE '%${e}%' OR \n            Uniqueid LIKE '%${e}%' OR \n            Owner LIKE '%${e}%' OR\n            GIS_LINK LIKE '%${e}%'\n        `,n=C.createQuery();n.where=r,n.returnGeometry=!1,n.outFields=t;let o=new Set;C.queryFeatures(n).then(r=>{let n=document.getElementById("suggestions");n.innerHTML="",r.features.forEach(r=>{t.forEach(t=>{let i=r.attributes[t];if(i&&i.includes(e)&&!o.has(i)){let e=document.createElement("div");e.className="list-group-item",e.innerText=`${i}`,n.appendChild(e),o.add(i),n.style.display="block",e.addEventListener("click",function(e){f=!0;let t=e.target.textContent;f&&(p=t.replace(/&amp;/g,"&"),U()),f=!1})}})})})}(p):$("#suggestions").hide()}),document.addEventListener("click",function(e){"searchInput"!==e.target.id&&(document.getElementById("suggestions").style.display="none")}),c.addEventListener("click",function(){H()}),$("#home").on("click",function(e){x.goTo(g.homeExtent)});let j=new l({view:x,graphic:new o({symbol:{type:"simple-marker"}})});window._widgets={locateWidget:j},$("#locate").on("click",function(e){e.stopPropagation(),window._widgets?.locateWidget?.locate()});const Q=function(){const e={},t=window.location.search.substring(1).split("&");for(let r=0;r<t.length;r++){const n=t[r].split("=");n[0]&&n[1]&&(e[decodeURIComponent(n[0])]=decodeURIComponent(n[1].replace(/\+/g," ")))}return e}().uniqueid;let z,Z=`Uniqueid = '${Q}'`;Q&&(u=!0,x.when(function(){query=G.createQuery(),query.where=Z,query.returnGeometry=!1,query.returnHiddenFields=!0,query.outFields=["*"],query=G.createQuery(),query.where=Z,query.returnGeometry=!1,query.returnHiddenFields=!0,query.outFields=["*"],C.queryFeatures(query).then(e=>{let t=e.features[0].attributes,r=t.Building_Type;"MISMATCH"===t.Match_Status&&"Condominium"===r&&(v=!0),U(query)})}).catch(function(e){console.error("Error occurred while the view was loading: ",e)})),document.getElementById("searchButton").addEventListener("click",function(e){e.preventDefault(),clearTimeout(z),z=setTimeout(()=>{"no"===sessionStorage.getItem("condos")?T.visible=!0:S.visible=!0,$("dropdown").empty(),$("#total-results").show(),$("#ResultDiv").hide(),m=[],x.graphics.removeAll(),U()},300)});let V=null;function W(e){const t=$("#action-exp");V===e&&$(e).is(":visible")?($(".content").hide(),$(".content > div").hide(),V=null,t.attr("aria-expanded","false")):($(".content").show(),$(".content > div").hide(),$(e).show(),V=e,t.attr("aria-expanded","true"))}$(".action-btn").click(function(){const e=$(this).data("target");".help"!=e&&".report"!=e&&W(e)}),$("#action-exp").click(function(){if(V)W(V);else{W($(".action-btn").first().data("target"))}})})});
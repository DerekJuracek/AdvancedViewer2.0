// @ts-nocheck
require(["esri/WebMap","esri/views/MapView","esri/layers/FeatureLayer","esri/core/reactiveUtils","esri/Graphic","esri/layers/GraphicsLayer","esri/widgets/BasemapLayerList","esri/widgets/Legend"],(function(e,t,r,a,i,n,s,o){const l=new URLSearchParams(window.location.search);let c=window.location.href,u=l.get("viewer");let d=["colebrookct","columbiact","durhamct","franklinct","haddamct","northcanaanct","roxburyct","roxburyctassessor","scotlandct","warrenct","warrenctassessor","washingtonct","wiltonct","wolcottct"].join("|"),m=new RegExp(`\\?viewer=cama\\/(${d})(\\&\\w+=[\\w-]+)*$`);null!=u&&m.test(c)?(u+=".json",console.log(u)):"https://terrenogis.com"===window.location.href||"https://terrenogis.com/"===window.location.href?window.location.href="https://www.qds.biz/gis-service":window.location.href="./onload.html";const p={mapId:"",condoLayer:"",title:"",isCondosLayer:"",noCondoLayer:""};console.log(u),fetch(u).then((e=>e.json())).then((a=>{p.mapId=a.webmapId||"6448b08504de4244973a28305b18271f",p.condoLayer=a.condoLayer,p.noCondoLayer=a.noCondoLayer,p.title=a.title,p.isCondosLayer=a.condos,p.masterTable=a.masterTable,p.zoom=a.zoom,p.parcelZoom=a.parcelZoom,p.imageUrl=a.imageUrl,p.welcomeImage=a.welcomeImage,p.pdf_Image=a.pdf_Image,p.pdf_demo=a.pdf_demographics,p.taxMap_Url=a.taxMapUrl,p.parcelMapUrl=a.parcelMapUrl,p.housingUrl=a.housingUrl,p.propertyCardPdf=a.propertyCardPdf,p.propertyCard=a.propertyCard,p.tax_bill=a.tax_bill,p.useVisionForTaxBillUrl=a.useVisionForTaxBillUrl,p.accessorName=a.accessorName,p.parcelTitle=a.parcelServiceTitle,p.tabTitle=a.tabTitle,p.basemapTitle=a.basemapTitle,p.parcelRenderer=a.parcelRenderer,p.useUniqueIdforParcelMap=a.useUniqueIdforParcelMap,p.helpUrl=a.helpUrl,p.includeFilter=a.includeFilter,p.customWelcomePage=a.customWelcomePage,p.customWelcomeMessage=a.customWelcomeMessage,p.showDisclaimer=a.showDisclaimer,p.customDisclaimerPage=a.customDisclaimerPage,p.customDisclaimerMessage=a.customDisclaimerMessage,p.DetailLinks=a.DetailLinks,p.DetailLinksToInclude=a.DetailLinksToInclude,p.includePermitLink=a.includePermitLink,p.scale=a.scale,$(".help-url").attr("href",p.helpUrl),document.getElementById("title").innerHTML=p.title;const i=document.getElementById("clear-btn"),s=new n;let o,l,c,u=[];const d=new e({portalItem:{id:p.mapId},layers:[s]});var m=new t({container:"viewDiv",map:d,units:"imperial",scale:p.scale,popupEnabled:!1,ui:{components:["attribution"]}});m.when((()=>{p.homeExtent=m.extent}));const g=new r({url:`${p.masterTable}`}),b=new r({url:`${p.masterTable}`});function h(e){let t=e.attributes.OBJECTID,r=e.attributes.Location,a=e.attributes.Uniqueid,i=e.attributes.GIS_LINK,n=e.attributes.Co_Owner,s=e.attributes.Owner,o=e.attributes.MBL,l=e.geometry,c=e.attributes.Mailing_Address_1,d=e.attributes.Mailing_Address_2,m=e.attributes.Mailing_City,p=e.attributes.Mail_State,g=e.attributes.Mailing_Zip,b=e.attributes.Total_Acres,h=e.attributes.Parcel_Primary_Use,w=e.attributes.Building_Use_Code,L=e.attributes.Parcel_Type,y=e.attributes.Design_Type,I=e.attributes.Zoning,_=e.attributes.Neighborhood,f=e.attributes.Land_Type_Rate,T=e.attributes.Functional_Obs,E=e.attributes.External_Obs,$=e.attributes.Sale_Date,M=(v=new Date($),C=v.getDate(),v.getMonth()+1+"/"+C+"/"+v.getFullYear());var v,C;let O=e.attributes.Sale_Price,U=e.attributes.Vol_Page,P=e.attributes.Assessed_Total,B=e.attributes.Appraised_Total,R=e.attributes.Influence_Factor,S=e.attributes.Influence_Type,D=e.attributes.Land_Type,K=e.attributes.Prior_Assessment_Year,k=e.attributes.Prior_Assessed_Total,N=e.attributes.Prior_Appraised_Total,x=e.attributes.Map,q=e.attributes.Lat,A=e.attributes.Lon,F=e.attributes.Image_Path,G=e.attributes.AcctNum,H=e.attributes.Match_Status,W=e.attributes.ACCOUNT_TYPE;u.push(new Parcel(t,r,a,i,n,s,o,l,c,d,m,p,g,b,h,w,L,y,I,_,f,T,E,M,O,U,P,B,R,S,D,K,k,N,x,q,A,F,G,H,W))}const w=()=>{let e;u=[],document.getElementById("suggestions").innerHTML="";let t=c;if(t?.length<3&&!t)L();else{let r;$("#dropdown").toggleClass("expanded"),o?r=filterQuery:(r=g.createQuery(),r.where=`\n              Street_Name LIKE '%${t}%' OR \n              MBL LIKE '%${t}%' OR \n              Location LIKE '%${t}%' OR \n              Co_Owner LIKE '%${t}%' OR \n              Uniqueid LIKE '%${t}%' OR \n              Owner LIKE '%${t}%' OR\n              GIS_LINK LIKE '%${t}%'\n            `,r.returnGeometry=!1,r.returnHiddenFields=!0,r.outFields=["*"]),g.queryFeatures(r).then((r=>{r.features.length>0&&(e=r.features,"MISMATCH"===r.features[0].attributes.Match_Status&&"Condominium"===r.features[0].attributes.Parcel_Type&&(triggerfromNoCondos=!0),e.forEach((function(e){const r=function(e,t){const r=t.attributes?.Location;return r.includes(e)}(t,e);""===e.attributes.Owner||"RESIDENT"===e.attributes.Owner&&!r||h(e)})),queryRelatedRecords(c,tableSearch,query2))})).catch((e=>{console.error("Error querying for details:",e)}))}};function L(e,t){const r=window.location.href,a=removeQueryParam("uniqueid",r);window.history.pushState({path:a},"",a),"no"===sessionStorage.getItem("condos")?noCondosLayer.visible=!0:CondosLayer.visible=!0,c="",$("#searchInput ul").remove(),$("#searchInput").val="",$("#select-button").prop("disabled",!1);document.getElementById("searchInput").value="",searchTerm="",u=[],secondList=[],zoomToObjectID="",o=!1,triggerfromNoCondos=!1,$(".spinner-container").hide(),$("#dropdown").hide(),urlBackButton=!1,document.getElementById("suggestions").innerHTML="",detailsHandleUsed,m.graphics.removeAll(),l=[]}document.getElementById("searchInput").addEventListener("input",(function(e){u=[],secondList=[],l=[],m.graphics.removeAll(),$("#suggestions").html(""),c=e.target.value.toUpperCase().replace(/&amp;/g,"&"),function(e){const t=["Street_Name","MBL","Location","Co_Owner","Uniqueid","Owner","GIS_LINK"];$("#searchInput ul").remove(),$("#suggestions").hide(),$("#dropdown").show();let r=`\n            Street_Name LIKE '%${e}%' OR \n            MBL LIKE '%${e}%' OR \n            Location LIKE '%${e}%' OR \n            Co_Owner LIKE '%${e}%' OR \n            Uniqueid LIKE '%${e}%' OR \n            Owner LIKE '%${e}%' OR\n            GIS_LINK LIKE '%${e}%'\n        `,a=b.createQuery();a.where=r,a.returnGeometry=!1,a.outFields=t;let i=new Set;b.queryFeatures(a).then((r=>{let a=document.getElementById("suggestions");a.innerHTML="",r.features.forEach((r=>{t.forEach((t=>{let n=r.attributes[t];if(n&&n.includes(e)&&!i.has(n)){let e=document.createElement("div");e.className="list-group-item",e.innerText=`${n}`,a.appendChild(e),i.add(n),a.style.display="block",e.addEventListener("click",(function(e){clickedToggle=!0,w(e.target.innerHTML),clickedToggle=!1}))}}))}))}))}(c)})),document.addEventListener("click",(function(e){"searchInput"!==e.target.id&&(document.getElementById("suggestions").style.display="none")})),i.addEventListener("click",(function(){L()})),document.getElementById("searchButton").addEventListener("click",(function(){$("#results-div").css("left","0px"),clearTimeout(debounceTimer2),debounceTimer2=setTimeout((()=>{"no"===sessionStorage.getItem("condos")?noCondosLayer.visible=!0:CondosLayer.visible=!0,$("dropdown").empty(),$("#total-results").show(),$("#ResultDiv").hide(),l=[],m.graphics.removeAll(),w()}),300)}))}))}));
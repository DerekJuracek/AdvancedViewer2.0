// @ts-nocheck
require(["esri/WebMap","esri/views/MapView","esri/layers/FeatureLayer","esri/core/reactiveUtils","esri/Graphic","esri/layers/GraphicsLayer","esri/widgets/BasemapLayerList"],(function(e,t,r,i,n,o,a){const s=new URLSearchParams(window.location.search);let l=window.location.href,c=s.get("viewer");let d=["colebrookct","columbiact","durhamct","franklinct","haddamct","northcanaanct","roxburyct","roxburyctassessor","scotlandct","warrenct","warrenctassessor","washingtonct","wiltonct","wolcottct"].join("|"),u=new RegExp(`\\?viewer=cama\\/(${d})(\\&\\w+=[\\w-]+)*$`);null!=c&&u.test(l)?c+=".json":"https://terrenogis.com"===window.location.href||"https://terrenogis.com/"===window.location.href?window.location.href="https://www.qds.biz/gis-service":window.location.href="./onload.html";const m={mapId:"",condoLayer:"",title:"",isCondosLayer:"",noCondoLayer:""};fetch(c).then((e=>e.json())).then((s=>{m.mapId=s.webmapId||"6448b08504de4244973a28305b18271f",m.condoLayer=s.condoLayer,m.noCondoLayer=s.noCondoLayer,m.title=s.title,m.isCondosLayer=s.condos,m.masterTable=s.masterTable,m.zoom=s.zoom,m.parcelZoom=s.parcelZoom,m.imageUrl=s.imageUrl,m.welcomeImage=s.welcomeImage,m.pdf_Image=s.pdf_Image,m.pdf_demo=s.pdf_demographics,m.taxMap_Url=s.taxMapUrl,m.parcelMapUrl=s.parcelMapUrl,m.housingUrl=s.housingUrl,m.propertyCardPdf=s.propertyCardPdf,m.propertyCard=s.propertyCard,m.tax_bill=s.tax_bill,m.useVisionForTaxBillUrl=s.useVisionForTaxBillUrl,m.accessorName=s.accessorName,m.parcelTitle=s.parcelServiceTitle,m.tabTitle=s.tabTitle,m.basemapTitle=s.basemapTitle,m.parcelRenderer=s.parcelRenderer,m.useUniqueIdforParcelMap=s.useUniqueIdforParcelMap,m.helpUrl=s.helpUrl,m.includeFilter=s.includeFilter,m.customWelcomePage=s.customWelcomePage,m.customWelcomeMessage=s.customWelcomeMessage,m.showDisclaimer=s.showDisclaimer,m.customDisclaimerPage=s.customDisclaimerPage,m.customDisclaimerMessage=s.customDisclaimerMessage,m.DetailLinks=s.DetailLinks,m.DetailLinksToInclude=s.DetailLinksToInclude,m.includePermitLink=s.includePermitLink,m.scale=s.scale,$(".help-url").attr("href",m.helpUrl);const l=document.getElementById("clear-btn"),c=new o;let d,u,p,g,f,h,y,b,I=[],L=!1;const w=new e({portalItem:{id:m.mapId},layers:[c]});var v=new t({container:"viewDiv",map:w,units:"imperial",scale:m.scale,popupEnabled:!1,ui:{components:["attribution"]}});v.when((()=>{m.homeExtent=v.extent}));const E=new r({url:`${m.noCondoLayer}`,visible:!1,popupEnabled:!0,title:"Parcel Boundaries",id:"noCondoLayer"}),_=new r({url:`${m.condoLayer}`,visible:!1,popupEnabled:!0,title:"Parcel Boundaries",id:"condoLayer"}),x=new r({url:`${m.masterTable}`}),T=new r({url:`${m.masterTable}`});function C(e,t){e.forEach((function(e){if("group"===e.type){if(e.title&&"hidden group"===e.title.toLowerCase())return;var r=e.title||"Industry",i=$(`\n              <calcite-accordion scale="m">\n                <calcite-accordion-item heading="${r}">\n                </calcite-accordion-item>\n              </calcite-accordion>`);C(e.layers.items,i.find("calcite-accordion-item")),t.append(i)}else!function(e,t){let r;if(r="yes"===sessionStorage.getItem("condos")?"noCondoLayer":"condoLayer","graphics"!==e.type&&"Tax Map Annotation"!=e.title&&"Road Centerline"!=e.title&&null!=e.title&&""!=e.title&&e.id!=r){var i;i=e.visible?"check-square":"square";var n=$(`\n          <calcite-list-item scale="m" label="${e.title}" value="${e.id}" style="border: white 0.5px solid;">\n          <calcite-action class="toggle-slider" id="action-${e.id}-dropdown" slot="actions-end" icon="sliders-horizontal" text="${e.title}"></calcite-action>\n            <calcite-action class="layer-vis" id="action-${e.id}" slot="actions-end" icon="${i}" text="${e.title}"></calcite-action>\n            <div id="opacityDiv-${e.id}" class="esri-slider esri-widget esri-slider--horizontal opacity-div " touch-action="none" style="display: none; height: 45px; align-items: center; padding-bottom: 10px; padding-left: 10px;">\n              <label style="margin-right: 10px; padding-top: 20px; font-weight: 500;font-size: 12px;">Layer Opacity (%)</label>\n              <calcite-slider class="slider-opacity" id="${e.id}" style="width: 50%;" value="100" label-handles max-label="100" max-value="100" min-label="0"></calcite-slider>\n              </calcite-slider>\n            </div>\n          </calcite-list-item>\n      `);t.append(n)}}(e,t)}))}function S(e){let t=e.attributes.OBJECTID,r=e.attributes.Location,i=e.attributes.Uniqueid,n=e.attributes.GIS_LINK,o=e.attributes.Co_Owner,a=e.attributes.Owner,s=e.attributes.MBL,l=e.geometry,c=e.attributes.Mailing_Address_1,d=e.attributes.Mailing_Address_2,u=e.attributes.Mailing_City,m=e.attributes.Mail_State,p=e.attributes.Mailing_Zip,g=e.attributes.Total_Acres,f=e.attributes.Parcel_Primary_Use,h=e.attributes.Building_Use_Code,y=e.attributes.Parcel_Type,b=e.attributes.Design_Type,L=e.attributes.Zoning,w=e.attributes.Neighborhood,$=e.attributes.Land_Type_Rate,v=e.attributes.Functional_Obs,E=e.attributes.External_Obs,_=e.attributes.Sale_Date,x=(T=new Date(_),C=T.getDate(),T.getMonth()+1+"/"+C+"/"+T.getFullYear());var T,C;let S=e.attributes.Sale_Price,G=e.attributes.Vol_Page,M=e.attributes.Assessed_Total,P=e.attributes.Appraised_Total,O=e.attributes.Influence_Factor,k=e.attributes.Influence_Type,B=e.attributes.Land_Type,K=e.attributes.Prior_Assessment_Year,q=e.attributes.Prior_Assessed_Total,N=e.attributes.Prior_Appraised_Total,D=e.attributes.Map,F=e.attributes.Lat,A=e.attributes.Lon,R=e.attributes.Image_Path,U=e.attributes.AcctNum,z=e.attributes.Match_Status,j=e.attributes.ACCOUNT_TYPE;I.push(new Parcel(t,r,i,n,o,a,s,l,c,d,u,m,p,g,f,h,y,b,L,w,$,v,E,x,S,G,M,P,O,k,B,K,q,N,D,F,A,R,U,z,j))}function G(e){e.addEventListener("click",(function(e){let t=!0;if(e.target.closest(".justZoom")||e.target.closest(".justZoomBtn")||e.target.closest(".pdf-links"))return;$("#select-button").attr("title","Select Enabled");let r=e.target.closest("li");if(!r)return;let i=r.getAttribute("data-id");!function(e,t,r){v.graphics.removeAll(u),detailsChanged={isChanged:!1,item:""},g=[];let i="uniqueBufferGraphicId";const o=v.graphics.items.findIndex((e=>e.id===i));if(o>-1&&v.graphics.removeAt(o),g=I.filter((e=>e.GIS_LINK==t)),"no"==sessionStorage.getItem("condos")&&g.length==I.length&&g.length>1)if(noCondosParcelGeom){CondoBuffer=!1,targetExtent=noCondosParcelGeom[0].geometry,detailsGeometry=noCondosParcelGeom[0].geometry;const e={type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},t=3,r=targetExtent.extent.expand(t),o=new n({geometry:targetExtent,symbol:e,id:i});v.graphics.addMany([o]),v.goTo({target:o,extent:r}).catch((function(e){"AbortError"!=e.name&&console.error(e)}))}else{let e=`GIS_LINK = '${t}'`,r=E.createQuery();r.where=e,r.returnGeometry=!0,r.returnHiddenFields=!0,r.outFields=["*"],E.queryFeatures(r).then((e=>{let t=e.features[0].geometry;targetExtent=t,detailsGeometry=t;const r=targetExtent.extent.expand(4);v.goTo({target:t,extent:r}).catch((function(e){"AbortError"!=e.name&&console.error(e)}));const o=new n({geometry:detailsGeometry,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:i});v.graphics.addMany([o])}))}else{let o;if(CondoBuffer=!0,o=r?I.filter((t=>t.uniqueId==e)):I.filter((t=>t.objectid==e)),o.length>0)if(null!=o[0].geometry&&""!=o[0].geometry){detailsGeometry=o[0].geometry;const e=4,t=detailsGeometry.extent.expand(e);v.goTo({target:detailsGeometry,extent:t}).catch((function(e){"AbortError"!=e.name&&console.error(e)}));const r=new n({geometry:detailsGeometry,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:i});v.graphics.addMany([r])}else{let e;CondoBuffer=!1,e=o.filter((e=>{e.GIS_LINK}))?`GIS_LINK = '${t}'`:`GIS_LINK = '${o[0].GIS_LINK}'`;let r=E.createQuery();r.where=e,r.returnGeometry=!0,r.returnHiddenFields=!0,r.outFields=["*"],E.queryFeatures(r).then((e=>{let t=e.features[0].geometry;detailsGeometry=t,targetExtent=t;const r=targetExtent.extent.expand(4);v.goTo({target:t,extent:r}).catch((function(e){"AbortError"!=e.name&&console.error(e)}));const o=new n({geometry:detailsGeometry,symbol:{type:"simple-fill",color:[0,0,0,.1],outline:{color:[145,199,61,1],width:4}},id:i});v.graphics.addMany([o])}))}}}(r.getAttribute("object-id"),i),$("#featureWid").hide(),e.target.closest(".no-zoomto")&&(console.log("dont zoom"),t=!1)}))}function M(e,t,r,i,n,o){$("status-loader").show(),$("#results").empty();let{uniqueArray:a,seenIds:s}=function(e){let t=new Set,r=new Set,i=e.filter((e=>!!e.geometry&&(t.add(e.uniqueId),!0)));return e.forEach((e=>{t.has(e.uniqueId)||(r.add(e.uniqueId),i.push(e))})),{uniqueArray:i,seenIds:t}}(I);var l;a=a.sort(((e,t)=>{const r=e.owner?e.owner.toLowerCase():"",i=t.owner?t.owner.toLowerCase():"";return r.localeCompare(i)})),l=i,I.filter((e=>e.objectid===l)).length>1&&(a=function(e,t,r,i){return"yes"===sessionStorage.getItem("condos")?($(`li[object-id="${t}"]`).remove(),e.filter((e=>e.objectid!==t))):($(`li[data-id="${i}"]`).remove(),e.filter((e=>e.GIS_LINK!==i)))}(a,i,0,o)),function(e){const t=document.getElementById("results"),r=document.createElement("ul");let i,n;e.forEach((function(e){let t=e.objectid,o=e.location,a=void 0===e.uniqueId?e.GIS_LINK:e.uniqueId,s=e.GIS_LINK,l=e.coOwner,c=e.owner,d=e.MBL,u=e.geometry,p=e.Parcel_Type;"yes"===m.useUniqueIdforParcelMap?(i=a,n=a):(i=s,n=s);let g=e.Image_Path,f=void 0===e.AcctNum?"":e.AcctNum;const h=`${m.imageUrl}${g}`;r.classList.add("row"),r.classList.add("list-group");const y=document.createElement("li"),b=document.createElement("li"),I=document.createElement("tr");I.classList.add("col-12","list-group-item");let L,w,$=`<div class="extra-links">\n            <a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=https://publicweb-gis.s3.amazonaws.com/PDFs/${m.parcelMapUrl}/Quick_Maps/QM_${n}.pdf><span style="font-family:Tahoma;font-size:12px;"><strong>PDF Map</strong></a>`;"yes"==m.propertyCardPdf?$+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${m.propertyCard}${a}.PDF><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></a>`:$+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${m.propertyCard}${a}><span style="font-family:Tahoma;font-size:12px;"><strong>Property Card</strong></a>`,"yes"===m.useVisionForTaxBillUrl?$+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${m.tax_bill}&amp;uniqueId=${f}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`:$+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${m.tax_bill}&amp;uniqueId=${a}><span style="font-family:Tahoma;font-size:12px;"><strong>Tax Bills</strong></span></a>`,"yes"===m.includePermitLink&&($+=`<a target="_blank" class='pdf-links mx-2' rel="noopener noreferrer" href=${m.permitLink}?uniqueid=${a} ><span style="font-family:Tahoma;font-size:12px;"><strong>Permits</strong></a>`),$+="</div>",I.innerHTML=$,b.innerHTML=`<img class="img-search image" object-id="${t}" src="${h}" alt="Image of ${a}" >`,y.classList.add("list-group-item","col-9"),y.classList.add("search-list"),b.setAttribute("object-id",t),b.setAttribute("data-id",s),b.classList.add("image-div","col-3"),w="yes"===sessionStorage.getItem("No geometry"),!l&&u||u?L=` <div class="listText">UID: ${a}  &nbsp;<br>MBL: ${d} <br> ${c} ${l} <br> ${o} <br> Property Type: ${p}</div>\n            <div class="justZoomBtn"><button type="button" class="btn btn-primary btn-sm justZoom" title="Zoom to Parcel"><calcite-icon icon="magnifying-glass-plus" scale="s"/>Zoom</button></div>`:(L=` <div class="listText noGeometry">UID: ${a}  &nbsp;<br>MBL: ${d} <br> ${c} ${l} <br> ${o} <br> Property Type: ${p} \n             </div></div>`,y.classList.add("no-zoomto")),y.innerHTML+=L,y.setAttribute("object-id",t),y.setAttribute("data-id",s),r.appendChild(b),r.appendChild(y),r.appendChild(I)})),G(r),t.appendChild(r)}(a);F($(".action-btn").first().data("target")),searchResults=a.length,$("#total-results").html(searchResults+" results returned")}let P;function O(e,t,r,i){let o,a;if(e.features.length>0&&(o=e.features[0].attributes.Owner),"RESIDENT"!=o||r){P=i?e:e.features;let o,l,c=[];var s={type:"simple-fill",color:[127,42,145,.4],outline:{color:[127,42,145,.8],width:2}};if(r){o=e.features[0].attributes.OBJECTID,l=P[0].attributes.GIS_LINK;const r=new n({geometry:P[0].geometry,symbol:s,id:o});if(c.push(r),countCondos=I.filter((e=>e.GIS_LINK===l)).length,a=v.graphics.some((e=>e.id===o)),a){const e=v.graphics.findIndex((e=>e.id===o));v.graphics.removeAt(e);const t=u.findIndex((e=>e.id===o));1===u.length?u.splice(0,1):u.splice(t,1),0===u.length&&(DetailsHandle||(DetailsHandle=v.on("click",handleDetailsClick)),clickHandle&&(clickHandle?.remove(),clickHandle=null),clickHandle=v.on("click",handleClick))}else t.addMany(c)}else if(i){P.filter((e=>e.geometry)).forEach((e=>{const t=e.attributes.OBJECTID,r=new n({geometry:e.geometry,symbol:s,id:t});c.push(r)})),c.length>=1&&t.addMany(c),v.goTo({target:u,zoom:18})}else{let e;if(regSearch=!0,P.map((function(t){if(o=t.attributes.OBJECTID,!t.geometry||i)return null;e=new n({geometry:t.geometry,symbol:s,id:o}),c.push(e)})).filter((e=>null!==e)),1==c.length){t.addMany(c);const e=P[0].geometry.extent,r=(e.center,2),i=e.expand(r);v.goTo({target:c,extent:i})}else if(t.addMany(c),c.length>0){const e=c.map((e=>e.geometry.extent)),t=3,r=e.reduce(((e,t)=>e.union(t)),e[0]).expand(t);v.goTo({target:r}).catch((e=>{console.error("Error zooming to extent:",e)}))}else console.warn("No graphics available to calculate extent.")}if(u||(u=c),r&&!a){let e=c[0].id;u=[...u,c[0]],removeFromList=e}regSearch&&(u=c),a=!1,regSearch=!1}else console.log("serach on resident not clicking")}function k(e,t,r,i){let n,o,a,s=!1;function l(e){e.forEach((function(e){(""!==e.attributes.Owner&&"RESIDENT"!==e.attributes.Owner||lasso||s)&&S(e)}))}if(r&&null!=r){s=!0,n=e[0].attributes.OBJECTID,o=e[0].attributes.Location,a=e[0].attributes.GIS_LINK;const t=I.filter((e=>e.objectid===n)).length,r=I.filter((e=>e.GIS_LINK===a)).length;t>=1||0==t&&r>=1?(l(e),M(0,0,0,n,0,a)):(l(e),M())}else e?(e.length,l(e)):M(0,0,0,n);r||M(0,0,0,n,0,a)}function B(e,t,r){let i,n,o;"no"===sessionStorage.getItem("condos")?E.visible=!0:_.visible=!0,$(".spinner-container").show(),i=`\n          Street_Name LIKE '%${e}%' OR \n          MBL LIKE '%${e}%' OR \n          Location LIKE '%${e}%' OR \n          Co_Owner LIKE '%${e}%' OR \n          Uniqueid LIKE '%${e}%' OR \n          Owner LIKE '%${e}%' OR \n          GIS_LINK LIKE '%${e}%'\n      `,r?n=r:d&&(n=r,tableSearch=!0),"no"===sessionStorage.getItem("condos")?E.queryFeatures(n).then((function(a){if(o=a.features,a.features.length>=0)if(o=a.features,noCondosParcelGeom=a.features,L){let r="",i="";const a=T.createQuery();a.where=n.where,a.returnGeometry=!1,a.outFields=["*"],T.queryFeatures(a).then((function(e){r=e.features;const t=e.features[0].attributes.GIS_LINK;let i=E.createQuery();return i.where=`GIS_LINK = '${t}'`,i.returnGeometry=!0,i.returnHiddenFields=!0,i.outFields=["*"],E.queryFeatures(i)})).then((function(n){o=n.features,i=n.features,noCondosParcelGeom=n.features,O(n,v.graphics,""),k(n.features),t&&setTimeout((()=>{triggerListGroup(r,i,e)}),200)})).catch((function(e){console.error("Error querying features: ",e)}))}else noCondosParcelGeom=a.features,O(a,v.graphics,""),k(a.features),t&&setTimeout((()=>{triggerListGroup(o,e)}),200),L=!1;else if(1===a.features.length&&I.length>2){const r=T.createQuery();r.where=i,r.returnGeometry=!1,r.outFields=["*"],T.queryFeatures(r).then((function(r){O(r.features),k(),t&&setTimeout((()=>{triggerListGroup(o,e)}),200)}))}else{const e=T.createQuery();e.where=r.where,e.returnGeometry=!1,e.outFields=["*"],0==a.features.length&&T.queryFeatures(e).then((function(e){o=e.features,GISLINK=e.features[0].attributes.GIS_LINK;let r=e.features[0].attributes.Uniqueid;noCondosParcelGeom=e.features,O(e,v.graphics),k(e.features),t&&setTimeout((()=>{needToSearchGisLink=!0,triggerListGroup(o,r)}),200)}))}})):_.queryFeatures(n).then((function(e){if(o=e.features,e.features.length>0){const r=e.features[0].attributes.Uniqueid;O(e,v.graphics,""),t&&setTimeout((()=>{triggerListGroup(o,r)}),200)}k(e.features)}))}h=v.extent,y=v.scale,b=v.zoom,i.watch((()=>[v.zoom,v.extent,v.scale]),(([e,t,r],[i])=>(e?(e!==b&&(b=e),E.visible||_.visible||Number(e)>m.parcelZoom&&("no"===sessionStorage.getItem("condos")?E.visible=!0:_.visible=!0)):i&&(h=t,y=r,b=e),""))),$("#layerList").on("click",".layer-vis",(function(e){e.preventDefault(),function(e,t){let r=w.findLayerById(e);r&&(r.visible=!r.visible,"group"===r.type&&r.layers.forEach((e=>{e.visible=r.visible})),t.attr("icon",r.visible?"check-square":"square"))}($(this).closest("calcite-list-item").attr("value"),$(this))})),$(document).ready((function(){$("body").on("click",".toggle-slider",(function(){$(this).closest("calcite-list-item").find(".opacity-div").toggle()}))})),v.when((function(){var e=$("#layerList");C(w.layers.items,e),$(".slider-opacity").on("calciteSliderChange",(function(e){console.log();const t=e.target.id;let r=w.findLayerById(t),i=e.target.value/100;r.opacity=i}))})),v.when((()=>{new a({view:v,container:$(".basemaps")[0],dragEnabled:!0}).visibleElements={statusIndicators:!0,baseLayers:!0,referenceLayers:!1,referenceLayersTitle:!1,errors:!0,heading:!1};let e={type:"simple",symbol:{type:"simple-fill",color:[255,255,255,0],outline:{width:1,color:`${m.parcelRenderer}`}}},t={type:"simple",symbol:{type:"simple-fill",color:[255,255,255,0],outline:{width:1,color:"#897044"}}};v.map.allLayers.forEach((e=>{"Parcel Boundaries"===e.title&&(originalRenderer=e.renderer)}));const r=["Aerial-Ortho 2023","Aerial-Ortho 2019","Aerial-Ortho 2016","Aerial-Ortho 2012"];v.map.allLayers.some((e=>r.includes(e.title)&&e.visible))&&v.map.allLayers.forEach((t=>{"Parcel Boundaries"===t.title&&(t.renderer=e)})),"yes"===sessionStorage.getItem("condos")?originalRenderer=_.renderer:originalRenderer=E.renderer;const n={};v.map.basemap.baseLayers.forEach((e=>{n[e.id]=e.visible})),i.watch((()=>v.map.basemap.baseLayers.map((e=>e.visible))),(()=>{!function(r,i){let n=r.find((e=>e.visible&&!i[e.id]));if(n)r.forEach((e=>{e!==n&&(e.visible=!1)})),n.title!==`${m.basemapTitle}`&&"Washington Basemap"!==n.title?"yes"===sessionStorage.getItem("condos")?_.renderer=e:E.renderer=e:v.map.allLayers.forEach((e=>{"Parcel Boundaries"===e.title&&(e.renderer=t)}));else{0===r.filter((e=>e.visible)).length&&r.forEach((e=>{e.visible=i[e.id]}))}r.forEach((e=>{i[e.id]=e.visible}))}(v.map.basemap.baseLayers,n)}))}));const K=()=>{let e;I=[],$("#suggestions").val("").html("");let t=p;if(t?.length<3||!t)q();else{let r;d?r=filterQuery:(r=x.createQuery(),r.where=`\n              Street_Name LIKE '%${t}%' OR \n              MBL LIKE '%${t}%' OR \n              Location LIKE '%${t}%' OR \n              Co_Owner LIKE '%${t}%' OR \n              Uniqueid LIKE '%${t}%' OR \n              Owner LIKE '%${t}%' OR\n              GIS_LINK LIKE '%${t}%'\n            `,r.returnGeometry=!1,r.returnHiddenFields=!0,r.outFields=["*"]),x.queryFeatures(r).then((i=>{if(i.features.length>0){e=i.features,"MISMATCH"===i.features[0].attributes.Match_Status&&"Condominium"===i.features[0].attributes.Parcel_Type&&(L=!0),e.forEach((function(e){const r=function(e,t){const r=t.attributes?.Location;return r.includes(e)}(t,e);""===e.attributes.Owner||"RESIDENT"===e.attributes.Owner&&!r||S(e)}));let n=null;d&&(o.where=filterQuery.where,n=!0);const o=function(e){let t;return"no"===sessionStorage.getItem("condos")?(t=E.createQuery(),t.where=e.where,t.returnDistinctValues=!1,t.returnGeometry=!0,t.outFields=["*"]):(t=_.createQuery(),t.where=e.where,t.returnDistinctValues=!1,t.returnGeometry=!0,t.outFields=["*"]),t}(r);B(p,n,o)}})).catch((e=>{console.error("Error querying for details:",e)}))}};function q(e,t){const r=function(e,t){let r,i=t.split("?")[0],n=[],o=-1!==t.indexOf("?")?t.split("?")[1]:"";if(""!==o){n=o.split("&");for(let t=n.length-1;t>=0;t-=1)r=n[t].split("=")[0],r===e&&n.splice(t,1);i=i+"?"+n.join("&")}return i}("uniqueid",window.location.href);window.history.pushState({path:r},"",r),"no"===sessionStorage.getItem("condos")?E.visible=!0:_.visible=!0,p="",$("#searchInput ul").remove(),$("#searchInput").val="",$("#results").empty(),$("#total-results").html("No Parcels Selected");document.getElementById("searchInput").value="",searchTerm="",I=[],secondList=[],zoomToObjectID="",d=!1,L=!1,$(".spinner-container").hide(),$("#dropdown").hide(),$("#suggestions").hide();F($(".action-btn").first().data("target")),document.getElementById("suggestions").innerHTML="",v.graphics.removeAll(),u=[]}let N;document.getElementById("searchInput").addEventListener("input",(function(e){e.preventDefault(),I=[],secondList=[],u=[],v.graphics.removeAll(),$("#suggestions").html(""),p=e.target.value.toUpperCase().replace(/&amp;/g,"&"),p.length>1?function(e){const t=["Street_Name","MBL","Location","Co_Owner","Uniqueid","Owner","GIS_LINK"];$("#searchInput ul").remove(),$("#suggestions").hide(),$("#dropdown").show();let r=`\n            Street_Name LIKE '%${e}%' OR \n            MBL LIKE '%${e}%' OR \n            Location LIKE '%${e}%' OR \n            Co_Owner LIKE '%${e}%' OR \n            Uniqueid LIKE '%${e}%' OR \n            Owner LIKE '%${e}%' OR\n            GIS_LINK LIKE '%${e}%'\n        `,i=T.createQuery();i.where=r,i.returnGeometry=!1,i.outFields=t;let n=new Set;T.queryFeatures(i).then((r=>{let i=document.getElementById("suggestions");i.innerHTML="",r.features.forEach((r=>{t.forEach((t=>{let o=r.attributes[t];if(o&&o.includes(e)&&!n.has(o)){let e=document.createElement("div");e.className="list-group-item",e.innerText=`${o}`,i.appendChild(e),n.add(o),i.style.display="block",e.addEventListener("click",(function(e){f=!0;let t=e.target.textContent;f&&(p=t.replace(/&amp;/g,"&"),K()),f=!1}))}}))}))}))}(p):$("#suggestions").hide()})),document.addEventListener("click",(function(e){"searchInput"!==e.target.id&&(document.getElementById("suggestions").style.display="none")})),l.addEventListener("click",(function(){q()})),document.getElementById("searchButton").addEventListener("click",(function(e){e.preventDefault(),clearTimeout(N),N=setTimeout((()=>{"no"===sessionStorage.getItem("condos")?E.visible=!0:_.visible=!0,$("dropdown").empty(),$("#total-results").show(),$("#ResultDiv").hide(),u=[],v.graphics.removeAll(),K()}),300)}));let D=null;function F(e){D===e&&$(e).is(":visible")?($("#closed").show(),$("#open").hide(),$(".content").hide(),$(".content > div").hide(),D=null):($("#open").show(),$("#closed").hide(),$(".content").show(),$(".content > div").hide(),$(e).show(),D=e)}$(".action-btn").click((function(){F($(this).data("target"))})),$("#action-exp").click((function(){if(D)F(D);else{F($(".action-btn").first().data("target"))}}))}))}));
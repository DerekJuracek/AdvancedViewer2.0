// @ts-nocheck
require(["esri/WebMap","esri/views/MapView","esri/layers/FeatureLayer","esri/core/reactiveUtils","esri/Graphic","esri/layers/GraphicsLayer","esri/widgets/BasemapLayerList","esri/widgets/Legend"],(function(e,t,r,n,s,i,o,a){const l=new URLSearchParams(window.location.search);let u=window.location.href,c=l.get("viewer");let d=["colebrookct","columbiact","durhamct","franklinct","haddamct","northcanaanct","roxburyct","roxburyctassessor","scotlandct","warrenct","warrenctassessor","washingtonct","wiltonct","wolcottct"].join("|"),m=new RegExp(`\\?viewer=cama\\/(${d})(\\&\\w+=[\\w-]+)*$`);null!=c&&m.test(u)?c+=".json":"https://terrenogis.com"===window.location.href||"https://terrenogis.com/"===window.location.href?window.location.href="https://www.qds.biz/gis-service":window.location.href="./onload.html";const g={mapId:"",condoLayer:"",title:"",isCondosLayer:"",noCondoLayer:""};fetch(c).then((e=>e.json())).then((n=>{g.mapId=n.webmapId||"6448b08504de4244973a28305b18271f",g.condoLayer=n.condoLayer,g.noCondoLayer=n.noCondoLayer,g.title=n.title,g.isCondosLayer=n.condos,g.masterTable=n.masterTable,g.zoom=n.zoom,g.parcelZoom=n.parcelZoom,g.imageUrl=n.imageUrl,g.welcomeImage=n.welcomeImage,g.pdf_Image=n.pdf_Image,g.pdf_demo=n.pdf_demographics,g.taxMap_Url=n.taxMapUrl,g.parcelMapUrl=n.parcelMapUrl,g.housingUrl=n.housingUrl,g.propertyCardPdf=n.propertyCardPdf,g.propertyCard=n.propertyCard,g.tax_bill=n.tax_bill,g.useVisionForTaxBillUrl=n.useVisionForTaxBillUrl,g.accessorName=n.accessorName,g.parcelTitle=n.parcelServiceTitle,g.tabTitle=n.tabTitle,g.basemapTitle=n.basemapTitle,g.parcelRenderer=n.parcelRenderer,g.useUniqueIdforParcelMap=n.useUniqueIdforParcelMap,g.helpUrl=n.helpUrl,g.includeFilter=n.includeFilter,g.customWelcomePage=n.customWelcomePage,g.customWelcomeMessage=n.customWelcomeMessage,g.showDisclaimer=n.showDisclaimer,g.customDisclaimerPage=n.customDisclaimerPage,g.customDisclaimerMessage=n.customDisclaimerMessage,g.DetailLinks=n.DetailLinks,g.DetailLinksToInclude=n.DetailLinksToInclude,g.includePermitLink=n.includePermitLink,g.scale=n.scale,$(".help-url").attr("href",g.helpUrl);const o=document.getElementById("clear-btn"),a=new i;let l,u,c,d=[];const m=new e({portalItem:{id:g.mapId},layers:[a]});var p=new t({container:"viewDiv",map:m,units:"imperial",scale:g.scale,popupEnabled:!1,ui:{components:["attribution"]}});p.when((()=>{g.homeExtent=p.extent}));const h=new r({url:`${g.noCondoLayer}`,visible:!1,popupEnabled:!0,title:"Parcel Boundaries",id:"noCondoLayer"}),f=new r({url:`${g.condoLayer}`,visible:!1,popupEnabled:!0,title:"Parcel Boundaries",id:"condoLayer"}),b=new r({url:`${g.masterTable}`}),y=new r({url:`${g.masterTable}`});function w(e){let t=e.attributes.OBJECTID,r=e.attributes.Location,n=e.attributes.Uniqueid,s=e.attributes.GIS_LINK,i=e.attributes.Co_Owner,o=e.attributes.Owner,a=e.attributes.MBL,l=e.geometry,u=e.attributes.Mailing_Address_1,c=e.attributes.Mailing_Address_2,m=e.attributes.Mailing_City,g=e.attributes.Mail_State,p=e.attributes.Mailing_Zip,h=e.attributes.Total_Acres,f=e.attributes.Parcel_Primary_Use,b=e.attributes.Building_Use_Code,y=e.attributes.Parcel_Type,w=e.attributes.Design_Type,L=e.attributes.Zoning,I=e.attributes.Neighborhood,_=e.attributes.Land_Type_Rate,E=e.attributes.Functional_Obs,T=e.attributes.External_Obs,$=e.attributes.Sale_Date,v=(O=new Date($),C=O.getDate(),O.getMonth()+1+"/"+C+"/"+O.getFullYear());var O,C;let S=e.attributes.Sale_Price,M=e.attributes.Vol_Page,F=e.attributes.Assessed_Total,K=e.attributes.Appraised_Total,G=e.attributes.Influence_Factor,D=e.attributes.Influence_Type,P=e.attributes.Land_Type,N=e.attributes.Prior_Assessment_Year,U=e.attributes.Prior_Assessed_Total,k=e.attributes.Prior_Appraised_Total,R=e.attributes.Map,B=e.attributes.Lat,x=e.attributes.Lon,q=e.attributes.Image_Path,A=e.attributes.AcctNum,H=e.attributes.Match_Status,Q=e.attributes.ACCOUNT_TYPE;d.push(new Parcel(t,r,n,s,i,o,a,l,u,c,m,g,p,h,f,b,y,w,L,I,_,E,T,v,S,M,F,K,G,D,P,N,U,k,R,B,x,q,A,H,Q))}let L;function I(e,t,r,n){let i,o;if(e.features.length>0&&(i=e.features[0].attributes.Owner),"RESIDENT"!=i||r){L=n?e:e.features;let i,l,c=[];var a={type:"simple-fill",color:[127,42,145,.4],outline:{color:[127,42,145,.8],width:2}};if(r){i=e.features[0].attributes.OBJECTID,l=L[0].attributes.GIS_LINK;const r=new s({geometry:L[0].geometry,symbol:a,id:i});if(c.push(r),countCondos=d.filter((e=>e.GIS_LINK===l)).length,o=p.graphics.some((e=>e.id===i)),o){const e=p.graphics.findIndex((e=>e.id===i));p.graphics.removeAt(e);const t=u.findIndex((e=>e.id===i));1===u.length?u.splice(0,1):u.splice(t,1),0===u.length&&(DetailsHandle||(DetailsHandle=p.on("click",handleDetailsClick)),clickHandle&&(clickHandle?.remove(),clickHandle=null),clickHandle=p.on("click",handleClick))}else t.addMany(c)}else if(n){L.filter((e=>e.geometry)).forEach((e=>{const t=e.attributes.OBJECTID,r=new s({geometry:e.geometry,symbol:a,id:t});c.push(r)})),c.length>=1&&t.addMany(c),p.goTo({target:u,zoom:18})}else{let e;if(regSearch=!0,L.map((function(t){if(i=t.attributes.OBJECTID,!t.geometry||n)return null;e=new s({geometry:t.geometry,symbol:a,id:i}),c.push(e)})).filter((e=>null!==e)),1==c.length){t.addMany(c);const e=L[0].geometry.extent,r=(e.center,2),n=e.expand(r);p.goTo({target:c,extent:n})}else if(t.addMany(c),c.length>0){const e=c.map((e=>e.geometry.extent)),t=3,r=e.reduce(((e,t)=>e.union(t)),e[0]).expand(t);p.goTo({target:r}).catch((e=>{console.error("Error zooming to extent:",e)}))}else console.warn("No graphics available to calculate extent.")}if(u||(u=c),r&&!o){let e=c[0].id;u=[...u,c[0]],removeFromList=e}regSearch&&(u=c),o=!1,regSearch=!1}else console.log("serach on resident not clicking")}function _(e,t,r){let n,s,i;"no"===sessionStorage.getItem("condos")?h.visible=!0:f.visible=!0,$(".spinner-container").show(),n=`\n          Street_Name LIKE '%${e}%' OR \n          MBL LIKE '%${e}%' OR \n          Location LIKE '%${e}%' OR \n          Co_Owner LIKE '%${e}%' OR \n          Uniqueid LIKE '%${e}%' OR \n          Owner LIKE '%${e}%' OR \n          GIS_LINK LIKE '%${e}%'\n      `,r?s=r:l&&(s=r,tableSearch=!0),"no"===sessionStorage.getItem("condos")?h.queryFeatures(s).then((function(o){if(i=o.features,o.features.length>=0)if(i=o.features,noCondosParcelGeom=o.features,triggerfromNoCondos){let r="",n="";const o=y.createQuery();o.where=s.where,o.returnGeometry=!1,o.outFields=["*"],y.queryFeatures(o).then((function(e){r=e.features;const t=e.features[0].attributes.GIS_LINK;let n=h.createQuery();return n.where=`GIS_LINK = '${t}'`,n.returnGeometry=!0,n.returnHiddenFields=!0,n.outFields=["*"],h.queryFeatures(n)})).then((function(s){i=s.features,n=s.features,noCondosParcelGeom=s.features,I(s,p.graphics,""),processFeatures(s.features),t&&setTimeout((()=>{triggerListGroup(r,n,e)}),200)})).catch((function(e){console.error("Error querying features: ",e)}))}else noCondosParcelGeom=o.features,I(o,p.graphics,""),processFeatures(o.features),t&&setTimeout((()=>{triggerListGroup(i,e)}),200),triggerfromNoCondos=!1;else if(1===o.features.length&&d.length>2){const r=y.createQuery();r.where=n,r.returnGeometry=!1,r.outFields=["*"],y.queryFeatures(r).then((function(r){I(r.features),processFeatures(),t&&setTimeout((()=>{triggerListGroup(i,e)}),200)}))}else{const e=y.createQuery();e.where=r.where,e.returnGeometry=!1,e.outFields=["*"],0==o.features.length&&y.queryFeatures(e).then((function(e){i=e.features,GISLINK=e.features[0].attributes.GIS_LINK;let r=e.features[0].attributes.Uniqueid;noCondosParcelGeom=e.features,I(e,p.graphics),processFeatures(e.features),t&&setTimeout((()=>{needToSearchGisLink=!0,triggerListGroup(i,r)}),200)}))}})):f.queryFeatures(s).then((function(e){if(i=e.features,e.features.length>0){const r=e.features[0].attributes.Uniqueid;I(e,p.graphics,""),t&&setTimeout((()=>{triggerListGroup(i,r)}),200)}processFeatures(e.features)}))}const E=()=>{let e;d=[],$("#suggestions").val("").html("");let t=c;if(t?.length<3&&!t)T();else{let r;l?r=filterQuery:(r=b.createQuery(),r.where=`\n              Street_Name LIKE '%${t}%' OR \n              MBL LIKE '%${t}%' OR \n              Location LIKE '%${t}%' OR \n              Co_Owner LIKE '%${t}%' OR \n              Uniqueid LIKE '%${t}%' OR \n              Owner LIKE '%${t}%' OR\n              GIS_LINK LIKE '%${t}%'\n            `,r.returnGeometry=!1,r.returnHiddenFields=!0,r.outFields=["*"]),b.queryFeatures(r).then((n=>{if(n.features.length>0){e=n.features,"MISMATCH"===n.features[0].attributes.Match_Status&&"Condominium"===n.features[0].attributes.Parcel_Type&&(triggerfromNoCondos=!0),e.forEach((function(e){const r=function(e,t){const r=t.attributes?.Location;return r.includes(e)}(t,e);""===e.attributes.Owner||"RESIDENT"===e.attributes.Owner&&!r||w(e)}));let s=null;l&&(i.where=filterQuery.where,s=!0);const i=function(e){let t;return"no"===sessionStorage.getItem("condos")?(t=h.createQuery(),t.where=e.where,t.returnDistinctValues=!1,t.returnGeometry=!0,t.outFields=["*"]):(t=f.createQuery(),t.where=e.where,t.returnDistinctValues=!1,t.returnGeometry=!0,t.outFields=["*"]),t}(r);_(c,s,i)}})).catch((e=>{console.error("Error querying for details:",e)}))}};function T(e,t){const r=function(e,t){let r,n=t.split("?")[0],s=[],i=-1!==t.indexOf("?")?t.split("?")[1]:"";if(""!==i){s=i.split("&");for(let t=s.length-1;t>=0;t-=1)r=s[t].split("=")[0],r===e&&s.splice(t,1);n=n+"?"+s.join("&")}return n}("uniqueid",window.location.href);window.history.pushState({path:r},"",r),"no"===sessionStorage.getItem("condos")?h.visible=!0:f.visible=!0,c="",$("#searchInput ul").remove(),$("#searchInput").val="";document.getElementById("searchInput").value="",searchTerm="",d=[],secondList=[],zoomToObjectID="",l=!1,triggerfromNoCondos=!1,$(".spinner-container").hide(),$("#dropdown").hide(),urlBackButton=!1,document.getElementById("suggestions").innerHTML="",p.graphics.removeAll(),u=[]}document.getElementById("searchInput").addEventListener("input",(function(e){d=[],secondList=[],u=[],p.graphics.removeAll(),$("#suggestions").html(""),c=e.target.value.toUpperCase().replace(/&amp;/g,"&"),function(e){const t=["Street_Name","MBL","Location","Co_Owner","Uniqueid","Owner","GIS_LINK"];$("#searchInput ul").remove(),$("#suggestions").hide(),$("#dropdown").show();let r=`\n            Street_Name LIKE '%${e}%' OR \n            MBL LIKE '%${e}%' OR \n            Location LIKE '%${e}%' OR \n            Co_Owner LIKE '%${e}%' OR \n            Uniqueid LIKE '%${e}%' OR \n            Owner LIKE '%${e}%' OR\n            GIS_LINK LIKE '%${e}%'\n        `,n=y.createQuery();n.where=r,n.returnGeometry=!1,n.outFields=t;let s=new Set;y.queryFeatures(n).then((r=>{let n=document.getElementById("suggestions");n.innerHTML="",r.features.forEach((r=>{t.forEach((t=>{let i=r.attributes[t];if(i&&i.includes(e)&&!s.has(i)){let e=document.createElement("div");e.className="list-group-item",e.innerText=`${i}`,n.appendChild(e),s.add(i),n.style.display="block",e.addEventListener("click",(function(e){clickedToggle=!0,E(e.target.innerHTML),clickedToggle=!1}))}}))}))}))}(c)})),document.addEventListener("click",(function(e){"searchInput"!==e.target.id&&(document.getElementById("suggestions").style.display="none")})),o.addEventListener("click",(function(){T()})),document.getElementById("searchButton").addEventListener("click",(function(e){e.preventDefault(),$("#results-div").css("left","0px"),clearTimeout(debounceTimer2),debounceTimer2=setTimeout((()=>{"no"===sessionStorage.getItem("condos")?h.visible=!0:f.visible=!0,$("dropdown").empty(),$("#total-results").show(),$("#ResultDiv").hide(),u=[],p.graphics.removeAll(),E()}),300)}))}))}));